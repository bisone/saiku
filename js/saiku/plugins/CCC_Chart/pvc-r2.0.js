var pvc=def.globalSpace("pvc",{debug:0});
(function(){function a(){if(pvc.debug&&typeof console!=="undefined")["log","info",["trace","debug"],"error","warn",["group","groupCollapsed"],"groupEnd"].forEach(function(f){f=f instanceof Array?f:[f,f];pvc._installLog(pvc,f[0],f[1],"[pvChart]")});else{if(pvc.debug>1)pvc.debug=1;["log","info","trace","warn","group","groupEnd"].forEach(function(f){pvc[f]=def.noop});pvc.error=function(f){if(f&&typeof f==="object"&&f.message)f=f.message;f=""+def.nullyTo(f,"");if(f.indexOf("[pvChart ERROR]: ")<0)f="[pvChart ERROR]: "+
f;throw new Error(f);}}}function b(){var f=pv.Behavior.tipsy;if(f&&f.setDebug){f.setDebug(pvc.debug);f.log=pvc.log}}function c(f,i){if(f){if(def.object.is(f))return f.abs;return i?i+def.firstUpperCase(f):f}return i}(function(){if(typeof window.location!=="undefined"){var f=window.location.href;if(f&&/\bdebug=true\b/.test(f)){f=/\bdebugLevel=(\d+)/.exec(f);pvc.debug=f?+f[1]:3}}})();pvc.invisibleFill="rgba(127,127,127,0.00001)";pvc.logSeparator="------------------------------------------";var d=pvc.arraySlice=
Array.prototype.slice;pvc.setDebug=function(f){f=+f;pvc.debug=isNaN(f)?0:f;a();b();return pvc.debug};pvc._installLog=function(f,i,l,m){l||(l=i);var n=console,o=n[l]||n.log,p;if(o){var q=m+": %s";if(def.fun.is(o))p=o.bind(console,q);else{var r=Function.prototype.apply;p=function(){r.call(o,n,def.array.append([q],arguments))}}}f[i]=p};a();pvc.logError=pvc.error;pv.error=pvc.error;b();pvc.defaultCompatVersion=function(f){var i=pvc.BaseChart.prototype.defaults;if(f!=null)return i.compatVersion=f;return i.compatVersion};
pvc.cloneMatrix=function(f){return f.map(function(i){return i.slice()})};pvc.stringify=function(f,i){var l=def.get(i,"maxLevel")||5,m=[];pvc.stringifyRecursive(m,f,l,i);return m.join("")};pvc.stringifyRecursive=function(f,i,l,m){if(l>0){l--;switch(typeof i){case "undefined":return f.push("undefined");case "object":if(!i){f.push("null");return true}if(def.fun.is(i.stringify))return i.stringify(f,l,m);if(i instanceof Array){f.push("[");i.forEach(function(q,r){r&&f.push(", ");pvc.stringifyRecursive(f,
q,l,m)||f.pop()});f.push("]")}else{var n=def.get(m,"ownOnly",true);if(i===def.global){f.push("<window>");return true}if(def.fun.is(i.cloneNode)){f.push("<dom #"+(i.id||i.name||"?")+">");return true}if(l>1&&i.constructor!==Object){l=1;n=true}f.push("{");var o=true;for(var p in i)if(!n||def.hasOwnProp.call(i,p)){o||f.push(", ");f.push(p+": ");if(pvc.stringifyRecursive(f,i[p],l,m)){if(o)o=false}else{f.pop();o||f.pop()}}if(o){i=""+i;i!=="[object Object]"&&f.push("{"+i+"}")}f.push("}")}return true;case "number":f.push(""+
Math.round(1E5*i)/1E5);return true;case "boolean":f.push(""+i);return true;case "string":f.push(JSON.stringify(i));return true;case "function":if(def.get(m,"funs",false)){f.push(JSON.stringify(i.toString().substr(0,13)+"..."));return true}return false}f.push("'new ???'");return true}};pvc.orientation={vertical:"vertical",horizontal:"horizontal"};pvc.extensionTag="extension";pvc.extendType=function(f,i,l){if(i){var m,n=function(o,p){if(o!==undefined){m||(m={});m[p]=def.fun.to(o)}};l?l.forEach(function(o){n(i[o],
o)}):def.each(n);m&&f.add(m)}};pv.Color.prototype.stringify=function(f,i,l){return pvc.stringifyRecursive(f,this.key,i,l)};pv.Mark.prototype.hasDelegateValue=function(f,i){var l=this.$propertiesMap[f];if(l)return!i||l.tag===i;if(this.proto)return this.proto.hasDelegateValue(f,i);return false};pvc.defaultColorScheme=null;pvc.brighterColorTransform=function(f){return(f.rgb?f:pv.color(f)).brighter(0.6)};pvc.setDefaultColorScheme=function(f){return pvc.defaultColorScheme=pvc.colorScheme(f)};pvc.defaultColor=
pv.Colors.category10()("?");pvc.colorScheme=function(f){if(f==null)return null;if(typeof f==="function"){if(!f.hasOwnProperty("range"))return f;f=f.range()}else f=def.array.as(f);if(!f.length)return null;return function(){var i=pv.colors(f);i.domain.apply(i,arguments);return i}};pvc.createColorScheme=function(f){return pvc.colorScheme(f)||pvc.defaultColorScheme||pv.Colors.category10};pvc.toGrayScale=function(f,i,l,m){f=pv.color(f);var n=0.299*f.r+0.587*f.g+0.114*f.b;if(l===undefined)l=200;else if(l==
null)l=255;if(m===undefined)m=30;else if(m==null)m=0;var o=l-m;n=o<=0?l:m+n/255*o;if(i==null)i=f.opacity;else if(i<0)i=-i*f.opacity;n=Math.round(n);return pv.rgb(n,n,n,i)};pvc.removeTipsyLegends=function(){try{$(".tipsy").remove()}catch(f){}};pvc.createDateComparer=function(f,i){if(!i)i=pv.identity;return function(l,m){return f.parse(i(l))-f.parse(i(m))}};pvc.time={intervals:{y:31536E6,m:2592E6,d30:2592E6,w:6048E5,d7:6048E5,d:864E5,h:36E5,M:6E4,s:1E3,ms:1},withoutTime:function(f){return new Date(f.getFullYear(),
f.getMonth(),f.getDate())},weekday:{previousOrSelf:function(f,i){if(i=f.getDay()-i)f=new Date(f-(i<0?7+i:i)*pvc.time.intervals.d);return f},nextOrSelf:function(f,i){if(i=f.getDay()-i)f=new Date(f+(i>0?7-i:-i)*pvc.time.intervals.d);return f},closestOrSelf:function(f,i){if(i=f.getDay()-i){var l=pvc.time.intervals.d,m=i>0?1:-1;i=Math.abs(i);f=i>=4?new Date(f.getTime()+m*(7-i)*l):new Date(f.getTime()-m*i*l)}return f}}};pv.Format.createParser=function(f){function i(l){return f.parse(l)}return i};pv.Format.createFormatter=
function(f){function i(l){return l!=null?f.format(l):""}return i};pvc.buildTitleFromName=function(f){return def.firstUpperCase(f).replace(/([a-z\d])([A-Z])/,"$1 $2")};pvc.buildIndexedId=function(f,i){if(i>0)return f+""+(i+1);return f};pvc.splitIndexedId=function(f){f=/^(.*?)(\d*)$/.exec(f);var i=null;if(f[2]){i=Number(f[2]);if(i<=1)i=1;else i--}return[f[1],i]};var e=[null];pvc.makeExtensionAbsId=function(f,i){if(!f)return i;return def.query(i||e).selectMany(function(l){return def.query(f).select(function(m){return c(m,
l)})}).where(def.truthy).array()};pvc.parseDistinctIndexArray=function(f,i){f=def.array.as(f);if(f==null)return null;if(i==null)i=Infinity;f=def.query(f).select(function(l){return+l}).where(function(l){return!isNaN(l)&&l>=0&&l<=i}).distinct().array();return f.length?f:null};pvc.parseLegendClickMode=function(f){f||(f="none");switch(f){case "toggleSelected":case "toggleVisible":case "none":break;default:pvc.debug>=2&&pvc.log("[Warning] Invalid 'legendClickMode' option value: '"+f+"'. Assuming 'none'.");
f="none";break}return f};pvc.parseShape=function(f){if(f)switch(f){case "square":case "circle":case "diamond":case "triangle":case "cross":case "bar":break;default:pvc.debug>=2&&pvc.log("[Warning] Invalid 'shape' option value: '"+f+"'.");f=null;break}return f};pvc.parseContinuousColorScaleType=function(f){if(f)switch(f){case "linear":case "normal":case "discrete":break;default:pvc.debug>=2&&pvc.log("[Warning] Invalid 'ScaleType' option value: '"+f+"'.");f=null;break}return f};pvc.parseDomainScope=
function(f,i){if(f)switch(f){case "cell":case "global":break;case "section":if(!i)throw def.error.argumentRequired("orientation");f=i==="y"?"row":"column";break;case "column":case "row":if(i&&i!==(f==="row"?"y":"x")){f="section";pvc.debug>=2&&pvc.log("[Warning] Invalid 'DomainScope' option value: '"+f+"' for the orientation: '"+i+"'.")}break;default:pvc.debug>=2&&pvc.log("[Warning] Invalid 'DomainScope' option value: '"+f+"'.");f=null;break}return f};pvc.parseDomainRoundingMode=function(f){if(f)switch(f){case "none":case "nice":case "tick":break;
default:pvc.debug>=2&&pvc.log("[Warning] Invalid 'DomainRoundMode' value: '"+f+"'.");f=null;break}return f};pvc.parseOverlappedLabelsMode=function(f){if(f)switch(f){case "leave":case "hide":break;default:pvc.debug>=2&&pvc.log("[Warning] Invalid 'OverlappedLabelsMode' option value: '"+f+"'.");f=null;break}return f};pvc.castNumber=function(f){if(f!=null){f=+f;if(isNaN(f))f=null}return f};pvc.parseWaterDirection=function(f){if(f){switch(f){case "up":case "down":return f}pvc.debug>=2&&pvc.log("[Warning] Invalid 'WaterDirection' value: '"+
f+"'.")}};pvc.parseTrendType=function(f){if(f){if(f==="none")return f;if(pvc.trends.has(f))return f;pvc.debug>=2&&pvc.log("[Warning] Invalid 'TrendType' value: '"+f+"'.")}};pvc.parseNullInterpolationMode=function(f){if(f){switch(f){case "none":case "linear":case "zero":return f}pvc.debug>=2&&pvc.log("[Warning] Invalid 'NullInterpolationMode' value: '"+f+"'.")}};pvc.parseAlign=function(f,i){var l;if(f==="left"||f==="right"){f=i&&pvc.BasePanel.verticalAlign[i];if(!f){f="middle";l=!!i}}else{f=i&&pvc.BasePanel.horizontalAlign[i];
if(!f){f="center";l=!!i}}l&&pvc.debug>=2&&pvc.log(def.format("Invalid alignment value '{0}'. Assuming '{1}'.",[i,f]));return f};pvc.parseAnchor=function(f){if(f){switch(f){case "top":case "left":case "center":case "bottom":case "right":return f}pvc.debug>=2&&pvc.log(def.format("Invalid anchor value '{0}'.",[f]))}};pvc.parseAnchorWedge=function(f){if(f){switch(f){case "outer":case "inner":case "center":case "start":case "end":return f}pvc.debug>=2&&pvc.log(def.format("Invalid wedge anchor value '{0}'.",
[f]))}};pvc.unionExtents=function(f,i){if(f){if(i){if(i.min<f.min)f.min=i.min;if(i.max>f.max)f.max=i.max}}else{if(!i)return null;f={min:i.min,max:i.max}}return f};pvc.Sides=function(f){f!=null&&this.setSides(f)};pvc.Sides.hnames="left right".split(" ");pvc.Sides.vnames="top bottom".split(" ");pvc.Sides.names="left right top bottom".split(" ");pvc.Sides.namesSet=pv.dict(pvc.Sides.names,def.retTrue);pvc.parsePosition=function(f,i){if(f&&!def.hasOwn(pvc.Sides.namesSet,f)){i||(i="left");pvc.debug>=2&&
pvc.log(def.format("Invalid position value '{0}. Assuming '{1}'.",[f,i]));f=i}return f};pvc.Sides.as=function(f){if(f!=null&&!(f instanceof pvc.Sides))f=(new pvc.Sides).setSides(f);return f};pvc.Sides.prototype.stringify=function(f,i,l){return pvc.stringifyRecursive(f,def.copyOwn(this),i,l)};pvc.Sides.prototype.setSides=function(f){if(typeof f==="string"){var i=f.split(/\s+/).map(function(l){return pvc.PercentValue.parse(l)});switch(i.length){case 1:this.set("all",i[0]);return this;case 2:this.set("top",
i[0]);this.set("left",i[1]);this.set("right",i[1]);this.set("bottom",i[0]);return this;case 3:this.set("top",i[0]);this.set("left",i[1]);this.set("right",i[1]);this.set("bottom",i[2]);return this;case 4:this.set("top",i[0]);this.set("right",i[1]);this.set("bottom",i[2]);this.set("left",i[3]);return this;case 0:return this}}else if(typeof f==="number"){this.set("all",f);return this}else if(typeof f==="object"){if(f instanceof pvc.PercentValue)this.set("all",f);else{this.set("all",f.all);for(i in f)i!==
"all"&&pvc.Sides.namesSet.hasOwnProperty(i)&&this.set(i,f[i])}return this}pvc.debug&&pvc.log("Invalid 'sides' value: "+pvc.stringify(f));return this};pvc.Sides.prototype.set=function(f,i){i=pvc.PercentValue.parse(i);if(i!=null)if(f==="all")pvc.Sides.names.forEach(function(l){this[l]=i},this);else if(def.hasOwn(pvc.Sides.namesSet,f))this[f]=i};pvc.Sides.prototype.resolve=function(f,i){if(typeof f==="object"){i=f.height;f=f.width}var l={};pvc.Sides.names.forEach(function(m){var n=0,o=this[m];if(o!=
null)n=typeof o==="number"?o:o.resolve(m==="left"||m==="right"?f:i);l[m]=n},this);return pvc.Sides.updateSize(l)};pvc.Sides.updateSize=function(f){f.width=(f.left||0)+(f.right||0);f.height=(f.bottom||0)+(f.top||0);return f};pvc.Sides.resolvedMax=function(f,i){var l={};pvc.Sides.names.forEach(function(m){l[m]=Math.max(f[m]||0,i[m]||0)});return l};pvc.Sides.inflate=function(f,i){var l={};pvc.Sides.names.forEach(function(m){l[m]=(f[m]||0)+i});return pvc.Sides.updateSize(l)};pvc.PercentValue=function(f){this.percent=
f};pvc.PercentValue.prototype.resolve=function(f){return this.percent*f};pvc.PercentValue.parse=function(f){if(f!=null&&f!==""){switch(typeof f){case "number":return f;case "string":var i=f.match(/^(.+?)\s*(%)?$/);if(i){var l=+i[1];if(!isNaN(l))if(i[2]){if(l>=0)return new pvc.PercentValue(l/100)}else return l}break;case "object":if(f instanceof pvc.PercentValue)return f;break}pvc.debug&&pvc.log(def.format("Invalid margins component '{0}'",[""+f]))}};pvc.PercentValue.resolve=function(f,i){return f instanceof
pvc.PercentValue?f.resolve(i):f};var h=pv.Mark.prototype.renderCore,g=pv.Mark.prototype.zOrder;pv.Mark.prototype.zOrder=function(f){var i=this.borderPanel;if(i&&i!==this)return g.call(i,f);return g.call(this,f)};pv.Mark.prototype.renderCore=function(){var f=this.root;f._renderId=(f._renderId||0)+1;pvc.debug>=25&&pvc.log("BEGIN RENDER "+f._renderId);h.apply(this,arguments);pvc.debug>=25&&pvc.log("END RENDER "+f._renderId)};pv.Mark.prototype.renderId=function(){return this.root._renderId};pv.Mark.prototype.wrapper=
function(f){this._wrapper=f;return this};pv.Mark.prototype.wrap=function(f,i){if(f&&def.fun.is(f)&&this._wrapper&&!f._cccWrapped){f=this._wrapper(f,i);f._cccWrapped=true}return f};pv.Mark.prototype.lock=function(f,i){i!==undefined&&this[f](i);(this._locked||(this._locked={}))[f]=true;return this};pv.Mark.prototype.isIntercepted=function(f){return this._intercepted&&this._intercepted[f]};pv.Mark.prototype.isLocked=function(f){return this._locked&&this._locked[f]};pv.Mark.prototype.addMargin=function(f,
i){if(i!==0){var l=def.nullyTo(this.propertyValue(f),0),m=pv.functor(l);this[f](function(){return i+m.apply(this,d.call(arguments))})}return this};pv.Mark.prototype.addMargins=function(f){var i=def.get(f,"all",0);this.addMargin("left",def.get(f,"left",i));this.addMargin("right",def.get(f,"right",i));this.addMargin("top",def.get(f,"top",i));this.addMargin("bottom",def.get(f,"bottom",i));return this};pv.Mark.prototype.eachInstanceWithData=function(f,i){this.eachInstance(function(l,m,n){l.mark.sign&&
l[m].data&&f.call(i,l,m,n)})};pv.Transform.prototype.transformHPosition=function(f){return this.x+this.k*f};pv.Transform.prototype.transformVPosition=function(f){return this.y+this.k*f};pv.Transform.prototype.transformLength=function(f){return this.k*f};var j=def.type("pvc.Size").init(function(f,i){if(arguments.length===1)f!=null&&this.setSize(f);else{if(f!=null)this.width=f;if(i!=null)this.height=i}}).add({stringify:function(f,i,l){return pvc.stringifyRecursive(f,def.copyOwn(this),i,l)},setSize:function(f,
i){if(typeof f==="string"){var l=f.split(/\s+/).map(function(m){return pvc.PercentValue.parse(m)});switch(l.length){case 1:this.set(def.get(i,"singleProp","all"),l[0]);return this;case 2:this.set("width",l[0]);this.set("height",l[1]);return this;case 0:return this}}else if(typeof f==="number"){this.set(def.get(i,"singleProp","all"),f);return this}else if(typeof f==="object"){if(f instanceof pvc.PercentValue)this.set(def.get(i,"singleProp","all"),f);else{this.set("all",f.all);for(l in f)l!=="all"&&
this.set(l,f[l])}return this}pvc.debug&&pvc.log("Invalid 'size' value: "+pvc.stringify(f));return this},set:function(f,i){if(i!=null&&(f==="all"||def.hasOwn(pvc.Size.namesSet,f))){i=pvc.PercentValue.parse(i);if(i!=null)if(f==="all")pvc.Size.names.forEach(function(l){this[l]=i},this);else this[f]=i}return this},clone:function(){return new j(this.width,this.height)},intersect:function(f){return new j(Math.min(this.width,f.width),Math.min(this.height,f.height))},resolve:function(f){var i={};pvc.Size.names.forEach(function(l){var m=
this[l];if(m!=null)if(typeof m==="number")i[l]=m;else if(f){var n=f[l];if(n!=null)i[l]=m.resolve(n)}},this);return i}});pvc.Size.names=["width","height"];pvc.Size.namesSet=pv.dict(pvc.Size.names,def.retTrue);pvc.Size.toOrtho=function(f,i){if(f!=null){var l;if(i)l=pvc.BasePanel.orthogonalLength[i];f=pvc.Size.to(f,{singleProp:l});i&&delete f[pvc.BasePanel.oppositeLength[l]]}return f};pvc.Size.to=function(f,i){if(f!=null&&!(f instanceof j))f=(new j).setSize(f,i);return f};var k=def.type("pvc.Offset").init(function(f,
i){if(arguments.length===1)f!=null&&this.setOffset(f);else{if(f!=null)this.x=f;if(i!=null)this.y=i}}).add({stringify:function(f,i,l){return pvc.stringifyRecursive(f,def.copyOwn(this),i,l)},setOffset:function(f,i){if(typeof f==="string"){var l=f.split(/\s+/).map(function(m){return pvc.PercentValue.parse(m)});switch(l.length){case 1:this.set(def.get(i,"singleProp","all"),l[0]);return this;case 2:this.set("x",l[0]);this.set("y",l[1]);return this;case 0:return this}}else if(typeof f==="number"){this.set(def.get(i,
"singleProp","all"),f);return this}else if(typeof f==="object"){this.set("all",f.all);for(l in f)l!=="all"&&this.set(l,f[l]);return this}pvc.debug&&pvc.log("Invalid 'offset' value: "+pvc.stringify(f));return this},set:function(f,i){if(i!=null&&def.hasOwn(pvc.Offset.namesSet,f)){i=pvc.PercentValue.parse(i);if(i!=null)if(f==="all")pvc.Offset.names.forEach(function(l){this[l]=i},this);else this[f]=i}},resolve:function(f){var i={};pvc.Size.names.forEach(function(l){var m=pvc.Offset.namesSizeToOffset[l],
n=this[m];if(n!=null)if(typeof n==="number")i[m]=n;else if(f){l=f[l];if(l!=null)i[m]=n.resolve(l)}},this);return i}});pvc.Offset.names=["x","y"];pvc.Offset.namesSet=pv.dict(pvc.Offset.names,def.retTrue);pvc.Offset.namesSizeToOffset={width:"x",height:"y"};pvc.Offset.namesSidesToOffset={left:"x",right:"x",top:"y",bottom:"y"};pvc.Offset.as=function(f){if(f!=null&&!(f instanceof k))f=(new k).setOffset(f);return f}})();
(function(a){a.support.svg=a.support.svg||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")})(jQuery);
pvc.text={getFitInfo:function(a,b,c,d,e){if(c==="")return{h:true,v:true,d:true};c=pv.Text.measure(c,d).width;return{h:c<=a,v:c<=b,d:c<=Math.sqrt(a*a+b*b)-e}},trimToWidthB:function(a,b,c,d,e){a-=pv.Text.measure(d,c).width;return pvc.text.trimToWidth(a,b,c,d,e)},trimToWidth:function(a,b,c,d,e){if(b==="")return b;var h=pv.Text.measure(b,c).width;if(h<=a)return b;if(h>a*1.5)return pvc.text.trimToWidthBin(a,b,c,d,e);for(;h>a;){b=e?b.slice(1):b.slice(0,b.length-1);h=pv.Text.measure(b,c).width}return e?
d+b:b+d},trimToWidthBin:function(a,b,c,d,e){for(var h=b.length,g=h-2,j=0,k,f;j<=g&&g>0;){k=Math.ceil((j+g)/2);var i=e?b.slice(h-k):b.slice(0,k);f=pv.Text.measure(i,c).width;if(f>a)g=k-1;else if(pv.Text.measure(e?b.slice(h-k-1):b.slice(0,k+1),c).width<a)j=k+1;else return e?d+i:i+d}return e?d+b.slice(h-g):b.slice(0,g)+d},justify:function(a,b,c){var d=[];if(b<pv.Text.measure("a",c).width)return d;a=(a||"").split(/\s+/);for(var e="";a.length;){var h=a.shift();if(h){var g=e?e+" "+h:h;if(pv.Text.measure(g,
c).width>b){e&&d.push(e);e=h}else e=g}}e&&d.push(e);return d},getLabelBBox:function(a,b,c,d,e,h){b=pv.Label.getPolygon(a,b,c,d,e,h);d=b.bbox();d.source=b;d.sourceAngle=e;d.sourceAlign=c;d.sourceTextWidth=a;return d}};
def.scope(function(){function a(d){d=pv.color(d);var e=d.r,h=d.g;d=d.b;var g=(e+h+d)/3;return Math.abs(e-g)<=2&&Math.abs(h-g)<=2&&Math.abs(d-g)<=2}function b(d){d||def.fail.argumentRequired("keyArgs");var e=d.type||def.fail.argumentRequired("keyArgs.type");switch(e){case "linear":return(new pvc.color.LinearScalesBuild(d)).buildMap();case "discrete":return(new pvc.color.DiscreteScalesBuild(d)).buildMap();case "normal":return(new pvc.color.NormalScalesBuild(d)).buildMap()}throw def.error.argumentInvalid("scaleType",
"Unexistent scale type '{0}'.",[e]);}function c(d){d||def.fail.argumentRequired("keyArgs");var e=d.type||def.fail.argumentRequired("keyArgs.type");switch(e){case "linear":return(new pvc.color.LinearScalesBuild(d)).build();case "discrete":return(new pvc.color.DiscreteScalesBuild(d)).build();case "normal":return(new pvc.color.NormalScalesBuild(d)).build()}throw def.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[e]);}pvc.color={scale:c,scales:b,toGray:pvc.toGrayScale,isGray:a};def.type("pvc.color.ScalesBuild").init(function(d){this.keyArgs=
d;this.data=d.data||def.fail.argumentRequired("keyArgs.data");this.domainDimName=d.colorDimension||def.fail.argumentRequired("keyArgs.colorDimension");this.domainDim=this.data.dimensions(this.domainDimName);var e=this.domainDim.type;if(e.isComparable)this.domainComparer=function(h,g){return e.compare(h,g)};else{this.domainComparer=null;pvc.log("Color value dimension should be comparable. Generated color scale may be invalid.")}this.nullRangeValue=d.colorMissing?pv.color(d.colorMissing):pv.Color.transparent;
this.domainRangeCountDif=0}).add({build:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;return this._createScale(this._getDomain())},buildMap:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var d;if(this.keyArgs.normPerBaseCategory)d=function(e){return this._createScale(this._ensureDomain(null,false,e))};else{d=this._createScale(this._getDomain());d=def.fun.constant(d)}return this._createCategoryScalesMap(d)},
_createScale:def.method({isAbstract:true}),_createCategoryScalesMap:function(d){return this.data.children().object({name:function(e){return e.absKey},value:d,context:this})},_getRange:function(){var d=this.keyArgs,e=d.colors||["red","yellow","green"];if(d.colorMin!=null&&d.colorMax!=null)e=[d.colorMin,d.colorMax];else if(d.colorMin!=null)e.unshift(d.colorMin);else d.colorMax!=null&&e.push(d.colorMax);return e.map(function(h){return pv.color(h)})},_getDataExtent:function(d){var e=d.dimensions(this.domainDimName).extent({visible:true});
if(!e)return null;d=e.min.value;e=e.max.value;if(e==d)if(e>=1)d=e-1;else e=d+1;return{min:d,max:e}},_getDomain:function(){var d=this.keyArgs.colorDomain;if(d!=null){this.domainComparer&&d.sort(this.domainComparer);if(d.length>this.desiredDomainCount)d=d.slice(0,this.desiredDomainCount)}else d=[];return this._ensureDomain(d,true,this.data)},_ensureDomain:function(d,e,h){var g;if(d&&e){e=this.desiredDomainCount-d.length;if(e>0)if(g=this._getDataExtent(h))switch(e){case 1:this.domainComparer?def.array.insert(d,
g.max,this.domainComparer):d.push(g.max);break;case 2:if(this.domainComparer){def.array.insert(d,g.min,this.domainComparer);def.array.insert(d,g.max,this.domainComparer)}else{d.unshift(g.min);d.push(g.max)}break;default:pvc.debug>=2&&pvc.log("Ignoring option 'colorDomain' due to unsupported length."+def.format(" Should have '{0}', but instead has '{1}'.",[this.desiredDomainCount,d.length]));d=null}}if(!d){g||(g=this._getDataExtent(h));if(g){d=g.min;g=g.max;h=(g-d)/(this.desiredDomainCount-1);d=pv.range(d,
g+h,h)}}return d}});def.type("pvc.color.LinearScalesBuild",pvc.color.ScalesBuild).add({_createScale:function(d){var e=pv.Scale.linear();d&&e.domain.apply(e,d);e.range.apply(e,this.range);return e}});def.type("pvc.color.DiscreteScalesBuild",pvc.color.ScalesBuild).init(function(d){this.base(d);this.domainRangeCountDif=1}).add({_createScale:function(d){function e(f){if(f==null)return j;for(var i=0;i<h;i++)if(f<=d[i+1])return g[i];return g[k]}var h=d.length-1,g=this.range,j=this.nullRangeValue,k=g.length-
1;def.copy(e,pv.Scale.common);e.domain=function(){return d};e.range=function(){return g};return e}})});
def.space("pvc.trends",function(a){var b={};def.set(a,"define",function(c,d){c||def.fail.argumentRequired("type");d||def.fail.argumentRequired("trendSpec");def.object.is(d)||def.fail.argumentInvalid("trendSpec","Must be a trend specification object.");pvc.debug>=2&&def.hasOwn(b,c)&&pvc.log(def.format("[WARNING] A trend type with the name '{0}' is already defined.",[c]));var e=d.label||def.fail.argumentRequired("trendSpec.label");d=d.model||def.fail.argumentRequired("trendSpec.model");def.fun.is(d)||
def.fail.argumentInvalid("trendSpec.mode","Must be a function.");b[c]={dataPartAtom:{v:"trend",f:e},type:c,label:e,model:d}},"get",function(c){c||def.fail.argumentRequired("type");return def.getOwn(b,c)||def.fail.operationInvalid("Undefined trend type '{0}'.",[c])},"has",function(c){return def.hasOwn(b,c)},"types",function(){return def.ownKeys(b)});a.define("linear",{label:"Linear trend",model:function(c){for(var d=def.get(c,"rows"),e=def.get(c,"x"),h=def.get(c,"y"),g=0,j=c=0,k=0,f=0,i=0,l=function(q){return q!=
null?+q:NaN};d.next();){var m=d.item,n=e?l(e(m)):g;if(!isNaN(n)){m=l(h(m));if(!isNaN(m)){c++;j+=n;k+=m;f+=n*m;i+=n*n}}g++}var o,p;if(c>=2){d=j/c;e=k/c;f=f/c;c=i/c-d*d;p=c===0?0:(f-d*e)/c;o=e-p*d;return{alpha:o,beta:p,reset:def.noop,sample:function(q){return o+p*+q}}}}});a.define("moving-average",{label:"Moving average",model:function(c){var d=Math.max(+(def.get(c,"periods")||3),2),e=0,h=[];return{reset:function(){e=0;h.length=0},sample:function(g,j){g=d;if(j!=null){h.unshift(j);e+=j;g=h.length;if(g>
d){e-=h.pop();g=d}}return e/g}}}});a.define("weighted-moving-average",{label:"Weighted Moving average",model:function(c){var d=Math.max(+(def.get(c,"periods")||3),2),e=0,h=0,g=[],j=0,k=0;return{reset:function(){e=h=k=j=0;g.length=0},sample:function(f,i){if(i!=null)if(j<d){g.push(i);j++;k+=j;h+=j*i;e+=i}else{h+=j*i-e;e+=i-g[0];for(f=1;f<d;f++)g[f-1]=g[f];g[d-1]=i}return h/k}}}})});
def.scope(function(){function a(g,j){function k(v){return(def.getOwn(r,v)||def.fail.operationInvalid("Undefined option '{0}'",[v])).resolve()}function f(v,t){v=k(v);return t&&!v.isSpecified?undefined:v.value}function i(v){return k(v).isSpecified}function l(v){return f(v,true)}function m(v){return def.hasOwn(r,v)}function n(v){return q(v,false)}function o(v){return q(v,true)}function p(v){return k(v)._defaultValue}function q(v,t){for(var u in v){var w=def.getOwn(r,u);if(w){var x=v[u];x!==undefined&&
w.set(x,t)}}return f}g||def.fail.argumentRequired("specs");var r={};def.each(g,function(v,t){v=new h(t,f,j,v);r[v.name]=v});f.option=f;f.specified=l;f.isSpecified=i;f.isDefined=m;f.defaultValue=p;f.specify=n;f.defaults=o;return f}function b(g){return function(j){for(var k=0,f=g.length;k<f;k++){var i=g[k];if(def.string.is(i))i=this[i];if(i.call(this,j)===true)return true}}}function c(g){return function(j){j.specify(g);return true}}function d(g){return function(j){var k=g.call(this,j);if(k!==undefined){j.specify(k);
return true}}}function e(g){return function(j){var k=g.call(this,j);if(k!==undefined){j.defaultValue(k);return true}}}a.resolvers=b;a.constant=c;a.specify=d;a.defaultValue=e;pvc.options=a;var h=def.type().init(function(g,j,k,f){this.name=g;this._context=k;this.option=j;this._cast=def.get(f,"cast");g=def.get(f,"value");if(g!==undefined)this._defaultValue=this.value=g;this.resolveCore=def.get(f,"resolve");if(!this.resolveCore)this.isResolved=true;if(g=def.get(f,"getDefault"))this._getDefault=g;g=def.get(f,
"data");if(g!=null)this.data=g;this.alias=def.array.to(def.get(f,"alias"))}).add({isSpecified:false,isResolved:false,value:undefined,_defaultValue:undefined,resolve:function(){if(!this.isResolved){this.isResolved=true;this._getFunProp("resolveCore").call(this._context,this);if(this.value==null){var g=this._getFunProp("_getDefault");if(g){g=this.cast(g.call(this._context,this));if(g!=null){delete this.isSpecified;this.value=this._defaultValue=g}}}}return this},specify:function(g){return this.set(g,
false)},defaultValue:function(g){g!==undefined&&this.set(g,true);return this._defaultValue},cast:function(g){if(g!=null){var j=this._getFunProp("_cast");if(j)g=j.call(this._context,g,this)}return g},dynDefault:function(){var g=this._getFunProp("_dynDefault");if(g)return this.cast(g.call(this._context,this))},set:function(g,j){if(g!=null)g=this.cast(g);if(g==null){g=this.dynDefault();if(g!=null)j=true}if(j){this._defaultValue=g;if(!this.isSpecified)this.value=g}else{this.isResolved=this.isSpecified=
true;this.value=g}return this},_getFunProp:function(g){if(g=this[g]){var j=this._context;if(j&&def.string.is(g))g=j[g]}return g}})});def.global.NoDataException=function(){};pvc.data={visibleKeyArgs:{visible:true}};function data_disposeChildList(a,b){if(a){a.forEach(function(c){if(b)c[b]=null;c.dispose()});a.length=0}}function data_addColChild(a,b,c,d,e){c&&!c[d]||def.assert("Must not have a '"+d+"'.");c[d]=a;a=a[b]||(a[b]=[]);e==null||e>=a.length?a.push(c):a.splice(e,0,c)}
function data_removeColChild(a,b,c,d){c&&(!c[d]||c[d]===a)||def.assert("Not a child");if(a=a[b]){b=a.indexOf(c);b>=0&&def.array.removeAt(a,b)}c[d]=null}
def.type("pvc.data.DimensionType").init(function(a,b,c){this.complexType=a;this.name=b;this.label=def.get(c,"label")||pvc.buildTitleFromName(b);a=pvc.splitIndexedId(b);this.group=a[0];this.groupLevel=def.nullyTo(a[1],0);if(this.label.indexOf("{")>=0)this.label=def.format(this.label,[this.groupLevel+1]);this.playedVisualRoles=new def.Map;this.isHidden=!!def.get(c,"isHidden");a=def.get(c,"valueType")||null;b=pvc.data.DimensionType.valueTypeName(a);var d=def.getOwn(pvc.data.DimensionType.cast,b,null);
this.valueType=a;this.valueTypeName=b;this.cast=d;this.isDiscreteValueType=this.valueType!==Number&&this.valueType!==Date;this.isDiscrete=def.get(c,"isDiscrete");if(this.isDiscrete==null)this.isDiscrete=this.isDiscreteValueType;else{this.isDiscrete=!!this.isDiscrete;if(!this.isDiscrete&&this.isDiscreteValueType)throw def.error.argumentInvalid("isDiscrete","The only supported continuous value types are Number and Date.");}this._converter=def.get(c,"converter")||null;if(!this._converter)if(a=def.get(c,
"rawFormat"))switch(this.valueType){case Date:this._converter=pv.Format.createParser(pv.Format.date(a));break}this._key=def.get(c,"key")||null;this._comparer=def.get(c,"comparer");if(this._comparer===undefined)switch(this.valueType){case Number:case Date:this._comparer=def.compare;break;default:this._comparer=null}this.isComparable=this._comparer!=null;this._formatter=def.get(c,"formatter")||null;if(!this._formatter)switch(this.valueType){case Number:this._formatter=pv.Format.createFormatter(pv.Format.number().fractionDigits(0,
2));break;case Date:a=def.get(c,"format");if(!a)if(a=def.get(c,"rawFormat"))a=a.replace(/-/g,"/");a||(a="%Y/%m/%d");this._formatter=pv.Format.createFormatter(pv.Format.date(a));break}}).add({isCalculated:false,compare:function(a,b){if(a==null){if(b==null)return 0;return-1}else if(b==null)return 1;return this._comparer.call(null,a,b)},comparer:function(a){if(!this.isComparable)return null;var b=this;if(a)return this._reverseComparer||(this._reverseComparer=function(c,d){return b.compare(d,c)});return this._directComparer||
(this._directComparer=function(c,d){return b.compare(c,d)})},atomComparer:function(a){if(a)return this._reverseAtomComparer||(this._reverseAtomComparer=this._createReverseAtomComparer());return this._directAtomComparer||(this._directAtomComparer=this._createDirectAtomComparer())},_toDiscrete:function(){this.isDiscrete=true},_toCalculated:function(){this.isCalculated=true},_createReverseAtomComparer:function(){function a(c,d){if(c===d)return 0;return b.compare(d.value,c.value)}if(!this.isComparable)return atom_idComparerReverse;
var b=this;return a},_createDirectAtomComparer:function(){function a(c,d){if(c===d)return 0;return b.compare(c.value,d.value)}if(!this.isComparable)return atom_idComparer;var b=this;return a},formatter:function(){return this._formatter},converter:function(){return this._converter},playingPercentVisualRole:function(){return def.query(this.playedVisualRoles.values()).any(function(a){return a.isPercent})}});
pvc.data.DimensionType.cast={Date:function(a){return a instanceof Date?a:new Date(a)},Number:function(a){a=Number(a);return isNaN(a)?null:a},String:String,Boolean:Boolean,Object:Object,Any:null};pvc.data.DimensionType.dimensionGroupName=function(a){return a.replace(/^(.*?)(\d*)$/,"$1")};
pvc.data.DimensionType.valueTypeName=function(a){if(a==null)return"Any";switch(a){case Boolean:return"Boolean";case Number:return"Number";case String:return"String";case Object:return"Object";case Date:return"Date";default:throw def.error.argumentInvalid("valueType","Invalid valueType function: '{0}'.",[a]);}};
pvc.data.DimensionType.extendSpec=function(a,b,c){a=pvc.data.DimensionType.dimensionGroupName(a);var d=def.get(c,"dimensionGroups");if(d)if(d=d[a])b=def.create(d,b);b||(b={});switch(a){case "category":if(def.get(c,"isCategoryTimeSeries",false))if(b.valueType===undefined)b.valueType=Date;break;case "value":if(b.valueType===undefined)b.valueType=Number;if(b.valueType===Number)if(b.formatter===undefined&&!b.format)b.formatter=def.get(c,"valueNumberFormatter");break}if(b.converter===undefined&&b.valueType===
Date&&!b.rawFormat)b.rawFormat=def.get(c,"timeSeriesFormat");return b};function dimType_addVisualRole(a){this.playedVisualRoles.set(a.name,a);compType_dimensionRolesChanged.call(this.type,this)}function dimType_removeVisualRole(a){this.playedVisualRoles.rem(a.name);compType_dimensionRolesChanged.call(this.type,this)}
def.type("pvc.data.ComplexType").init(function(a){this._dims={};this._dimsList=[];this._dimsNames=[];this._calculations=[];this._calculatedDimNames={};this._dimsIndexByName=null;this._dimsByGroup={};this._dimsNamesByGroup={};if(a)for(var b in a)this.addDimension(b,a[b])}).add({describe:function(){var a=["COMPLEX TYPE INFORMATION",pvc.logSeparator];this._dimsList.forEach(function(b){var c=[];c.push(b.valueTypeName);b.isComparable&&c.push("comparable");b.isDiscrete||c.push("continuous");b.isHidden&&
c.push("hidden");a.push("  "+b.name+" ("+c.join(", ")+")")});return a.join("\n")},dimensions:function(a,b){if(a==null)return this._dims;var c=def.getOwn(this._dims,a,null);if(!c&&def.get(b,"assertExists",true))throw def.error.argumentInvalid("name","Undefined dimension '{0}'",[a]);return c},dimensionsList:function(){return this._dimsList},calculatedDimensionsList:function(){return this._calcDimsList},dimensionsNames:function(){return this._dimsNames},groupDimensions:function(a,b){var c=def.getOwn(this._dimsByGroup,
a);if(!c&&def.get(b,"assertExists",true))throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[a]);return c},groupDimensionsNames:function(a,b){var c=def.getOwn(this._dimsNamesByGroup,a);if(!c&&def.get(b,"assertExists",true))throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[a]);return c},addDimension:function(a,b){a||def.fail.argumentRequired("name");!def.hasOwn(this._dims,a)||def.fail.operationInvalid("A dimension type with name '{0}' is already defined.",
[a]);b=new pvc.data.DimensionType(this,a,b);this._dims[a]=b;this._dimsIndexByName=null;var c=b.group,d;if(c){var e=def.getOwn(this._dimsByGroup,c);if(e)d=this._dimsNamesByGroup[c];else{e=this._dimsByGroup[c]=[];d=this._dimsNamesByGroup[c]=[]}d=def.array.insert(d,a,def.compare);d=~d;def.array.insertAt(e,d,b)}var h;e=this._dimsList.length;if(c){d=b.groupLevel;for(var g=0;g<e;g++){var j=this._dimsList[g];if(j.group===c){if(j.groupLevel>d){h=g;break}h=g+1}}if(h==null)h=e}else h=e;def.array.insertAt(this._dimsList,
h,b);def.array.insertAt(this._dimsNames,h,a);if(b._calculate){h=def.array.binarySearch(this._calcDimsList,b._calculationOrder,def.compare,function(k){return k._calculationOrder});if(h>=0)h++;else h=~h;def.array.insertAt(this._calcDimsList,h,b)}this._isPctRoleDimTypeMap=null;return b},addCalculation:function(a,b){a||def.fail.argumentRequired("calcSpec");var c=a.calculation||def.fail.argumentRequired("calculations[i].calculation");a=a.names;if((a=typeof a==="string"?a.split(/\s*\,\s*/):def.array.as(a))&&
a.length){var d=this._calculatedDimNames;a.forEach(function(e){if(e){e=e.replace(/^\s*(.+?)\s*$/,"$1");!def.hasOwn(d,e)||def.fail.argumentInvalid("calculations[i].names","Dimension name '{0}' is already being calculated.",[e]);var h=this._dims[e];if(!h){var g=pvc.data.DimensionType.extendSpec(e,null,b);this.addDimension(e,g)}d[e]=true;h._toCalculated()}},this)}this._calculations.push(c)},isCalculated:function(a){return def.hasOwn(this._calculatedDimNames,a)},_calculate:function(a){var b=this._calculations;
if(b.length){var c={};b.forEach(function(d){d(a,c)});return c}},getPlayingPercentVisualRoleDimensionMap:function(){var a=this._isPctRoleDimTypeMap;if(!a)a=this._isPctRoleDimTypeMap=new def.Map(def.query(def.own(this._dims)).where(function(b){return b.playingPercentVisualRole()}).object({name:function(b){return b.name}}));return a},sortDimensionNames:function(a,b){var c=this._dimsIndexByName;if(!c)this._dimsIndexByName=c=def.query(this._dimsList).object({name:function(d){return d.name},value:function(d,
e){return e}});a.sort(function(d,e){return def.compare(c[b?b(d):d],c[b?b(e):e])});return a}});function compType_dimensionRolesChanged(){this._isPctRoleDimTypeMap=null}
def.type("pvc.data.ComplexTypeProject").init(function(a){this._dims={};this._dimList=[];this._dimGroupsDims={};this._dimGroupSpecs=a||{};this._calcList=[]}).add({_ensureDim:function(a){a||def.fail.argumentInvalid("name","Invalid dimension name '{0}'.",[a]);var b=def.getOwn(this._dims,a);if(!b){b=this._dims[a]=this._createDim(a);this._dimList.push(b);var c=def.array.lazy(this._dimGroupsDims,b.groupName);def.array.insert(c,a,def.compare)}return b},hasDim:function(a){return def.hasOwn(this._dims,a)},
setDim:function(a,b){a=this._ensureDim(a).spec;b&&def.copy(a,b);return this},setDimDefaults:function(a,b){def.setUDefaults(this._ensureDim(a).spec,b);return this},_createDim:function(a,b){var c=pvc.data.DimensionType.dimensionGroupName(a),d=this._dimGroupSpecs[c];if(d)b=def.create(d,b);return{name:a,groupName:c,spec:b||{}}},readDim:function(a){var b=this._ensureDim(a);if(b.isRead)throw def.error.operationInvalid("Dimension '{0}' already is the target of a reader.",[a]);if(b.isCalc)throw def.error.operationInvalid("Dimension '{0}' is being calculated, so it cannot be the target of a reader.",
[a]);b.isRead=true},calcDim:function(a){var b=this._ensureDim(a);if(b.isCalc)throw def.error.operationInvalid("Dimension '{0}' already is being calculated.",[a]);if(b.isRead)throw def.error.operationInvalid("Dimension '{0}' is the target of a reader, so it cannot be calculated.",[a]);b.isCalc=true},isReadOrCalc:function(a){if(a)if(a=def.getOwn(this._dims,a))return a.isRead||a.isCalc;return false},groupDimensionsNames:function(a){return this._dimGroupsDims[a]},setCalc:function(a){a||def.fail.argumentRequired("calculations[i]");
a.calculation||def.fail.argumentRequired("calculations[i].calculation");var b=a.names;(b=typeof b==="string"?b.split(/\s*\,\s*/):def.array.as(b))&&b.length&&b.forEach(this.calcDim,this);this._calcList.push(a)},configureComplexType:function(a,b){this._dimList.forEach(function(c){var d=c.name;c=c.spec;c=pvc.data.DimensionType.extendSpec(d,c,b);a.addDimension(d,c)});this._calcList.forEach(function(c){a.addCalculation(c)})}});
def.type("pvc.data.TranslationOper").init(function(a,b,c,d,e){this.chart=a;this.complexTypeProj=b;this.source=c;this.metadata=d||{};this.options=e||{};this._initType();if(pvc.debug>=4){this._logItems=true;this._logItemCount=0}}).add({_logItems:false,logSource:def.method({isAbstract:true}),virtualItemSize:function(){return this.metadata.length},freeVirtualItemSize:function(){return this.virtualItemSize()-this._userUsedIndexesCount},defReader:function(a){a||def.fail.argumentRequired("readerSpec");var b;
b=typeof a==="string"?a:a.names;b=typeof b==="string"?b.split(/\s*\,\s*/):def.array.as(b);var c=def.array.as(a.indexes);c&&c.forEach(this._userUseIndex,this);var d=!!(b&&b.length);if(a=a.reader){d||def.fail.argumentRequired("reader.names","Required argument when a reader function is specified.");this._userRead(a,b)}else if(d)return this._userCreateReaders(b,c);return c},configureType:function(){this._configureTypeCore()},_configureTypeCore:def.method({isAbstract:true}),_initType:function(){this._userDimsReaders=
[];this._userDimsReadersByDim={};this._userItem=[];this._userUsedIndexes={};this._userUsedIndexesCount=0;var a=this.options.readers;a&&a.forEach(this.defReader,this);if(a=pvc.parseDistinctIndexArray(this.options.multiChartIndexes))this._multiChartIndexes=this.defReader({names:"multiChart",indexes:a})},_userUseIndex:function(a){a=+a;a>=0||def.fail.argumentInvalid("index","Invalid reader index: '{0}'.",[a]);!def.hasOwn(this._userUsedIndexes,a)||def.fail.argumentInvalid("index","Virtual item index '{0}' is already assigned.",
[a]);this._userUsedIndexes[a]=true;this._userUsedIndexesCount++;this._userItem[a]=true;return a},_userCreateReaders:function(a,b){if(b)b.forEach(function(j,k){b[k]=+j});else b=[];var c=b.length,d=a.length,e;if(d>c){e=c>0?b[c-1]+1:0;do{e=this._nextAvailableItemIndex(e);b[c]=e;this._userUseIndex(e);c++}while(d>c)}for(var h=c===d?d:d-1,g=0;g<h;g++){e=a[g];this._userRead(this._propGet(e,b[g]),e)}if(h<d){e=pvc.splitIndexedId(a[d-1]);a=e[0];d=def.nullyTo(e[1],0);for(h=h;h<c;h++,d++){e=pvc.buildIndexedId(a,
d);this._userRead(this._propGet(e,b[h]),e)}}return b},_userRead:function(a,b){def.fun.is(a)||def.fail.argumentInvalid("reader","Reader must be a function.");def.array.is(b)?b.forEach(function(c){this._readDim(c,a)},this):this._readDim(b,a);this._userDimsReaders.push(a)},_readDim:function(a,b){this.complexTypeProj.readDim(a);this._userDimsReadersByDim[a]=b},execute:function(a){this.data=a;return this._executeCore()},_executeCore:function(){var a=this._getDimensionsReaders();return def.query(this._getItems()).select(function(b){return this._readItem(b,
a)},this)},_getItems:function(){return this.source},_getDimensionsReaders:function(){return this._userDimsReaders},_readItem:function(a,b){var c=this._logItems;if(c)if(this._logItemCount<10){pvc.log("virtual item ["+this._logItemCount+"]: "+pvc.stringify(a));this._logItemCount++}else{pvc.log("...");c=this._logItems=false}for(var d=0,e=b.length,h=this.data,g={};d<e;)b[d++].call(h,a,g);if(c){a={};for(var j in g){b=g[j];if(def.object.is(b))b="v"in b?b.v:"value"in b?b.value:"...";a[j]=b}pvc.log("-> read: "+
pvc.stringify(a))}return g},_propGet:function(a,b){function c(d,e){e[a]=d[b]}return c},_constGet:function(a,b){function c(h,g){g[a]=e||(e=d.data.dimensions(a).intern(b))}var d=this,e;return c},_nextAvailableItemIndex:function(a,b){if(a==null)a=0;if(b==null)b=Infinity;for(;a<b&&def.hasOwn(this._userItem,a);)a++;return a<b?a:-1},_getUnboundRoleDefaultDimNames:function(a,b,c,d){if((a=this.chart.visualRoles(a,{assertExists:false}))&&!a.isPreBound())if(a=a.defaultDimensionName){a=a.match(/^(.*?)(\*)?$/)[1];
c||(c=[]);if(d==null)d=0;if(b==null)b=1;for(;b--;){var e=pvc.buildIndexedId(a,d++);this.complexTypeProj.isReadOrCalc(e)||c.push(e)}return c.length?c:null}}});
def.type("pvc.data.MatrixTranslationOper",pvc.data.TranslationOper).add({_initType:function(){this.J=this.metadata.length;this.I=this.source.length;this._processMetadata();this.base()},_knownContinuousColTypes:{numeric:1,number:1,integer:1},_processMetadata:function(){for(var a=this._knownContinuousColTypes,b=def.query(this.metadata).select(function(l,m){l.colIndex=m;return l}).where(function(l){l=l.colType;return!l||a[l.toLowerCase()]!==1}).select(function(l){return l.colIndex}).array(),c=def.array.create(this.J,
1),d=this.I,e=this.source,h=b.length,g=0;g<d&&h>0;g++)for(var j=e[g],k=0;k<h;){var f=b[k],i=j[f];if(i!=null){c[f]=this._getSourceValueType(i);b.splice(k,1);h--}else k++}this._columnTypes=c},_getSourceValueType:function(a){switch(typeof a){case "number":return 1;case "object":if(a instanceof Date)return 1}return 0},logSource:function(){var a=["DATA SOURCE SUMMARY",pvc.logSeparator,"ROWS ("+Math.min(10,this.I)+"/"+this.I+")"];def.query(this.source).take(10).each(function(c,d){a.push("  ["+d+"] "+pvc.stringify(c))});
this.I>10&&a.push("  ...");a.push("COLS ("+this.J+")");var b=this._columnTypes;this.metadata.forEach(function(c,d){a.push("  ["+d+"] '"+c.colName+"' (type: "+c.colType+", inspected: "+(b[d]?"continuous":"discrete")+(c.colLabel?", label: '"+c.colLabel+"'":"")+")")});pvc.log(a.join("\n"))},_createPlot2SeriesKeySet:function(a,b){var c=null,d=b.length;def.query(a).each(function(e){var h=+e;if(isNaN(h))throw def.error.argumentInvalid("plot2SeriesIndexes","Element is not a number '{0}'.",[e]);if(h<0){if(h<=
-d)throw def.error.argumentInvalid("plot2SeriesIndexes","Index is out of range '{0}'.",[h]);h=d+h}else if(h>=d)throw def.error.argumentInvalid("plot2SeriesIndexes","Index is out of range '{0}'.",[h]);c||(c={});c[b[h]]=true});return c},_dataPartGet:function(a,b){function c(i,l){if(!h){g=a();h=d.data.dimensions(e);pvc.debug>=3&&g&&pvc.log("Second axis series values: "+pvc.stringify(def.keys(g)))}b(i,f);i=f.series;if(i!=null&&i.v!=null)i=i.v;i=def.hasOwn(g,i)?k||(k=h.intern("1")):j||(j=h.intern("0"));
l[e]=i}var d=this,e=this.options.dataPartDimName,h,g,j,k,f={};return c}});
def.type("pvc.data.CrosstabTranslationOper",pvc.data.MatrixTranslationOper).add({virtualItemSize:function(){return this.R+this.C+this.M},_executeCore:function(){function a(j,k){var f=h[j],i=0;for(j=g[j];j-- >0;)e[f++]=k[i++]}function b(j,k){var f=h.M;k=g._colGroupsIndexes[k];for(var i=g.M,l=0;l<i;l++){var m=k[l];e[f++]=m!=null?j[m]:null}}function c(j){a("R",j);return def.query(this._colGroups).select(function(k,f){a("C",k);b(j,f);return this._readItem(e,d)},this)}if(!this.metadata.length)return def.query();
var d=this._getDimensionsReaders(),e=new Array(this.virtualItemSize()),h=this._itemCrossGroupIndex,g=this;return def.query(this._lines).selectMany(c,this)},_processMetadata:function(){this.base();this._separator=this.options.separator||"~";this._lines=pvc.cloneMatrix(this.source);this.M=this.C=this.R=1;this.measuresDirection=null;var a;a=this.options.seriesInRows?this.metadata.map(function(e){return e.colName}):this.options.compatVersion<=1?this.metadata.map(function(e){return{v:e.colName}}):this.metadata.map(function(e){return{v:e.colName,
f:e.colLabel}});var b=this._itemCrossGroupTypes={};if(this.options.isMultiValued){var c=def.get(this.options,"measuresInColumns",true);if(c||this.options.measuresIndex==null){this.R=this._getCategoriesCount();a=a.slice(this.R);if(a.length>0){if(c){this.measuresDirection="columns";this._processEncodedColGroups(a)}else{this._colGroups=a;this._colGroupsIndexes=[];this._colGroups.forEach(function(e,h){this._colGroups[h]=this._splitEncodedColGroupCell(e);this._colGroupsIndexes[h]=[this.R+h]},this);b.M=
[this._columnTypes[this.R]]}this.C=this._colGroups[0].length;b.C=def.array.create(this.C,0)}else{this.C=this.M=0;b.M=b.C=[]}}else{this.measuresDirection="rows";this.R=+this.options.measuresIndex;c=this.options.measuresCount;if(c==null)c=1;this.M=c;this._colGroups=a.slice(this.R+1);this._colGroups.forEach(function(e,h){this._colGroups[h]=[e]},this)}}else{this.R=this._getCategoriesCount();this._colGroups=a.slice(this.R);this._colGroupsIndexes=new Array(this._colGroups.length);this._colGroups.forEach(function(e,
h){this._colGroups[h]=[e];this._colGroupsIndexes[h]=[this.R+h]},this);b.C=[0];b.M=[this._columnTypes[this.R]]}b.R=this._columnTypes.slice(0,this.R);a=this.options.seriesInRows;c=this._itemCrossGroupIndex={C:!a?0:this.R,R:!a?this.C:0,M:this.C+this.R};var d=this._itemTypes=new Array(this.virtualItemSize());def.eachOwn(c,function(e,h){b[h].forEach(function(g,j){d[e+j]=g})});this._itemLogicalGroup={series:a?this.R:this.C,category:a?this.C:this.R,value:this.M};this._itemLogicalGroupIndex={series:0,category:this._itemLogicalGroup.series,
value:this.C+this.R};pvc.debug>=3&&pvc.log("Crosstab translator "+pvc.stringify({R:this.R,C:this.C,M:this.M}))},_getCategoriesCount:function(){var a=this.options.categoriesCount;if(a!=null&&(!isFinite(a)||a<0))a=null;if(a==null)(a=def.query(this._columnTypes).whayl(function(b){return b===0}).count())||(a=1);return a},_splitEncodedColGroupCell:function(a){var b=a.v,c;if(b==null)b=[];else{b=b.split(this._separator);if(c=a.f)c=c.split(this._separator)}return b.map(function(d,e){return{v:d,f:c&&c[e]}})},
_processEncodedColGroups:function(a){for(var b=a.length||def.assert("Must have columns"),c=this.R,d=[],e,h={},g=[],j=0;j<b;j++){var k=a[j],f=k.v,i=k.f,l=f.lastIndexOf(this._separator),m,n;if(l<0){k=f;f="";m=[]}else{k=f.substring(l+1);f=f.substring(0,l);m=f.split(this._separator);if(i!=null){n=i.split(this._separator);n.pop()}m.forEach(function(v,t){m[t]={v:v,f:n&&n[t]}})}if(!e||e.encValues!==f){e={startIndex:j,encValues:f,values:m,measureNames:[k]};d.push(e)}else e.measureNames.push(k);f=j-e.startIndex;
if(i=def.getOwn(h,k)){if(f>i.groupIndex)i.groupIndex=f}else{h[k]=i={name:k,groupIndex:f,index:j,type:this._columnTypes[c+j]};g.push(i)}}g.sort(function(v,t){return def.compare(v.groupIndex,t.groupIndex)||def.compare(v.index,t.index)});var o=g.length,p=new Array(o);this._itemCrossGroupTypes.M=p;g.forEach(function(v,t){v.groupIndex=t;p[t]=v.type});a=d.length;var q=new Array(a),r=new Array(a);d.map(function(v,t){q[t]=v.values;var u=v.startIndex,w=r[t]=new Array(o);v.measureNames.forEach(function(x,s){w[h[x].groupIndex]=
c+u+s})});this._colGroups=q;this._colGroupsIndexes=r;this.M=o},configureType:function(){if(this.measuresDirection==="rows")throw def.error.notImplemented();this.base()},_configureTypeCore:function(){function a(f,i,l){for(var m=d[f]+l;l>0;){var n=pvc.buildIndexedId(f,i);if(!b.complexTypeProj.isReadOrCalc(n)){e=b._nextAvailableItemIndex(e);if(e>=m)return;h.push({names:n,indexes:e});e++;l--}i++}}var b=this,c=b._itemLogicalGroup,d=b._itemLogicalGroupIndex,e=0,h=[],g=this.options.dataPartDimName;if(g&&
this.C===1&&!this.complexTypeProj.isReadOrCalc(g)){var j=this.options.plot2SeriesIndexes;if(j!=null){var k=this._colGroups.map(function(f){return""+f[0].v});this._plot2SeriesKeySet=this._createPlot2SeriesKeySet(j,k)}}["series","category","value"].forEach(function(f){var i=c[f];i>0&&a(f,0,i)});h&&h.forEach(this.defReader,this);if(this._plot2SeriesKeySet)(j=this._userDimsReadersByDim.series)&&this._userRead(this._dataPartGet(def.fun.constant(this._plot2SeriesKeySet),j),g)}});
def.type("pvc.data.RelationalTranslationOper",pvc.data.MatrixTranslationOper).add({M:0,C:0,S:0,_processMetadata:function(){this.base();var a=this.metadata,b=this.J,c=this.options.categoriesCount;if(c!=null&&(!isFinite(c)||c<0))c=0;var d,e,h;if(this.options.isMultiValued)h=(e=pvc.parseDistinctIndexArray(this.options.measuresIndexes,b-1))?e.length:0;var g;if(h==null)if(b>0&&b<=3&&(c==null||c===1)&&d==null){h=1;e=[b-1];c=b>=2?1:0;d=b>=3?1:0;g=c+d}else if(c!=null&&c>=b){c=g=b;h=d=0}else{h=c!=null?b-c:
Infinity;e=def.query(a).where(function(m,n){return this._columnTypes[n]!==0},this).select(function(m){return m.colIndex}).take(h).array();h=e.length}if(g==null){g=b-h;if(g===0)d=c=0;else if(c!=null)if(c>g){c=g;d=0}else d=g-c;else{d=g>1?1:0;c=g-d}}a=this.options.seriesInRows;var j=[];if(g){d&&!a&&j.push({name:"S",count:d});c&&j.push({name:"C",count:c});d&&a&&j.push({name:"S",count:d})}h&&j.push({name:"M",count:h});var k=def.range(0,b).array();e&&e.forEach(function(m){k.splice(m,1)});var f={};j.forEach(function(m){var n=
m.count,o=m.name;f[o]=m;m.indexes=e&&o==="M"?e:k.splice(0,n)},this);this.M=h;this.S=d;this.C=c;var i=[];["S","C","M"].forEach(function(m){(m=f[m])&&def.array.append(i,m.indexes)});var l=this._columnTypes;this._itemTypes=i.map(function(m){return l[m]});this._itemCrossGroupIndex={S:0,C:this.S,M:this.S+this.C};this._itemPerm=i;if(pvc.debug>=3){b=["RELATIONAL TRANSLATOR MAPPING",pvc.logSeparator,"["+j.map(function(m){return def.array.create(m.count,m.name).join("")}).join(" ")+"]"];pvc.log(b.join("\n"))}},
_configureTypeCore:function(){function a(j,k,f,i){for(k=b._itemCrossGroupIndex[k]+i;i>0;){var l=pvc.buildIndexedId(j,f);if(!b.complexTypeProj.isReadOrCalc(l)){c=b._nextAvailableItemIndex(c);if(c>=k)return;d.push({names:l,indexes:c});c++;i--}f++}}var b=this,c=0,d=[];this.S>0&&a("series","S",0,this.S);this.C>0&&a("category","C",0,this.C);this.M>0&&a("value","M",0,this.M);d&&d.forEach(this.defReader,this);var e=this.options.plot2SeriesIndexes;if(e!=null){var h=this._userDimsReadersByDim.series;if(h){var g=
this.options.dataPartDimName;this._userRead(relTransl_dataPartGet.call(this,e,h),g)}}},_executeCore:function(){var a=this._getDimensionsReaders(),b=this._itemPerm;return def.query(this._getItems()).select(function(c){c=pv.permute(c,b);return this._readItem(c,a)},this)}});
function relTransl_dataPartGet(a,b){function c(){var e={},h=def.query(d.source).select(function(g){b(g,e);g=e.series;if(g!=null&&g.v!=null)g=g.v;return g||null}).distinct().array();return d._createPlot2SeriesKeySet(a,h)}var d=this;return this._dataPartGet(c,b)}
def.type("pvc.data.Atom").init(function(a,b,c,d,e){this.dimension=a;this.id=b==null?-def.nextId():def.nextId();this.value=b;this.label=c;if(d!==undefined)this.rawValue=d;this.key=e}).add({isVirtual:false,rawValue:undefined,toString:function(){var a=this.label;if(a!=null)return a;a=this.value;return a!=null?""+a:""}});function atom_idComparer(a,b){return a.id-b.id}function atom_idComparerReverse(a,b){return b.id-a.id}var complex_nextId=1;
def.type("pvc.data.Complex").init(function(a,b,c,d,e,h){this.id=complex_nextId++;var g;if(a){g=a.owner;if(!d)d=a.atoms}this.owner=g||this;this.atoms=d?Object.create(d):{};var j=!!c;if(!c)c=g.type._dimsNames;var k=this.atoms;a=c.length;var f;if(b){var i=g._dimensions,l=function(o,p){var q=def.getOwn(i,o);if(p!=null){p=q.intern(p);if(!d||p!==d[o])k[o]=p}else q.intern(null)};if(j)for(j=0;j<a;j++){f=c[j];l(f,b[f])}else for(f in b)l(f,b[f]);if(h){j=g.type._calculate(this);for(f in j)def.hasOwnProp.call(k,
f)||l(f,j[f])}}if(a)if(a===1){c=k[c[0]];this.value=c.value;this.rawValue=c.rawValue;this.key=c.key;if(e)this.label=c.label}else{var m,n;b=g.labelSep;g=g.keySep;for(j=0;j<a;j++){f=c[j];f=k[f];if(j)m+=g+f.key;else m=f.key;if(e)if(f=f.label)if(n)n+=b+f;else n=f}this.value=this.rawValue=this.key=m;if(e)this.label=n}else{this.value=null;this.key="";if(e)this.label=""}}).add({labelSep:" ~ ",keySep:",",label:null,rawValue:undefined,ensureLabel:function(){var a=this.label;if(a!=null){a="";var b=this.owner.labelSep;
def.eachOwn(this.atoms,function(c){if(c=c.label)if(a)a+=b+c;else a=c});this.label=a}return a},view:function(a){return new pvc.data.ComplexView(this,a)},toString:function(){var a=[""+this.constructor.typeName];this.index!=null&&a.push("#"+this.index);this.owner.type.dimensionsNames().forEach(function(b){a.push(b+": "+pvc.stringify(this.atoms[b].value))},this);return a.join(" ")}});pvc.data.Complex.values=function(a,b){var c=a.atoms;return b.map(function(d){return c[d].value})};
pvc.data.Complex.labels=function(a,b){var c=a.atoms;return b.map(function(d){return c[d].label})};def.type("pvc.data.ComplexView",pvc.data.Complex).init(function(a,b){this.source=a;this.viewDimNames=b;var c=a.atoms,d=[];b.forEach(function(e){if(def.hasOwnProp.call(c,e))d[e]=c[e]});this.base(a,d,b,a.owner.atoms,true)}).add({values:function(){return pvc.data.Complex.values(this,this.viewDimNames)},labels:function(){return pvc.data.Complex.labels(this,this.viewDimNames)}});
def.type("pvc.data.Datum",pvc.data.Complex).init(function(a,b,c){this.base(a,b,null,null,false,!c);if(c)this.isNull=true}).add({isSelected:false,isVisible:true,isNull:false,isVirtual:false,isTrend:false,trendType:null,isInterpolated:false,interpolation:null,setSelected:function(a){if(this.isNull)return false;a=a==null||!!a;var b=this.isSelected!==a;if(b){if(a)this.isSelected=true;else delete this.isSelected;data_onDatumSelectedChanged.call(this.owner,this,a)}return b},toggleSelected:function(){return this.setSelected(!this.isSelected)},
setVisible:function(a){if(this.isNull)return false;a=a==null||!!a;var b=this.isVisible!==a;if(b){this.isVisible=a;data_onDatumVisibleChanged.call(this.owner,this,a)}return b},toggleVisible:function(){return this.setVisible(!this.isVisible)}});function datum_deselect(){delete this.isSelected}
def.type("pvc.data.Dimension").init(function(a,b){this.data=a;this.type=b;this.root=this;this.owner=this;var c=b.name;this.name=c;this._atomComparer=b.atomComparer();this._atomsByKey={};if(a.isOwner()){this._atoms=[];dim_createVirtualNullAtom.call(this)}else{b=a.parent;var d;if(b){d=b._dimensions[c];dim_addChild.call(d,this);this.root=a.parent.root}else{(b=a.linkParent)||def.assert("Data must have a linkParent");d=b._dimensions[c];dim_addLinkChild.call(d,this)}this._nullAtom=this.owner._nullAtom;
this._lazyInit=function(){this._lazyInit=null;for(var e=this.data._datums,h=e.length,g=this._atomsByKey,j=0;j<h;j++){var k=e[j].atoms[c];g[k.key]=k}this._atoms=d.atoms().filter(function(f){return def.hasOwnProp.call(g,f.key)})}}}).add({parent:null,linkParent:null,_children:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:false,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){this._lazyInit&&
this._lazyInit();return this._atoms.length},isVisible:function(a){this._lazyInit&&this._lazyInit();def.hasOwn(this._atomsByKey,a.key)||def.assert("Atom must exist in this dimension.");return dim_getVisibleDatumsCountMap.call(this)[a.key]>0},atoms:function(a){this._lazyInit&&this._lazyInit();a=def.get(a,"visible");if(a==null)return this._atoms;a=!!a;this._visibleAtoms||(this._visibleAtoms={});return this._visibleAtoms[a]||(this._visibleAtoms[a]=dim_calcVisibleAtoms.call(this,a))},indexes:function(a){this._lazyInit&&
this._lazyInit();a=def.get(a,"visible");if(a==null)return pv.range(0,this._atoms.length);a=!!a;this._visibleIndexes||(this._visibleIndexes={});return this._visibleIndexes[a]||(this._visibleIndexes[a]=dim_calcVisibleIndexes.call(this,a))},atom:function(a){if(a==null||a==="")return this._nullAtom;if(a instanceof pvc.data.Atom)return a;this._lazyInit&&this._lazyInit();return this._atomsByKey[this.type._key?this.type._key.call(null,a):a]||null},extent:function(a){var b=this.atoms(a),c=b.length;if(c){var d=
this._nullAtom&&b[0].value==null?1:0,e=c-d;if(e>0){d=b[d];c=b[c-1];if(d!==c&&def.get(a,"abs",false)){a=c.value<0?-1:1;if((d.value<0?-1:1)===a){if(a<0){b=c;c=d;d=b}}else if(e>2){if(c.value<-d.value)c=d;d=def.array.binarySearch(b,0,this.type.comparer(),function(h){return h.value});if(d<0){d=~d;e=b[d-1];b=b[d];d=-e.value<b.value?e:b}else d=b[d]}else if(c.value<-d.value){b=c;c=d;d=b}}return{min:d,max:c}}}},min:function(a){a=this.atoms(a);var b=a.length;if(b){var c=this._nullAtom&&a[0].value==null?1:0;
return b>c?a[c]:undefined}},max:function(a){a=this.atoms(a);var b=a.length;return b&&a[b-1].value!=null?a[b-1]:undefined},sum:function(a){var b=!!def.get(a,"abs",false),c=def.get(a,"zeroIfNone",true),d=dim_buildDatumsFilterKey(a)+":"+b,e=def.getOwn(this._sumCache,d);if(e===undefined){var h=this.name;e=this.data.datums(null,a).reduce(function(g,j){j=j.atoms[h].value;if(b&&j<0)j=-j;return g!=null?g+j:j},null);(this._sumCache||(this._sumCache={}))[d]=e}return c?e||0:e},percent:function(a,b){a=a instanceof
pvc.data.Atom?a.value:a;if(!a)return 0;return(b=this.sum(def.create(b,{abs:true})))?Math.abs(a)/b:0},percentOverParent:function(a){var b=this.sum(a);if(!b)return 0;var c=this.data.parent;if(!c)return 0;return(a=c.dimensionsSumAbs(this.name,a))?Math.abs(b)/a:0},format:function(a,b){return""+(this.type._formatter?this.type._formatter.call(null,a,b):"")},intern:function(a,b){if(a==null||a==="")return this._nullAtom||dim_createNullAtom.call(this,a);if(a instanceof pvc.data.Atom){if(a.dimension!==this)throw def.error.operationInvalid("Atom is of a different dimension.");
return a}var c,d,e=this.type;if(typeof a==="object"&&"v"in a){d=a.f;a=a.v}if(b)c=a;else{c=(c=e._converter)?c(a):a;if(c==null||c==="")return this._nullAtom||dim_createNullAtom.call(this,a)}var h=e.cast;if(h){c=h(c);if(c==null||c==="")return this._nullAtom||dim_createNullAtom.call(this)}h=e._key;(h=""+(h?h(c):c))||def.fail.operationInvalid("Only a null value can have an empty key.");var g=this._atomsByKey[h];if(g){!b&&g.isVirtual&&delete g.isVirtual;return g}return dim_createAtom.call(this,e,a,h,c,
d,b)},dispose:function(){if(!this._disposed){data_disposeChildList(this._children,"parent");data_disposeChildList(this._linkChildren,"linkParent");this.parent&&dim_removeChild.call(this.parent,this);this.linkParent&&dim_removeLinkChild.call(this.linkParent,this);dim_clearVisiblesCache.call(this);this._atoms=this._nullAtom=this._virtualNullAtom=this._lazyInit=null;this._disposed=true}}});
function dim_createAtom(a,b,c,d,e,h){if(this.owner===this){if(e==null)e=(a=a._formatter)?a(d,b):d;e=""+e;!e&&pvc.debug>=2&&pvc.log("Only the null value should have an empty label.");b=new pvc.data.Atom(this,d,e,b,c);if(h)b.isVirtual=true}else{var g=this.parent||this.linkParent;b=g._atomsByKey[c]||dim_createAtom.call(g,a,b,c,d,e,h)}def.array.insert(this._atoms,b,this._atomComparer);dim_clearVisiblesCache.call(this);return this._atomsByKey[c]=b}
function dim_internAtom(a){var b=a.key;if(a.dimension===this){this.owner===this||def.assert("Should be an owner dimension");if(!b&&a===this._virtualNullAtom)a=this.intern(null);return a}if(!this._lazyInit){var c=this._atomsByKey[b];if(c){if(c!==a)throw def.error.operationInvalid("Atom is from a different root data.");return a}if(this.owner===this)throw def.error.operationInvalid("Atom is from a different root data.");}dim_internAtom.call(this.parent||this.linkParent,a);if(!this._lazyInit){this._atomsByKey[b]=
a;if(b)def.array.insert(this._atoms,a,this._atomComparer);else{this._nullAtom=a;this._atoms.unshift(a)}dim_clearVisiblesCache.call(this)}return a}function dim_buildDatumsFilterKey(a){var b=def.get(a,"visible");a=def.get(a,"selected");return(b==null?null:!!b)+":"+(a==null?null:!!a)}
function dim_createNullAtom(a){var b=this._nullAtom;if(!b){if(this.owner===this){b=this.type._formatter;a=""+(b?b.call(null,null,a):"");b=new pvc.data.Atom(this,null,a,null,"");this.data._atomsBase[this.name]=b}else b=dim_createNullAtom.call(this.parent||this.linkParent,a);this._atomsByKey[""]=this._nullAtom=b;this._atoms.unshift(b)}return b}
function dim_createVirtualNullAtom(){this.owner===this||def.assert("Can only create atoms on an owner dimension.");if(!this._virtualNullAtom){this._virtualNullAtom=new pvc.data.Atom(this,null,"",null,"");this.data._atomsBase[this.name]=this._virtualNullAtom}return this._virtualNullAtom}
function dim_unintern(a){this.owner===this||def.assert("Can only unintern atoms on an owner dimension.");a&&a.dimension===this||def.assert("Not an interned atom");if(a!==this._virtualNullAtom){var b=a.key;if(this._atomsByKey[b]===a){def.array.remove(this._atoms,a,this._atomComparer);delete this._atomsByKey[b];if(!b){delete this._nullAtom;this.data._atomsBase[this.name]=this._virtualNullAtom}}dim_clearVisiblesCache.call(this)}}
function dim_uninternUnvisitedAtoms(){this.owner===this||def.assert("Can only unintern atoms of an owner dimension.");var a=this._atoms;if(a){for(var b=this._atomsByKey,c=0,d=a.length;c<d;){var e=a[c];if(e.visited){delete e.visited;c++}else if(e!==this._virtualNullAtom){a.splice(c,1);d--;e=e.key;delete b[e];if(!e){delete this._nullAtom;this.data._atomsBase[this.name]=this._virtualNullAtom}}}dim_clearVisiblesCache.call(this)}}
function dim_uninternVirtualAtoms(){var a=this._atoms;if(a){for(var b=this._atomsByKey,c=0,d=a.length,e;c<d;){var h=a[c];if(h.isVirtual){a.splice(c,1);d--;e=true;h=h.key||def.assert("Cannot be the null or virtual null atom.");delete b[h]}else c++}e&&dim_clearVisiblesCache.call(this)}}function dim_clearVisiblesCache(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null}function dim_onDatumsChanged(){dim_clearVisiblesCache.call(this)}
function dim_addChild(a){data_addColChild(this,"_children",a,"parent");a.owner=this.owner}function dim_removeChild(a){data_removeColChild(this,"_children",a,"parent")}function dim_addLinkChild(a){data_addColChild(this,"_linkChildren",a,"linkParent");a.owner=this.owner}function dim_removeLinkChild(a){data_removeColChild(this,"_linkChildren",a,"linkParent")}
function dim_onDatumVisibleChanged(a,b){var c;if(!this._disposed&&(c=this._atomVisibleDatumsCount)){a=a.atoms[this.name].key;def.hasOwn(this._atomsByKey,a)||def.assert("Atom must exist in this dimension.");var d=c[a];b||d>0||def.assert("Must have had accounted for at least one visible datum.");c[a]=(d||0)+(b?1:-1);this._visibleAtoms=this._sumCache=this._visibleIndexes=null}}
function dim_getVisibleDatumsCountMap(){var a=this._atomVisibleDatumsCount;if(!a){a={};this.data.datums(null,{visible:true}).each(function(b){b=b.atoms[this.name].key;a[b]=(a[b]||0)+1},this);this._atomVisibleDatumsCount=a}return a}function dim_calcVisibleIndexes(a){var b=[];this._atoms.forEach(function(c,d){this.isVisible(c)===a&&b.push(d)},this);return b}function dim_calcVisibleAtoms(a){return def.query(this._atoms).where(function(b){return this.isVisible(b)===a},this).array()}
def.type("pvc.data.Data",pvc.data.Complex).init(function(a){a||def.fail.argumentRequired("keyArgs");this._visibleDatums=new def.Map;var b,c,d,e,h,g,j=this.parent=a.parent||null;if(j){this.root=j.root;this.depth=j.depth+1;this.type=j.type;h=a.datums||def.fail.argumentRequired("datums");b=j.owner;c=a.atoms||def.fail.argumentRequired("atoms");e=a.dimNames||def.fail.argumentRequired("dimNames");d=j.atoms}else{this.root=this;e=[];var k=a.linkParent||null;if(k){b=k.owner;this.type=b.type;h=a.datums||def.fail.argumentRequired("datums");
this._leafs=[];d=k.atoms;g=def.get(a,"index",null);data_addLinkChild.call(k,this,g)}else{b=this;d={};if(a.labelSep)this.labelSep=a.labelSep;this.type=a.type||def.fail.argumentRequired("type");this._selectedDatums=new def.Map}}h&&data_setDatums.call(this,h);this.owner=b;this._atomsBase=d;this._dimensions={};this.type.dimensionsList().forEach(this._initDimension,this);this.base(b,c,e,d,true);pv.Dom.Node.call(this,null);delete this.nodeValue;this._children=this.childNodes;if(j){g=def.get(a,"index",null);
data_addChild.call(j,this,g);this.absLabel=j.absLabel?def.string.join(b.labelSep,j.absLabel,this.label):this.label;this.absKey=j.absKey?def.string.join(",",j.absKey,this.key):this.key}else{this.absLabel=this.label;this.absKey=this.key}}).add(pv.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_freeDimensionNames:null,_children:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_visibleDatums:null,_selectedDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_groupOper:null,
_groupSpec:null,_groupLevel:null,_datums:null,_datumsById:null,depth:0,label:"",absLabel:"",_disposed:false,_isFlattenGroup:false,_isDegenerateFlattenGroup:false,_initDimension:function(a){this._dimensions[a.name]=new pvc.data.Dimension(this,a)},dimensions:function(a,b){if(a==null)return this._dimensions;var c=def.getOwn(this._dimensions,a);if(!c&&def.get(b,"assertExists",true))throw def.error.argumentInvalid("name","Undefined dimension '{0}'.",[a]);return c},freeDimensionNames:function(){if(!this._freeDimensionNames){var a=
this._freeDimensionNames=[];def.eachOwn(this._dimensions,function(b,c){b=this.atoms[c];if(!(b instanceof pvc.data.Atom)||b.value==null)a.push(c)},this)}return this._freeDimensionNames},isOwner:function(){return this.owner===this},children:function(){if(!this._children)return def.query();return def.query(this._children)},childCount:function(){return this._children?this._children.length:0},leafs:function(){return def.query(this._leafs)},count:function(){return this._datums.length},singleDatum:function(){var a=
this._datums;return a.length===1?a[0]:null},dispose:function(){if(!this._disposed){data_disposeChildLists.call(this);this._selectedDatums&&this._selectedDatums.clear();this._visibleDatums.clear();def.eachOwn(this._dimensions,function(a){a.dispose()});if(this.parent){this.parent.removeChild(this);this.parent=null}this.linkParent&&data_removeLinkChild.call(this.linkParent,this);this._disposed=true}},disposeChildren:function(){data_disposeChildLists.call(this)}});
function data_addChild(a,b){this.insertAt(a,b);(this._childrenByKey||(this._childrenByKey={}))[a.key]=a}function data_addLinkChild(a,b){data_addColChild(this,"_linkChildren",a,"linkParent",b)}function data_removeLinkChild(a){data_removeColChild(this,"_linkChildren",a,"linkParent")}function data_disposeChildLists(){data_disposeChildList(this._children,"parent");this._childrenByKey=null;data_disposeChildList(this._linkChildren,"linkParent");this._sumAbsCache=this._groupByCache=null}
function data_assertIsOwner(){this.isOwner()||def.fail("Can only be called on the owner data.")}
pvc.data.Data.add({selectedCount:function(){if(!this.isOwner())return this.datums(null,{selected:true}).count();return this._selectedDatums.count},selectedDatums:function(){if(!this.isOwner())return this.datums(null,{selected:true}).array();return this._selectedDatums.values()},selectedDatumMap:function(){if(!this.isOwner()){var a=this.datums(null,{selected:true}).object({name:function(b){return b.id}});return new def.Set(a)}return this._selectedDatums.clone()},visibleCount:function(){return this._visibleDatums.count},
replaceSelected:function(a){def.array.is(a)||(a=a.array());var b=def.query(a).where(function(d){return d.isSelected}).object({name:function(d){return d.id}}),c=this.owner.clearSelected(function(d){return!def.hasOwn(b,d.id)});c|=pvc.data.Data.setSelected(a,true);return c},clearSelected:function(a){if(this.owner!==this)return this.owner.clearSelected(a);if(!this._selectedDatums.count)return false;var b;if(a){b=false;this._selectedDatums.values().filter(a).forEach(function(c){b=true;datum_deselect.call(c);
this._selectedDatums.rem(c.id)},this)}else{b=true;this._selectedDatums.values().forEach(function(c){datum_deselect.call(c)});this._selectedDatums.clear()}return b}});function data_onDatumSelectedChanged(a,b){!a.isNull||def.assert("Null datums do not notify selected changes");b?this._selectedDatums.set(a.id,a):this._selectedDatums.rem(a.id);this._sumAbsCache=null}
function data_onDatumVisibleChanged(a,b){if(def.hasOwn(this._datumsById,a.id)){!a.isNull||def.assert("Null datums do not notify visible changes");b?this._visibleDatums.set(a.id,a):this._visibleDatums.rem(a.id);this._sumAbsCache=null;def.eachOwn(this._dimensions,function(c){dim_onDatumVisibleChanged.call(c,a,b)});this._children.forEach(function(c){data_onDatumVisibleChanged.call(c,a,b)});this._linkChildren&&this._linkChildren.forEach(function(c){data_onDatumVisibleChanged.call(c,a,b)})}}
pvc.data.Data.setSelected=function(a,b){var c=false;a&&def.query(a).each(function(d){if(d.setSelected(b))c=true});return c};pvc.data.Data.toggleSelected=function(a){def.array.isLike(a)||(a=def.query(a).array());var b=def.query(a).all(function(c){return c.isNull||c.isSelected});return this.setSelected(a,!b)};pvc.data.Data.setVisible=function(a,b){var c=false;a&&def.query(a).each(function(d){if(d.setVisible(b))c=true});return c};
pvc.data.Data.toggleVisible=function(a){def.array.isLike(a)||(a=def.query(a).array());var b=def.query(a).all(function(c){return c.isVisible});return pvc.data.Data.setVisible(a,!b)};
def.type("pvc.data.GroupingSpec").init(function(a,b,c){this.type=b||null;var d=[];this.hasCompositeLevels=false;var e=[];this.levels=def.query(a||undefined).where(function(h){return h.dimensions.length>0}).select(function(h){d.push(h.id);def.array.append(e,h.dimensionNames());if(!this.hasCompositeLevels&&h.dimensions.length>1)this.hasCompositeLevels=true;h._setAccDimNames(e.slice(0));return h},this).array();this._dimNames=e;this.depth=this.levels.length;this.isSingleDimension=(this.isSingleLevel=
this.depth===1)&&!this.hasCompositeLevels;this.firstDimension=this.depth>0?this.levels[0].dimensions[0]:null;this.flatteningMode=def.get(c,"flatteningMode")||null;this.flattenRootLabel=def.get(c,"flattenRootLabel")||"";this.id=(this.flatteningMode||"")+"##"+this.flattenRootLabel+"##"+d.join("||")}).add({bind:function(a){this.type=a||def.fail.argumentRequired("type");this.levels.forEach(function(b){b.bind(a)})},dimensions:function(){return def.query(this.levels).selectMany(function(a){return a.dimensions})},
dimensionNames:function(){return this._dimNames},view:function(a){return a.view(this.dimensionNames())},isDiscrete:function(){var a;return!this.isSingleDimension||!!(a=this.firstDimension)&&a.type.isDiscrete},firstDimensionType:function(){var a=this.firstDimension;return a&&a.type},firstDimensionName:function(){var a=this.firstDimensionType();return a&&a.name},firstDimensionValueType:function(){var a=this.firstDimensionType();return a&&a.valueType},isNull:function(){return!this.levels.length},ensure:function(a){var b=
this,c=def.get(a,"flatteningMode");if(c){if(c==="singleLevel")return b.singleLevelGrouping(a);var d=def.get(a,"flattenRootLabel")||"";if(this.flatteningMode!==c||this.flattenRootLabel!==d)b=new pvc.data.GroupingSpec(b.levels,b.type,{flatteningMode:c,flattenRootLabel:d})}if(def.get(a,"reverse",false))b=b.reversed();return b},singleLevelGrouping:function(a){var b=!!def.get(a,"reverse",false);if(this.isSingleLevel&&!b)return this;this._singleLevelGrouping||(this._singleLevelGrouping={});a=this._singleLevelGrouping[b];
if(!a){a=this.dimensions().select(function(c){return b?new pvc.data.GroupingDimensionSpec(c.name,!c.reverse,c.type.complexType):c});a=new pvc.data.GroupingLevelSpec(a,this.type);a=new pvc.data.GroupingSpec([a],this.type,{flatteningMode:this.flatteningMode});this._singleLevelGrouping[b]=a}return a},reversed:function(){var a=this._reverseGrouping;if(!a){a=def.query(this.levels).select(function(b){b=def.query(b.dimensions).select(function(c){return new pvc.data.GroupingDimensionSpec(c.name,!c.reverse,
c.type.complexType)});return new pvc.data.GroupingLevelSpec(b,this.type)});this._reverseGrouping=a=new pvc.data.GroupingSpec(a,this.type,{flatteningMode:this.flatteningMode})}return a},toString:function(){return def.query(this.levels).select(function(a){return""+a}).array().join(", ")}});
def.type("pvc.data.GroupingLevelSpec").init(function(a,b){var c=[],d=[];this.dimensions=def.query(a).select(function(h){c.push(h.id);d.push(h.name);return h}).array();this._dimNames=d;this.dimensionsInDefOrder=this.dimensions.slice(0);b&&this._sortDimensions(b);this.id=c.join(",");this.depth=this.dimensions.length;var e=this;this.comparer=function(h,g){return e.compare(h,g)}}).add({_sortDimensions:function(a){a.sortDimensionNames(this.dimensionsInDefOrder,function(b){return b.name})},_setAccDimNames:function(a){this._accDimNames=
a},accDimensionNames:function(){return this._accDimNames},dimensionNames:function(){return this._dimNames},bind:function(a){this._sortDimensions(a);this.dimensions.forEach(function(b){b.bind(a)})},compare:function(a,b){for(var c=0,d=this.depth;c<d;c++){var e=this.dimensions[c].compareDatums(a,b);if(e!==0)return e}return 0},key:function(a){var b="",c={},d=a.atoms,e=this._dimNames;a=a.owner.keySep;for(var h=0,g=this.depth;h<g;h++){var j=e[h],k=d[j];c[j]=k;if(h)b+=a+k.key;else b=k.key}return{key:b,atoms:c,
dimNames:e}},toString:function(){return def.query(this.dimensions).select(function(a){return""+a}).array().join("|")}});
def.type("pvc.data.GroupingDimensionSpec").init(function(a,b,c){this.name=a;this.reverse=!!b;this.id=this.name+":"+(this.reverse?"0":"1");c&&this.bind(c)}).add({type:null,comparer:null,bind:function(a){a||def.fail.argumentRequired("type");this.type=a.dimensions(this.name);this.comparer=this.type.atomComparer(this.reverse)},compareDatums:function(a,b){a=this.comparer(a.atoms[this.name],b.atoms[this.name]);if(a!==0)return a;return 0},toString:function(){return this.name+(this.reverse?" desc":"")}});
pvc.data.GroupingSpec.parse=function(a,b){if(!a)return new pvc.data.GroupingSpec(null,b);var c;if(def.array.is(a))c=a;else if(def.string.is(a))c=a.split(/\s*,\s*/);a=def.query(c).select(function(d){d=groupSpec_parseGroupingLevel(d,b);return new pvc.data.GroupingLevelSpec(d,b)});return new pvc.data.GroupingSpec(a,b)};var groupSpec_matchDimSpec=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;
function groupSpec_parseGroupingLevel(a,b){def.string.is(a)||def.fail.argumentInvalid("groupLevelText","Invalid grouping specification.");return def.query(a.split(/\s*\|\s*/)).where(def.truthy).select(function(c){var d=groupSpec_matchDimSpec.exec(c)||def.fail.argumentInvalid("groupLevelText","Invalid grouping level syntax '{0}'.",[c]);c=d[1];d=(d[2]||"").toLowerCase()==="desc";return new pvc.data.GroupingDimensionSpec(c,d,b)})}
def.type("pvc.data.DataOper").init(function(a){this._linkParent=a}).add({key:null,execute:def.method({isAbstract:true})});
def.type("pvc.data.GroupingOper",pvc.data.DataOper).init(function(a,b,c){b||def.fail.argumentRequired("groupingSpecs");this.base(a,c);this._where=def.get(c,"where");this._visible=def.get(c,"visible",null);this._selected=def.get(c,"selected",null);this._isNull=def.get(c,"isNull",null);var d=this._selected==null,e="";if(this._where){e=def.get(c,"whereKey");if(!e)if(!c||e===null)d=false;else{e=""+def.nextId("dataOperWhereKey");c.whereKey=e}}var h=[];this._groupSpecs=def.array.as(b).map(function(g){if(g instanceof
pvc.data.GroupingSpec){if(g.type!==a.type)throw def.error.argumentInvalid("groupingSpecText","Invalid associated complex type.");}else g=pvc.data.GroupingSpec.parse(g,a.type);h.push(g.id);return g});if(d)this.key=h.join("!!")+"||visible:"+this._visible+"||isNull:"+this._isNull+"||where:"+e}).add({execute:function(){return this._generateData(this._group(data_whereState(def.query(this._linkParent._datums),{visible:this._visible,selected:this._selected,isNull:this._isNull,where:this._where})),null,this._linkParent)},
executeAdd:function(a,b){b=this._group(data_whereState(def.query(b),{visible:this._visible,selected:this._selected,isNull:this._isNull,where:this._where}));this._generateData(b,null,this._linkParent,a);return b.datums},_group:function(a){var b={isRoot:true,treeHeight:def.query(this._groupSpecs).select(function(c){var d=c.levels.length;if(!d)return 0;return c.flatteningMode?1:d}).reduce(def.add,0),datums:[]};b.treeHeight>0&&this._groupSpecRecursive(b,a,0);return b},_groupSpecRecursive:function(a,b,
c){function d(l,m,n){var o=h[n];if(!j){l.children=[];l.groupSpec=e;l.groupLevelSpec=o}m=this._groupDatums(o,l,m,j);var p=n===g-1;var q=(o=j&&!f)?[]:l.datums;m.forEach(function(r){var v=r.datums;if(!(f&&p))r.datums=[];var t;if(j){def.array.lazy(l,"_children").push(r);if(def.hasOwn(a.childrenByKey,r.key)){def.array.append(q,v);return}t=a.children.length;if(!i){a.children.push(r);a.childrenByKey[r.key]=r;l.isFlattenGroup=true}}else l.children.push(r);if(p)f||this._groupSpecRecursive(r,v,k);else d.call(this,
r,v,n+1);def.array.append(q,r.datums);if(j&&i){if(def.hasOwn(a.childrenByKey,r.key)){r.isFlattenGroup||def.assert("Must be a parent for duplicate keys to exist.");if(r._children.length===1){a.children.splice(t,a.children.length-t);r.isDegenerateFlattenGroup=true}}a.children.push(r);a.childrenByKey[r.key]=r;l.isFlattenGroup=true}},this);o&&this._groupSpecRecursive(l,q,k)}var e=this._groupSpecs[c],h=e.levels,g=h.length,j=!!e.flatteningMode,k=c+1,f=k>=this._groupSpecs.length,i=j&&e.flatteningMode===
"tree-post";if(j){a.children=[];a.childrenByKey={};c={key:"",absKey:"",atoms:{},datums:[],label:e.flattenRootLabel,dimNames:[]};if(!i){a.children.push(c);a.childrenByKey[""]=c}}else c=a;d.call(this,c,b,0);if(j){i&&a.children.push(c);a.datums=c.datums}},_groupDatums:function(a,b,c,d){var e=[],h=new def.OrderedMap;def.query(c).each(function(g){var j=a.key(g),k=j.key,f=h.get(k);if(f)f.datums.push(g);else{f=j;f.datums=[g];if(d){def.copy(f.atoms,b.atoms);if(b.dimNames.length){j=g.owner.keySep;f.absKey=
b.absKey+j+k;for(var i=j.length,l=f.absKey;l.lastIndexOf(j)===l.length-i;)l=l.substr(0,l.length-i);f.key=l}else f.absKey=k;f.dimNames=a.accDimensionNames()}g=def.array.insert(e,g,a.comparer);h.add(k,f,~g)}});return h},_generateData:function(a,b,c,d){var e,h;if(a.isRoot)if(d){e=d;data_addDatumsLocal.call(e,a.datums)}else{h=true;e=new pvc.data.Data({linkParent:c,datums:a.datums});e.treeHeight=a.treeHeight;e._groupOper=this}else{if(d)(e=def.get(c._childrenByKey,a.key))&&data_addDatumsSimple.call(e,a.datums);
if(!e){h=true;var g,j;if(d&&(j=c._children))g=~def.array.binarySearch(j,a.datums[0],b.groupLevelSpec.comparer);e=new pvc.data.Data({parent:c,atoms:a.atoms,dimNames:a.dimNames,datums:a.datums,index:g})}}if(h&&a.isFlattenGroup){e._isFlattenGroup=true;e._isDegenerateFlattenGroup=!!a.isDegenerateFlattenGroup;if(b=a.label){e.label+=b;e.absLabel+=b}}if((b=a.children)&&b.length){if(h){e._groupSpec=a.groupSpec;e._groupLevelSpec=a.groupLevelSpec}b.forEach(function(k){this._generateData(k,a,e,d)},this)}else if(h&&
!a.isRoot){h=e.root._leafs;e.leafIndex=h.length;h.push(e)}return e}});
def.type("pvc.data.LinearInterpolationOper").init(function(a,b,c,d,e,h){this._newDatums=[];this._data=b;a=a.flattenBy(c,{ignoreNulls:false})._children;var g=this._serDatas1=d.isBound()?b.flattenBy(d).children().array():[null];this._isCatDiscrete=c.grouping.isDiscrete();this._firstCatDim=!this._isCatDiscrete?b.owner.dimensions(c.firstDimensionName()):null;this._stretchEnds=h;var j=this._valDim=b.owner.dimensions(e.firstDimensionName()),k={visible:true,zeroIfNone:false};this._catInfos=a.map(function(f,
i){var l=b._childrenByKey[f.key],m={data:l||f,value:f.value,isInterpolated:false,serInfos:null,index:i};m.serInfos=g.map(function(n){var o=l;if(o&&n)o=o._childrenByKey[n.key];var p=o?o.dimensions(j.name).sum(k):null;return{data:n,group:o,value:p,isNull:p==null,catInfo:m}},this);return m});this._serCount=g.length;this._serStates=def.range(0,this._serCount).select(function(f){return new pvc.data.LinearInterpolationOperSeriesState(this,f)},this).array()}).add({interpolate:function(){for(var a;a=this._catInfos.shift();)a.serInfos.forEach(this._visitSeries,
this);a=this._newDatums;a.length&&this._data.owner.add(a)},_visitSeries:function(a,b){this._serStates[b].visit(a)},nextUnprocessedNonNullCategOfSeries:function(a){for(var b=0,c=this._catInfos.length;b<c;){var d=this._catInfos[b++].serInfos[a];if(!d.isNull)return d}}});
def.type("pvc.data.LinearInterpolationOperSeriesState").init(function(a,b){this.interpolation=a;this.index=b;this._lastNonNull(null)}).add({visit:function(a){a.isNull?this._interpolate(a):this._lastNonNull(a)},_lastNonNull:function(a){if(arguments.length){this.__lastNonNull=a;this.__nextNonNull=undefined}return this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(this.__nextNonNull===undefined){var a=this.__lastNonNull,b=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||
null;if(b&&a){var c=b.value-a.value;if(this.interpolation._isCatDiscrete){b=b.catInfo.index-a.catInfo.index;b>=2||def.assert("Must have at least one interpolation point.");this._stepValue=c/b;this._middleIndex=~~(b/2);this._isOdd=(b-1)%2>0}else{a=+a.catInfo.value;b=+b.catInfo.value;this._steep=c/(b-a);this._middleCat=(b+a)/2}}}},_interpolate:function(a){this._initInterpData();var b=this.__nextNonNull,c=this.__lastNonNull,d=b||c;if(d){var e=this.interpolation,h=a.catInfo;if(b&&c)if(e._isCatDiscrete){d=
h.index-c.catInfo.index;a=c.value+this._stepValue*d;b=this._isOdd?d<this._middleIndex?c.group:b.group:d<=this._middleIndex?c.group:b.group}else{d=+h.value;a=c.value+this._steep*(d-+c.catInfo.value);b=d<this._middleCat?c.group:b.group}else{if(!e._stretchEnds)return;a=d.value;b=d.group}c=Object.create(b._datums[0].atoms);def.copyOwn(c,h.data.atoms);a=e._valDim.intern(a,true);c[a.dimension.name]=a;a=new pvc.data.Datum(b.owner,c);a.isVirtual=true;a.isInterpolated=true;a.interpolation="linear";e._newDatums.push(a)}}});
def.type("pvc.data.ZeroInterpolationOper").init(function(a,b,c,d,e,h){this._newDatums=[];this._data=b;a=a.flattenBy(c,{ignoreNulls:false})._children;var g=this._serDatas1=d.isBound()?b.flattenBy(d).children().array():[null];this._isCatDiscrete=c.grouping.isDiscrete();this._firstCatDim=!this._isCatDiscrete?b.owner.dimensions(c.firstDimensionName()):null;this._stretchEnds=h;var j=this._valDim=b.owner.dimensions(e.firstDimensionName()),k={visible:true,zeroIfNone:false};this._catInfos=a.map(function(f,
i){var l=b._childrenByKey[f.key],m={data:l||f,value:f.value,isInterpolated:false,serInfos:null,index:i};m.serInfos=g.map(function(n){var o=l;if(o&&n)o=o._childrenByKey[n.key];var p=o?o.dimensions(j.name).sum(k):null;return{data:n,group:o,value:p,isNull:p==null,catInfo:m}},this);return m});this._serCount=g.length;this._serStates=def.range(0,this._serCount).select(function(f){return new pvc.data.ZeroInterpolationOperSeriesState(this,f)},this).array()}).add({interpolate:function(){for(var a;a=this._catInfos.shift();)a.serInfos.forEach(this._visitSeries,
this);a=this._newDatums;a.length&&this._data.owner.add(a)},_visitSeries:function(a,b){this._serStates[b].visit(a)},nextUnprocessedNonNullCategOfSeries:function(a){for(var b=0,c=this._catInfos.length;b<c;){var d=this._catInfos[b++].serInfos[a];if(!d.isNull)return d}}});
def.type("pvc.data.ZeroInterpolationOperSeriesState").init(function(a,b){this.interpolation=a;this.index=b;this._lastNonNull(null)}).add({visit:function(a){a.isNull?this._interpolate(a):this._lastNonNull(a)},_lastNonNull:function(a){if(arguments.length){this.__lastNonNull=a;this.__nextNonNull=undefined}return this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(this.__nextNonNull===undefined){var a=this.__lastNonNull,b=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||
null;if(b&&a)if(this.interpolation._isCatDiscrete){a=b.catInfo.index-a.catInfo.index;a>=2||def.assert("Must have at least one interpolation point.");this._middleIndex=~~(a/2);this._isOdd=(a-1)%2>0}else this._middleCat=(+b.catInfo.value+ +a.catInfo.value)/2}},_interpolate:function(a){this._initInterpData();var b=this.__nextNonNull,c=this.__lastNonNull,d=b||c;if(d){var e=this.interpolation;a=a.catInfo;if(b&&c)if(e._isCatDiscrete){d=a.index-c.catInfo.index;b=this._isOdd?d<this._middleIndex?c.group:b.group:
d<=this._middleIndex?c.group:b.group}else b=+a.value<this._middleCat?c.group:b.group;else{if(!e._stretchEnds)return;b=d.group}c=Object.create(b._datums[0].atoms);def.copyOwn(c,a.data.atoms);a=e._zeroAtom||(e._zeroAtom=e._valDim.intern(0,true));c[a.dimension.name]=a;a=new pvc.data.Datum(b.owner,c);a.isVirtual=true;a.isInterpolated=true;a.interpolation="zero";e._newDatums.push(a)}}});
pvc.data.Data.add({load:function(a,b){data_assertIsOwner.call(this);var c=def.get(b,"where"),d=def.get(b,"isNull");a=def.query(a).select(function(e){e=new pvc.data.Datum(this,e);if(d&&d(e))e.isNull=true;if(c&&!c(e))return null;return e},this);data_setDatums.call(this,a,{doAtomGC:true})},clearVirtuals:function(){var a=this._datums;if(a){this._sumAbsCache=null;for(var b=this._visibleDatums,c=this._selectedDatums,d=0,e=a.length,h;d<e;){var g=a[d];if(g.isVirtual){h=g.id;c&&g.isSelected&&c.rem(h);g.isVisible&&
b.rem(h);a.splice(d,1);e--;h=true}else d++}if(h){if(!a.length&&this.parent){this.dispose();return}if(a=this._children){d=0;for(e=a.length;d<e;){b=a[d];b.clearVirtuals();if(b.parent)d++;else e--}}this._linkChildren&&this._linkChildren.forEach(function(j){j.clearVirtuals()})}}def.eachOwn(this._dimensions,function(j){dim_uninternVirtualAtoms.call(j)})},add:function(a){data_assertIsOwner.call(this);data_setDatums.call(this,a,{isAdditive:true,doAtomGC:true})},groupBy:function(a,b){a=new pvc.data.GroupingOper(this,
a,b);b=a.key;var c,d;if(b)d=(c=this._groupByCache)&&c[b];if(d)pvc.debug>=7&&pvc.log("[GroupBy] Cache key hit '"+b+"'");else{if(pvc.debug>=7)pvc.log("[GroupBy] "+(b?"Cache key not found: '"+b+"'":"No Cache key"));d=a.execute();if(b)(c||(this._groupByCache={}))[b]=d}return d},flattenBy:function(a,b){return this.groupBy(a.flattenedGrouping(b)||def.fail.operationInvalid("Role is unbound."),b)},where:function(a,b){a=this.datums(a,b);return new pvc.data.Data({linkParent:this,datums:a})},datums:function(a,
b){if(!a){if(!b)return def.query(this._datums);return data_whereState(def.query(this._datums),b)}a=data_processWhereSpec.call(this,a,b);return data_where.call(this,a,b)},datum:function(a,b){a||def.fail.argumentRequired("whereSpec");a=data_processWhereSpec.call(this,a,b);var c=data_where.call(this,a,b).first()||null;if(!c&&def.get(b,"createNull")&&a.length){a=a[0];b={};for(var d in this._dimensions)if(c=a[d])b[d]=c[0];c=new pvc.data.Datum(this,b,true)}return c},firstDatum:function(){return this._datums.length?
this._datums[0]:null},dimensionsSumAbs:function(a,b){var c=a+":"+dim_buildDatumsFilterKey(b),d=def.getOwn(this._sumAbsCache,c);if(d==null){d=this.children().where(function(e){return!e._isFlattenGroup||e._isDegenerateFlattenGroup}).select(function(e){return Math.abs(e.dimensions(a).sum(b))},this).reduce(def.add,0);(this._sumAbsCache||(this._sumAbsCache={}))[c]=d}return d}});
function data_setDatums(a,b){function c(p){if(p){var q=p.key;if(!def.hasOwnProp.call(j,q)){if(k){var r=def.getOwn(k,q);if(r){if(e)return;p=r}}j[q]=p;q=p.id;i[q]=p;data_processDatumAtoms.call(this,p,!!this._dimensions,d);if(!p.isNull){g&&p.isSelected&&g.set(q,p);p.isVisible&&h.set(q,p)}return p}}}a||def.fail.argumentRequired("newDatums");var d=def.get(b,"doAtomGC",false),e=def.get(b,"isAdditive",false),h=this._visibleDatums,g=this._selectedDatums,j={},k;if(b=this._datums){var f=e&&d;k=def.query(b).uniqueIndex(function(p){f&&
data_processDatumAtoms.call(this,p,false,true);return p.key},this);if(e)this._sumAbsCache=null;else{data_disposeChildLists.call(this);g&&g.clear();h.clear()}}else e=false;var i;i=e?this._datumsById:(this._datumsById={});if(def.array.is(a))for(var l=0,m=a.length;l<m;){var n=a[l],o=c.call(this,n);if(o){if(o!==n)a[l]=o;l++}else{a.splice(l,1);m--}}else if(a instanceof def.Query)a=a.select(c,this).where(def.notNully).array();else throw def.error.argumentInvalid("newDatums","Argument is of invalid type.");
d&&def.eachOwn(this._dimensions,function(p){dim_uninternUnvisitedAtoms.call(p)});if(e){def.array.append(b,a);this._linkChildren&&this._linkChildren.forEach(function(p){data_addDatumsSimple.call(p,a)})}else this._datums=a}function data_processDatumAtoms(a,b,c){var d=this._dimensions;d||(b=false);def.each(a.atoms,function(e){if(b){var h=def.getOwn(d,e.dimension.name)||def.fail.argumentInvalid("Datum has atoms of foreign dimension.");dim_internAtom.call(h,e)}if(c)e.visited=true})}
function data_addDatumsSimple(a){a||def.fail.argumentRequired("newDatums");var b=this._groupOper;if(b)a=b.executeAdd(this,a);else data_addDatumsLocal.call(this,a);this._linkChildren&&this._linkChildren.forEach(function(c){data_addDatumsSimple.call(c,a)})}
function data_addDatumsLocal(a){function b(g){var j=g.id;e[j]=g;data_processDatumAtoms.call(this,g,true,false);if(!g.isNull){d&&g.isSelected&&d.set(j,g);g.isVisible&&c.set(j,g)}h.push(g)}var c=this._visibleDatums,d=this._selectedDatums;this._sumAbsCache=null;var e=this._datumsById,h=this._datums;a.forEach(b,this)}
function data_processWhereSpec(a){function b(e){if(e!=null){typeof e==="object"||def.fail.invalidArgument("datumFilter");var h={},g=false;for(var j in e){var k=c.call(this,j,e[j]);if(k){g=true;h[j]=k}}g&&d.push(h)}}function c(e,h){var g=this.dimensions(e);e=def.query(h).select(function(j){return g.atom(j)}).where(def.notNully).distinct(function(j){return j.key}).array();return e.length?e:null}var d=[];(a=def.array.as(a))&&a.forEach(b,this);return d}
function data_whereState(a,b){var c=def.get(b,"selected"),d=def.get(b,"visible"),e=def.get(b,"where"),h=def.get(b,"isNull");if(d!=null)a=a.where(function(g){return g.isVisible===d});if(h!=null)a=a.where(function(g){return g.isNull===h});if(c!=null)a=a.where(function(g){return g.isSelected===c});if(e)a=a.where(e);return a}
function data_where(a,b){var c=def.array.as(def.get(b,"orderBy")),d=def.create(b||{},{orderBy:null});return def.query(a).selectMany(function(e,h){if(c)d.orderBy=c[h];return data_whereDatumFilter.call(this,e,d)},this).distinct(function(e){return e.id})}
function data_whereDatumFilter(a,b){var c=b.orderBy;if(c){if(c.indexOf("|")>=0)throw def.error.argumentInvalid("keyArgs.orderBy","Multi-dimension order by is not supported.");}else c=Object.keys(a).sort().join(",");var d=this.groupBy(c,b),e=d.treeHeight,h=[];return def.query(function(){var g;if(this._data){if(this._datumsQuery){this._data||def.assert("Must have a current data");h.length||def.assert("Must have a parent data");!this._dimAtomsOrQuery||def.assert();if(this._datumsQuery.next()){this.item=
this._datumsQuery.item;return 1}this._datumsQuery=null;g=h.pop();this._data=g.data;this._dimAtomsOrQuery=g.dimAtomsOrQuery}}else{this._data=d;this._dimAtomsOrQuery=def.query(a[d._groupLevelSpec.dimensions[0].name])}this._dimAtomsOrQuery||def.assert("Invalid programmer");this._data||def.assert("Must have a current data");var j=h.length;do{for(;this._dimAtomsOrQuery.next();)if((g=this._data._childrenByKey[this._dimAtomsOrQuery.item.key])&&(j<e-1||g._datums.length)){h.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery});
this._data=g;if(j<e-1){this._dimAtomsOrQuery=def.query(a[g._groupLevelSpec.dimensions[0].name]);j++}else{this._dimAtomsOrQuery=null;this._datumsQuery=def.query(g._datums);this._datumsQuery.next();this.item=this._datumsQuery.item;return 1}}if(!j)return 0;g=h.pop();this._data=g.data;this._dimAtomsOrQuery=g.dimAtomsOrQuery;j--}while(1);return 0})}
pvc.data.Data.add({getInfo:function(){var a=["DATA SUMMARY",pvc.logSeparator,"  Dimension",pvc.logSeparator];def.eachOwn(this.dimensions(),function(b,c){var d=b.count(),e=b.type,h=[];h.push('"'+e.label+'"');h.push(e.valueTypeName);e.isComparable&&h.push("comparable");e.isDiscrete||h.push("continuous");e.isHidden&&h.push("hidden");a.push("  "+c+" ("+h.join(", ")+") ("+d+")\n\t"+b.atoms().slice(0,10).map(function(g){return g.label}).join(", ")+(d>10?"...":""))});return a.join("\n")},getValues:function(){return pv.range(0,
this.getCategoriesSize()).map(function(a){return this._getValuesForCategoryIndex(a)},this)},_getDimensionValues:function(a){return this.dimensions(a).atoms().map(function(b){return b.value})},_getDimensionVisibleValues:function(a){return this.dimensions(a).atoms({visible:true}).map(function(b){return b.value})},getSeries:function(){return this._getDimensionValues("series")},getVisibleSeriesIndexes:function(){return this.dimensions("series").indexes({visible:true})},getVisibleCategoriesIndexes:function(){return this.dimensions("category").indexes({visible:true})},
getVisibleSeries:function(){return this._getDimensionVisibleValues("series")},getCategories:function(){return this._getDimensionValues("category")},getVisibleCategories:function(){return this._getDimensionVisibleValues("category")},_getValuesForCategoryIndex:function(a){var b=this.datums({category:this.dimensions("category").atoms()[a]}).uniqueIndex(function(c){return c.atoms.series.key});return this.dimensions("series").atoms().map(function(c){return(c=def.getOwn(b,c.key))?c.atoms.value.value:null})},
getSeriesSize:function(){var a=this.dimensions("series",{assertExists:false});return a?a.count():0},getCategoriesSize:function(){var a=this.dimensions("category",{assertExists:false});return a?a.count():0}});
def.type("pvc.visual.Role").init(function(a,b){this.name=a;this.label=def.get(b,"label")||pvc.buildTitleFromName(a);this.index=def.get(b,"index")||0;this.dimensionDefaults=def.get(b,"dimensionDefaults")||{};if(def.get(b,"isRequired",false))this.isRequired=true;if(def.get(b,"autoCreateDimension",false))this.autoCreateDimension=true;if(a=def.get(b,"defaultSourceRole"))this.defaultSourceRoleName=a;if(a=def.get(b,"defaultDimension"))this.defaultDimensionName=a;if(!a&&this.autoCreateDimension)throw def.error.argumentRequired("defaultDimension");
var c;a=def.get(b,"requireIsDiscrete");if(a!=null)a||(c=true);if(c!=null)if(c=def.get(b,"requireSingleDimension",false)){if(def.get(b,"isMeasure",false)){this.isMeasure=true;if(def.get(b,"isPercent",false))this.isPercent=true}var d=def.get(b,"valueType",null);if(d!==this.valueType){this.valueType=d;this.dimensionDefaults.valueType=d}}if(c!==this.requireSingleDimension)this.requireSingleDimension=c;if(a!=this.requireIsDiscrete){this.requireIsDiscrete=!!a;this.dimensionDefaults.isDiscrete=this.requireIsDiscrete}if((b=
def.get(b,"flatteningMode"))&&b!=this.flatteningMode)this.flatteningMode=b}).add({isRequired:false,requireSingleDimension:false,valueType:null,requireIsDiscrete:null,isMeasure:false,isPercent:false,defaultSourceRoleName:null,defaultDimensionName:null,grouping:null,flatteningMode:"singleLevel",flattenRootLabel:"",autoCreateDimension:false,isReversed:false,label:null,sourceRole:null,firstDimensionType:function(){var a=this.grouping;return a&&a.firstDimensionType()},firstDimensionName:function(){var a=
this.grouping;return a&&a.firstDimensionName()},firstDimensionValueType:function(){var a=this.grouping;return a&&a.firstDimensionValueType()},isDiscrete:function(){var a=this.grouping;return a&&a.isDiscrete()},setSourceRole:function(a){this.sourceRole=a},setIsReversed:function(a){if(a)this.isReversed=true;else delete this.isReversed},setFlatteningMode:function(a){if(!a||a==="singleLevel")delete this.flatteningMode;else this.flatteningMode=a},setFlattenRootLabel:function(a){if(a)this.flattenRootLabel=
a;else delete this.flattenRootLabel},flatten:function(a,b){if(this.grouping)return a.flattenBy(this,b)},flattenedGrouping:function(a){var b=this.grouping;if(b){a=def.setDefaults(a,"flatteningMode",this.flatteningMode,"flattenRootLabel",this.flattenRootLabel);return b.ensure(a)}},select:function(a,b){var c=this.grouping;if(c)return a.groupBy(c.ensure(b),b)},view:function(a){var b=this.grouping;if(b)return b.view(a)},preBind:function(a){this.__grouping=a;return this},isPreBound:function(){return!!this.__grouping},
preBoundGrouping:function(){return this.__grouping},isBound:function(){return!!this.grouping},postBind:function(a){var b=this.__grouping;if(b){delete this.__grouping;b.bind(a);this.bind(b)}return this},bind:function(a){if(a)if(a.isNull())a=null;else{if(this.requireSingleDimension&&!a.isSingleDimension)throw def.error.operationInvalid("Role '{0}' only accepts a single dimension.",[this.name]);var b=this.valueType,c=this.requireIsDiscrete;a.dimensions().each(function(d){d=d.type;if(b&&d.valueType!==
b)throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts dimensions of type '{2}' and not of type '{3}'.",[this.name,d.name,pvc.data.DimensionType.valueTypeName(b),d.valueTypeName]);if(c!=null&&d.isDiscrete!==c)if(c)d._toDiscrete();else throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts {2} dimensions.",[this.name,d.name,c?"discrete":"continuous"]);},this)}this.grouping&&this.grouping.dimensions().each(function(d){d.type&&
dimType_removeVisualRole.call(d.type,this)},this);if(this.grouping=a){if(this.isReversed)this.grouping=this.grouping.reversed();this.grouping.dimensions().each(function(d){dimType_addVisualRole.call(d.type,this)},this)}return this}});
def.type("pvc.visual.Scene").init(function(a,b){if(pvc.debug>=4)this.id=def.nextId("scene");this._renderId=0;this.renderState={};pv.Dom.Node.call(this,null);this.parent=a||null;this.root=this;if(a){var c=def.get(b,"index",null);a.insertAt(this,c);this.root=a.root}else{this._active=null;this._panel=def.get(b,"panel")||def.fail.argumentRequired("panel","Argument is required on root scene.")}this.datum=(b=(c=def.get(b,"group",null))?c._datums[0]:def.get(b,"datum"))||null;this.group=c;var d,e=c||b;this.atoms=
e?e.atoms:(d=a&&a.atoms)?Object.create(d):{};if(!e||e.isNull)this.isNull=true;this.firstAtoms=(e=b||c)?e.atoms:(d=a&&a.atoms)?Object.create(d):this.atoms;this.vars=a?Object.create(a.vars):{}}).add(pv.Dom.Node).add({isNull:false,data:function(){var a=this.group;if(!a){for(var b=this;!a&&(b=b.parent);)a=b.group;if(!a)a=this.panel.data}return a},datums:function(){return this.group?this.group.datums():this.datum?def.query(this.datum):def.query()},format:function(a){return def.format(a,this._formatScope,
this)},_formatScope:function(a){if(a.charAt(0)==="#"){a=a.substr(1).split(".");if(a.length>2)throw def.error.operationInvalid("Scene format mask is invalid.");var b=this.firstAtoms[a[0]];if(b){if(a.length>1)switch(a[1]){case "value":return b.value;case "label":break;default:throw def.error.operationInvalid("Scene format mask is invalid.");}return b}return null}return def.getPath(this.vars,a)},isRoot:function(){return this.root===this},panel:function(){return this.root._panel},chart:function(){return this.root._panel.chart},
compatVersion:function(){return this.root._panel.compatVersion()},children:function(){if(!this.childNodes)return def.query();return def.query(this.childNodes)},leafs:function(){function a(c){for(;c.childNodes.length;)c=c.childNodes[0];return c}var b=this;return def.query(function(c){if(!c){c=a(b);if(c===b)return 0;this.item=c;return 1}if(c=this.item.nextSibling){this.item=c;return 1}for(var d=this.item;d!==b&&(d=d.parentNode);)if(c=d.nextSibling){this.item=a(c);return 1}return 0})},anyInteraction:function(){return!!this.root._active||
this.anySelected()},isActive:false,setActive:function(a){a=!!a;if(this.isActive!==a)rootScene_setActive.call(this.root,this.isActive?null:this)},clearActive:function(){return rootScene_setActive.call(this.root,null)},anyActive:function(){return!!this.root._active},active:function(){return this.root._active},activeSeries:function(){var a=this.active(),b;return a&&(b=a.vars.series)&&b.value},isActiveSeries:function(){if(this.isActive)return true;var a=this.renderState.isActiveSeries;if(a==null){var b;
a=(b=this.activeSeries())!=null&&b===this.vars.series.value;this.renderState.isActiveSeries=a}return a},isActiveDatum:function(){if(this.isActive)return true;var a=this.renderState.isActiveDatum;if(a==null){a=(a=this.active())?this.group&&a.group===this.group||this.datum&&a.datum===this.datum:false;this.renderState.isActiveDatum=a}return a},isSelected:function(){return this._selectedData().is},anySelected:function(){return this._selectedData().any},_selectedData:function(){return def.lazy(this.renderState,
"_selectedData",this._createSelectedData,this)},_createSelectedData:function(){var a=this.panel().chart.data.owner.selectedCount()>0,b=a&&this.datums().any(function(c){return c.isSelected});return{any:a,is:b}}});function scene_renderId(a){if(this._renderId!==a){this._renderId=a;this.renderState={}}}
function rootScene_setActive(a){var b;if(a&&(b=a.ownerScene))a=b;if(this._active!==a){this._active&&scene_setActive.call(this._active,false);(this._active=a||null)&&scene_setActive.call(this._active,true);return true}return false}function scene_setActive(a){if(this.isActive!==a)if(a)this.isActive=true;else delete this.isActive}
def.scope(function(){var a=pvc.visual.ValueLabelVar=function(b,c,d){this.value=b;this.label=c;if(d!==undefined)this.rawValue=d};def.set(a.prototype,"rawValue",undefined,"clone",function(){return new pvc.visual.ValueLabelVar(this.value,this.label,this.rawValue)},"toString",function(){var b=this.label||this.value;return b==null?"":typeof b!=="string"?""+b:b});a.fromComplex=function(b){return b?new pvc.visual.ValueLabelVar(b.value,b.label,b.rawValue):new pvc.visual.ValueLabelVar(null,"",null)};a.fromAtom=
a.fromComplex});
def.type("pvc.visual.RoleVarHelper").init(function(a,b,c){var d=def.get(c,"hasPercentSubVar",false);c=def.get(c,"roleVar");var e=this.grouping=b&&b.grouping;if(e){this.role=b;this.sourceRoleName=b.sourceRole&&b.sourceRole.name;var h=a.panel();this.panel=h;if(!e.isDiscrete()){this.rootContDim=h.data.owner.dimensions(e.firstDimensionName());if(d)this.percentFormatter=h.chart.options.percentValueFormat}}if(!c){if(!b)throw def.error.operationInvalid("Role is not defined, so the roleVar argument is required.");c=
b.name}if(!e){b=a.vars[c]=new pvc.visual.ValueLabelVar(null,"");if(d)b.percent=new pvc.visual.ValueLabelVar(null,"")}this.roleVarName=c;a["is"+def.firstUpperCase(c)+"Bound"]=!!e}).add({isBound:function(){return!!this.grouping},onNewScene:function(a,b){if(this.grouping){var c=this.roleVarName;if(!a.vars[c]){var d=this.sourceRoleName;if(d)if(d=def.getOwn(a.vars,d)){a.vars[c]=d.clone();return}if(b){var e;if(b=this.rootContDim){var h;var g=(d=a.group)?d.singleDatum():a.datum;if(g){if(!g.isNull){e=pvc.visual.ValueLabelVar.fromAtom(g.atoms[b.name]);
if(e.value!=null&&this.percentFormatter)if(d){d=d.dimensions(b.name);h=d.percentOverParent({visible:true})}else h=a.data().dimensions(b.name).percent(e.value)}}else if(d){d=d.dimensions(b.name);g=d.sum({visible:true,zeroIfNone:false});if(g!=null){e=b.format(g);e=new pvc.visual.ValueLabelVar(g,e,g);if(this.percentFormatter)h=d.percentOverParent({visible:true})}}if(e&&this.percentFormatter)e.percent=e.value==null?new pvc.visual.ValueLabelVar(null,""):new pvc.visual.ValueLabelVar(h,this.percentFormatter.call(null,
h))}else if((h=a.datum)&&!h.isNull){e=this.grouping.view(h);e=pvc.visual.ValueLabelVar.fromComplex(e)}if(!e){e=new pvc.visual.ValueLabelVar(null,"");if(this.percentFormatter)e.percent=new pvc.visual.ValueLabelVar(null,"")}a.vars[c]=e}}}}});
(function(){function a(c){var d=b(c)||def.assert("There must exist an ancestor sign");d=new pvc.visual.BasicSign(d.panel,c);var e,h=c.scene;if(h&&(e=c.index)!=null&&e>=0)d._buildInstance(c,h[e],true);return d}function b(c){var d;do c=c.parent;while(c&&!(d=c.sign)&&(!c.proto||!(d=c.proto.sign)));return d}pv.Mark.prototype.getSign=function(){return this.sign||a(this)};pv.Mark.prototype.getScene=function(){return this.getSign().scene};def.type("pvc.visual.BasicSign").init(function(c,d){this.chart=c.chart;
this.panel=c;this.pvMark=d;!d.sign||def.assert("Mark already has an attached Sign.");d.sign=this;d.__buildInstance=d.buildInstance;d.buildInstance=this._dispatchBuildInstance}).add({compatVersion:function(){return this.chart.compatVersion()},localProperty:function(c,d){this.pvMark.localProperty(c,d);return this},lock:function(c,d){return this.lockMark(c,this._bindWhenFun(d))},optional:function(c,d,e){return this.optionalMark(c,this._bindWhenFun(d),e)},lockMark:function(c,d){this.pvMark.lock(c,d);
return this},optionalMark:function(c,d,e){this.pvMark[c](d,e);return this},delegate:function(c,d){return this.pvMark.delegate(c,d)},delegateExtension:function(c){return this.pvMark.delegate(c,pvc.extensionTag)},hasDelegate:function(c){return this.pvMark.hasDelegate(c)},_bindWhenFun:function(c){if(typeof c==="function")return function(){var d=this.getSign();return c.apply(d,arguments)};return c},_lockDynamic:function(c,d){var e=this;return this.lockMark(c,function(){var h=this.getSign();return(h[d]||
e[d]||def.assert("No method with name '"+d+"' is defined")).apply(h,arguments)})},_dispatchBuildInstance:function(c){this.sign._buildInstance(this,c)},_buildInstance:function(c,d,e){var h=d.data,g=h?h.childIndex():0;this.pvInstance=d;this.scene=h;this.index=g<0?0:g;scene_renderId.call(h,c.renderId());this.state={};e||c.__buildInstance.call(c,d)}})})();
def.type("pvc.visual.Sign",pvc.visual.BasicSign).init(function(a,b,c){this.base(a,b,c);this.bits=0;var d=def.get(c,"extensionId");if(d!=null)this.extensionAbsIds=def.array.to(a._makeExtensionAbsId(d));if(this.isActiveSeriesAware=def.get(c,"activeSeriesAware",true)){d=a.visualRoles&&a.visualRoles.series;if(!d||!d.isBound())this.isActiveSeriesAware=false}(d=def.get(c,"wrapper"))||(d=function(e){return function(h){return e.call(a._getContext(b),h)}});b.wrapper(d);def.get(c,"freeColor",true)||this._bindProperty("fillStyle",
"fillColor","color")._bindProperty("strokeStyle","strokeColor","color")}).postInit(function(a,b,c){this._addInteractive(c);a._addSign(this)}).add({property:function(a){var b=def.firstUpperCase(a),c="base"+b,d="default"+b,e="normal"+b,h="interactive"+b;b={};b[a]=function(g){delete this._finished;var j;this._arg=g;try{j=this[c](g);if(j==null)return null;if(this.hasOwnProperty("_finished"))return j;j=this.showsInteraction()&&this.scene.anyInteraction()?this[h](j,g):this[e](j,g)}finally{delete this._arg}return j};
b[c]=function(){return this.delegateExtension()};b[d]=function(){};b[e]=function(g){return g};b[h]=function(g){return g};this.constructor.add(b);return this},finished:function(a){this._finished=true;return a},applyExtensions:function(){if(!this._extended){this._extended=true;var a=this.extensionAbsIds;a&&a.forEach(function(b){this.panel.extendAbs(this.pvMark,b)},this)}return this},intercept:function(a,b){return this._intercept(a,b.bind(this))},lockDimensions:function(){this.pvMark.lock("left").lock("right").lock("top").lock("bottom").lock("width").lock("height");
return this},_extensionKeyArgs:{tag:pvc.extensionTag},_bindProperty:function(a,b,c){function d(){return e[b]()}var e=this;c||(c=b);var h="default"+def.firstUpperCase(c);if(def.fun.is(this[h]))this.pvMark.hasDelegateValue(a,pvc.extensionTag)||this.pvMark.intercept(a,function(){return e[h](e._arg)},this._extensionKeyArgs);return this._intercept(a,d)},_intercept:function(a,b){var c=this.pvMark,d=this.extensionAbsIds;d&&def.query(d).select(function(e){return this.panel._getExtensionAbs(e,a)},this).where(def.notUndef).each(function(e){e=
c.wrap(e,a);c.intercept(a,e,this._extensionKeyArgs)},this);(c._intercepted||(c._intercepted={}))[a]=true;c.intercept(a,b);return this}}).prototype.property("color").constructor.add({_bitShowsActivity:2,_bitShowsSelection:4,_bitShowsInteraction:6,_bitShowsTooltip:8,_bitSelectable:16,_bitHoverable:32,_bitClickable:64,_bitDoubleClickable:128,_bitClickSelectable:256,_bitRubberSelectable:512,_bitHasEvents:248,showsInteraction:function(){return(this.bits&this._bitShowsInteraction)!==0},showsActivity:function(){return(this.bits&
this._bitShowsActivity)!==0},showsSelection:function(){return(this.bits&this._bitShowsSelection)!==0},showsTooltip:function(){return(this.bits&this._bitShowsTooltip)!==0},isSelectable:function(){return(this.bits&this._bitSelectable)!==0},isRubberSelectable:function(){return(this.bits&this._bitRubberSelectable)!==0},isClickSelectable:function(){return(this.bits&this._bitClickSelectable)!==0},isHoverable:function(){return(this.bits&this._bitHoverable)!==0},isClickable:function(){return(this.bits&this._bitClickable)!==
0},isDoubleClickable:function(){return(this.bits&this._bitDoubleClickable)!==0},extensionAbsIds:null,_addInteractive:function(a){var b=this.panel,c=this.pvMark,d=this.chart,e=d.options,h=this.bits;h|=this._bitShowsInteraction;if(d._tooltipEnabled&&!def.get(a,"noTooltip")){h|=this._bitShowsTooltip;this.panel._addPropTooltip(c,def.get(a,"tooltipArgs"))}var g=false,j=false;if(e.selectable||e.hoverable){if(e.selectable&&!def.get(a,"noSelect")){h|=this._bitSelectable;if(g=!def.get(a,"noClickSelect")&&
d._canSelectWithClick())h|=this._bitClickSelectable;def.get(a,"noRubberSelect")||(h|=this._bitRubberSelectable)}if(e.hoverable&&!def.get(a,"noHover")){h|=this._bitHoverable;b._addPropHoverable(c)}}d=def.get(a,"showsInteraction");if(d!=null)if(d)h|=this._bitShowsInteraction;else h&=~this._bitShowsInteraction;d=def.get(a,"showsActivity");if(d!=null)if(d)h|=this._bitShowsActivity;else h&=~this._bitShowsActivity;d=def.get(a,"showsSelection");if(d!=null)if(d)h|=this._bitShowsSelection;else h&=~this._bitShowsSelection;
if(!def.get(a,"noClick")&&b._isClickable()){h|=this._bitClickable;j=true}if(g||j)b._addPropClick(c);if(!def.get(a,"noDoubleClick")&&b._isDoubleClickable()){h|=this._bitDoubleClickable;b._addPropDoubleClick(c)}h&this._bitHasEvents||this.pvMark.events("none");this.bits=h},fillColor:function(){return this.color("fill")},strokeColor:function(){return this.color("stroke")},defaultColor:function(){return this.defaultColorSceneScale()(this.scene)},dimColor:function(a,b){if(b==="text")return pvc.toGrayScale(a,
-0.75,null,null);return pvc.toGrayScale(a,-0.3,null,null)},defaultColorSceneScale:function(){return def.lazy(this,"_defaultColorSceneScale",this._initDefColorScale,this)},_initDefColorScale:function(){var a=this.panel.axes.color;return a?a.sceneScale({sceneVarName:"color"}):def.fun.constant(pvc.defaultColor)},mayShowActive:function(a){if(!this.showsActivity())return false;var b=this.scene;return b.isActive||!a&&this.isActiveSeriesAware&&b.isActiveSeries()||b.isActiveDatum()},mayShowNotAmongSelected:function(){return this.showsSelection()&&
this.scene.anySelected()&&!this.scene.isSelected()},mayShowSelected:function(){return this.showsSelection()&&this.scene.isSelected()}});def.type("pvc.visual.Panel",pvc.visual.Sign).init(function(a,b,c){var d=def.get(c,"panel");if(!d){d=def.get(c,"panelType")||pv.Panel;d=b.add(d)}this.base(a,d,c)}).add({_addInteractive:function(a){a=def.setDefaults(a,"noSelect",true,"noHover",true,"noTooltip",true,"noClick",true,"noDoubleClick",true);this.base(a)}});
def.type("pvc.visual.Label",pvc.visual.Sign).init(function(a,b,c){b=b.add(pv.Label);this.base(a,b,c)}).add({_addInteractive:function(a){a=def.setDefaults(a,"noSelect",true,"noHover",true,"noTooltip",true,"noClick",true,"noDoubleClick",true,"showsInteraction",false);this.base(a)},defaultColor:function(){return pv.Color.names.black}});
def.type("pvc.visual.ValueLabel",pvc.visual.Label).init(function(a,b,c){b=b.anchor(a.valuesAnchor);if(c&&c.extensionId==null)c.extensionId="label";this.base(a,b,c);var d=a.valuesMask;this.pvMark.font(a.valuesFont).text(function(e){return e.format(d)});this.intercept("textStyle",function(){delete this._finished;var e=this.delegate();if(e&&!this.hasOwnProperty("_finished")&&!this.mayShowActive()&&this.mayShowNotAmongSelected())e=this.dimColor(e,"text");return e})}).addStatic({maybeCreate:function(a,
b,c){return a.valuesVisible&&a.valuesMask?new pvc.visual.ValueLabel(a,b,c):null},isNeeded:function(a){return a.valuesVisible&&a.valuesMask}}).add({_addInteractive:function(a){a=def.setDefaults(a,"showsInteraction",true,"noSelect",false);this.base(a)}});
def.type("pvc.visual.Dot",pvc.visual.Sign).init(function(a,b,c){b=b.add(pv.Dot);var d=def.get(c,"proto");d&&b.extend(d);c=def.setDefaults(c,"freeColor",false);this.base(a,b,c);if(!def.get(c,"freePosition",false)){c=a.isOrientationVertical()?"left":"bottom";a=a.anchorOrtho(c);this._lockDynamic(c,"x")._lockDynamic(a,"y")}this._bindProperty("shape","shape")._bindProperty("shapeRadius","radius")._bindProperty("shapeSize","size");this.optional("strokeDasharray",undefined).optional("lineWidth",1.5)}).prototype.property("size").property("shape").constructor.add({y:function(){return 0},
x:function(){return 0},radius:function(){this.state.radius=this.delegateExtension()},baseSize:function(){var a=this.state.radius;return a!=null?def.sqr(a):this.base()},defaultSize:function(){return 12},interactiveSize:function(a){return this.mayShowActive(true)?Math.max(a,5)*2.5:a},interactiveColor:function(a,b){if(this.mayShowActive(true)){if(b==="stroke")return a.brighter(1)}else if(this.mayShowNotAmongSelected()){if(this.mayShowActive())return a.alpha(0.8);switch(b){case "fill":return this.dimColor(a,
b);case "stroke":return a.alpha(0.45)}}return this.base(a,b)}});
def.type("pvc.visual.DotSizeColor",pvc.visual.Dot).init(function(a,b,c){this.base(a,b,c);var d=this.compatVersion()<=1;this._bindProperty("lineWidth","strokeWidth").intercept("visible",function(){if(!this.canShow())return false;var h=this.delegateExtension();if(h==null)h=d?true:this.defaultVisible();return h});this._initColor();this._initSize();if(this.isSizeBound)if(a.axes.size.scaleUsesAbs()){this.isSizeAbs=true;var e=this._sceneDefColor;this._sceneDefColor=function(h,g){return g==="stroke"&&h.vars.size.value<
0?pv.Color.names.black:e.call(this,h,g)};this.pvMark.lineCap("round").strokeDasharray(function(h){return h.vars.size.value<0?"shortdash":null})}}).prototype.property("strokeWidth").constructor.add({isColorBound:false,isColorDiscrete:false,isSizeBound:false,isSizeAbs:false,canShow:function(){return!this.scene.isIntermediate},defaultVisible:function(){var a=this.scene;return!a.isNull&&(!this.isSizeBound&&!this.isColorBound||this.isSizeBound&&a.vars.size.value!=null||this.isColorBound&&(this.isColorDiscrete||
a.vars.color.value!=null))},_initColor:function(){var a,b,c=this.panel,d=c.visualRoles.color;if(d){this.isColorDiscrete=d.isDiscrete();var e=(c=c.axes.color)&&c.scale;if(e&&d.isBound()){this.isColorBound=true;b=c.sceneScale({sceneVarName:d.name})}else if(e)if((d=e.range())&&d.length)a=d[0]}b||(b=def.fun.constant(a||pvc.defaultColor));this._sceneDefColor=b},_initSize:function(){var a=this.panel,b=a.plot,c=b.option("Shape"),d=b.option("NullShape");b=a.visualRoles.size;var e,h;if(b){var g=(a=a.axes.size)&&
a.scale;if(g&&b.isBound()){this.isSizeBound=true;var j=g.min+(g.max-g.min)*0.05;this.nullSizeShapeHasStrokeOnly=d==="cross";h=function(k){return k.vars.size.value!=null?c:d};e=function(k){k=k.vars.size.value;return k!=null?g(k):d?j:0}}}if(!e){h=def.fun.constant(c);e=function(k){return this.base(k)}}this._sceneDefSize=e;this._sceneDefShape=h},defaultColor:function(a){return this._sceneDefColor(this.scene,a)},normalColor:function(a,b){return b==="stroke"?a.darker():this.base(a,b)},interactiveColor:function(a,
b){var c=this.scene;if(this.mayShowActive(true))switch(b){case "fill":return this.isSizeBound?a.alpha(0.75):a;case "stroke":return a.darker()}else if(this.showsSelection()){var d=c.isSelected();if(!d&&c.anySelected()){if(this.mayShowActive())return a.alpha(0.8);switch(b){case "fill":return this.dimColor(a,b);case "stroke":return a.alpha(0.45)}}if(d&&pvc.color.isGray(a)){if(b==="stroke")a=a.darker(3);return a.darker(2)}}if(b==="stroke")return a.darker();return a},defaultSize:function(){return this._sceneDefSize(this.scene)},
defaultShape:function(){return this._sceneDefShape(this.scene)},interactiveSize:function(a){if(!this.mayShowActive(true))return a;a=Math.sqrt(a);var b=Math.max(1,Math.min(1.1*a,2));return def.sqr(a+b)},defaultStrokeWidth:function(){return this.nullSizeShapeHasStrokeOnly&&this.scene.vars.size.value==null?1.8:1},interactiveStrokeWidth:function(a){return this.mayShowActive(true)?2*a:this.mayShowSelected()?1.5*a:a}});
def.type("pvc.visual.Line",pvc.visual.Sign).init(function(a,b,c){b=b.add(pv.Line);this.base(a,b,c);this.lock("segmented","smart").lock("antialias",true);if(!def.get(c,"freePosition",false)){c=a.isOrientationVertical()?"left":"bottom";this._lockDynamic(a.anchorOrtho(c),"y")._lockDynamic(c,"x")}this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({_addInteractive:function(a){a=def.setDefaults(a,"noTooltip",
true);this.base(a)},y:function(){return 0},x:function(){return 0},defaultStrokeWidth:function(){return 1.5},interactiveStrokeWidth:function(a){if(this.mayShowActive())return Math.max(1,a)*2.5;return a},interactiveColor:function(a,b){if(this.mayShowNotAmongSelected()){if(this.mayShowActive())return pv.Color.names.darkgray.darker().darker();if(b==="stroke")return this.dimColor(a,b)}return this.base(a,b)}});
def.type("pvc.visual.Area",pvc.visual.Sign).init(function(a,b,c){b=b.add(pv.Area);c||(c={});c.freeColor=true;this.base(a,b,c);b=def.get(c,"antialias",true);this.lock("segmented","smart").lock("antialias",b);if(!def.get(c,"freePosition",false)){c=a.isOrientationVertical()?"left":"bottom";b=a.anchorOrtho(c);a=a.anchorOrthoLength(b);this._lockDynamic(c,"x")._lockDynamic(b,"y")._lockDynamic(a,"dy")}this._bindProperty("fillStyle","fillColor","color");this.lock("strokeStyle",null).lock("lineWidth",0)}).add({_addInteractive:function(a){a=
def.setDefaults(a,"noTooltip",true);this.base(a)},x:function(){return 0},y:function(){return 0},dy:function(){return 0},interactiveColor:function(a,b){if(b==="fill"&&this.mayShowNotAmongSelected())return this.dimColor(a,b);return this.base(a,b)}});
def.type("pvc.visual.Bar",pvc.visual.Sign).init(function(a,b,c){b=b.add(pv.Bar);c=def.setDefaults(c,"freeColor",false);this.base(a,b,c);this.normalStroke=def.get(c,"normalStroke",false);this._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({normalColor:function(a,b){if(b==="stroke"&&!this.normalStroke)return null;return a},interactiveColor:function(a,b){if(b==="stroke"){if(this.mayShowActive(true))return a.brighter(1.3).alpha(0.7);if(!this.normalStroke)return null;
if(this.mayShowNotAmongSelected()){if(this.mayShowActive())return pv.Color.names.darkgray.darker().darker();return this.dimColor(a,b)}if(this.mayShowActive())return a.brighter(1).alpha(0.7)}else if(b==="fill"){if(this.mayShowActive(true))return a.brighter(0.2).alpha(0.8);if(this.mayShowNotAmongSelected()){if(this.mayShowActive())return pv.Color.names.darkgray.darker(2).alpha(0.8);return this.dimColor(a,b)}if(this.mayShowActive())return a.brighter(0.2).alpha(0.8)}return this.base(a,b)},defaultStrokeWidth:function(){return 0.5},
interactiveStrokeWidth:function(a){if(this.mayShowActive(true))return Math.max(1,a)*1.3;return a}});pv.PieSlice=function(){pv.Wedge.call(this)};pv.PieSlice.prototype=pv.extend(pv.Wedge);pv.PieSlice.prototype.midAngle=function(){var a=this.instance();return a.startAngle+a.angle/2};
def.type("pvc.visual.PieSlice",pvc.visual.Sign).init(function(a,b,c){b=b.add(pv.PieSlice);c=def.setDefaults(c,"freeColor",false);this.base(a,b,c);this._activeOffsetRadius=def.get(c,"activeOffsetRadius",0);this._center=def.get(c,"center");this.optional("lineWidth",0.6)._bindProperty("angle","angle")._lockDynamic("bottom","y")._lockDynamic("left","x").lock("top",null).lock("right",null)}).prototype.property("offsetRadius").constructor.add({angle:function(){return 0},x:function(){return this._center.x+
this._offsetSlice("cos")},y:function(){return this._center.y-this._offsetSlice("sin")},_offsetSlice:function(a){var b=this._getOffsetRadius();if(b!==0)b*=Math[a](this.pvMark.midAngle());return b},_getOffsetRadius:function(){var a=this.state.offsetRadius;if(a==null)a=this.state.offsetRadius=this.offsetRadius()||0;return a},defaultColor:function(a){if(a==="stroke")return null;return this.base(a)},interactiveColor:function(a,b){if(this.mayShowActive(true))switch(b){case "fill":return a.brighter(0.2).alpha(0.8);
case "stroke":return a.brighter(1.3).alpha(0.7)}else if(this.mayShowNotAmongSelected())if(b==="fill")return this.dimColor(a,b);return this.base(a,b)},baseOffsetRadius:function(){return 0},interactiveOffsetRadius:function(a){if(this.mayShowActive(true))return a+this._activeOffsetRadius;return a}});
def.type("pvc.visual.Rule",pvc.visual.Sign).init(function(a,b,c){b=b.add(pv.Rule);var d=def.get(c,"proto");d&&b.extend(d);this.base(a,b,c);def.get(c,"freeStyle")||this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({_addInteractive:function(a){a=def.setDefaults(a,"noHover",true,"noSelect",true,"noTooltip",true,"noClick",true,"noDoubleClick",true,"showsInteraction",false);this.base(a)},defaultStrokeWidth:function(){return 1},
interactiveStrokeWidth:function(a){if(this.mayShowActive(true))return Math.max(1,a)*2.2;return a},interactiveColor:function(a,b){if(this.scene.datum&&!this.mayShowActive(true)&&this.mayShowNotAmongSelected())return this.dimColor(a,b);return this.base(a,b)}});
def.type("pvc.visual.Context").init(function(a,b,c){this.chart=a.chart;this.panel=a;visualContext_update.call(this,b,c)}).add({isPinned:false,pin:function(){this.isPinned=true;return this},finished:function(a){return this.sign.finished(a)},delegate:function(a){return this.sign.delegate(a)},getV1Series:function(){var a,b=this.scene.firstAtoms&&(a=this.scene.firstAtoms[this.panel._getV1DimName("series")])&&a.rawValue;if(b==null)b="Series";return b},getV1Category:function(){var a;return this.scene.firstAtoms&&
(a=this.scene.firstAtoms[this.panel._getV1DimName("category")])&&a.rawValue},getV1Value:function(){var a;return this.scene.firstAtoms&&(a=this.scene.firstAtoms[this.panel._getV1DimName("value")])&&a.value},getV1Datum:function(){return this.panel._getV1Datum(this.scene)}});
if(Object.defineProperty)try{Object.defineProperty(pvc.visual.Context.prototype,"parent",{get:function(){throw def.error.operationInvalid("The 'this.parent.index' idiom has no equivalent in this version. Please try 'this.pvMark.parent.index'.");}})}catch(ex){}
function visualContext_update(a,b){this.event=b||null;this.pvMark=a;var c;if(a){if(this.sign=a.sign||null)c=a.instance().data;if(c)this.index=c.childIndex();else{this.index=null;c=new pvc.visual.Scene(null,{panel:this.panel})}}else{this.index=this.sign=null;c=new pvc.visual.Scene(null,{panel:this.panel,group:this.chart.root.data})}this.scene=c}
def.type("pvc.visual.OptionsBase").init(function(a,b,c,d){this.chart=a;this.type=b;this.index=c==null?0:c;this.name=def.get(d,"name");this.id=this._buildId();this.optionId=this._buildOptionId();this._registerResolversFull(this._resolvers=[],d);this.option=pvc.options(this._getOptionsDefinition(),this)}).add({_buildId:function(){return pvc.buildIndexedId(this.type,this.index)},_buildOptionId:function(){return this.id},_getOptionsDefinition:def.method({isAbstract:true}),_chartOption:function(a){return this.chart.options[a]},
_registerResolversFull:function(a,b){var c=def.get(b,"fixed");if(c){this._fixed=c;a.push(pvc.options.specify(function(d){return c[d.name]}))}this._registerResolversNormal(a,b);if(b=def.get(b,"defaults"))this._defaults=b;a.push(this._resolveDefault)},_registerResolversNormal:function(a,b){this.chart.compatVersion()<=1&&a.push(this._resolveByV1OnlyLogic);this.name&&a.push(pvc.options.specify(function(c){return this._chartOption(this.name+def.firstUpperCase(c.name))}));a.push(this._resolveByOptionId);
def.get(b,"byNaked",!this.index)&&a.push(this._resolveByNaked)},_resolveFull:function(a){for(var b=this._resolvers,c=0,d=b.length;c<d;c++)if(b[c].call(this,a))return true;return false},_resolveFixed:pvc.options.specify(function(a){if(this._fixed)return this._fixed[a.name]}),_resolveByV1OnlyLogic:function(a){var b=a.data,c;if(b&&(c=b.resolveV1))return c.call(this,a)},_resolveByName:pvc.options.specify(function(a){if(this.name)return this._chartOption(this.name+def.firstUpperCase(a.name))}),_resolveByOptionId:pvc.options.specify(function(a){return this._chartOption(this.optionId+
def.firstUpperCase(a.name))}),_resolveByNaked:pvc.options.specify(function(a){if(!this.index)return this._chartOption(def.firstLowerCase(a.name))}),_resolveDefault:function(a){var b=a.data,c;if(b&&(c=b.resolveDefault))if(c.call(this,a))return true;if(this._defaults){b=this._defaults[a.name];if(b!==undefined){a.defaultValue(b);return true}}},_specifyChartOption:function(a,b){b=this._chartOption(b);if(b!=null){a.specify(b);return true}}});var axis_optionsDef;
def.scope(function(){function a(b){return b.isDiscrete()?"discrete":b.firstDimensionValueType()===Date?"timeSeries":"numeric"}def.type("pvc.visual.Axis",pvc.visual.OptionsBase).init(function(b,c,d,e){this.base(b,c,d,e);b._addAxis(this)}).add({isVisible:true,scaleTreatsNullAs:function(){return"null"},scaleNullRangeValue:function(){return null},scaleUsesAbs:function(){return false},bind:function(b){b||def.fail.argumentRequired("dataCells");!this.dataCells||def.fail.operationInvalid("Axis is already bound.");
this.dataCells=def.array.to(b);this.role=(this.dataCell=this.dataCells[0])&&this.dataCell.role;this.scaleType=a(this.role.grouping);this._checkRoleCompatibility();return this},isDiscrete:function(){return this.role&&this.role.isDiscrete()},isBound:function(){return!!this.role},setScale:function(b,c){this.role||def.fail.operationInvalid("Axis is unbound.");this.scale=b?c?b:this._wrapScale(b):null;return this},_wrapScale:function(b){b.type=this.scaleType;var c;if(b.type!=="discrete"){c=this.scaleUsesAbs();
var d=this.scaleTreatsNullAs();if(d&&d!=="null"){var e=d==="min"?b.domain()[0]:0;c=c?function(g){return b(g==null?e:g<0?-g:g)}:function(g){return b(g==null?e:g)}}else{var h=this.scaleNullRangeValue();c=c?function(g){return g==null?h:b(g<0?-g:g)}:function(g){return g==null?h:b(g)}}}else c=function(g){return b(g==null?"":g)};return def.copy(c,b)},sceneScale:function(b){var c=def.get(b,"sceneVarName")||this.role.name,d=this.role.grouping;if(d.isSingleDimension&&d.firstDimensionValueType()===Number){var e=
this.scale,h=def.get(b,"nullToZero",true);b=function(g){g=g.vars[c].value;if(g==null){if(!h)return g;g=0}return e(g)};def.copy(b,e);return b}return this.scale.by1(function(g){return g.vars[c].value})},_checkRoleCompatibility:function(){var b=this.dataCells.length;if(b>1){var c=this.role.grouping,d;if(this.scaleType==="discrete")for(d=1;d<b;d++){if(c.id!==this.dataCells[d].role.grouping.id)throw def.error.operationInvalid("Discrete roles on the same axis must have equal groupings.");}else{if(!c.firstDimensionType().isComparable)throw def.error.operationInvalid("Continuous roles on the same axis must have 'comparable' groupings.");
for(d=1;d<b;d++)if(this.scaleType!==a(this.dataCells[d].role.grouping))throw def.error.operationInvalid("Continuous roles on the same axis must have scales of the same type.");}}},_getOptionsDefinition:function(){return axis_optionsDef}});axis_optionsDef={}});
def.scope(function(){function a(f,i){return pvc.parseDomainScope(f,i.orientation)}function b(f){if(f){if(def.hasOwn(pvc.Sides.namesSet,f))return pvc.BasePanel[this.orientation==="y"?"horizontalAlign":"verticalAlign2"][f];pvc.debug>=2&&pvc.log(def.format("Invalid axis position value '{0}'.",[f]))}return this.orientation==="x"?"bottom":"left"}function c(f){var i=this.option("Position");return pvc.Size.toOrtho(f,i)}function d(f){var i=this.option("Position");return pvc.Size.to(f,{singleProp:pvc.BasePanel.orthogonalLength[i]})}
def.type("pvc.visual.CartesianAxis",pvc.visual.Axis).init(function(f,i,l,m){this.orientation=e.getOrientation(i,f.options.orientation);this.orientedId=e.getOrientedId(this.orientation,l);if(f._allowV1SecondAxis&&l===1)this.v1SecondOrientedId="second"+this.orientation.toUpperCase();this.base(f,i,l,m);f=this.extensionPrefixes=[this.id+"Axis",this.orientedId+"Axis"];this.v1SecondOrientedId&&f.push(this.v1SecondOrientedId+"Axis");this._extPrefAxisPosition=f.length;f.push("axis")}).add({bind:function(f){this.base(f);
this._syncExtensionPrefixes();return this},_syncExtensionPrefixes:function(){var f=this.extensionPrefixes;f.length=this._extPrefAxisPosition;var i=this.scaleType;if(i){f.push(i+"Axis");i!=="discrete"&&f.push("continuousAxis")}f.push("axis")},setScale:function(f){var i=this.scale;this.base(f);if(i){delete this.domain;delete this.ticks;delete this._roundingPaddings}if(f)if(!f.isNull&&this.scaleType!=="discrete"){this.domain=f.domain();this.domain.minLocked=!!f.minLocked;this.domain.maxLocked=!!f.maxLocked;
if(this.scaleType==="numeric"){this.option("DomainRoundMode")==="nice"&&f.nice();(i=this.option("TickFormatter"))&&f.tickFormatter(i)}}return this},setTicks:function(f){var i=this.scale;i&&!i.isNull||def.fail.operationInvalid("Scale must be set and non-null.");this.ticks=f;if(i.type==="numeric"&&this.option("DomainRoundMode")==="tick"){delete this._roundingPaddings;(i=f&&f.length)?this.scale.domain(f[0],f[i-1]):this.scale.domain(this.domain[0],this.domain[1])}},setScaleRange:function(f){var i=this.scale;
i.min=0;i.max=f;i.size=f;if(i.type==="discrete"){if(i.domain().length>0)i.splitBandedCenter(i.min,i.max,this.chart.options.panelSizeRatio||0.8)}else i.range(i.min,i.max);return i},getScaleRoundingPaddings:function(){var f=this._roundingPaddings;if(!f){f={begin:0,end:0,beginLocked:false,endLocked:false};var i=this.scale;if(i&&!i.isNull&&i.type!=="discrete"){var l=this.domain;f.beginLocked=l.minLocked;f.endLocked=l.maxLocked;if(i.type==="numeric"&&this.option("DomainRoundMode")!=="none"){i=i.domain();
l=this.domain||def.assert("Original domain must be set");var m=i[1]-i[0];if(m){var n=l[0]-i[0];if(n>0)f.begin=n/m;n=i[1]-l[1];if(n>0)f.end=n/m}}}this._roundingPaddings=f}return f},calcContinuousTicks:function(f){if(f==null)f=this.option("DesiredTickCount");return this.scale.ticks(f,{roundInside:this.option("DomainRoundMode")!=="tick",numberExponentMin:this.option("TickExponentMin"),numberExponentMax:this.option("TickExponentMax")})},_getOptionsDefinition:function(){return k},_buildOptionId:function(){return this.id+
"Axis"},_registerResolversNormal:function(f){this.chart.compatVersion()<=1&&f.push(this._resolveByV1OnlyLogic);f.push(this._resolveByOptionId,this._resolveByOrientedId);this.index===1&&f.push(this._resolveByV1OptionId);f.push(this._resolveByScaleType,this._resolveByCommonId)},_resolveByOrientedId:pvc.options.specify(function(f){return this._chartOption(this.orientedId+"Axis"+f.name)}),_resolveByV1OptionId:pvc.options.specify(function(f){return this._chartOption("secondAxis"+f.name)}),_resolveByScaleType:pvc.options.specify(function(f){var i=
this.scaleType;if(i){f=f.name;var l=this._chartOption(i+"Axis"+f);if(l===undefined&&i!=="discrete")l=this._chartOption("continuousAxis"+f);return l}}),_resolveByCommonId:pvc.options.specify(function(f){return this._chartOption("axis"+f.name)})});var e=pvc.visual.CartesianAxis;e.getOrientation=function(f,i){return f==="base"===(i==="vertical")?"x":"y"};e.getOrientedId=function(f,i){if(i===0)return f;return f+(i+1)};var h={resolve:"_resolveFull",data:{resolveV1:function(f){!this.index&&this.type===
"ortho"&&this._specifyChartOption(f,this.id+f.name);return true}},cast:pvc.castNumber},g={resolveV1:function(f){if(this.index){if(this._resolveByV1OptionId(f))return true}else if(this._resolveByOrientedId(f))return true;this._resolveDefault(f);return true}},j=pvc.options.defaultValue(function(){if(!this.typeIndex)return this.orientation==="x"?"bottom":"left";var f=this.chart.axesByType[this.type].first.option("Position");return pvc.BasePanel.oppositeAnchor[f]}),k=def.create(axis_optionsDef,{Visible:{resolve:"_resolveFull",
data:{resolveV1:function(f){if(this.index<=1){var i=this.index===0?def.firstUpperCase(this.orientation):"Second";this._specifyChartOption(f,"show"+i+"Scale")}return true}},cast:Boolean,value:true},Composite:{resolve:function(f){if(this.index>0){f.specify(false);return true}return this._resolveFull(f)},data:{resolveV1:function(f){this._specifyChartOption(f,"useCompositeAxis");return true}},cast:Boolean,value:false},Size:{resolve:"_resolveFull",data:g,cast:c},SizeMax:{resolve:"_resolveFull",cast:c},
Position:{resolve:"_resolveFull",data:{resolveV1:g.resolveV1,resolveDefault:j},cast:b},FixedMin:h,FixedMax:h,OriginIsZero:{resolve:"_resolveFull",data:{resolveV1:function(f){switch(this.index){case 0:this._specifyChartOption(f,"originIsZero");break;case 1:this.chart._allowV1SecondAxis&&this._specifyChartOption(f,"secondAxisOriginIsZero");break}return true}},cast:Boolean,value:true},DomainScope:{resolve:"_resolveFull",cast:a,value:"global"},Offset:{resolve:"_resolveFull",data:{resolveV1:function(f){switch(this.index){case 0:this._specifyChartOption(f,
"axisOffset");break;case 1:if(this.chart._allowV1SecondAxis){this._specifyChartOption(f,"secondAxisOffset");break}break}return true}},cast:pvc.castNumber},LabelSpacingMin:{resolve:"_resolveFull",cast:pvc.castNumber},OverlappedLabelsMode:{resolve:"_resolveFull",cast:pvc.parseOverlappedLabelsMode,value:"hide"},Grid:{resolve:"_resolveFull",data:{resolveV1:function(f){this.index||this._specifyChartOption(f,this.orientation+"AxisFullGrid");return true}},cast:Boolean,value:false},GridCrossesMargin:{resolve:"_resolveFull",
cast:Boolean,value:true},EndLine:{resolve:"_resolveFull",cast:Boolean},ZeroLine:{resolve:"_resolveFull",cast:Boolean,value:true},RuleCrossesMargin:{resolve:"_resolveFull",cast:Boolean,value:true},Ticks:{resolve:"_resolveFull",cast:Boolean},DesiredTickCount:{resolve:"_resolveFull",data:{resolveV1:g.resolveV1,resolveDefault:function(f){if(this.chart.compatVersion()<=1){f.defaultValue(5);return true}}},cast:pvc.castNumber},MinorTicks:{resolve:"_resolveFull",data:g,cast:Boolean,value:true},TickFormatter:{resolve:"_resolveFull",
cast:def.fun.as},DomainRoundMode:{resolve:"_resolveFull",data:{resolveV1:g.resolveV1,resolveDefault:function(f){if(this.chart.compatVersion()<=1){f.defaultValue("none");return true}}},cast:pvc.parseDomainRoundingMode,value:"tick"},TickExponentMin:{resolve:"_resolveFull",cast:pvc.castNumber},TickExponentMax:{resolve:"_resolveFull",cast:pvc.castNumber},Title:{resolve:"_resolveFull",cast:String},TitleSize:{resolve:"_resolveFull",cast:d},TitleSizeMax:{resolve:"_resolveFull",cast:d},TitleFont:{resolve:"_resolveFull",
cast:String},TitleMargins:{resolve:"_resolveFull",cast:pvc.Sides.as},TitlePaddings:{resolve:"_resolveFull",cast:pvc.Sides.as},TitleAlign:{resolve:"_resolveFull",cast:function(f){var i=this.option("Position");return pvc.parseAlign(i,f)}},Font:{resolve:"_resolveFull",cast:String},ClickAction:{resolve:"_resolveFull",data:g},DoubleClickAction:{resolve:"_resolveFull",data:g}})});def.type("pvc.visual.CartesianAxisRootScene",pvc.visual.Scene);
def.type("pvc.visual.CartesianAxisTickScene",pvc.visual.Scene).init(function(a,b){this.base(a,b);this.vars.tick=new pvc.visual.ValueLabelVar(def.get(b,"tick"),def.get(b,"tickLabel"),def.get(b,"tickRaw"))});
def.scope(function(){def.type("pvc.visual.CartesianFocusWindow",pvc.visual.OptionsBase).init(function(c){this.base(c,"focusWindow",0,{byNaked:false});this.base=new pvc.visual.CartesianFocusWindowAxis(this,c.axes.base)}).add({_getOptionsDefinition:function(){return a},_exportData:function(){return{base:def.copyProps(this.base,pvc.visual.CartesianFocusWindow.props)}},_importData:function(c){c=c.base;this.base.option.specify({Begin:c.begin,End:c.end,Length:c.length})},_initFromOptions:function(){this.base._initFromOptions()},
_onAxisChanged:function(){var c=this.option("Changed");c&&c.call(this.chart.basePanel._getContext())}});var a=def.create(axis_optionsDef,{Changed:{resolve:"_resolveFull",cast:def.fun.as}});def.type("pvc.visual.CartesianFocusWindowAxis",pvc.visual.OptionsBase).init(function(c,d){this.window=c;this.axis=d;this.isDiscrete=d.isDiscrete();this.base(d.chart,"focusWindow"+def.firstUpperCase(d.type),0,{byNaked:false})}).addStatic({props:["begin","end","length"]}).add({_getOptionsDefinition:function(){return b},
_initFromOptions:function(){var c=this.option;this.set({begin:c("Begin"),end:c("End"),length:c("Length")})},set:function(c){var d=this,e=def.get(c,"render"),h=def.get(c,"select",true),g,j,k;if(c=d._readArgs(c)){g=c.begin;j=c.end;k=c.length}else if(this.begin!=null&&this.end!=null&&this.length!=null)return;c=d.axis;var f=c.scale,i=d.isDiscrete;c=!i?c.role.firstDimensionType().cast:null;f=f.domain();var l;if(i){i=f.length;var m,n;if(g!=null){c=+g;if(!isNaN(c))if(c===Infinity){m=i-1;g=f[m]}else if(c===
-Infinity){m=0;g=f[m]}if(m==null){m=f.indexOf(""+g);if(m<0){m=0;g=f[m]}}}if(j!=null){c=+j;if(!isNaN(c))if(c===Infinity){n=i-1;j=f[n]}else if(c===-Infinity){n=0;j=f[n]}if(n==null){n=f.indexOf(""+j);if(n<0){n=i-1;j=f[n]}}}if(k!=null){k=+k;if(isNaN(k))k=null;else if(k<0&&(g!=null||j!=null)){l=g;c=m;g=j;m=n;j=l;n=c;k=-k}}if(g!=null)if(j!=null){if(m>n){l=g;c=m;g=j;m=n;j=l;n=c}k=n-m+1}else{if(k==null)k=i-m;n=m+k-1;if(n>i-1){n=i-1;k=n-m+1}j=f[n]}else if(j!=null){if(k==null)k=n;m=n-k+1;if(m<0){m=0;k=n-m+
1}g=f[m]}else{if(k==null)k=Math.max(~~(i/3),1);if(k>i){k=i;m=0;n=i-1}else{c=~~(i/2);m=c-~~(k/2);n=m+k-1}g=f[m];j=f[n]}}else{if(k!=null){k=+k;if(isNaN(k))k=null;else if(k<0&&(g!=null||j!=null)){l=g;g=j;j=l;k=-k}}m=f[0];n=f[1];i=n-m;if(g!=null){if(g<m)g=m;if(g>n)g=n}if(j!=null){if(j<m)j=m;if(j>n)j=n}if(g!=null)if(j!=null){if(g>j){l=g;g=j;j=l}k=j-g}else{if(k==null)k=n-g;j=g+k;if(j>n){j=n;k=j-g}}else if(j!=null){if(k==null)k=j-m;g=j-k;if(g<m){g=m;k=j-g}}else{if(k==null)k=Math.max(~~(i/3),1);if(k>i){k=
i;g=m;j=n}else{l=~~(i/2);g=l-~~(k/2);j=+g+ +k}}g=c(g);j=c(j);k=c(k);if(f=d.option("Constraint")){j={type:"new",target:"begin",value:g,length:k,length0:k,min:m,max:n,minView:m,maxView:n};f(j);g=c(j.value);k=c(j.length);j=c(+g+ +k)}}d._set(g,j,k,h,e)},_updatePosition:function(c,d,e,h){var g=this,j=g.axis.scale;if(g.isDiscrete){g=j.invertIndex(c);d=j.invertIndex(d)-1;j=j.domain();c=j[g];j=j[d];g=d-g+1}else{c=j.invert(c);j=j.invert(d);g=j-c}this._set(c,j,g,e,h)},_constraintPosition:function(c){var d=
this,e=d.axis,h=e.scale;if(d.isDiscrete){e=Math.floor(h.invertIndex(c.point,true));if(e>=0){d=h.range();h=h.domain().length;d=(d.max-d.min)/h;if(e>=h&&(c.type==="new"||c.type==="resize-begin"))e=h-1;c.point=e*d}}else if(d=d.option("Constraint")){var g=e.role.firstDimensionType().cast,j=g(h.invert(c.point));e=c.target==="begin"?1:-1;var k=g(h.invert(c.point+e*c.length));k=g(e*(k-j));var f,i;if(c.length===c.length0)f=k;else{i=c.point+e*c.length0;i=g(h.invert(i));f=e*(i-j)}i=g(h.invert(c.min));var l=
g(h.invert(c.max));g={type:c.type,target:c.target,value:j,length:k,length0:f,min:i,max:l,minView:g(h.invert(c.minView)),maxView:g(h.invert(c.maxView))};d(g);if(+g.value!==+j){j=g.value;c.point=h(j)}d=g.length;if(+d!==+k)if(+d===+f)c.length=c.length0;else{d=h(+j+e*+d);c.length=d-e*c.point}if(+g.min!==+i)c.min=h(g.min);if(+g.max!==+l)c.max=h(g.max)}},_compare:function(c,d){return this.isDiscrete?""+c===""+d:+c===+d},_set:function(c,d,e,h,g){var j=this,k=false;if(!j._compare(c,j.begin)){j.begin=c;k=
true}if(!j._compare(d,j.end)){j.end=d;k=true}if(!j._compare(e,j.length)){j.length=e;k=true}k&&j.window._onAxisChanged(this);h&&j._updateSelection({render:g});return k},_readArgs:function(c){if(c){var d={},e=0;pvc.visual.CartesianFocusWindowAxis.props.forEach(function(h){var g=c[h];if(g!=null)e=true;else g=this[h];d[h]=g},this);if(e)return d}},_updateSelection:function(c){var d=this,e,h=d.axis,g=h.isDiscrete(),j=h.chart,k=h.dataCell;h=k.role;k=j.partData(k.dataPartValue,{visible:true});var f;if(g){f=
k.flattenBy(h);h=f._childrenByKey[d.begin];g=f._childrenByKey[d.end];if(h&&g){e=h.childIndex();g=g.childIndex();e=def.range(e,g-e+1).select(function(l){return f._children[l]}).selectMany(function(l){return l._datums}).distinct(function(l){return l.key})}}else{f=k;var i=h.firstDimensionName();e=def.query(k._datums).where(function(l){l=l.atoms[i].value;return l!=null&&l>=d.begin&&l<=d.end})}if(e){j.data.replaceSelected(e);j.root.updateSelections(c)}}});var b=def.create(axis_optionsDef,{Resizable:{resolve:"_resolveFull",
cast:Boolean,value:true},Movable:{resolve:"_resolveFull",cast:Boolean,value:true},Begin:{resolve:"_resolveFull"},End:{resolve:"_resolveFull"},Length:{resolve:"_resolveFull"},Constraint:{resolve:"_resolveFull",cast:def.fun.as}})});
def.scope(function(){function a(e){var h;if(e){var g;def.eachOwn(e,function(j,k){g=true;e[k]=pv.color(j)});if(g)h=e}return h}function b(){var e;if(this.scaleType==="discrete")if(this.index===0)e=pvc.createColorScheme();else{var h=this;e=function(){return h.chart._getRoleColorScale(h.role.name)}}else e=["red","yellow","green"].map(function(g){return pv.Color.names[g]});return e}def.type("pvc.visual.ColorAxis",pvc.visual.Axis).add({scaleNullRangeValue:function(){return this.option("Missing")||null},
scaleUsesAbs:function(){return this.option("UseAbs")},bind:function(e){this.base(e);this._plotList=def.query(e).select(function(h){return h.plot}).distinct(function(h){return h&&h.id}).array();return this},calculateScale:function(){var e,h,g=this.dataCells;if(g){var j=this.chart;if(this.scaleType==="discrete"){this.domainValues=e=def.query(g).selectMany(function(f){var i=f.role;if(i&&i.isBound()){var l=j.partData(f.dataPartValue);i=l&&l.flattenBy(i);return(f.data=i)&&i.children()}}).distinct(function(f){return f.key}).select(function(f){return def.nullyTo(f.value,
"")}).array();e=this.scheme()(e);h=true}else if(g.length===1){var k=j.root.visibleData(this.dataCell.dataPartValue);g=this.option("NormByCategory");k={type:this.option("ScaleType"),colors:this.option("Colors")().range(),colorDomain:this.option("Domain"),colorMin:this.option("Min"),colorMax:this.option("Max"),colorMissing:this.option("Missing"),data:k,colorDimension:this.role.firstDimensionName(),normPerBaseCategory:g};if(g)this.scalesByCateg=pvc.color.scales(k);else e=pvc.color.scale(k)}}this.setScale(e,
h);return this},_wrapScale:function(e){if(this.scaleType==="discrete"?this.option.isSpecified("Transform")||!this.option.isSpecified("Colors")&&!this.option.isSpecified("Map"):true){var h=this.option("Transform");if(h)e=e.transform(h)}return this.base(e)},scheme:function(){return def.lazy(this,"_scheme",this._createScheme,this)},_createColorMapFilter:function(e){var h=def.uniqueIndex(e,function(g){return g.key});return{domain:function(g){return!def.hasOwn(e,g)},color:function(g){return!def.hasOwn(h,
g.key)}}},_createScheme:function(){var e=this,h=e.option("Colors");if(e.scaleType!=="discrete")return function(){var k=h.apply(null,arguments);return e._wrapScale(k)};var g=e.option("Map");if(!g)return function(){var k=h.apply(null,arguments);return e._wrapScale(k)};var j=this._createColorMapFilter(g);return function(k){var f;k instanceof Array||(k=def.array.copy(arguments));k=k.filter(j.domain);var i=h(k);f=i.range().filter(j.color);i.range(f);f=function(n){return def.getOwn(g,n)||i(n)};def.copy(f,
i);var l,m;f.domain=function(){if(arguments.length)throw def.operationInvalid("The scale cannot be modified.");l||(l=def.array.append(def.ownKeys(g),k));return l};f.range=function(){if(arguments.length)throw def.operationInvalid("The scale cannot be modified.");m||(m=def.array.append(def.own(g),k));return m};return e._wrapScale(f)}},sceneScale:function(e){var h=def.get(e,"sceneVarName")||this.role.name,g=this.scalesByCateg;if(g){var j=this.option("Missing");return function(k){var f=k.vars[h].value;
if(f==null)return j;return g[k.group.parent.absKey](f)}}return this.scale.by1(function(k){return k.vars[h].value})},_buildOptionId:function(){return this.id+"Axis"},_getOptionsDefinition:function(){return d},_resolveByNaked:pvc.options.specify(function(e){if(!this.index)return this._chartOption(this.id+def.firstUpperCase(e.name))}),_specifyV1ChartOption:function(e,h){if(!this.index&&this.chart.compatVersion()<=1&&this._specifyChartOption(e,h))return true}});var c={resolveDefault:function(e){if(!this.index&&
this._specifyChartOption(e,def.firstLowerCase(e.name)))return true}},d=def.create(axis_optionsDef,{Colors:{resolve:"_resolveFull",getDefault:b,data:{resolveV1:function(e){if(this.scaleType==="discrete")if(this.index===0)this._specifyChartOption(e,"colors");else this.index===1&&this.chart._allowV1SecondAxis&&this._specifyChartOption(e,"secondAxisColor");else this._specifyChartOption(e,"colorRange");return true},resolveDefault:function(e){this.index===0&&this._specifyChartOption(e,"colors")}},cast:pvc.colorScheme},
Map:{resolve:"_resolveFull",cast:a},Transform:{resolve:"_resolveFull",data:{resolveDefault:function(e){var h=this._plotList;if(h.length<=2)if(def.query(h).all(function(g){g=g.name;return g==="plot2"||g==="trend"})){e.defaultValue(pvc.brighterColorTransform);return true}}},cast:def.fun.to},NormByCategory:{resolve:function(e){if(!this.chart._allowColorPerCategory){e.specify(false);return true}return this._resolveFull(e)},data:{resolveV1:function(e){this._specifyV1ChartOption(e,"normPerBaseCategory");
return true}},cast:Boolean,value:false},ScaleType:{resolve:"_resolveFull",data:{resolveV1:function(e){this._specifyV1ChartOption(e,"scalingType");return true}},cast:pvc.parseContinuousColorScaleType,value:"linear"},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:false},Domain:{resolve:"_resolveFull",data:{resolveV1:function(e){this._specifyV1ChartOption(e,"colorRangeInterval");return true}},cast:def.array.to},Min:{resolve:"_resolveFull",data:{resolveV1:function(e){this._specifyV1ChartOption(e,"minColor");
return true}},cast:pv.color},Max:{resolve:"_resolveFull",data:{resolveV1:function(e){this._specifyV1ChartOption(e,"maxColor");return true}},cast:pv.color},Missing:{resolve:"_resolveFull",data:{resolveV1:function(e){this._specifyV1ChartOption(e,"nullColor");return true}},cast:pv.color,value:pv.color("lightgray")},LegendVisible:{resolve:"_resolveFull",data:c,cast:Boolean,value:true},LegendClickMode:{resolve:"_resolveFull",data:c,cast:pvc.parseLegendClickMode,value:"toggleVisible"},LegendDrawLine:{resolve:"_resolveFull",
data:c,cast:Boolean,value:false},LegendDrawMarker:{resolve:"_resolveFull",data:c,cast:Boolean,value:true},LegendShape:{resolve:"_resolveFull",data:c,cast:pvc.parseShape}})});var sizeAxis_optionsDef;
def.scope(function(){def.type("pvc.visual.SizeAxis",pvc.visual.Axis).init(function(a,b,c,d){d=def.set(d,"byNaked",false);this.base(a,b,c,d)}).add({_buildOptionId:function(){return this.id+"Axis"},scaleTreatsNullAs:function(){return"min"},scaleUsesAbs:function(){return this.option("UseAbs")},setScaleRange:function(a){var b=this.scale;b.min=a.min;b.max=a.max;b.size=a.max-a.min;b.range(b.min,b.max);pvc.debug>=4&&pvc.log("Scale: "+pvc.stringify(def.copyOwn(b)));return this},_getOptionsDefinition:function(){return sizeAxis_optionsDef}});
sizeAxis_optionsDef=def.create(axis_optionsDef,{OriginIsZero:{resolve:"_resolveFull",cast:Boolean,value:false},FixedMin:{resolve:"_resolveFull",cast:pvc.castNumber},FixedMax:{resolve:"_resolveFull",cast:pvc.castNumber},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:false}})});
def.scope(function(){function a(d){if(!def.object.is(d)){var e=this.option("Position");d=(new pvc.Size).setSize(d,{singleProp:pvc.BasePanel.orthogonalLength[e]})}return d}function b(d){var e=this.option("Position");return pvc.parseAlign(e,d)}def.type("pvc.visual.Legend",pvc.visual.OptionsBase).init(function(d,e,h,g){g=def.set(g,"byNaked",false);this.base(d,e,h,g)}).add({_getOptionsDefinition:function(){return c}});var c={Position:{resolve:"_resolveFull",cast:pvc.parsePosition,value:"bottom"},Size:{resolve:"_resolveFull",
cast:a},SizeMax:{resolve:"_resolveFull",cast:a},Align:{resolve:"_resolveFull",data:{resolveDefault:function(d){var e=this.option("Position"),h;if(e!=="top"&&e!=="bottom")h="top";else if(this.chart.compatVersion()<=1)h="left";d.defaultValue(h);return true}},cast:b},Margins:{resolve:"_resolveFull",data:{resolveDefault:function(d){if(this.chart.compatVersion()>1){var e=this.option("Position");e=def.set({},pvc.BasePanel.oppositeAnchor[e],5);d.defaultValue(e)}return true}},cast:pvc.Sides.as},Paddings:{resolve:"_resolveFull",
cast:pvc.Sides.as,value:5},Font:{resolve:"_resolveFull",cast:String,value:"10px sans-serif"}}});
def.type("pvc.visual.legend.BulletRootScene",pvc.visual.Scene).init(function(a,b){this.base(a,b);a=def.get(b,"markerSize",15);var c=(new pvc.Sides(def.get(b,"itemPadding",5))).resolve(a,a);def.set(this.vars,"horizontal",def.get(b,"horizontal",false),"font",def.get(b,"font"),"markerSize",a,"textMargin",def.get(b,"textMargin",6),"itemPadding",c)}).add({layout:function(a){function b(o){var p=o.labelTextSize(),q=!p||!p.width||!p.height;o.isHidden=q;if(!q){p={width:g+p.width+0,height:Math.max(p.height,
h)};var r;if(l)r=!l.items.length;else{l=new pvc.visual.legend.BulletItemSceneRow(0);r=true}q=l.size.width+p[k];r||(q+=j[k]);if(!r&&q>i){c(false);q=p[k]}r=l.size;r.width=q;r.height=Math.max(r.height,p[f]);q=l.items.length;l.items.push(o);def.set(o.vars,"row",l,"rowIndex",q,"clientSize",p)}}function c(o){var p=l.size;n.height+=p.height;if(m.length)n.height+=j[f];n.width=Math.max(n.width,p.width);m.push(l);o||(l=new pvc.visual.legend.BulletItemSceneRow(m.length))}var d=a.clientSize;if(!(d.width>0&&d.height>
0))return new pvc.Size(0,0);var e=a.desiredClientSize,h=this.vars.markerSize,g=h+this.vars.textMargin,j=this.vars.itemPadding,k=this.vars.horizontal?"width":"height",f=pvc.BasePanel.oppositeLength[k],i=e[k];if(!i||i<0)i=d[k];var l,m=[],n={width:0,height:0};this.childNodes.forEach(function(o){o.childNodes.forEach(b,this)},this);if(!l)return new pvc.Size(0,0);c(true);def.set(this.vars,"rows",m,"rowCount",l,"size",n);a=this.compatVersion()<=1?i:n.width;e=e[f];if(!e||e<0)e=n.height;return def.set({},
k,Math.min(a,d[k]),f,Math.min(e,d[f]))},defaultGroupSceneType:function(){var a=this._bulletGroupType;if(!a)this._bulletGroupType=a=def.type(pvc.visual.legend.BulletGroupScene);return a},createGroup:function(a){return new (this.defaultGroupSceneType())(this,a)}});def.type("pvc.visual.legend.BulletItemSceneRow").init(function(a){this.index=a;this.items=[];this.size={width:0,height:0}});
def.type("pvc.visual.legend.BulletGroupScene",pvc.visual.Scene).init(function(a,b){this.base(a,b);this.extensionPrefix=def.get(b,"extensionPrefix")||"";this._renderer=def.get(b,"renderer");this.colorAxis=def.get(b,"colorAxis");this.clickMode=def.get(b,"clickMode");if(this.colorAxis&&!this.clickMode)this.clickMode=this.colorAxis.option("LegendClickMode")}).add({hasRenderer:function(){return this._renderer},renderer:function(a){if(a!=null)this._renderer=a;else{a=this._renderer;if(!a){var b;if(a=this.colorAxis)b=
{drawRule:a.option("LegendDrawLine"),drawMarker:a.option("LegendDrawMarker"),markerShape:a.option("LegendShape")};this._renderer=a=new pvc.visual.legend.BulletItemDefaultRenderer(b)}}return a},itemSceneType:function(){var a=this._itemSceneType;if(!a){a=def.type(pvc.visual.legend.BulletItemScene);switch(this.clickMode){case "toggleSelected":a.add(pvc.visual.legend.BulletItemSceneSelection);break;case "toggleVisible":a.add(pvc.visual.legend.BulletItemSceneVisibility);break}this.panel()._extendSceneType("item",
a,["isOn","isClickable","click"]);this._itemSceneType=a}return a},createItem:function(a){return new (this.itemSceneType())(this,a)}});
def.type("pvc.visual.legend.BulletItemScene",pvc.visual.Scene).init(function(a,b){this.base(a,b);var c,d,e;if(b){c=b.value;d=b.rawValue;e=b.label}if(c===undefined)if(a=this.group||this.datum){c=a.value;d=a.rawValue;e=a.ensureLabel();if(b=this.chart()._getDataPartDimName()){a=a.atoms[b];if(isNaN(+a.value))e+=" ("+a.label+")"}}this.vars.value=new pvc.visual.ValueLabelVar(c||null,e||"",d)}).add({isOn:function(){return true},isClickable:function(){return false},click:function(){},labelTextSize:function(){var a=
this.vars.value;return a&&pv.Text.measure(a.label,this.vars.font)}});
def.type("pvc.visual.legend.BulletItemSceneSelection").add({isOn:function(){return!(this.group||this.datum).owner.selectedCount()||this.datums().any(function(a){return!a.isNull&&a.isSelected})},isClickable:function(){return this.chart()._canSelectWithClick()},click:function(){var a=this.datums().array();if(a.length){var b=this.chart();b._updatingSelections(function(){if(a=b._onUserSelection(a)){var c=def.query(a).any(function(d){return d.isSelected});pvc.data.Data.setSelected(a,!c)}})}}});
def.type("pvc.visual.legend.BulletItemSceneVisibility").add({isOn:function(){return this.datums().any(function(a){return!a.isNull&&a.isVisible})},isClickable:function(){return true},click:function(){pvc.data.Data.toggleVisible(this.datums())&&this.chart().render(true,true,false)}});def.type("pvc.visual.legend.BulletItemRenderer");
def.type("pvc.visual.legend.BulletItemDefaultRenderer",pvc.visual.legend.BulletItemRenderer).init(function(a){this.noSelect=def.get(a,"noSelect",false);this.noHover=def.get(a,"noHover",false);if(this.drawRule=def.get(a,"drawRule",false))this.rulePvProto=def.get(a,"rulePvProto");if(this.drawMarker=!this.drawRule||def.get(a,"drawMarker",true)){this.markerShape=def.get(a,"markerShape","square");this.markerPvProto=def.get(a,"markerPvProto")}}).add({drawRule:false,drawMarker:true,markerShape:null,rulePvProto:null,
markerPvProto:null,create:function(a,b,c,d){var e={},h=this.drawRule,g=function(k){return k.color};if(h){var j=(new pv.Mark).left(0).top(function(){return this.parent.height()/2}).width(function(){return this.parent.width()}).lineWidth(1,pvc.extensionTag).strokeStyle(g,pvc.extensionTag);if(this.rulePvProto)j=this.rulePvProto.extend(j);e.pvRule=(new pvc.visual.Rule(a,b,{proto:j,noSelect:this.noSelect,noHover:this.noHover,activeSeriesAware:false,extensionId:c+"Rule",showsInteraction:true,wrapper:d})).pvMark}if(this.drawMarker){h=
(new pv.Mark).left(function(){return this.parent.width()/2}).top(function(){return this.parent.height()/2}).shapeSize(function(){return this.parent.width()},pvc.extensionTag).lineWidth(2,pvc.extensionTag).fillStyle(g,pvc.extensionTag).strokeStyle(g,pvc.extensionTag).shape(this.markerShape,pvc.extensionTag).angle(h?0:Math.PI/2,pvc.extensionTag).antialias(function(){var k=Math.abs(Math.cos(this.angle()));if(k!==0&&k!==1)switch(this.shape()){case "square":case "bar":return false}return true},pvc.extensionTag);
if(this.markerPvProto)h=this.markerPvProto.extend(h);e.pvDot=(new pvc.visual.Dot(a,b,{proto:h,freePosition:true,activeSeriesAware:false,noTooltip:true,noSelect:this.noSelect,noHover:this.noHover,extensionId:c+"Dot",wrapper:d})).pvMark}return e}});
def.scope(function(){def.type("pvc.visual.Plot",pvc.visual.OptionsBase).init(function(a,b){var c=def.getPath(a,["plotsByType",this.type]);c=c?c.length:0;b=def.set(b,"byNaked",!a.plotList.length);this.base(a,this.type,c,b);a._addPlot(this);a=this.extensionPrefixes=[this.id];this.globalIndex||a.push("");this.name&&a.push(this.name)}).add({_getOptionsDefinition:function(){return pvc.visual.Plot.optionsDef},_resolveByNaked:pvc.options.specify(function(a){if(!this.globalIndex)return this._chartOption(def.firstLowerCase(a.name))})});
pvc.visual.Plot.optionsDef={Orientation:{resolve:function(a){a.specify(this._chartOption("orientation")||"vertical");return true},cast:String},ValuesVisible:{resolve:"_resolveFull",data:{resolveV1:function(a){if(this.globalIndex===0){var b=this._chartOption("showValues");if(b!==undefined)a.specify(b);else{b=this.type!=="point";a.defaultValue(b)}return true}}},cast:Boolean,value:false},ValuesAnchor:{resolve:"_resolveFull",cast:pvc.parseAnchor},ValuesFont:{resolve:"_resolveFull",cast:String,value:"10px sans-serif"},
ValuesMask:{resolve:"_resolveFull",cast:String,value:"{value}"},DataPart:{resolve:"_resolveFixed",cast:String,value:"0"},ColorRole:{resolve:"_resolveFixed",cast:String,value:"color"},ColorAxis:{resolve:pvc.options.resolvers([function(a){if(this.globalIndex===0){a.specify(1);return true}},"_resolveFull"]),cast:function(a){a=pvc.castNumber(a);return a=a!=null?def.between(a,1,10):1},value:1}}});
def.scope(function(){function a(b){if(this.name==="trend")return null;var c=this.option("TrendType");if(!c&&b)c=b.type;if(!c||c==="none")return null;b=b?Object.create(b):{};b.type=c;c=this.option("TrendLabel");if(c!==undefined)b.label=c;return b}def.type("pvc.visual.CartesianPlot",pvc.visual.Plot).add({_getOptionsDefinition:function(){return pvc.visual.CartesianPlot.optionsDef}});pvc.visual.CartesianPlot.optionsDef=def.create(pvc.visual.Plot.optionsDef,{BaseAxis:{value:1},BaseRole:{resolve:"_resolveFixed",
cast:String},OrthoAxis:{resolve:function(b){if(this.globalIndex===0){b.specify(1);return true}return this._resolveFull(b)},data:{resolveV1:function(b){this.name==="plot2"&&this.chart._allowV1SecondAxis&&this._chartOption("secondAxisIndependentScale")&&b.specify(2);return true}},cast:function(b){b=pvc.castNumber(b);return b=b!=null?def.between(b,1,10):1},value:1},OrthoRole:{resolve:pvc.options.resolvers(["_resolveFixed","_resolveDefault"])},Trend:{resolve:"_resolveFull",data:{resolveDefault:function(b){var c=
this.option("TrendType");if(c){b.defaultValue({type:c});return true}}},cast:a},TrendType:{resolve:"_resolveFull",cast:pvc.parseTrendType},TrendLabel:{resolve:"_resolveFull",cast:String},NullInterpolationMode:{resolve:"_resolveFull",cast:pvc.parseNullInterpolationMode,value:"none"}})});
def.scope(function(){def.type("pvc.visual.CategoricalPlot",pvc.visual.CartesianPlot).add({_getOptionsDefinition:function(){return pvc.visual.CategoricalPlot.optionsDef}});pvc.visual.CategoricalPlot.optionsDef=def.create(pvc.visual.CartesianPlot.optionsDef,{Stacked:{resolve:"_resolveFull",cast:Boolean,value:false},BaseRole:{value:"category"},OrthoRole:{value:"value"}})});
def.scope(function(){def.type("pvc.visual.BarPlotAbstract",pvc.visual.CategoricalPlot).add({_getOptionsDefinition:function(){return pvc.visual.BarPlotAbstract.optionsDef}});pvc.visual.BarPlotAbstract.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{BarSizeRatio:{resolve:"_resolveFull",cast:function(a){a=pvc.castNumber(a);if(a==null)a=1;else if(a<0.05)a=0.05;else if(a>1)a=1;return a},value:0.9},BarSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(a){this._specifyChartOption(a,"maxBarSize");
return true}},cast:function(a){a=pvc.castNumber(a);if(a==null)a=Infinity;else if(a<1)a=1;return a},value:2E3},BarStackedMargin:{resolve:"_resolveFull",cast:function(a){a=pvc.castNumber(a);if(a!=null&&a<0)a=0;return a},value:0},OverflowMarkersVisible:{resolve:"_resolveFull",cast:Boolean,value:true},ValuesAnchor:{value:"center"}})});def.type("pvc.visual.BarPlot",pvc.visual.BarPlotAbstract).add({type:"bar"});
def.scope(function(){def.type("pvc.visual.NormalizedBarPlot",pvc.visual.BarPlotAbstract).add({type:"bar",_getOptionsDefinition:function(){return pvc.visual.NormalizedBarPlot.optionsDef}});pvc.visual.NormalizedBarPlot.optionsDef=def.create(pvc.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:true}})});
def.scope(function(){def.type("pvc.visual.WaterfallPlot",pvc.visual.BarPlotAbstract).add({type:"water",_getOptionsDefinition:function(){return pvc.visual.WaterfallPlot.optionsDef}});pvc.visual.WaterfallPlot.optionsDef=def.create(pvc.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:true},TotalLineLabel:{resolve:"_resolveFull",cast:String,value:"Accumulated"},TotalValuesVisible:{resolve:"_resolveFull",data:{resolveDefault:function(a){a.defaultValue(this.option("ValuesVisible"));return true}},
cast:Boolean},Direction:{resolve:"_resolveFull",cast:pvc.parseWaterDirection,value:"down"},AreasVisible:{resolve:"_resolveFull",cast:Boolean,value:true},AllCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"}})});
def.scope(function(){function a(b,c){return{resolveV1:function(d){if(this.globalIndex===0){this._specifyChartOption(d,"show"+b)||d.defaultValue(c);return true}}}}def.type("pvc.visual.PointPlot",pvc.visual.CategoricalPlot).add({type:"point",_getOptionsDefinition:function(){return pvc.visual.PointPlot.optionsDef}});pvc.visual.PointPlot.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{DotsVisible:{resolve:"_resolveFull",data:a("Dots",true),cast:Boolean,value:false},LinesVisible:{resolve:"_resolveFull",
data:a("Lines",true),cast:Boolean,value:false},AreasVisible:{resolve:"_resolveFull",data:a("Areas",false),cast:Boolean,value:false},ValuesAnchor:{value:"right"}})});def.scope(function(){def.type("pvc.visual.MetricXYPlot",pvc.visual.CartesianPlot).add({_getOptionsDefinition:function(){return pvc.visual.MetricXYPlot.optionsDef}});pvc.visual.MetricXYPlot.optionsDef=def.create(pvc.visual.CartesianPlot.optionsDef,{BaseRole:{value:"x"},OrthoAxis:{resolve:null},OrthoRole:{value:"y"}})});
def.scope(function(){function a(b){return{resolveV1:function(c){this._specifyChartOption(c,"show"+b);return true}}}def.type("pvc.visual.MetricPointPlot",pvc.visual.MetricXYPlot).add({type:"scatter",_getOptionsDefinition:function(){return pvc.visual.MetricPointPlot.optionsDef}});pvc.visual.MetricPointPlot.optionsDef=def.create(pvc.visual.MetricXYPlot.optionsDef,{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},Shape:{resolve:"_resolveFull",cast:pvc.parseShape,
value:"circle"},NullShape:{resolve:"_resolveFull",cast:pvc.parseShape,value:"cross"},DotsVisible:{resolve:"_resolveFull",data:a("Dots"),cast:Boolean,value:false},LinesVisible:{resolve:"_resolveFull",data:a("Lines"),cast:Boolean,value:false},ValuesAnchor:{value:"right"},ValuesMask:{value:"{x},{y}"}})});
def.scope(function(){def.type("pvc.visual.PiePlot",pvc.visual.Plot).add({type:"pie",_getOptionsDefinition:function(){return pvc.visual.PiePlot.optionsDef}});pvc.visual.PiePlot.optionsDef=def.create(pvc.visual.Plot.optionsDef,{ActiveSliceRadius:{resolve:"_resolveFull",cast:pvc.PercentValue.parse,value:new pvc.PercentValue(0.05)},ExplodedSliceRadius:{resolve:"_resolveFull",cast:pvc.PercentValue.parse,value:0},ExplodedSliceIndex:{resolve:"_resolveFull",cast:pvc.castNumber,value:null},ValuesAnchor:{cast:pvc.parseAnchorWedge,
value:"outer"},ValuesVisible:{value:true},ValuesLabelStyle:{resolve:function(a){if(this.chart.compatVersion()<=1){a.specify("inside");return true}return this._resolveFull(a)},cast:function(a){switch(a){case "inside":case "linked":return a}pvc.debug>=2&&pvc.log("[Warning] Invalid 'ValuesLabelStyle' value: '"+a+"'.");return"linked"},value:"linked"},ValuesMask:{resolve:"_resolveFull",data:{resolveDefault:function(a){a.defaultValue(this.option("ValuesLabelStyle")==="linked"?"{value} ({value.percent})":
"{value}");return true}}},LinkInsetRadius:{resolve:"_resolveFull",cast:pvc.PercentValue.parse,value:new pvc.PercentValue(0.05)},LinkOutsetRadius:{resolve:"_resolveFull",cast:pvc.PercentValue.parse,value:new pvc.PercentValue(0.025)},LinkMargin:{resolve:"_resolveFull",cast:pvc.PercentValue.parse,value:new pvc.PercentValue(0.025)},LinkHandleWidth:{resolve:"_resolveFull",cast:pvc.castNumber,value:0.5},LinkLabelSize:{resolve:"_resolveFull",cast:pvc.PercentValue.parse,value:new pvc.PercentValue(0.15)},
LinkLabelSpacingMin:{resolve:"_resolveFull",cast:pvc.castNumber,value:0.5}})});
def.scope(function(){def.type("pvc.visual.HeatGridPlot",pvc.visual.CategoricalPlot).add({type:"heatGrid",_getOptionsDefinition:function(){return pvc.visual.HeatGridPlot.optionsDef}});pvc.visual.HeatGridPlot.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{SizeRole:{value:"size"},SizeAxis:{value:1},UseShapes:{resolve:"_resolveFull",cast:Boolean,value:false},Shape:{resolve:"_resolveFull",cast:pvc.parseShape,value:"square"},NullShape:{resolve:"_resolveFull",cast:pvc.parseShape,value:"cross"},
ValuesVisible:{getDefault:function(){return!this.option("UseShapes")},value:null},ValuesMask:{value:null},ValuesAnchor:{value:"center"},OrthoRole:{value:"series"},OrthoAxis:{resolve:null},NullInterpolationMode:{resolve:null,value:"none"},Stacked:{resolve:null,value:false}})});
def.scope(function(){def.type("pvc.visual.BoxPlot",pvc.visual.CategoricalPlot).add({type:"box",_getOptionsDefinition:function(){return pvc.visual.BoxPlot.optionsDef}});pvc.visual.BoxPlot.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{Stacked:{resolve:null,value:false},OrthoRole:{value:["median","lowerQuartil","upperQuartil","minimum","maximum"]},BoxSizeRatio:{resolve:"_resolveFull",cast:function(a){a=pvc.castNumber(a);if(a==null)a=1;else if(a<0.05)a=0.05;else if(a>1)a=1;return a},value:1/
3},BoxSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(a){this._specifyChartOption(a,"maxBoxSize");return true}},cast:function(a){a=pvc.castNumber(a);if(a==null)a=Infinity;else if(a<1)a=1;return a},value:Infinity}})});def.type("pvc.visual.BulletPlot",pvc.visual.Plot).add({type:"bullet",_getOptionsDefinition:function(){return pvc.visual.BulletPlot.optionsDef}});pvc.visual.BulletPlot.optionsDef=def.create(pvc.visual.Plot.optionsDef,{ValuesVisible:{value:true},ColorRole:{value:null}});
def.type("pvc.Abstract").init(function(){this._syncLog()}).add({invisibleLineWidth:0.001,defaultLineWidth:1.5,_logInstanceId:null,_syncLog:function(){if(pvc.debug&&typeof console!=="undefined"){var a=this._getLogInstanceId();["log","info",["trace","debug"],"error","warn",["group","groupCollapsed"],"groupEnd"].forEach(function(b){b=b instanceof Array?b:[b,b];pvc._installLog(this,"_"+b[0],b[1],a)},this)}},_getLogInstanceId:function(){return this._logInstanceId||(this._logInstanceId=this._processLogInstanceId(this._createLogInstanceId()))},
_createLogInstanceId:function(){return""+this.constructor},_processLogInstanceId:function(a){a=a.substr(0,30);if(a.length<30)a+=def.array.create(30-a.length," ").join("");return"["+a+"]"}});def.scope(function(){var a=pvc.Abstract.prototype,b=function(){this._syncLog()};["log","info","trace","error","warn","group","groupEnd"].forEach(function(c){a["_"+c]=b})});
def.type("pvc.BaseChart",pvc.Abstract).init(function(a){var b=a,c=this.parent=def.get(a,"parent")||null;if(c)a||def.fail.argumentRequired("options");else a=def.mixin.copy({},this.defaults,a);this.options=a;if(c){this.root=c.root;this.smallColIndex=a.smallColIndex;this.smallRowIndex=a.smallRowIndex;this._tooltipEnabled=c._tooltipEnabled;this._tooltipOptions=c._tooltipOptions}else this.root=this;this.base();pvc.debug>=3&&this._info("NEW CHART\n"+pvc.logSeparator.replace(/-/g,"=")+"\n  DebugLevel: "+
pvc.debug);if(pvc.debug>=3&&!c&&b){this._info("OPTIONS:\n",b);pvc.debug>=5&&this._trace(pvc.stringify(a,{ownOnly:false,funs:true}))}c&&c._addChild(this);this._constructData(a);this._constructVisualRoles(a)}).add({_disposed:false,_animatable:false,parent:null,children:null,root:null,isPreRendered:false,_createVersion:0,renderCallback:undefined,multiChartPageCount:null,multiChartPageIndex:null,left:0,top:0,width:null,height:null,margins:null,paddings:null,_allowV1SecondAxis:false,compatVersion:function(a){return(a||
this.options).compatVersion},_createLogInstanceId:function(){return""+this.constructor+this._createLogChildSuffix()},_createLogChildSuffix:function(){return this.parent?" ("+(this.smallRowIndex+1)+","+(this.smallColIndex+1)+")":""},_addChild:function(a){a.parent===this||def.assert("Not a child of this chart.");this.children.push(a)},_preRender:function(a){this._preRenderPhase1(a);this._preRenderPhase2(a)},_preRenderPhase1:function(a){this._createVersion++;this.isPreRendered=false;pvc.debug>=3&&this._log("Prerendering");
this.children=[];this.parent||pvc.removeTipsyLegends();this._processOptions();this._checkNoDataI();if(!this.parent&&this._createVersion===1){this._initVisualRoles();this._bindVisualRolesPreI();this._complexTypeProj=this._createComplexTypeProject();this._bindVisualRolesPreII()}this._initData(a);this._checkNoDataII();a=this._isRoleAssigned("multiChart");this._initPlots(a);this._initAxes(a);this._bindAxes(a);if(this.parent||!a){this._interpolate(a);this._generateTrends(a)}this._setAxesScales(a)},_preRenderPhase2:function(){this._initChartPanels(this._isRoleAssigned("multiChart"));
this.isPreRendered=true},_setSmallLayout:function(a){if(a){var b=this.basePanel;this._setProp("left",a)|this._setProp("top",a)&&b&&def.set(b.position,"left",this.left,"top",this.top);if(this._setProp("width",a)|this._setProp("height",a))if(b)b.size=new pvc.Size(this.width,this.height);if(this._setProp("margins",a)&&b)b.margins=new pvc.Sides(this.margins);if(this._setProp("paddings",a)&&b)b.paddings=new pvc.Sides(this.paddings)}},_setProp:function(a,b){b=b[a];if(b!=null){this[a]=b;return true}},_processOptions:function(){var a=
this.options;if(!this.parent){this.width=a.width;this.height=a.height;this.margins=a.margins;this.paddings=a.paddings}if(this.compatVersion()<=1)a.plot2=this._allowV1SecondAxis&&!!a.secondAxis;this._processOptionsCore(a);this._processExtensionPoints();return a},_processOptionsCore:function(a){if(!this.parent){if(!$.support.svg||pv.renderer()==="batik")a.animate=false;this._processTooltipOptions(a)}},_tooltipDefaults:{gravity:"s",delayIn:200,delayOut:80,offset:2,opacity:0.9,html:true,fade:true,useCorners:false,
arrowVisible:true,followMouse:false,format:undefined},_processTooltipOptions:function(a){var b=this.compatVersion()<=1,c=a.tooltip,d=a.tooltipEnabled;if(d==null){if(c)d=c.enabled;if(d==null){if(b)d=a.showTooltips;if(d==null)d=true}}if(d){c||(c={});b&&this._importV1TooltipOptions(c,a);def.eachOwn(this._tooltipDefaults,function(e,h){var g=a["tooltip"+def.firstUpperCase(h)];if(g!==undefined)c[h]=g;else if(c[h]===undefined)c[h]=e})}else c={};this._tooltipEnabled=d;this._tooltipOptions=c},_importV1TooltipOptions:function(a,
b){if(b=b.tipsySettings){this.extend(b,"tooltip");for(var c in b)if(a[c]===undefined)a[c]=b[c];if(a.html==null)a.html=false}},render:function(a,b,c){var d;pvc.debug>1&&pvc.group("CCC RENDER");this._suspendSelectionUpdate();try{this.useTextMeasureCache(function(){try{if(!this.isPreRendered||b)this._preRender({reloadData:c});else!this.parent&&this.isPreRendered&&pvc.removeTipsyLegends();this.basePanel.render({bypassAnimation:a,recreate:b})}catch(e){if(e instanceof NoDataException){pvc.debug>1&&this._log("No data found.");
this._addErrorPanelMessage("No data found",true)}else{d=true;pvc.logError(e.message);pvc.debug>0&&this._addErrorPanelMessage("Error: "+e.message,false)}}})}finally{d||this._resumeSelectionUpdate();pvc.debug>1&&pvc.groupEnd()}return this},_addErrorPanelMessage:function(a,b){var c=this.options;c=(new pv.Panel).canvas(c.canvas).width(this.width).height(this.height);a=c.anchor("center").add(pv.Label).text(a);b&&this.extend(a,"noDataMessage");c.render()},useTextMeasureCache:function(a,b){var c=this.root;
c=c._textMeasureCache||(c._textMeasureCache=pv.Text.createCache());return pv.Text.usingCache(c,a,b||this)},animate:function(a,b){return this.basePanel.animate(a,b)},isAnimatingStart:function(){return this.basePanel.isAnimatingStart()},isOrientationVertical:function(a){return(a||this.options.orientation)===pvc.orientation.vertical},isOrientationHorizontal:function(a){return(a||this.options.orientation)===pvc.orientation.horizontal},dispose:function(){if(!this._disposed)this._disposed=true},defaults:{width:400,
height:300,orientation:"vertical",ignoreNulls:true,crosstabMode:true,isMultiValued:false,seriesInRows:false,groupedLabelSep:undefined,animate:true,titlePosition:"top",titleAlign:"center",legend:false,legendPosition:"bottom",v1StyleTooltipFormat:function(a,b,c,d){return a+", "+b+":  "+this.chart.options.valueFormat(c)+(d&&d.percent?" ("+d.percent.label+")":"")},valueFormat:def.scope(function(){var a=pv.Format.number().fractionDigits(0,2);return function(b){return a.format(b)}}),percentValueFormat:def.scope(function(){var a=
pv.Format.number().fractionDigits(0,1);return function(b){return a.format(b*100)+"%"}}),clickable:false,doubleClickMaxDelay:300,hoverable:false,selectable:false,selectionMode:"rubberband",ctrlSelectMode:true,clearSelectionMode:"emptySpaceClick",compatVersion:Infinity}});
pvc.BaseChart.add({_visualRoles:null,_visualRoleList:null,_serRole:null,_dataPartRole:null,_measureVisualRoles:null,_constructVisualRoles:function(){var a=this.parent;if(a){this._visualRoles=a._visualRoles;this._visualRoleList=a._visualRoleList;this._measureVisualRoles=a._measureVisualRoles;if(a._multiChartRole)this._multiChartRole=a._multiChartRole;if(a._serRole)this._serRole=a._serRole;if(a._colorRole)this._colorRole=a._colorRole;if(a._dataPartRole)this._dataPartRole=a._dataPartRole}else{this._visualRoles=
{};this._visualRoleList=[];this._measureVisualRoles=[]}},_hasDataPartRole:function(){return false},_getSeriesRoleSpec:function(){return null},_getColorRoleSpec:function(){return null},_addVisualRole:function(a,b){b=def.set(b,"index",this._visualRoleList.length);b=new pvc.visual.Role(a,b);this._visualRoleList.push(b);this._visualRoles[a]=b;b.isMeasure&&this._measureVisualRoles.push(b);return b},_initVisualRoles:function(){this._multiChartRole=this._addVisualRole("multiChart",{defaultDimension:"multiChart*",
requireIsDiscrete:true});if(this._hasDataPartRole())this._dataPartRole=this._addVisualRole("dataPart",{defaultDimension:"dataPart",requireSingleDimension:true,requireIsDiscrete:true,dimensionDefaults:{isHidden:true,comparer:def.compare}});var a=this._getSeriesRoleSpec();if(a)this._serRole=this._addVisualRole("series",a);if(a=this._getColorRoleSpec())this._colorRole=this._addVisualRole("color",a)},_bindVisualRolesPreI:function(){def.eachOwn(this._visualRoles,function(h){h.setIsReversed(false)});var a=
[],b=this.options,c=b.visualRoles;this._visualRoleList.forEach(function(h){h=h.name;var g=b[h+"Role"];if(g!==undefined){if(!c)c=b.visualRoles={};if(c[h]===undefined)c[h]=g}});var d;if(c){d={};var e=def.query(def.keys(c)).select(function(h){return this._visualRoles[h]||def.fail.operationInvalid("Role '{0}' is not supported by the chart type.",[h])},this).array();e.sort(function(h,g){return h.index-g.index});e.forEach(function(h){var g=h.name,j=c[g],k,f;if(def.object.is(j)){def.nullyTo(j.isReversed,
false)&&h.setIsReversed(true);if((f=j.from)&&f!==g){g=this._visualRoles[f]||def.fail.operationInvalid("Source role '{0}' is not supported by the chart type.",[f]);h.setSourceRole(g);a.push(h)}else k=j.dimensions}else k=j;if(k!==undefined){k=pvc.data.GroupingSpec.parse(k);h.preBind(k);k.dimensions().each(function(i){if(def.hasOwn(d,i.name))delete d[i.name];else d[i.name]=h})}},this)}this._sourcedRoles=a;this._dimsBoundToSingleRole=d},_bindVisualRolesPreII:function(){var a=this._dimsBoundToSingleRole;
if(a){delete this._dimsBoundToSingleRole;def.eachOwn(a,this._setRoleBoundDimensionDefaults,this)}var b=this._sourcedRoles;delete this._sourcedRoles;def.query(this._visualRoleList).where(function(c){return c.defaultSourceRoleName&&!c.sourceRole&&!c.isPreBound()}).each(function(c){var d=this._visualRoles[c.defaultSourceRoleName];if(d){c.setSourceRole(d);b.push(c)}},this);b.forEach(function(c){var d=c.sourceRole;d.isReversed&&c.setIsReversed(!c.isReversed);!c.defaultDimensionName&&d.isPreBound()&&c.preBind(d.preBoundGrouping())})},
_setRoleBoundDimensionDefaults:function(a,b){this._complexTypeProj.setDimDefaults(b,a.dimensionDefaults)},_bindVisualRolesPostI:function(){function a(m,n){def.array.lazy(i,m).push(n)}function b(m){return f.hasDim(m)}function c(m,n){def.array.is(n)?n.forEach(function(o){a(o,m)}):a(n,m);m.setSourceRole(null);m.preBind(pvc.data.GroupingSpec.parse(n))}function d(m,n){if(n.length)m.requireSingleDimension?c(m,n[0]):c(m,n)}function e(m,n){f.setDim(n,{isHidden:true});c(m,n)}function h(m){if(m.isRequired)throw def.error.operationInvalid("Chart type requires unassigned role '{0}'.",
[m.name]);m.bind(null);m.setSourceRole(null)}function g(m){m.preBoundGrouping().dimensionNames().forEach(a)}function j(m){var n=m.defaultDimensionName;if(n){var o=n.match(/^(.*?)(\*)?$/)||def.fail.argumentInvalid("defaultDimensionName");n=o[1];if(o[2]){if(o=f.groupDimensionsNames(n)){d(m,o);return}}else if(b(n)){c(m,n);return}if(m.autoCreateDimension)e(m,n);else m.sourceRole?l.push(m):h(m)}else m.sourceRole?l.push(m):h(m)}function k(m){var n=m.sourceRole;n.isPreBound()?m.preBind(n.preBoundGrouping()):
h(m)}var f=this._complexTypeProj,i={},l=[];def.query(this._visualRoleList).where(function(m){return m.isPreBound()}).each(g,this);def.query(this._visualRoleList).where(function(m){return!m.isPreBound()}).each(j,this);l.forEach(k,this);def.query(def.ownKeys(i)).where(function(m){return i[m].length===1}).each(function(m){this._setRoleBoundDimensionDefaults(i[m][0],m)},this)},_bindVisualRolesPostII:function(a){function b(c){c.postBind(a)}def.query(this._visualRoleList).where(function(c){return c.isPreBound()}).each(b,
this)},_logVisualRoles:function(){var a=["VISUAL ROLES MAP SUMMARY",pvc.logSeparator,"  VisualRole         <-- Dimensions",pvc.logSeparator];def.eachOwn(this._visualRoles,function(b,c){a.push("  "+c+def.array.create(18-c.length," ").join("")+(b.grouping?" <-- "+b.grouping:""))});this._log(a.join("\n"))},visualRoles:function(a,b){if(a==null)return def.own(this._visualRoles);var c=def.getOwn(this._visualRoles,a)||null;if(!c&&def.get(b,"assertExists",true))throw def.error.argumentInvalid("roleName",
"Undefined role name '{0}'.",[a]);return c},measureVisualRoles:function(){return this._measureVisualRoles},measureDimensionsNames:function(){return def.query(this._measureVisualRoles).select(function(a){return a.firstDimensionName()}).where(def.notNully).array()},_isRoleAssigned:function(a){return!!this._visualRoles[a].grouping},_getDataPartDimName:function(){var a=this._dataPartRole;if(a){if(a.isBound())return a.firstDimensionName();var b=a.preBoundGrouping();if(b)return b.firstDimensionName();return a.defaultDimensionName}}});
pvc.BaseChart.add({dataEngine:null,data:null,_partData:null,_visibleDataCache:null,resultset:[],metadata:[],_constructData:function(a){if(this.parent)this.dataEngine=this.data=a.data||def.fail.argumentRequired("options.data")},_checkNoDataI:function(){if(!this.parent)if(!this.allowNoData&&this.resultset.length===0)throw new NoDataException;},_checkNoDataII:function(){if(!this.parent)if(!this.allowNoData&&(!this.data||!this.data.count()))throw new NoDataException;},_initData:function(a){if(!this.parent){var b=
this.data;if(!b||def.get(a,"reloadData",true))this._onLoadData();else{b.clearVirtuals();b.disposeChildren()}}delete this._partData;delete this._visibleDataCache;pvc.debug>=3&&this._log(this.data.getInfo())},_onLoadData:function(){var a=this.data,b=this.options,c=this._getDataPartDimName(),d=this._complexTypeProj,e=this._createTranslationOptions(c),h=this._createTranslation(e);pvc.debug>=3&&h.logSource();if(!a){h.configureType();c&&!d.isReadOrCalc(c)&&this._addDefaultDataPartCalculation(c)}this._bindVisualRolesPostI();
if(a)c=a.type;else{c=new pvc.data.ComplexType;d.configureComplexType(c,e)}this._bindVisualRolesPostII(c);pvc.debug>=10&&this._log(c.describe());pvc.debug>=3&&this._logVisualRoles();if(!a)a=this.dataEngine=this.data=new pvc.data.Data({type:c,labelSep:b.groupedLabelSep});b={where:this._getLoadFilter(),isNull:this._getIsNullDatum()};h=h.execute(a);a.load(h,b)},_createComplexTypeProject:function(){var a=this.options,b=new pvc.data.ComplexTypeProject(a.dimensionGroups),c=a.dimensions;for(var d in c)b.setDim(d,
c[d]);if(c=this._getDataPartDimName()){b.setDim(c);this._addPlot2SeriesDataPartCalculation(b,c)}(a=a.calculations)&&a.forEach(function(e){b.setCalc(e)});return b},_getLoadFilter:function(){if(this.options.ignoreNulls){var a=this;return function(b){(b=b.isNull)&&pvc.debug>=4&&a._info("Datum excluded.");return!b}}},_getIsNullDatum:function(){var a=this.measureDimensionsNames(),b=a.length;if(b)return function(c){c=c.atoms;for(var d=0;d<b;d++)if(c[a[d]].value!=null)return false;return true}},_createTranslation:function(a){return new (this._getTranslationClass(a))(this,
this._complexTypeProj,this.resultset,this.metadata,a)},_getTranslationClass:function(a){return a.crosstabMode?pvc.data.CrosstabTranslationOper:pvc.data.RelationalTranslationOper},_createTranslationOptions:function(a){var b=this.options,c=b.dataOptions||{},d=b.dataSeparator;if(d===undefined)d=c.separator;var e=b.dataMeasuresInColumns;if(e===undefined)e=c.measuresInColumns;var h=b.dataCategoriesCount;if(h===undefined)h=c.categoriesCount;var g=b.plot2,j=b.valueFormat,k;if(j&&j!==this.defaults.valueFormat)k=
function(i){return i!=null?j(i):""};var f;if(g&&this._allowV1SecondAxis&&this.compatVersion()<=1)f=pvc.parseDistinctIndexArray(b.secondAxisIdx)||-1;return{compatVersion:this.compatVersion(),plot2SeriesIndexes:f,seriesInRows:b.seriesInRows,crosstabMode:b.crosstabMode,isMultiValued:b.isMultiValued,dataPartDimName:a,dimensionGroups:b.dimensionGroups,dimensions:b.dimensions,readers:b.readers,measuresIndexes:b.measuresIndexes,multiChartIndexes:b.multiChartIndexes,separator:d,measuresInColumns:e,categoriesCount:h,
measuresIndex:c.measuresIndex||c.measuresIdx,measuresCount:c.measuresCount||c.numMeasures,isCategoryTimeSeries:b.timeSeries,timeSeriesFormat:b.timeSeriesFormat,valueNumberFormatter:k}},_addPlot2SeriesDataPartCalculation:function(a,b){if(!(this.compatVersion()<=1)){var c=this.options,d=this._serRole;if((c=d!=null&&c.plot2&&c.plot2Series&&def.array.as(c.plot2Series))&&c.length){var e=false,h=def.query(c).uniqueIndex(),g,j,k,f;a.setCalc({names:b,calculation:function(i,l){if(!e){if(d.isBound()){g=d.grouping.dimensionNames();
j=i.owner.dimensions(b)}e=true}if(j){i=pvc.data.Complex.values(i,g).join(",");l[b]=def.hasOwnProp.call(h,i)?f||(f=j.intern("1")):k||(k=j.intern("0"))}}})}}},_addDefaultDataPartCalculation:function(a){var b,c;this._complexTypeProj.setCalc({names:a,calculation:function(d,e){b||(b=d.owner.dimensions(a));e[a]=c||(c=b.intern("0"))}})},partData:function(a){if(!this._partData){if(!this._dataPartRole||!this._dataPartRole.grouping)return this._partData=this.data;this._partData=this.data.flattenBy(this._dataPartRole)}if(!a||
!this._dataPartRole||!this._dataPartRole.grouping)return this._partData;var b=this._dataPartRole.firstDimensionName();if(def.array.is(a)){if(a.length>1)return this._partData.where([def.set({},b,a)]);a=a[0]}var c=this._partData._childrenByKey[a+""];if(!c){c={v:a};if(a==="trend")if(a=this._firstTrendAtomProto)c.f=a.f;c=new pvc.data.Data({parent:this._partData,atoms:def.set({},b,c),dimNames:[b],datums:[]})}return c},visibleData:function(a,b){var c=def.get(b,"ignoreNulls",true);if(c&&this.options.ignoreNulls)c=
false;b=b?Object.create(b):{};b.ignoreNulls=c;c=c+"|"+a;var d=def.getOwn(this._visibleDataCache,c);if(!d)if(d=this._createVisibleData(a,b))(this._visibleDataCache||(this._visibleDataCache={}))[c]=d;return d},_createVisibleData:function(a,b){a=this.partData(a);if(!a)return null;b=def.get(b,"ignoreNulls");return this._serRole&&this._serRole.grouping?a.flattenBy(this._serRole,{visible:true,isNull:b?false:null}):a},_generateTrends:function(){this._dataPartRole&&def.query(def.own(this.axes)).selectMany(function(a){return a.dataCells}).where(function(a){return!!a.trend}).distinct(function(a){return a.role.name+
"|"+(a.dataPartValue||"")}).each(this._generateTrendsDataCell,this)},_interpolate:function(){def.query(def.own(this.axes)).selectMany(function(a){return a.dataCells}).where(function(a){a=a.nullInterpolationMode;return!!a&&a!=="none"}).distinct(function(a){return a.role.name+"|"+(a.dataPartValue||"")}).each(this._interpolateDataCell,this)},_interpolateDataCell:function(){},_generateTrendsDataCell:function(){},setData:function(a,b){this.setResultset(a.resultset);this.setMetadata(a.metadata);$.extend(this.options,
b);return this},setResultset:function(a){!this.parent||def.fail.operationInvalid("Can only set resultset on root chart.");this.resultset=a;a.length||this._log("Warning: Resultset is empty");return this},setMetadata:function(a){!this.parent||def.fail.operationInvalid("Can only set resultset on root chart.");this.metadata=a;a.length||this._log("Warning: Metadata is empty");return this}});
pvc.BaseChart.add({_initPlots:function(a){this.plotPanelList=null;if(this.parent){a=this.root;this.plots=a.plots;this.plotList=a.plotList;this.plotsByType=a.plotsByType}else{this.plots={};this.plotList=[];this.plotsByType={};this._initPlotsCore(a)}},_initPlotsCore:function(){},_addPlot:function(a){var b=this.plotsByType,c=this.plots,d=a.type,e=a.index,h=a.name,g=a.id;if(h&&def.hasOwn(c,h))throw def.error.operationInvalid("Plot name '{0}' already taken.",[h]);if(def.hasOwn(c,g))throw def.error.operationInvalid("Plot id '{0}' already taken.",
[g]);b=def.array.lazy(b,d);if(def.hasOwn(b,e))throw def.error.operationInvalid("Plot index '{0}' of type '{1}' already taken.",[e,d]);a.globalIndex=this.plotList.length;b[e]=a;this.plotList.push(a);c[g]=a;if(h)c[h]=a},_collectPlotAxesDataCells:function(a,b){var c=a.option("ColorRole");if(c){c=this.visualRoles(c);if(c.isBound()){b=def.array.lazy(b,"color");def.array.lazy(b,a.option("ColorAxis")-1).push({plot:a,role:c,dataPartValue:a.option("DataPart")})}}},_addPlotPanel:function(a){def.lazy(this,"plotPanels")[a.plot.id]=
a;def.array.lazy(this,"plotPanelList").push(a)},_createPlotPanels:function(){throw def.error.notImplemented();}});
pvc.BaseChart.add({colors:null,axes:null,axesList:null,axesByType:null,_axisClassByType:{color:pvc.visual.ColorAxis,size:pvc.visual.SizeAxis,base:pvc.visual.CartesianAxis,ortho:pvc.visual.CartesianAxis},_axisCreateWhere:{color:1,size:2,base:3,ortho:3},_axisCreationOrder:["color","size","base","ortho"],_axisCreateIfUnbound:{},_initAxes:function(a){this.axes={};this.axesList=[];this.axesByType={};delete this._rolesColorScale;var b;if(this.parent)b=this.root._dataCellsByAxisTypeThenIndex;else{b={};this.plotList.forEach(function(d){this._collectPlotAxesDataCells(d,
b)},this);this._fixTrendsLabel(b)}this._dataCellsByAxisTypeThenIndex=b;var c=0;this.parent||(c|=1);if(this.parent||!a)c|=2;this._axisCreateHere=c;this._axisCreationOrder.forEach(function(d){if((this._axisCreateWhere[d]&c)!==0){var e,h=b[d];if(h)(e=this._axisClassByType[d])&&h.forEach(function(g,j){new e(this,d,j)},this);else if(this._axisCreateIfUnbound[d])(e=this._axisClassByType[d])&&new e(this,d,0)}},this);this.parent&&this.root.axesList.forEach(function(d){def.hasOwn(this.axes,d.id)||this._addAxis(d)},
this)},_fixTrendsLabel:function(a){if(this._getDataPartDimName()){var b=def.query(def.ownKeys(a)).selectMany(function(d){return a[d]}).selectMany().first(function(d){return!!d.trend});if(b){var c=pvc.trends.get(b.trend.type).dataPartAtom;b=b.trend.label;if(b===undefined)b=c.f;this._firstTrendAtomProto={v:c.v,f:b}}else delete this._firstTrendAtomProto}},_addAxis:function(a){this.axes[a.id]=a;if(a.chart===this)a.axisIndex=this.axesList.length;this.axesList.push(a);var b=def.array.lazy(this.axesByType,
a.type),c=b.count||0;a.typeIndex=c;b[a.index]=a;if(!c)b.first=a;b.count=c+1;a.type==="color"&&a.isBound()&&this._onColorAxisScaleSet(a);return this},_getAxis:function(a,b){if((a=this.axesByType[a])&&b!=null&&+b>=0)return a[b]},_bindAxes:function(){var a=this._axisCreateHere;def.eachOwn(this._dataCellsByAxisTypeThenIndex,function(b,c){(this._axisCreateWhere[c]&a)!==0&&b.forEach(function(d,e){e=this.axes[pvc.buildIndexedId(c,e)];e.isBound()||e.bind(d)},this)},this)},_setAxesScales:function(){if(!this.parent){var a=
this.axesByType.color;a&&a.forEach(function(b){if(b.isBound()){b.calculateScale();this._onColorAxisScaleSet(b)}},this)}},_onColorAxisScaleSet:function(a){switch(a.index){case 0:this.colors=a.scheme();break;case 1:if(this._allowV1SecondAxis)this.secondAxisColor=a.scheme();break}},_getRoleColorScale:function(a){return def.lazy(def.lazy(this,"_rolesColorScale"),a,this._createRoleColorScale,this)},_createRoleColorScale:function(a){function b(h){var g=""+h;def.hasOwnProp.call(e,g)||(e[g]=d(h))}var c,d,
e={};this.axesByType.color.forEach(function(h){var g=h.role;if((g.name===a||g.sourceRole&&g.sourceRole.name===a)&&h.scale&&(h.index===0||h.option.isSpecified("Colors")||h.option.isSpecified("Map"))){d=h.scale;c||(c=d);h.domainValues.forEach(b)}},this);if(!c)return pvc.createColorScheme()();d=function(h){var g=""+h;if(def.hasOwnProp.call(e,g))return e[g];h=c(h);return e[g]=h};def.copy(d,c);return d},_onLaidOut:function(){}});
pvc.BaseChart.add({basePanel:null,titlePanel:null,legendPanel:null,_multiChartPanel:null,_initChartPanels:function(a){this._initBasePanel();this._initTitlePanel();var b=this._initLegendPanel();if(!this.parent&&a){this._initMultiChartPanel();b&&this._initLegendScenes(b)}else{var c=this.options;b&&this._initLegendScenes(b);this._preRenderContent({margins:a?c.smallContentMargins:c.contentMargins,paddings:a?c.smallContentPaddings:c.contentPaddings,clickAction:c.clickAction,doubleClickAction:c.doubleClickAction})}},
_preRenderContent:function(){},_initBasePanel:function(){this.basePanel=new pvc.BasePanel(this,this.parent&&this.parent._multiChartPanel,{margins:this.margins,paddings:this.paddings,size:{width:this.width,height:this.height}})},_initTitlePanel:function(){var a=this.options;if(!def.empty(a.title))this.titlePanel=new pvc.TitlePanel(this,this.basePanel,{title:a.title,font:a.titleFont,anchor:a.titlePosition,align:a.titleAlign,alignTo:a.titleAlignTo,offset:a.titleOffset,keepInBounds:a.titleKeepInBounds,
margins:a.titleMargins,paddings:a.titlePaddings,titleSize:a.titleSize,titleSizeMax:a.titleSizeMax})},_initLegendPanel:function(){var a=this.options;if(a.legend){var b=new pvc.visual.Legend(this,"legend",0);return this.legendPanel=new pvc.LegendPanel(this,this.basePanel,{anchor:b.option("Position"),align:b.option("Align"),alignTo:a.legendAlignTo,offset:a.legendOffset,keepInBounds:a.legendKeepInBounds,size:b.option("Size"),sizeMax:b.option("SizeMax"),margins:b.option("Margins"),paddings:b.option("Paddings"),
font:b.option("Font"),scenes:def.getPath(a,"legend.scenes"),textMargin:a.legendTextMargin,itemPadding:a.legendItemPadding,markerSize:a.legendMarkerSize})}},_getLegendBulletRootScene:function(){return this.legendPanel&&this.legendPanel._getBulletRootScene()},_initMultiChartPanel:function(){var a=this.basePanel,b=this.options;this._multiChartPanel=new pvc.MultiChartPanel(this,a,{margins:b.contentMargins,paddings:b.contentPaddings});this._multiChartPanel.createSmallCharts();a._children.unshift(a._children.pop())},
_coordinateSmallChartsLayout:function(){},_initLegendScenes:function(a){function b(g){if(g.option("LegendVisible")){var j=g&&g.dataCells;j&&j.forEach(function(k){if(k.role.isDiscrete()){var f=k.data;if(!c){d=this._getDataPartDimName();c=a._getBulletRootScene()}var i,l=g.option("LegendClickMode")==="toggleVisible"&&(i=f.atoms[d])&&i.value==="trend",m=c.createGroup({group:f,colorAxis:g,clickMode:l?"none":undefined,extensionPrefix:pvc.buildIndexedId("",e++)});k.legendBulletGroupScene=m;var n=g.scale;
f.children().each(function(o){m.createItem({group:o}).color=n(o.value)})}},this)}}var c,d,e=0,h=this.axesByType.color;h&&h.forEach(b,this)}});
pvc.BaseChart.add({_updateSelectionSuspendCount:0,_lastSelectedDatums:null,clearSelections:function(){this.data.owner.clearSelected()&&this.updateSelections();return this},_updatingSelections:function(a,b){this._suspendSelectionUpdate();try{a.call(b||this)}finally{this._resumeSelectionUpdate()}},_suspendSelectionUpdate:function(){if(this===this.root)this._updateSelectionSuspendCount++;else this.root._suspendSelectionUpdate()},_resumeSelectionUpdate:function(){if(this===this.root){if(this._updateSelectionSuspendCount>
0)--this._updateSelectionSuspendCount||this.updateSelections()}else this.root._resumeSelectionUpdate()},updateSelections:function(a){if(this===this.root){if(this._inUpdateSelections)return this;if(this._updateSelectionSuspendCount)return this;var b=this._calcSelectedChangedDatums();if(!b)return;pvc.removeTipsyLegends();this._inUpdateSelections=true;try{var c=this.options.selectionChangedAction;if(c){var d=this.data.selectedDatums(),e=b.values();c.call(this.basePanel._getContext(),d,e)}def.get(a,"render",
true)&&this.useTextMeasureCache(function(){this.basePanel.renderInteractive()},this)}finally{this._inUpdateSelections=false}}else this.root.updateSelections();return this},_calcSelectedChangedDatums:function(){if(this.data){var a,b=this.data.selectedDatumMap();if(a=this._lastSelectedDatums){a=a.symmetricDifference(b);if(!a.count)return}else{if(!b.count)return;a=b.clone()}(this._lastSelectedDatums=b)&&this._lastSelectedDatums.values();return a}},_onUserSelection:function(a){if(!a||!a.length)return a;
if(this===this.root){var b=this.options.userSelectionAction;if(b)return b.call(null,a)||a;return a}return this.root._onUserSelection(a)},_isSelectable:function(){return this.options.selectable},_canSelectWithRubberband:function(){var a=this.options;return a.selectable&&a.selectionMode==="rubberband"},_canSelectWithClick:function(){return this._canSelectWithRubberband()},_canSelectWithFocusWindow:function(){var a=this.options;return a.selectable&&a.selectionMode==="focuswindow"}});
pvc.BaseChart.add({_processExtensionPoints:function(){var a;if(this.parent)a=this.parent._components;else{var b=this.options.extensionPoints;a={};if(b)for(var c in b){var d,e;e=c.indexOf("_");if(e>0){d=c.substring(0,e);e=c.substr(e+1);if(d&&e)(def.getOwn(a,d)||(a[d]=new def.OrderedMap)).add(e,b[c])}}}this._components=a},extend:function(a,b,c){def.array.is(b)?b.forEach(function(d){this._extendCore(a,d,c)},this):this._extendCore(a,b,c)},_extendCore:function(a,b,c){if(a){var d=def.getOwn(this._components,
b);if(d){if(a.borderPanel)a=a.borderPanel;var e=pvc.debug>=3?[]:null,h=def.get(c,"constOnly",false),g=a.wrap,j={tag:pvc.extensionTag},k=a instanceof pv.Mark;d.forEach(function(f,i){if(a.isLocked&&a.isLocked(i))e&&e.push(i+": locked extension point!");else if(a.isIntercepted&&a.isIntercepted(i))e&&e.push(i+":"+pvc.stringify(f)+" (controlled)");else{e&&e.push(i+": "+pvc.stringify(f));if(f!=null){var l=typeof f;if(l==="object"){if(i==="svg"||i==="css")if(l=a.propertyValue(i))f=def.copy(l,f)}else if(k&&
(g||h)&&l==="function"){if(h)return;if(i!=="add")f=g.call(a,f,i)}}if(typeof a[i]==="function")i!="add"&&a.intercept?a.intercept(i,f,j):a[i](f);else a[i]=f}});if(e)if(e.length)this._log("Applying Extension Points for: '"+b+"'\n\t* "+e.join("\n\t* "));else pvc.debug>=5&&this._log("No Extension Points for: '"+b+"'")}}else pvc.debug>=4&&this._log("Applying Extension Points for: '"+b+"' (target mark does not exist)")},_getExtension:function(a,b){var c;if(def.array.is(a))for(var d=a.length-1,e;d>=0;){if((c=
def.getOwn(this._components,a[d--]))&&(e=c.get(b))!==undefined)return e}else if(c=def.getOwn(this._components,a))return c.get(b)},_getConstantExtension:function(a,b){a=this._getExtension(a,b);if(!def.fun.is(a))return a}});
def.type("pvc.BasePanel",pvc.Abstract).init(function(a,b,c){this.chart=a;this.base();this.axes={};if(c){if(c.scenes){this._sceneTypeExtensions=c.scenes;delete c.scenes}var d=c.axes;if(d){def.copy(this.axes,d);delete c.axes}}$.extend(this,c);this.chart=a;if(!this.axes.color)this.axes.color=a.axes.color;this.position={};d=c&&c.margins;if(!b&&d===undefined)d=3;this.margins=new pvc.Sides(d);this.paddings=new pvc.Sides(c&&c.paddings);this.size=new pvc.Size(c&&c.size);this.sizeMax=new pvc.Size(c&&c.sizeMax);
if(b){this.parent=b;this.isTopRoot=false;this.root=(this.isRoot=b.chart!==a)?this:b.root;this.topRoot=b.topRoot;if(this.isRoot){this.position.left=a.left;this.position.top=a.top}b._addChild(this)}else{this.parent=null;this.root=this;this.topRoot=this;this.isTopRoot=this.isRoot=true}this.data=(this.isRoot?a:b).data;if(this.isRoot)this.offset=this.alignTo=this.align=this.anchor=null;else{this.align=pvc.parseAlign(this.anchor,this.align);a=this.alignTo;b=this.anchor;if(a!=null&&a!==""&&(b==="left"||
b==="right")){if(a!=="page-middle")a=isNaN(+a.charAt(0))?pvc.parseAlign(b,a):pvc.PercentValue.parse(a)}else a=this.align;this.alignTo=a;this.offset=new pvc.Offset(this.offset)}if(this.borderWidth==null){var e;if(a=this._getExtensionId())if(this._getExtension(a,"strokeStyle")!=null){e=+this._getConstantExtension(a,"lineWidth");if(isNaN(e)||!isFinite(e))e=null}this.borderWidth=e==null?0:1.5}}).add({chart:null,parent:null,_children:null,type:pv.Panel,_extensionPrefix:"",_rubberSelectableMarks:null,height:null,
width:null,borderWidth:null,anchor:"top",pvPanel:null,margins:null,paddings:null,isRoot:false,isTopRoot:false,root:null,topRoot:null,_layoutInfo:null,_signs:null,data:null,dataPartValue:null,_isAnimating:0,_isRubberBandSelecting:false,_ignoreClicks:0,_v1DimRoleName:{series:"series",category:"category",value:"value"},_sceneTypeExtensions:null,clickAction:null,doubleClickAction:null,compatVersion:function(a){return this.chart.compatVersion(a)},_createLogInstanceId:function(){return""+this.constructor+
this.chart._createLogChildSuffix()},defaultVisibleBulletGroupScene:function(){var a=this.axes.color;if(a&&a.option("LegendVisible")){var b=this.dataPartValue;return def.query(a.dataCells).where(function(c){return c.dataPartValue===b}).select(function(c){return c.legendBulletGroupScene}).first(def.truthy)}return null},_getLegendBulletRootScene:function(){return this.chart._getLegendBulletRootScene()},_addChild:function(a){a.parent===this||def.assert("Child has a != parent.");(this._children||(this._children=
[])).push(a)},_addSign:function(a){def.array.lazy(this,"_signs").push(a);a.isRubberSelectable()&&def.array.lazy(this,"_rubberSelectableMarks").push(a.pvMark)},visibleData:function(){return this.chart.visibleData(this.dataPartValue)},layout:function(a,b){if(!this._layoutInfo||def.get(b,"force",false)){var c=def.get(b,"referenceSize");if(!c&&a)c=def.copyOwn(a);var d=this.size.resolve(c),e=this.sizeMax.resolve(c);if(!a){if(d.width==null||d.height==null)throw def.error.operationInvalid("Panel layout without width or height set.");
a=def.copyOwn(d)}if(!c&&a)c=def.copyOwn(a);if(e.width!=null&&a.width>e.width)a.width=e.width;if(e.height!=null&&a.height>e.height)a.height=e.height;e=this.borderWidth/2;var h=(def.get(b,"margins")||this.margins).resolve(c),g=(def.get(b,"paddings")||this.paddings).resolve(c),j=pvc.Sides.inflate(h,e),k=pvc.Sides.inflate(g,e),f=j.width+k.width,i=j.height+k.height;e=new pvc.Size(Math.max(a.width-f,0),Math.max(a.height-i,0));var l=def.copyOwn(d);if(l.width!=null)l.width=Math.max(l.width-f,0);if(l.height!=
null)l.height=Math.max(l.height-i,0);d=this._layoutInfo||null;b=def.get(b,"canChange",true);c=this._layoutInfo={canChange:b,referenceSize:c,realMargins:h,realPaddings:g,borderWidth:this.borderWidth,margins:j,paddings:k,desiredClientSize:l,clientSize:e,pageClientSize:d?d.pageClientSize:e.clone(),previous:d};if(d){delete d.previous;delete d.pageClientSize}if(h=this._calcLayout(c)){c.clientSize=h;a={width:h.width+f,height:h.height+i}}else{a=a;h=e}this.isVisible=h.width>0&&h.height>0;delete c.desiredClientSize;
this.width=a.width;this.height=a.height;!b&&d&&delete c.previous;if(pvc.debug>=5){this._log("Size       = "+pvc.stringify(a));this._log("Margins    = "+pvc.stringify(c.margins));this._log("Paddings   = "+pvc.stringify(c.paddings));this._log("ClientSize = "+pvc.stringify(c.clientSize))}this._onLaidOut()}},_onLaidOut:function(){this.isRoot&&this.chart._onLaidOut()},_calcLayout:function(a){function b(u,w,x){for(var s=0;u--;){if(w.call(x,u,s)===false)return true;s++}return false}function c(u,w){m&&f._group("LayoutCycle #"+
(w+1)+" (remaining: "+u+")");try{u=u>0;i=new pvc.Sides(0);l=def.copyOwn(k);var x;w=0;for(var s=v.length;w<s;){x=v[w];m&&f._group("SIDE Child #"+(w+1)+" at "+x.anchor);try{if(d.call(this,x,u))return true}finally{m&&f._groupEnd()}w++}w=0;for(s=r.length;w<s;){x=r[w];m&&f._group("FILL Child #"+(w+1));try{if(d.call(this,x,u))return true}finally{m&&f._groupEnd()}w++}return false}finally{m&&f._groupEnd()}}function d(u,w){var x=false,s;t.canChange=w;b(3,function(y,D){m&&f._group("Attempt #"+(D+1));try{t.paddings=
s;t.canChange=y>0;u.layout(new pvc.Size(l),t);if(u.isVisible){if(x=h.call(this,u,w))return false;var F=u._layoutInfo.requestPaddings;if(e(s,F)){s=F;if(y>0){s=new pvc.Sides(s);m&&this._log("Child requested paddings change: "+pvc.stringify(s));return true}pvc.debug>=2&&this._warn("Child requests paddings change but iterations limit has been reached.")}g.call(this,u);u.anchor!=="fill"&&j.call(this,u)}return false}finally{m&&f._groupEnd()}},this);return x}function e(u,w){if(!w)return false;return def.query(pvc.Sides.names).each(function(x){if(Math.abs((w&&
w[x]||0)-(u&&u[x]||0))>=0.1)return false})}function h(u,w){var x=false,s=u.width-l.width;if(s>0){pvc.debug>=3&&this._log("Child added width = "+s);if(w){x=true;l.width+=s;k.width+=s}else pvc.debug>=2&&this._warn("Child wanted more width, but layout iterations limit has been reached.")}u=u.height-l.height;if(u>0){pvc.debug>=3&&this._log("Child added height ="+u);if(w){x=true;l.height+=u;k.height+=u}else pvc.debug>=2&&this._warn("Child wanted more height, but layout iterations limit has been reached.")}return x}
function g(u){var w=u.anchor,x=u.align,s=u.alignTo,y;if(w==="fill"){w="left";y=i.left+l.width/2-u.width/2;x=s="middle"}else y=i[w];var D,F;switch(x){case "top":case "bottom":case "left":case "right":D=x;F=0;break;case "center":case "middle":D=p[o[w]];F=-u[n[D]]/2;break}var M,E;switch(s){case "top":case "bottom":case "left":case "right":E=s;M=E!==D?l[n[D]]:0;break;case "center":case "middle":E=p[o[w]];M=l[n[D]]/2;break;case "page-center":case "page-middle":E=p[o[w]];x=n[D];M=Math.min(l[x],a.pageClientSize[x])/
2;break}F=i[E]+M+F;if(E=u.offset.resolve(l)){y+=E[q[w]]||0;F+=E[q[D]]||0}if(u.keepInBounds){if(y<0)y=0;if(F<0)F=0}u.setPosition(def.set({},w,y,D,F))}function j(u){var w=u.anchor,x=n[w];u=u[x];i[w]+=u;l[x]-=u}var k,f=this,i,l,m;if(f._children){var n=pvc.BasePanel.orthogonalLength,o=pvc.BasePanel.relativeAnchor,p=pvc.BasePanel.leftTopAnchor,q=pvc.Offset.namesSidesToOffset,r=[],v=[];f._children.forEach(function(u){var w=u.anchor;if(w)if(w==="fill")r.push(u);else{def.hasOwn(o,w)||def.fail.operationInvalid("Unknown anchor value '{0}'",
[w]);v.push(u)}});m=pvc.debug>=5;k=def.copyOwn(a.clientSize);var t={force:true,referenceSize:k};m&&f._group("CCC DOCK LAYOUT clientSize = "+pvc.stringify(k));try{b(5,c,f)}finally{m&&f._groupEnd()}}return k},invalidateLayout:function(){this._layoutInfo=null;this._children&&this._children.forEach(function(a){a.invalidateLayout()})},_create:function(a){if(!this.pvPanel||a){this.pvPanel=null;delete this._signs;this.layout();if(this.isVisible){this.isRoot&&this._creating();var b=this._layoutInfo.margins;
a=this._layoutInfo.paddings;if(this.isTopRoot){this.pvRootPanel=this.pvPanel=(new pv.Panel).canvas(this.chart.options.canvas);if(b.width>0||b.height>0){this.pvPanel.width(this.width).height(this.height);this.pvPanel=this.pvPanel.add(pv.Panel)}}else this.pvPanel=this.parent.pvPanel.add(this.type);var c=this.pvPanel,d=this.width-b.width,e=this.height-b.height;c.width(d).height(e);if(pvc.debug>=15&&(b.width>0||b.height>0))(this.isTopRoot?this.pvRootPanel:this.parent.pvPanel).add(this.type).width(this.width).height(this.height).left(this.position.left!=
null?this.position.left:null).right(this.position.right!=null?this.position.right:null).top(this.position.top!=null?this.position.top:null).bottom(this.position.bottom!=null?this.position.bottom:null).strokeStyle("orange").lineWidth(1).strokeDasharray("- .");var h={};def.eachOwn(this.position,function(j,k){c[k](j+b[k]);h[this.anchorLength(k)]=true},this);if(!h.width){b.left>0&&c.left(b.left);b.right>0&&c.right(b.right)}if(!h.height){b.top>0&&c.top(b.top);b.bottom>0&&c.bottom(b.bottom)}if(a.width>
0||a.height>0)this.pvPanel=c.add(pv.Panel).width(d-a.width).height(e-a.height).left(a.left).top(a.top);c.borderPanel=c;c.paddingPanel=this.pvPanel;this.pvPanel.paddingPanel=this.pvPanel;this.pvPanel.borderPanel=c;if(pvc.debug>=15){this.pvPanel.strokeStyle("lightgreen").lineWidth(1).strokeDasharray("- ");this.pvPanel!==c&&c.strokeStyle("blue").lineWidth(1).strokeDasharray(". ")}a=this._getExtensionId();new pvc.visual.Panel(this,null,{panel:c,extensionId:a});this._createCore(this._layoutInfo);this.isTopRoot&&
pv.renderer()!=="batik"&&this.chart._canSelectWithRubberband()&&this._initRubberBand();this.applyExtensions();if(this.isRoot&&pvc.debug>5){var g=["SCALES SUMMARY",pvc.logSeparator];this.chart.axesList.forEach(function(j){var k=j.scale;if(k){var f=k.domain&&k.domain();k=k.range&&k.range();g.push(j.id);g.push("    domain: "+(!f?"?":pvc.stringify(f)));g.push("    range : "+(!k?"?":pvc.stringify(k)))}},this);this._log(g.join("\n"))}}}},_creating:function(){this._children&&this._children.forEach(function(a){a._creating()})},
_createCore:function(){this._children&&this._children.forEach(function(a){a._create()})},render:function(a){if(!this.isTopRoot)return this.topRoot.render(a);this._create(def.get(a,"recreate",false));if(this.isVisible){this._onRender();var b=this.chart.options,c=this.pvRootPanel;this._isAnimating=this.chart._animatable&&b.animate&&!def.get(a,"bypassAnimation",false)?1:0;try{c.render();if(this._isAnimating){this._isAnimating=2;var d=this;c.transition().duration(2E3).ease("cubic-in-out").start(function(){d._isAnimating=
0;d._onRenderEnd(true)})}else this._onRenderEnd(false)}finally{this._isAnimating=0}}},_onRender:function(){var a=this.chart.options.renderCallback;if(a)if(this.compatVersion()<=1)a.call(this.chart);else{var b=this._getContext();a.call(b,b.scene)}},_onRenderEnd:function(a){this._children&&this._children.forEach(function(b){b._onRenderEnd(a)})},renderInteractive:function(){if(this.isVisible){var a=this._getSelectableMarks();if(a&&a.length)a.forEach(function(b){b.render()});else if(!this._children){this.pvPanel.render();
return}this._children&&this._children.forEach(function(b){b.renderInteractive()})}},_getSelectableMarks:function(){return this._rubberSelectableMarks},animate:function(a,b){return this.topRoot._isAnimating===1?a:b},isAnimatingStart:function(){return this.topRoot._isAnimating===1},isAnimating:function(){return this.topRoot._isAnimating>0},setPosition:function(a){for(var b in a)if(def.hasOwn(pvc.Sides.namesSet,b)){var c=a[b];if(c===null)delete this.position[b];else{c=+c;if(!isNaN(c)&&isFinite(c))this.position[b]=
c}}},createAnchoredSize:function(a,b){if(this.isAnchorTopOrBottom())return new pvc.Size(b.width,Math.min(b.height,a));return new pvc.Size(Math.min(b.width,a),b.height)},applyExtensions:function(){this._signs&&this._signs.forEach(function(a){a.applyExtensions()})},extend:function(a,b,c){this.chart.extend(a,this._makeExtensionAbsId(b),c)},extendAbs:function(a,b,c){this.chart.extend(a,b,c)},_extendSceneType:function(a,b,c){(a=def.get(this._sceneTypeExtensions,a))&&pvc.extendType(b,a,c)},_absBaseExtId:{abs:"base"},
_absSmallBaseExtId:{abs:"smallBase"},_getExtensionId:function(){if(this.isRoot)return!this.chart.parent?this._absBaseExtId:this._absSmallBaseExtId},_getExtensionPrefix:function(){return this._extensionPrefix},_makeExtensionAbsId:function(a){return pvc.makeExtensionAbsId(a,this._getExtensionPrefix())},_getExtension:function(a,b){return this.chart._getExtension(this._makeExtensionAbsId(a),b)},_getExtensionAbs:function(a,b){return this.chart._getExtension(a,b)},_getConstantExtension:function(a,b){return this.chart._getConstantExtension(this._makeExtensionAbsId(a),
b)},getPvPanel:function(a){var b=this.pvPanel;if(!a)return b;if(!this.parent)throw def.error.operationInvalid("Layers are not possible in a root panel.");if(!b)throw def.error.operationInvalid("Cannot access layer panels without having created the main panel.");var c=null;if(this._layers)c=this._layers[a];else this._layers={};if(!c){var d=c=this.parent.pvPanel.borderPanel.add(this.type).extend(b.borderPanel);if(b!==b.borderPanel)c=d.add(pv.Panel).extend(b);d.borderPanel=d;d.paddingPanel=c;c.paddingPanel=
c;c.borderPanel=d;this.initLayerPanel(c,a);this._layers[a]=c}return c},initLayerPanel:function(){},_getV1DimName:function(a){var b=this._v1DimName||(this._v1DimNameCache={}),c=b[a];if(c==null){c=(c=this.chart.visualRoles(this._v1DimRoleName[a],{assertExists:false}))?c.firstDimensionName():"";b[a]=c}return c},_getV1Datum:function(a){return a.datum},_createContext:function(a,b){return new pvc.visual.Context(this,a,b)},_getContext:function(a,b){var c=this._context;if(!c||c.isPinned)this._context=this._createContext(a,
b);else visualContext_update.call(c,a,b);return this._context},_isTooltipEnabled:function(){return!this.isRubberBandSelecting()&&!this.isAnimating()},_ensurePropEvents:function(a){var b=a.propertyValue("events",true);if(!b||b==="none")a.events("all")},_addPropHoverable:function(a){var b=this;a.event("mouseover",function(c){if(!b.isRubberBandSelecting()&&!b.isAnimating()){c.setActive(true);b.renderInteractive()}}).event("mouseout",function(c){!b.isRubberBandSelecting()&&!b.isAnimating()&&c.clearActive()&&
b.renderInteractive()});this._ensurePropEvents(a)},_addPropTooltip:function(a,b){if(!a.hasTooltip){var c=this.chart._tooltipOptions,d=def.get(b,"options");c=d?def.create(c,d):Object.create(c);if(d=def.get(b,"buildTooltip")||this._getTooltipBuilder(c)){c.isEnabled=this._isTooltipEnabled.bind(this);var e=def.get(b,"tipsyEvent");e||(e="mouseover");b=def.get(b,"isLazy",true);a.localProperty("tooltip").tooltip(this._createTooltipProp(a,d,b)).title(function(){return""}).event(e,pv.Behavior.tipsy(c));a.hasTooltip=
true;this._ensurePropEvents(a)}}},_getTooltipBuilder:function(a){var b=this.chart.options,c=this.compatVersion()<=1,d=a.format;if(!d){if(!c)return this._buildDataTooltip;d=b.v1StyleTooltipFormat;if(!d)return}if(c)return function(e){return d.call(e.panel,e.getV1Series(),e.getV1Category(),e.getV1Value()||"",e.getV1Datum())};return function(e){return d.call(e,e.scene)}},_createTooltipProp:function(a,b,c){var d=this;if(!c)return function(){var e=d._getContext(a,null);if(e.scene.isIntermediate)return null;
return b.call(d,e)};return function(){var e=d._getContext(a,null);if(e.scene.isIntermediate)return null;e.pin();var h;return function(){if(h==null){h=b.call(d,e);e=null}return h}}},_requirePointEvent:function(a){if(!this.isTopRoot)return this.topRoot._requirePointEvent(a);if(!this._attachedPointEvent){this.pvPanel.events("all").event("mousemove",pv.Behavior.point(a||20));this._attachedPointEvent=true}},_buildDataTooltip:function(a){function b(o,p){f.push("<b>"+o+"</b>: "+(def.html.escape(p)||" - ")+
"<br/>")}function c(o,p){o=e?e.dimensions(p).percentOverParent(k):j.dimensions(p).percent(o.value);return l(o)}var d=a.scene;if(!d.datum)return"";var e=d.group,h=e&&e.count()>1,g=d.datum;if(!h&&(!g||g.isNull))return"";var j=d.data(),k={visible:true},f=[];if(g.isInterpolated)f.push("<i>Interpolation</i>: "+def.html.escape(g.interpolation)+"<br/>");else g.isTrend&&f.push("<i>Trend</i>: "+def.html.escape(g.trendType)+"<br/>");g=j.type;var i=a.panel.stacked===false?null:g.getPlayingPercentVisualRoleDimensionMap(),
l=i?this.chart.options.percentValueFormat:null,m=h?e.atoms:d.datum.atoms,n=false;g.sortDimensionNames(def.keys(m)).forEach(function(o){var p=m[o];if(!p.dimension.type.isHidden)if(!h||p.value!=null){n=true;var q=p.label;if(i&&i.has(o))q+=" ("+c(p,o)+")";b(def.html.escape(p.dimension.type.label),q)}},this);if(h){n&&f.push("<hr />");f.push("<b>#</b>: "+e._datums.length+"<br/>");g.sortDimensionNames(e.freeDimensionNames()).forEach(function(o){var p=e.dimensions(o);if(!p.type.isHidden){var q=def.html.escape(p.type.label);
if(p.type.valueType===Number){p=p.format(p.sum(k));if(i&&i.has(o))p+=" ("+c(null,o)+")";q="&sum; "+q}else p=p.atoms(k).map(function(r){return r.label||"- "}).join(", ");b(q,p)}})}return'<div style="text-align: left;">'+f.join("\n")+"</div>"},_addPropClick:function(a){function b(){return c._handleClick(this,arguments[arguments.length-1])}var c=this;a.cursor("pointer").event("click",b);this._ensurePropEvents(a)},_addPropDoubleClick:function(a){function b(){return c._handleDoubleClick(this,arguments[arguments.length-
1])}var c=this;a.cursor("pointer").event("dblclick",b);this._ensurePropEvents(a)},_isDoubleClickable:function(a){return(a||this.chart.options).clickable&&!!this.doubleClickAction},_handleDoubleClick:function(a,b){if(this._isDoubleClickable()){this._ignoreClicks=2;var c=a.sign;if(!c||c.isDoubleClickable())this._onDoubleClick(this._getContext(a,b))}},_onDoubleClick:function(a){var b=this.doubleClickAction;if(b)this.compatVersion()<=1?this._onV1DoubleClick(a,b):b.call(a,a.scene)},_onV1DoubleClick:function(a,
b){b.call(a.pvMark,a.getV1Series(),a.getV1Category(),a.getV1Value(),a.event,a.getV1Datum())},_isClickable:function(){return this.chart.options.clickable&&!!this.clickAction},_shouldHandleClick:function(){return this.chart._canSelectWithClick()||this._isClickable()},_handleClick:function(a,b){if(this._shouldHandleClick()){var c=this.chart.options,d;if(this.doubleClickAction){var e=this;d=this._createContext(a,b);window.setTimeout(function(){e._handleClickCore.call(e,d)},c.doubleClickMaxDelay||300)}else{d=
this._getContext(a,b);this._handleClickCore(d)}}},_handleClickCore:function(a){if(this._ignoreClicks)this._ignoreClicks--;else{var b=a.sign;if(!b||b.isClickable())this._onClick(a);if(b&&b.isSelectable()||!b&&this.chart.options.selectable&&a.scene.datum)this._onSelect(a)}},_onClick:function(a){var b=this.clickAction;if(b)this.compatVersion()<=1?this._onV1Click(a,b):b.call(a,a.scene)},_onV1Click:function(a,b){b.call(a.pvMark,a.getV1Series(),a.getV1Category(),a.getV1Value(),a.event,a.getV1Datum())},
_onSelect:function(a){var b=a.scene.datums().array();if(b.length){var c=this.chart;c._updatingSelections(function(){if((b=c._onUserSelection(b))&&b.length)c.options.ctrlSelectMode&&!a.event.ctrlKey?c.data.replaceSelected(b):pvc.data.Data.toggleSelected(b)},this)}},isRubberBandSelecting:function(){return this.topRoot._isRubberBandSelecting},_initRubberBand:function(){var a=this,b=this.chart,c=b.options,d=b.data;this._isRubberBandSelecting=false;var e=this.pvRootPanel||this.pvPanel.paddingPanel,h,g,
j=this.selectBar=(new pvc.visual.Bar(this,e,{extensionId:"rubberBand",normalStroke:true,noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true})).override("defaultStrokeWidth",function(){return 1.5}).override("defaultColor",function(i){return i==="stroke"?"#86fe00":"rgba(203, 239, 163, 0.6)"}).override("interactiveColor",function(i){return i}).pvMark.lock("visible",function(){return!!g}).lock("left",function(){return g.x}).lock("right").lock("top",function(){return g.y}).lock("bottom").lock("width",
function(){return g.dx}).lock("height",function(){return g.dy}).lock("cursor").lock("events","none");this._getExtensionAbs("base","fillStyle")||e.fillStyle(pvc.invisibleFill);e.lock("events","all");var k=new pvc.visual.Scene(null,{panel:this});k.x=k.y=k.dx=k.dy=0;var f;e.lock("data",[k]).event("mousedown",pv.Behavior.select().autoRender(false)).event("select",function(){if(g)g=new pv.Shape.Rect(k.x,k.y,k.dx,k.dy);else{if(a.isAnimating())return;if(k.dx*k.dx+k.dy*k.dy<=4)return;g=new pv.Shape.Rect(k.x,
k.y,k.dx,k.dy);a._isRubberBandSelecting=true;h||(h=e.toScreenTransform());a.rubberBand=g.apply(h)}j.render()}).event("selectend",function(){if(g){var i=arguments[arguments.length-1];h||(h=e.toScreenTransform());var l=g.apply(h);g=null;a._isRubberBandSelecting=false;j.render();try{a._processRubberBand(l,i,{allowAdditive:true})}finally{f=new Date}}});c.clearSelectionMode==="emptySpaceClick"&&e.event("click",function(){if(f)if(new Date-f<300){f=null;return}d.owner.clearSelected()&&a.chart.updateSelections()})},
_processRubberBand:function(a,b,c){this.rubberBand=a;try{this._onRubberBandSelectionEnd(b,c)}finally{this.rubberBand=null}},_onRubberBandSelectionEnd:function(a,b){pvc.debug>=10&&this._log("rubberBand "+pvc.stringify(this.rubberBand));b=Object.create(b||{});b.toggle=false;var c=this._getDatumsOnRubberBand(a,b);if(c){var d=def.get(b,"allowAdditive",true),e=this.chart;e._updatingSelections(function(){if(!d||!a.ctrlKey&&e.options.ctrlSelectMode){e.data.owner.clearSelected();pvc.data.Data.setSelected(c,
true)}else b.toggle?pvc.data.Data.toggleSelected(c):pvc.data.Data.setSelected(c,true)})}},_getDatumsOnRubberBand:function(a,b){a=new def.Map;this._getDatumsOnRect(a,this.rubberBand,b);b=a.values();if(b.length)if((b=this.chart._onUserSelection(b))&&!b.length)b=null;return b},_getDatumsOnRect:function(a,b,c){this._getOwnDatumsOnRect(a,b,c);this._children&&this._children.forEach(function(d){d._getDatumsOnRect(a,b,c)},this)},_getOwnDatumsOnRect:function(a,b,c){var d=false;if(this.isVisible){var e=this._getSelectableMarks();
e&&e.length&&e.forEach(function(h){this._eachMarkDatumOnRect(h,b,function(g){a.set(g.id,g);d=true},this,def.get(c,"markSelectionMode"))},this)}return d},_eachMarkDatumOnRect:function(a,b,c,d,e){function h(k,f,i){if(k.intersectsRect(b))if((f=f.data)&&f.datum){var l=f.group;(f=l?l._datums:def.array.as(f.datum))&&f.forEach(function(m){if(!m.isNull){pvc.debug>=20&&this._log("Rubbered Datum.key="+m.key+": "+pvc.stringify(k)+" mark type: "+a.type+" index="+i);c.call(d,m)}},this)}}var g=a.sign;if(!(g&&!g.isSelectable())){if(e==
null)e=def.get(a,"rubberBandSelectionMode","partial");var j=e==="center";a.eachInstanceWithData(function(k,f,i){var l=a.getShape(k,f,0.2);l=(j?l.center():l).apply(i);h.call(this,l,k[f],f)},this)}},isAnchorTopOrBottom:function(a){if(!a)a=this.anchor;return a==="top"||a==="bottom"},anchorOrtho:function(a){if(!a)a=this.anchor;return pvc.BasePanel.relativeAnchor[a]},anchorOrthoMirror:function(a){if(!a)a=this.anchor;return pvc.BasePanel.relativeAnchorMirror[a]},anchorOpposite:function(a){if(!a)a=this.anchor;
return pvc.BasePanel.oppositeAnchor[a]},anchorLength:function(a){if(!a)a=this.anchor;return pvc.BasePanel.parallelLength[a]},anchorOrthoLength:function(a){if(!a)a=this.anchor;return pvc.BasePanel.orthogonalLength[a]},isOrientationVertical:function(a){return this.chart.isOrientationVertical(a)},isOrientationHorizontal:function(a){return this.chart.isOrientationHorizontal(a)}}).addStatic({relativeAnchor:{top:"left",bottom:"left",left:"bottom",right:"bottom"},leftBottomAnchor:{top:"bottom",bottom:"bottom",
left:"left",right:"left"},leftTopAnchor:{top:"top",bottom:"top",left:"left",right:"left"},horizontalAlign:{top:"right",bottom:"left",middle:"center",right:"right",left:"left",center:"center"},verticalAlign:{top:"top",bottom:"bottom",middle:"middle",right:"bottom",left:"top",center:"middle"},verticalAlign2:{top:"top",bottom:"bottom",middle:"middle",right:"top",left:"bottom",center:"middle"},relativeAnchorMirror:{top:"right",bottom:"right",left:"top",right:"top"},oppositeAnchor:{top:"bottom",bottom:"top",
left:"right",right:"left"},parallelLength:{top:"width",bottom:"width",right:"height",left:"height"},orthogonalLength:{top:"height",bottom:"height",right:"width",left:"width"},oppositeLength:{width:"height",height:"width"}});
def.type("pvc.PlotPanel",pvc.BasePanel).init(function(a,b,c,d){this.base(a,b,d);this.plot=c;this._extensionPrefix=c.extensionPrefixes;this.dataPartValue=c.option("DataPart");this.axes.color=a._getAxis("color",(c.option("ColorAxis")||0)-1);this.orientation=c.option("Orientation");this.valuesVisible=c.option("ValuesVisible");this.valuesAnchor=c.option("ValuesAnchor");this.valuesMask=c.option("ValuesMask");this.valuesFont=c.option("ValuesFont");b=this.visualRoles=Object.create(a._visualRoles);c=c.option("ColorRole");
b.color=c?a.visualRoles(c):null;this.chart._addPlotPanel(this)}).add({anchor:"fill",visualRoles:null,_getExtensionId:function(){var a=["chart","plot"];this.plotName&&a.push(this.plotName);return a},isOrientationVertical:function(){return this.orientation===pvc.orientation.vertical},isOrientationHorizontal:function(){return this.orientation===pvc.orientation.horizontal}});
def.type("pvc.MultiChartPanel",pvc.BasePanel).add({anchor:"fill",_multiInfo:null,createSmallCharts:function(){var a=this.chart,b=a.options,c=Number(b.multiChartMax);if(isNaN(c)||c<1)c=Infinity;var d=a.visualRoles("multiChart");d=a.data.flattenBy(d,{visible:true});var e=Math.min(d._children.length,c);if(e!==0){b=+b.multiChartColumnsMax;if(isNaN(b)||c<1)b=3;c=Math.min(e,b);c>=1&&isFinite(c)||def.assert("Must be at least 1 and finite");var h=Math.ceil(e/c);h>=1||def.assert("Must be at least 1");var g=
this._getCoordinatedRootAxesByScopeType(),j,k,f;if(g){j={};k=function(q,r,v){r=def.array.lazy(j,r);def.array.lazy(r,v).push(q)};f=function(q){g.row&&k(q,"row",q.smallRowIndex);g.column&&k(q,"column",q.smallColIndex);g.global&&k(q,"global",0)}}for(var i=this._buildSmallChartsBaseOptions(),l=a.constructor,m=0;m<e;m++){var n=d._children[m],o=m%c,p=Math.floor(m/c);n=def.set(Object.create(i),"smallColIndex",o,"smallRowIndex",p,"title",n.absLabel,"data",n);n=new l(n);if(g){n._preRenderPhase1();f(n)}else n._preRender()}if(g){def.eachOwn(g,
function(q,r){q.forEach(function(v){j[r].forEach(function(t){this._coordinateScopeAxes(v.id,t)},this)},this)},this);a.children.forEach(function(q){q._preRenderPhase2()})}this._multiInfo={data:d,count:e,rowCount:h,colCount:c,multiChartColumnsMax:b,coordScopesByType:j}}},_getCoordinatedRootAxesByScopeType:function(){var a=false,b=def.query(this.chart.axesList).multipleIndex(function(c){if(c.scaleType!=="discrete"&&c.option.isDefined("DomainScope")){c=c.option("DomainScope");if(c!=="cell"){a=true;return c}}});
return a?b:null},_coordinateScopeAxes:function(a,b){var c=def.query(b).select(function(d){d=d.axes[a].scale;if(!d.isNull){d=d.domain();return{min:d[0],max:d[1]}}}).reduce(pvc.unionExtents,null);c&&b.forEach(function(d){d=d.axes[a];var e=d.scale;if(!e.isNull){e.domain(c.min,c.max);d.setScale(e)}})},_buildSmallChartsBaseOptions:function(){var a=this.chart,b=a.options;return def.set(Object.create(b),"parent",a,"legend",false,"titleFont",b.smallTitleFont,"titlePosition",b.smallTitlePosition,"titleAlign",
b.smallTitleAlign,"titleAlignTo",b.smallTitleAlignTo,"titleOffset",b.smallTitleOffset,"titleKeepInBounds",b.smallTitleKeepInBounds,"titleMargins",b.smallTitleMargins,"titlePaddings",b.smallTitlePaddings,"titleSize",b.smallTitleSize,"titleSizeMax",b.smallTitleSizeMax)},_calcLayout:function(a){var b=this._multiInfo;if(b){var c=this.chart.options,d=a.clientSize,e=a.previous,h=e?e.initialClientWidth:d.width;e=e?e.initialClientHeight:d.height;var g=pvc.PercentValue.parse(c.smallWidth);if(g!=null)g=pvc.PercentValue.resolve(g,
h);var j=pvc.PercentValue.parse(c.smallHeight);if(j!=null)j=pvc.PercentValue.resolve(j,e);var k=+c.smallAspectRatio;if(isNaN(k)||k<=0)k=this._calulateDefaultAspectRatio();if(g==null)if(isFinite(b.multiChartColumnsMax))g=d.width/b.colCount;else{if(j==null)j=e;g=k*j}if(j==null)j=b.rowCount===1&&def.get(c,"multiChartSingleRowFillsHeight",true)||b.colCount===1&&def.get(c,"multiChartSingleColFillsHeight",true)?e:g/k;def.set(a,"initialClientWidth",h,"initialClientHeight",e,"width",g,"height",j);return{width:g*
b.colCount,height:Math.max(d.height,j*b.rowCount)}}},_calulateDefaultAspectRatio:function(){if(this.chart instanceof pvc.PieChart)return 10/7;return 1.25},_getExtensionId:function(){return"content"},_createCore:function(a){var b=this._multiInfo;if(b){var c=this.chart,d=c.options,e=d.smallMargins;e=e==null?new pvc.Sides(new pvc.PercentValue(0.02)):new pvc.Sides(e);var h=new pvc.Sides(d.smallPaddings);c.children.forEach(function(g){g._setSmallLayout({left:g.smallColIndex*a.width,top:g.smallRowIndex*
a.height,width:a.width,height:a.height,margins:this._buildSmallMargins(g,e),paddings:h})},this);(b=b.coordScopesByType)&&c._coordinateSmallChartsLayout(b);this.base(a)}},_buildSmallMargins:function(a,b){var c=this._multiInfo,d=c.colCount-1;c=c.rowCount-1;var e=a.smallColIndex;a=a.smallRowIndex;var h={};if(e>0)h.left=b.left;if(e<d)h.right=b.right;if(a>0)h.top=b.top;if(a<c)h.bottom=b.bottom;return h}});
def.type("pvc.TitlePanelAbstract",pvc.BasePanel).init(function(a,b,c){c||(c={});var d=c.anchor||this.anchor;if(c.size==null){var e=c.titleSize;if(e!=null)c.size=(new pvc.Size).setSize(e,{singleProp:this.anchorOrthoLength(d)})}if(c.sizeMax==null){e=c.titleSizeMax;if(e!=null)c.sizeMax=(new pvc.Size).setSize(e,{singleProp:this.anchorOrthoLength(d)})}if(c.paddings==null)c.paddings=this.defaultPaddings;this.base(a,b,c);if(c.font===undefined){a=this._getExtension("label","font");if(typeof a==="string")this.font=
a}}).add({pvLabel:null,anchor:"top",title:null,titleSize:undefined,font:"12px sans-serif",defaultPaddings:2,_extensionPrefix:"title",_calcLayout:function(a){var b=new pvc.Size,c=this.anchor,d=this.anchorLength(c);c=this.anchorOrthoLength(c);var e=pv.Text.measure(this.title,this.font).width+2,h=a.clientSize[d],g=a.desiredClientSize[d];if(g==null)g=e>h?h:e;else if(g>h)g=h;e=e>g?pvc.text.justify(this.title,g,this.font):this.title?[this.title]:[];h=pv.Text.fontHeight(this.font);var j=e.length*h,k=a.clientSize[c],
f=a.desiredClientSize[c];if(f==null)f=j;else if(f>k)f=k;if(j>f){k=Math.max(1,Math.floor(f/h));if(e.length>k){var i=e[k];e.length=k;j=f=k*h;e[k-1]=pvc.text.trimToWidthB(g,e[k-1]+" "+i,this.font,"..")}}a.lines=e;a.topOffset=(f-j)/2;a.lineSize={width:g,height:h};a.a_width=d;a.a_height=c;b[d]=g;b[c]=f;return b},_createCore:function(a){var b=this._buildScene(a),c={top:0,right:Math.PI/2,bottom:0,left:-Math.PI/2},d=pvc.BasePanel.horizontalAlign[this.align],e=pvc.BasePanel.leftTopAnchor[this.anchor],h;if(this.compatVersion()<=
1)h=function(g){return function(){return g.call(this)}};this.pvLabel=(new pvc.visual.Label(this,this.pvPanel,{extensionId:"label",wrapper:h})).lock("data",b.lineScenes).pvMark[e](function(g){return a.topOffset+g.vars.size.height/2+this.index*g.vars.size.height}).textAlign(d)[this.anchorOrtho(e)](function(g){switch(this.textAlign()){case "center":return g.vars.size.width/2;case "left":return 0;case "right":return g.vars.size.width}}).text(function(g){return g.vars.textLines[this.index]}).font(this.font).textBaseline("middle").textAngle(c[this.anchor])},
_buildScene:function(a){var b=new pvc.visual.Scene(null,{panel:this,group:this.chart.data}),c=a.lines;b.vars.size=a.lineSize;b.vars.textLines=c;b.lineScenes=def.array.create(c.length,b);return b},_getExtensionId:function(){return""}});def.type("pvc.TitlePanel",pvc.TitlePanelAbstract).init(function(a,b,c){c||(c={});if(a.compatVersion()<=1)if(c.titleSize==null)c.titleSize=25;this._extensionPrefix=!a.parent?"title":"smallTitle";this.base(a,b,c)}).add({font:"14px sans-serif",defaultPaddings:4});
def.type("pvc.LegendPanel",pvc.BasePanel).add({pvRule:null,pvDot:null,pvLabel:null,anchor:"bottom",pvLegendPanel:null,textMargin:6,itemPadding:2.5,markerSize:15,font:"10px sans-serif",_calcLayout:function(a){return this._getBulletRootScene().layout(a)},_createCore:function(a){var b=a.clientSize;a=this._getBulletRootScene();var c=a.vars.itemPadding,d=a.vars.size,e=this.isAnchorTopOrBottom(),h=e?"top":"left",g=this.anchorOpposite(h),j=this.anchorLength(h),k=this.anchorOrthoLength(h),f=e?"center":"middle",
i=e?"left":"top",l=this.anchorOpposite(i),m=0;switch(this.align){case l:m=b[j]-d.width;break;case f:m=(b[j]-d.width)/2;break}this.pvPanel.overflow("hidden");b=this.pvPanel.add(pv.Panel).data(a.vars.rows)[i](m)[h](function(){var p=this.sibling();return p?p[h]+p[k]+c[k]:0})[j](function(p){return p.size.width})[k](function(p){return p.size.height});var n;if(this.compatVersion()<=1)n=function(p){return function(q){return p.call(this,q.vars.value.rawValue)}};this.pvLegendPanel=(new pvc.visual.Panel(this,
b,{extensionId:"panel",wrapper:n,noSelect:false,noClickSelect:true})).lockMark("data",function(p){return p.items}).lock(l,null).lock(g,null).lockMark(i,function(p){p=p.vars.itemPadding;var q=this.sibling();return q?q[i]+q[j]+p[j]:0}).lockMark("height",function(p){return p.vars.clientSize.height}).lockMark(h,e?function(p){p=p.vars;return p.row.size.height/2-p.clientSize.height/2}:0).lockMark("width",e?function(p){return p.vars.clientSize.width}:function(){return this.parent.width()}).pvMark.def("hidden",
"false").fillStyle(function(){return this.hidden()=="true"?"rgba(200,200,200,1)":"rgba(200,200,200,0.0001)"}).cursor(function(p){return p.isClickable()?"pointer":null}).event("click",function(p){if(p.isClickable())return p.click()});var o=(new pvc.visual.Panel(this,this.pvLegendPanel)).pvMark.left(0).top(0).right(null).bottom(null).width(function(p){return p.vars.markerSize}).height(function(p){return p.vars.clientSize.height});if(pvc.debug>=20){b.strokeStyle("red");this.pvLegendPanel.strokeStyle("green");
o.strokeStyle("blue")}a.childNodes.forEach(function(p){var q=(new pvc.visual.Panel(this,o)).pvMark.visible(function(r){return r.parent===p});p.renderer().create(this,q,p.extensionPrefix,n)},this);this.pvLabel=(new pvc.visual.Label(this,o.anchor("right"),{extensionId:"label",wrapper:n})).intercept("textStyle",function(p){var q=this.delegateExtension()||"black";return p.isOn()?q:pvc.toGrayScale(q,null,undefined,150)}).pvMark.textAlign("left").text(function(p){return p.vars.value.label}).lock("textMargin",
function(p){return p.vars.textMargin-4}).font(function(p){return p.vars.font}).textDecoration(function(p){return p.isOn()?"":"line-through"})},_getExtensionId:function(){return"area"},_getExtensionPrefix:function(){return"legend"},_getSelectableMarks:function(){return[this.pvLegendPanel]},_getBulletRootScene:function(){var a=this._rootScene;if(!a)this._rootScene=a=new pvc.visual.legend.BulletRootScene(null,{panel:this,group:this.chart.data,horizontal:this.isAnchorTopOrBottom(),font:this.font,markerSize:this.markerSize,
textMargin:this.textMargin,itemPadding:this.itemPadding});return a}});
def.type("pvc.CartesianAbstract",pvc.BaseChart).init(function(a){this.axesPanels={};this.base(a)}).add({_gridDockPanel:null,axesPanels:null,yAxisPanel:null,xAxisPanel:null,secondXAxisPanel:null,secondYAxisPanel:null,yScale:null,xScale:null,_getSeriesRoleSpec:function(){return{isRequired:true,defaultDimension:"series*",autoCreateDimension:true,requireIsDiscrete:true}},_getColorRoleSpec:function(){return{isRequired:true,defaultDimension:"color*",defaultSourceRole:"series",requireIsDiscrete:true}},_collectPlotAxesDataCells:function(a,
b){this.base(a,b);if(a.option.isDefined("BaseAxis")){var c=def.array.lazy(b,"base");def.array.lazy(c,a.option("BaseAxis")-1).push({plot:a,role:this.visualRoles(a.option("BaseRole")),dataPartValue:a.option("DataPart")})}if(a.option.isDefined("OrthoAxis")){c=a.option("Trend");var d=a.option.isDefined("Stacked")?a.option("Stacked"):undefined;b=def.array.lazy(b,"ortho");var e=def.array.to(a.option("OrthoRole")),h={dataPartValue:a.option("DataPart"),isStacked:d,trend:c,nullInterpolationMode:a.option("NullInterpolationMode")},
g=def.array.lazy(b,a.option("OrthoAxis")-1);e.forEach(function(j){var k=Object.create(h);k.role=this.visualRoles(j);g.push(k)},this)}},_addAxis:function(a){this.base(a);switch(a.type){case "base":case "ortho":this.axes[a.orientedId]=a;if(a.v1SecondOrientedId)this.axes[a.v1SecondOrientedId]=a;break}return this},_generateTrendsDataCell:function(a){var b=a.trend;if(b){b=pvc.trends.get(b.type);var c=[];this._generateTrendsDataCellCore(c,a,b);c.length&&this.data.owner.add(c)}},_generateTrendsDataCellCore:function(){},
_setAxesScales:function(a){this.base(a);if(!a||this.parent)["base","ortho"].forEach(function(b){(b=this.axesByType[b])&&b.forEach(this._createAxisScale,this)},this)},_createAxisScale:function(a){var b=a.type==="ortho",c=b||a.type==="base",d=this._createScaleByAxis(a);d.isNull&&pvc.debug>=3&&this._log(def.format("{0} scale for axis '{1}'- no data",[a.scaleType,a.id]));d=a.setScale(d).scale;if(c)if(b&&a.index===1)this.secondScale=d;else a.index||(this[a.orientation+"Scale"]=d);return d},_createScaleByAxis:function(a){return this["_create"+
def.firstUpperCase(a.scaleType)+"ScaleByAxis"].call(this,a)},_preRenderContent:function(a){this._createFocusWindow();this._gridDockPanel=new pvc.CartesianGridDockingPanel(this,this.basePanel,{margins:a.margins,paddings:a.paddings});["base","ortho"].forEach(function(b){(b=this.axesByType[b])&&def.query(b).reverse().each(function(c){this._createAxisPanel(c)},this)},this);this._createPlotPanels(this._gridDockPanel,{clickAction:a.clickAction,doubleClickAction:a.doubleClickAction})},_createFocusWindow:function(){if(this._canSelectWithFocusWindow()){var a,
b=this.focusWindow;if(b)a=b._exportData();b=this.focusWindow=new pvc.visual.CartesianFocusWindow(this);a&&b._importData(a);b._initFromOptions()}else this.focusWindow&&delete this.focusWindow},_createAxisPanel:function(a){if(a.option("Visible")){var b,c=a.option("Title");def.empty(c)||(b=new pvc.AxisTitlePanel(this,this._gridDockPanel,a,{title:c,font:a.option("TitleFont")||a.option("Font"),anchor:a.option("Position"),align:a.option("TitleAlign"),margins:a.option("TitleMargins"),paddings:a.option("TitlePaddings"),
titleSize:a.option("TitleSize"),titleSizeMax:a.option("TitleSizeMax")}));c=new pvc.AxisPanel(this,this._gridDockPanel,a,{anchor:a.option("Position"),size:a.option("Size"),sizeMax:a.option("SizeMax"),clickAction:a.option("ClickAction"),doubleClickAction:a.option("DoubleClickAction"),useCompositeAxis:a.option("Composite"),font:a.option("Font"),labelSpacingMin:a.option("LabelSpacingMin"),grid:a.option("Grid"),gridCrossesMargin:a.option("GridCrossesMargin"),ruleCrossesMargin:a.option("RuleCrossesMargin"),
zeroLine:a.option("ZeroLine"),desiredTickCount:a.option("DesiredTickCount"),showTicks:a.option("Ticks"),showMinorTicks:a.option("MinorTicks")});if(b)c.titlePanel=b;this.axesPanels[a.id]=c;this.axesPanels[a.orientedId]=c;if(a.index<=1&&a.v1SecondOrientedId)this[a.v1SecondOrientedId+"AxisPanel"]=c;return c}},_createDiscreteScaleByAxis:function(a){var b=this.visibleData(a.dataCells.map(function(c){return c.dataPartValue}),{ignoreNulls:false});b=b&&b.flattenBy(a.role);a=new pv.Scale.ordinal;if(!b||!b.count())a.isNull=
true;else{b=b.children().select(function(c){return def.nullyTo(c.value,"")}).array();a.domain(b)}return a},_createTimeSeriesScaleByAxis:function(a){a=this._getContinuousVisibleExtent(a);var b=new pv.Scale.linear;if(a){var c=a.min,d=a.max;if(d-c===0)d=new Date(d.getTime()+36E5);b.domain(c,d);b.minLocked=a.minLocked;b.maxLocked=a.maxLocked}else b.isNull=true;return b},_createNumericScaleByAxis:function(a){var b=this._getContinuousVisibleExtentConstrained(a),c=new pv.Scale.linear;if(b){var d,e=b.min,
h=b.max;if(e>h){d=e;e=h;h=d}if(a.option("OriginIsZero"))if(e===0)b.minLocked=true;else if(h===0)b.maxLocked=true;else if(e*h>0)if(e>0){if(!b.minLocked){b.minLocked=true;e=0}}else if(!b.maxLocked){b.maxLocked=true;h=0}if(e>h){d=e;e=h;h=d}if(h-e<=1.0E-12){b.minLocked||(e=e!==0?e*0.99:-0.1);if(!b.maxLocked||b.minLocked)h=h!==0?h*1.01:0.1}c.domain(e,h);c.minLocked=b.minLocked;c.maxLocked=b.maxLocked}else c.isNull=true;return c},_onLaidOut:function(){this.plotPanelList&&this.plotPanelList[0]&&["base",
"ortho"].forEach(function(a){(a=this.axesByType[a])&&a.forEach(this._setCartAxisScaleRange,this)},this)},_setCartAxisScaleRange:function(a){var b=this.plotPanelList[0]._layoutInfo.clientSize;a.setScaleRange(a.orientation==="x"?b.width:b.height);return a.scale},_getAxesRoundingPaddings:function(){function a(e,h,g){var j=c[e];if(j==null||h>j){c[e]=h;c[e+"Locked"]=g}else if(g)c[e+"Locked"]=g}function b(e){if(e){var h=e.getScaleRoundingPaddings();if(h){e=e.orientation==="x";a(e?"left":"bottom",h.begin,
h.beginLocked);a(e?"right":"top",h.end,h.endLocked)}}}var c={},d=this.axesByType;["base","ortho"].forEach(function(e){(e=d[e])&&e.forEach(b)});return c},_warnSingleContinuousValueRole:function(a){a.grouping.isSingleDimension||this._log("[WARNING] A linear scale can only be obtained for a single dimension role.");a.grouping.isDiscrete()&&this._log("[WARNING] The single dimension of role '{0}' should be continuous.",[a.name])},_getContinuousVisibleExtentConstrained:function(a,b,c){var d=false,e=false;
if(b==null){b=a.option("FixedMin");d=b!=null}if(c==null){c=a.option("FixedMax");e=c!=null}if(b==null||c==null){a=this._getContinuousVisibleExtent(a);if(!a)return null;if(b==null)b=a.min;if(c==null)c=a.max}return{min:b,max:c,minLocked:d,maxLocked:e}},_getContinuousVisibleExtent:function(a){var b=a.dataCells;if(b.length===1)return this._getContinuousVisibleCellExtent(a,b[0]);return def.query(b).select(function(c){return this._getContinuousVisibleCellExtent(a,c)},this).reduce(pvc.unionExtents,null)},
_getContinuousVisibleCellExtent:function(a,b){var c=b.role;this._warnSingleContinuousValueRole(c);if(c.name==="series")throw def.error.notImplemented();a=a.scaleUsesAbs();if(b=(b=this.visibleData(b.dataPartValue))&&b.dimensions(c.firstDimensionName()).extent({abs:a})){c=b.min.value;b=b.max.value;return{min:a?Math.abs(c):c,max:a?Math.abs(b):b}}},markEventDefaults:{strokeStyle:"#5BCBF5",lineWidth:"0.5",textStyle:"#5BCBF5",verticalOffset:10,verticalAnchor:"bottom",horizontalAnchor:"right",forceHorizontalAnchor:false,
horizontalAnchorSwapLimit:80},markEvent:function(a,b,c){var d=this.axes.base.scale;if(d.type!=="timeSeries"){this._log("Attempting to mark an event on a non timeSeries chart");return this}c=$.extend({},this.markEventDefaults,c);a=pv.Format.date(this.options.timeSeriesFormat).parse(a);a=d(a);d=d.range();if(a<d[0]||a>d[1]){this._log("Event outside the allowed range, returning");return this}var e=this.plotPanelList[0].pvPanel,h=this.yScale.range()[1];if(!c.forceHorizontalAnchor)if((c.horizontalAnchor==
"right"?d[1]-a:a)<c.horizontalAnchorSwapLimit)c.horizontalAnchor=c.horizontalAnchor=="right"?"left":"right";e.add(pv.Line).data([0,h]).strokeStyle(c.strokeStyle).lineWidth(c.lineWidth).bottom(function(g){return g}).left(a).anchor(c.horizontalAnchor).top(c.verticalAnchor=="top"?c.verticalOffset:h-c.verticalOffset).add(pv.Label).text(b).textStyle(c.textStyle).visible(function(){return!this.index});return this},defaults:{panelSizeRatio:0.9,timeSeries:false,timeSeriesFormat:"%Y-%m-%d"}});
def.type("pvc.GridDockingPanel",pvc.BasePanel).add({anchor:"fill",_calcLayout:function(a){function b(A,z){if(p)o._group("LayoutCycle "+(N?"- Disaster MODE":"#"+(z+1)));try{var C,G,I=a.canChange!==false&&!N&&A>0,J;z=false;var B;C=0;for(G=y.length;C<G;){p&&o._group("SIDE Child #"+(C+1));try{J=g(y[C],I);if(!N&&J){B=false;if((J&E)!==0){p&&o._log("SIDE Child #"+(C+1)+" changed overflow paddings");if(!z){z=true;a.requestPaddings=a.paddings}}if((J&M)!==0)if(A>0){p&&o._log("SIDE Child #"+(C+1)+" changed normal paddings");
B=true}else pvc.debug>=2&&o._warn("SIDE Child #"+(C+1)+" changed paddings but no more iterations possible.");if((J&F)!==0){N=true;b(0);return false}if(B)return true}}finally{p&&o._groupEnd()}C++}if(z){p&&o._log("Restarting due to overflowPaddings change");return false}C=0;for(G=s.length;C<G;){p&&o._group("FILL Child #"+(C+1));try{J=h(s[C],I);if(!N&&J){B=false;if((J&M)!==0)if(A>0){pvc.debug>=5&&o._log("FILL Child #"+(C+1)+" increased paddings");B=true}else pvc.debug>=2&&o._warn("FILL Child #"+(C+1)+
" increased paddings but no more iterations possible.");if((J&F)!==0){N=true;b(0);return false}if(B)return true}}finally{p&&o._groupEnd()}C++}return false}finally{p&&o._groupEnd()}}function c(A,z){for(var C=0;A--;){if(z(A,C)===false)return true;C++}return false}function d(A){var z=A.anchor;if(z)if(z==="fill"){s.push(A);A=A.paddings.resolve(x.referenceSize);r=pvc.Sides.resolvedMax(r,A)}else{def.hasOwn(u,z)||def.fail.operationInvalid("Unknown anchor value '{0}'",[z]);y.push(A)}}function e(A,z){p&&o._group("SIDE Child #"+
(z+1));try{z=0;var C=A.anchor;x.paddings=i(C,r);A.layout(new pvc.Size(v),x);if(A.isVisible){z|=l(C,r,A);j(C,A);k(C,A)}return z}finally{p&&o._groupEnd()}}function h(A,z){var C=0,G=A.anchor;x.paddings=i(G,r);x.canChange=z;A.layout(new pvc.Size(v),x);if(A.isVisible){C|=l(G,r,A,z);j(G,A);f(A,G)}return C}function g(A,z){var C=0;if(A.isVisible){var G=A.anchor,I=w[G],J=t[G];I=new pvc.Size(def.set({},I,v[I],J,A[J]));x.paddings=i(G,r);x.canChange=z;A.layout(I,x);if(A.isVisible)(C=l(G,r,A,z)|m(G,a.paddings,
A,z))||f(A,A.align)}return C}function j(A,z){var C;if(A==="fill"){A="left";C=q.left+v.width/2-z.width/2}else C=q[A];z.setPosition(def.set({},A,C))}function k(A,z){var C=t[A];z=z[C];q[A]+=z;v[C]-=z}function f(A,z){var C;if(z==="fill")z="middle";var G;switch(z){case "top":case "bottom":case "left":case "right":C=z;G=q[C];break;case "middle":C="bottom";G=q.bottom+v.height/2-A.height/2;break;case "center":C="left";G=q.left+v.width/2-A.width/2;break}A.setPosition(def.set({},C,G))}function i(A,z){var C=
new pvc.Sides;n(A).forEach(function(G){C.set(G,z[G])});return C}function l(A,z,C,G){var I=C._layoutInfo.requestPaddings,J=0;if(I){if(p&&pvc.debug>=10){o._log("=> clientSize="+pvc.stringify(C._layoutInfo.clientSize));o._log("<= requestPaddings="+pvc.stringify(I))}n(A).forEach(function(B){var H=z[B]||0,L=Math.floor(1E4*(I[B]||0))/1E4,K=L-H;H=Math.max(1,Math.abs(0.01*H));if(K!==0&&Math.abs(K)>=H)if(G){J|=M;z[B]=L;p&&o._log("Changed padding "+B+" <- "+L)}else pvc.debug>=2&&o._warn("CANNOT change but child wanted to: "+
B+"="+L)});if(J){A=pvc.Sides.names.map(function(B){return(z[B]||0).toFixed(0)}).join("|");if(def.hasOwn(D,A)){pvc.debug>=2&&o._warn("LOOP detected!!!!");J|=F}else D[A]=true;z.width=z.left+z.right;z.height=z.top+z.bottom}}return J}function m(A,z,C,G){var I=C._layoutInfo.overflowPaddings||O,J=0;p&&pvc.debug>=10&&o._log("<= overflowPaddings="+pvc.stringify(I));n(A).forEach(function(B){if(I.hasOwnProperty(B)){var H=z[B]||0,L=Math.floor(1E4*(I[B]||0))/1E4;L-=q[B];var K=L-H;H=Math.max(1,Math.abs(0.05*H));
if(K>=H)if(G){J|=E;z[B]=L;p&&o._log("changed overflow padding "+B+" <- "+L)}else pvc.debug>=2&&o._warn("CANNOT change overflow padding but child wanted to: "+B+"="+L)}});if(J){z.width=z.left+z.right;z.height=z.top+z.bottom}return J}function n(A){switch(A){case "left":case "right":return pvc.Sides.vnames;case "top":case "bottom":return pvc.Sides.hnames;case "fill":return pvc.Sides.names}}var o=this;if(o._children){var p=pvc.debug>=5,q=new pvc.Sides(0),r=new pvc.Sides(0),v=def.copyOwn(a.clientSize),
t=pvc.BasePanel.orthogonalLength,u=pvc.BasePanel.relativeAnchor,w=pvc.BasePanel.parallelLength,x={force:true,referenceSize:a.clientSize},s=[],y=[],D={},F=1,M=2,E=4,O=new pvc.Sides,N=false;p&&o._group("CCC GRID LAYOUT clientSize = "+pvc.stringify(v));try{this._children.forEach(d);p&&o._group("Phase 1 - Determine MARGINS and FILL SIZE from SIDE panels");try{y.forEach(e)}finally{if(p){o._groupEnd();o._log("Final FILL margins = "+pvc.stringify(q));o._log("Final FILL border size = "+pvc.stringify(v))}}p&&
o._group("Phase 2 - Determine COMMON PADDINGS");try{c(9,b)}finally{if(p){o._groupEnd();o._log("Final FILL clientSize = "+pvc.stringify({width:v.width-r.width,height:v.height-r.height}));o._log("Final COMMON paddings = "+pvc.stringify(r))}}a.gridMargins=new pvc.Sides(q);a.gridPaddings=new pvc.Sides(r);a.gridSize=new pvc.Size(v)}finally{p&&o._groupEnd()}}}});
def.type("pvc.CartesianGridDockingPanel",pvc.GridDockingPanel).init(function(a,b,c){this.base(a,b,c);this._plotBgPanel=new pvc.PlotBgPanel(a,this)}).add({_getExtensionId:function(){return!this.chart.parent?"content":"smallContent"},_createCore:function(a){var b=this.chart,c=b.axes,d=c.x,e=c.y;if(d.option("Grid"))this.xGridRule=this._createGridRule(d);if(e.option("Grid"))this.yGridRule=this._createGridRule(e);this.base(a);b.focusWindow&&this._createFocusWindow(a);if(b.compatVersion()<=1?!!(d.option("EndLine")||
e.option("EndLine")):def.get(b.options,"plotFrameVisible",true))this.pvFrameBar=this._createFrame(a,c);if(d.scaleType!=="discrete"&&d.option("ZeroLine"))this.xZeroLine=this._createZeroLine(d,a);if(e.scaleType!=="discrete"&&e.option("ZeroLine"))this.yZeroLine=this._createZeroLine(e,a)},_createGridRule:function(a){var b=a.scale;if(!b.isNull){var c=a.role.grouping.isDiscrete(),d=this._getAxisGridRootScene(a);if(d){var e=this._layoutInfo.gridMargins,h=this._layoutInfo.gridPaddings,g=a.orientation==="x"?
"left":"bottom",j=this.anchorLength(g),k=this.anchorOrtho(g),f=this.anchorOpposite(k),i=e[g]+h[g];h=e[k];e=e[f];d=d.leafs().array();var l=d.length;c&&l&&d.push(d[l-1]);var m;if(this.compatVersion()<=1)m=function(o){return function(p){return o.call(this,p.vars.tick.rawValue)}};a=(new pvc.visual.Rule(this,this.pvPanel,{extensionId:a.extensionPrefixes.map(function(o){return o+"Grid"}),wrapper:m})).lock("data",d).lock(j,null).override("defaultColor",function(){return pv.color("#f0f0f0")}).pvMark.lineWidth(1).antialias(true)[k](h)[f](e).zOrder(-12).events("none");
if(c){var n=b.range().step/2;a.lock(g,function(o){return i+b(o.vars.tick.value)+(this.index===l?n:-n)})}else a.lock(g,function(o){return i+b(o.vars.tick.value)});return a}}},_getAxisGridRootScene:function(a){var b=this.data,c=a.isDiscrete();if(c)b=a.role.flatten(b,{visible:true});var d=new pvc.visual.CartesianAxisRootScene(null,{panel:this,group:b});c?b._children.forEach(function(e){new pvc.visual.CartesianAxisTickScene(d,{group:e,tick:e.value,tickRaw:e.rawValue,tickLabel:e.label})}):(a.ticks||a.calcContinuousTicks()).forEach(function(e){new pvc.visual.CartesianAxisTickScene(d,
{tick:e,tickRaw:e,tickLabel:a.scale.tickFormat(e)})},this);return d},_createFrame:function(a,b){if(!(b.base.scale.isNull||b.ortho.scale.isNull&&(!b.ortho2||b.ortho2.scale.isNull))){var c=a.gridMargins;a=c.left;b=c.right;var d=c.top;c=c.bottom;var e=[];if(this.compatVersion()<=1){e.push("xAxisEndLine");e.push("yAxisEndLine")}e.push("plotFrame");return(new pvc.visual.Panel(this,this.pvPanel,{extensionId:e})).pvMark.lock("left",a).lock("right",b).lock("top",d).lock("bottom",c).lock("fillStyle",null).events("none").strokeStyle("#666666").lineWidth(1).antialias(false).zOrder(-8)}},
_createZeroLine:function(a,b){var c=a.scale;if(!c.isNull){var d=c.domain();if(d[0]*d[1]<-1.0E-12){d=a.orientation==="x"?"left":"bottom";var e=this.anchorLength(d),h=this.anchorOrtho(d),g=this.anchorOpposite(h),j=b.gridMargins;b=j[d]+b.gridPaddings[d]+c(0);c=j[h];j=j[g];var k=new pvc.visual.Scene(null,{panel:this});return(new pvc.visual.Rule(this,this.pvPanel,{extensionId:a.extensionPrefixes.map(function(f){return f+"ZeroLine"})})).lock("data",[k]).lock(e,null).lock(h,c).lock(g,j).lock(d,b).override("defaultColor",
function(){return pv.color("#666666")}).pvMark.events("none").lineWidth(1).antialias(true).zOrder(-9)}}},_createFocusWindow:function(a){function b(){E[w]=0-s[o];E[x]=D+s[o]+s[v]}function c(){var B=arguments[arguments.length-1].drag.phase==="end";h._isRubberBandSelecting=!B;z.render();C.render();var H=E[t],L=E[t]+E[u];if(!m){var K=y-H;H=y-L;L=K}j._updatePosition(H,L,B,true)}function d(B,H){var L=B.m,K=L[I],P,Q=E[J],R;switch(H){case "new":P=0;R="begin";break;case "resize-begin":P=Q;R="begin";break;
case "move":P=Q;R="begin";break;case "resize-end":P=K-E[I];R="end";break}K={type:H,target:R,point:K,length:P,length0:Q,min:B.min[I],max:B.max[I],minView:0,maxView:y};j._constraintPosition(K);L[I]=K.point;switch(H){case "resize-begin":K.max=Math.min(K.max,E[I]+E[J]);break;case "resize-end":K.min=Math.max(K.min,E[I]);break}B.min[I]=K.min;B.max[I]=K.max}var e=this,h=e.topRoot,g=e.chart,j=g.focusWindow.base,k=j.axis,f=k.scale;if(!f.isNull){var i=j.option("Resizable"),l=j.option("Movable");k=k.isDiscrete();
var m=g.isOrientationVertical(),n=m?"left":"top",o=m?"top":"left",p=e.anchorOrthoLength(n),q=e.anchorOpposite(n),r=e.anchorOrthoLength(o),v=e.anchorOpposite(o),t=m?"x":"y",u="d"+t,w=m?"y":"x",x="d"+w;g=a.gridMargins;var s=a.gridPaddings;g={left:g.left+s.left,right:g.right+s.right,top:g.top+s.top,bottom:g.bottom+s.bottom};g.width=g.left+g.right;g.height=g.top+g.bottom;a=a.clientSize;var y=a[p]-g[p],D=a[r]-g[r],F=s[n],M=s[q],E=new pvc.visual.Scene(null,{panel:this});a=k?f.range().step:0;k=a/2;E[t]=
f(j.begin)-k;E[u]=a+(f(j.end)-k)-E[t];b();var O=function(B){return function(){return E[B]}},N=function(){return Math.max(0,Math.min(y,E[t]))},A=function(){var B=N(),H=E[t]+E[u];H=Math.max(0,Math.min(y,H));return H-B};f=function(B,H){return(new pvc.visual.Bar(e,B,{extensionId:H,normalStroke:true,noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true,showsInteraction:false})).pvMark.lock("data").lock("visible").lock(n,N).lock(p,A).lock(o,O(w)).lock(r,O(x)).lock(v).lock(q).sign};var z=
this._plotBgPanel.pvPanel.borderPanel;z.lock("data",[E]);l&&i?z.paddingPanel.lock("events","all").lock("cursor","crosshair").event("mousedown",pv.Behavior.select().autoRender(false).collapse(m?"y":"x").positionConstraint(function(B){return d(B,B.phase==="start"?"new":"resize-end")})).event("selectstart",function(B){b();c(B)}).event("select",c).event("selectend",c):z.paddingPanel.events("all");a=f(z.paddingPanel,"focusWindowBg").override("defaultColor",function(){return pvc.invisibleFill}).pvMark;
l?a.lock("events","all").lock("cursor","move").event("mousedown",pv.Behavior.drag().autoRender(false).collapse(m?"y":"x").positionConstraint(function(B){d(B,"move")})).event("drag",c).event("dragend",c):a.events("none");var C=(new pvc.visual.Panel(e,e.pvPanel)).pvMark.lock("data",[E]).lock("visible").lock("fillStyle",pvc.invisibleFill).lock("left",g.left).lock("right",g.right).lock("top",g.top).lock("bottom",g.bottom).lock("zOrder",10).lock("events",function(){var B=E.drag;return B&&B.phase!=="end"?
"all":"none"}).lock("cursor",function(){var B=E.drag;return B&&B.phase!=="end"?B.type==="drag"||B.type==="select"&&!i?"move":m?"ew-resize":"ns-resize":null}).antialias(false);(new pvc.visual.Bar(e,C,{extensionId:"focusWindowBaseCurtain",normalStroke:true,noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true,showsInteraction:false})).override("defaultColor",function(B){return B==="stroke"?null:"rgba(20, 20, 20, 0.1)"}).pvMark.lock("data",[E,E]).lock("visible").lock("events","none").lock(n,
function(){return!this.index?-F:N()+A()}).lock(q,function(){return!this.index?null:-M}).lock(p,function(){return!this.index?F+N():null}).lock(o,O(w)).lock(r,O(x)).lock(v);var G=f(C,"focusWindow").override("defaultColor",function(){return null}).pvMark.lock("events","none");l=function(B){var H=B==="left"||B==="top"?"begin":"end",L="linear-gradient(to "+e.anchorOpposite(B)+", rgba(20, 20, 20, 0.1), #444 90%)",K=(new pvc.visual.Bar(e,G.anchor(B),{extensionId:j.id+"Grip"+def.firstUpperCase(H),normalStroke:true,
noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true,showsInteraction:false})).override("defaultColor",function(Q){return Q==="stroke"?null:L}).pvMark.lock("data").lock("visible")[o](E[w])[r](E[x]);if(i){var P="resize-"+H;K.lock("events","all")[p](5).cursor(m?"ew-resize":"ns-resize").event("mousedown",pv.Behavior.resize(B).autoRender(false).positionConstraint(function(Q){d(Q,P)}).preserveOrtho(true)).event("resize",c).event("resizeend",c)}else K.events("none")[p](1);return K};
l(n);l(q);var I=t,J=u}},_getDatumsOnRect:function(a,b,c){var d=this.chart,e=d.axesPanels.x,h=d.axesPanels.y,g,j;if(e){g=new def.Map;e._getDatumsOnRect(g,b,c);g.count||(g=null)}if(h){j=new def.Map;h._getOwnDatumsOnRect(j,b,c);j.count||(j=null)}if(g&&j){g.intersect(j,a);c.toggle=true}else if(g)a.copy(g);else j?a.copy(j):d.plotPanelList.forEach(function(k){k._getDatumsOnRect(a,b,c)},this)}});
def.type("pvc.CartesianAbstractPanel",pvc.PlotPanel).init(function(a,b,c,d){function e(l){j[l.type]=l;j[l.orientedId]=l;if(l.v1SecondOrientedId)j[l.v1SecondOrientedId]=l}function h(l,m){var n=k[l];if(n==null||m>n){f=true;k[l]=m}}function g(l){var m=l&&l.option("Offset");if(m!=null&&m>0&&m<1)if(l.orientation==="x"){h("left",m);h("right",m)}else{h("top",m);h("bottom",m)}}this.base(a,b,c,d);var j=this.axes;e(a._getAxis("base",c.option("BaseAxis")-1));e(a._getAxis("ortho",c.option("OrthoAxis")-1));var k=
{},f=false,i=a.axesByType;["base","ortho"].forEach(function(l){(l=i[l])&&l.forEach(g)});if(f)this.offsetPaddings=k}).add({offsetPaddings:null,_calcLayout:function(a){a.requestPaddings=this._calcRequestPaddings(a)},_calcRequestPaddings:function(a){var b,c=this.offsetPaddings;if(c){var d=this.chart._getAxesRoundingPaddings(),e=a.clientSize,h=a.paddings;pvc.Sides.names.forEach(function(g){var j=pvc.BasePanel.orthogonalLength[g],k=e[j];j=k+h[j];if(!d[g+"Locked"]){j=j*(c[g]||0);k=k*(d[g]||0);(b||(b={}))[g]=
Math.max(j-k,0)}},this)}return b},_createCore:function(){this.pvPanel.zOrder(-10);var a=this.chart.options.leafContentOverflow||"auto";(a==="auto"?def.query(["ortho","base"]).select(function(b){return this.axes[b]},this).any(function(b){return b.option("FixedMin")!=null||b.option("FixedMax")!=null}):a==="hidden")&&this.pvPanel.borderPanel.overflow("hidden")}});
def.type("pvc.PlotBgPanel",pvc.BasePanel).init(function(a,b,c){this.base(a,b,c)}).add({anchor:"fill",_getExtensionId:function(){return"plotBg"},_createCore:function(a){this.pvPanel.borderPanel.lock("zOrder",-13).antialias(false);this.base(a)}});
def.type("pvc.CategoricalAbstract",pvc.CartesianAbstract).init(function(a){this.base(a);if(a=this.parent)this._catRole=a._catRole}).add({_initVisualRoles:function(){this.base();this._catRole=this._addVisualRole("category",this._getCategoryRoleSpec())},_getCategoryRoleSpec:function(){return{isRequired:true,defaultDimension:"category*",autoCreateDimension:true}},_generateTrendsDataCellCore:function(a,b,c){function d(p){var q=l?null:function(u){return u.atoms[i].value},r=function(u){if((u=n._childrenByKey[u.key])&&
p)u=u._childrenByKey[p.key];return u?u.dimensions(f).sum(m):null};q=def.create(j,{rows:def.query(o),x:q,y:r});var v=c.model(q),t=n.owner.dimensions(k).intern(this.root._firstTrendAtomProto);v&&o.forEach(function(u,w){w=v.sample(l?w:u.atoms[i].value,r(u),w);if(w!=null){var x=n._childrenByKey[u.key];u=x||u;if(p)if(x=x&&x._childrenByKey[p.key])x=Object.create(x._datums[0].atoms);else{x=Object.create(u._datums[0].atoms);def.copyOwn(x,p.atoms)}else x=Object.create(u._datums[0].atoms);x[f]=w;x[k]=t;w=new pvc.data.Datum(u.owner,
x);w.isVirtual=true;w.isTrend=true;w.trendType=c.type;a.push(w)}},this)}var e=this._serRole,h=this._catRole,g=b.role,j=b.trend;this._warnSingleContinuousValueRole(g);var k=this._dataPartRole.firstDimensionName(),f=g.firstDimensionName(),i,l=h.isDiscrete();l||(i=h.firstDimensionName());var m={zeroIfNone:false};g={ignoreNulls:false};var n=this.visibleData(b.dataPartValue),o=this.visibleData(null,g).flattenBy(h,g)._children;def.scope(function(){return e&&e.isBound()?n.flattenBy(e).children():def.query([null])}).each(d,
this)},_interpolateDataCell:function(a){var b=a.nullInterpolationMode;if(b){var c;switch(a.nullInterpolationMode){case "linear":c=pvc.data.LinearInterpolationOper;break;case "zero":c=pvc.data.ZeroInterpolationOper;break;case "none":break;default:throw def.error.argumentInvalid("nullInterpolationMode",""+b);}if(c){this._warnSingleContinuousValueRole(a.role);b=this.visibleData(a.dataPartValue);if(b.childCount()>0){var d=this.visibleData(null,{ignoreNulls:false});(new c(d,b,this._catRole,this._serRole,
a.role,true)).interpolate()}}}},_createVisibleData:function(a,b){var c=this._serRole&&this._serRole.flattenedGrouping(),d=this._catRole.flattenedGrouping();a=this.partData(a);b={visible:true,isNull:def.get(b,"ignoreNulls")?false:null};return c?a.groupBy([d,c],b):a.groupBy(d,b)},_getContinuousVisibleCellExtent:function(a,b){var c=b.role;switch(c.name){case "series":case "category":return this.base(a,b)}this._warnSingleContinuousValueRole(c);var d=b.dataPartValue,e=c.firstDimensionName();c=this.visibleData(d);
var h=a.scaleUsesAbs();if(a.type!=="ortho"||!b.isStacked)return c.leafs().select(function(g){g=g.dimensions(e).sum();return h&&g<0?-g:g}).range();return c.children().select(function(g){var j=this._getStackedCategoryValueExtent(g,e,h);if(j)return{range:j,group:g}},this).where(def.notNully).reduce(function(g,j){return this._reduceStackedCategoryValueExtent(g,j.range,j.group)}.bind(this),null)},_getStackedCategoryValueExtent:function(a,b,c){var d=null,e=null;a.children().select(function(h){h=h.dimensions(b).sum();
return c&&h<0?-h:h}).each(function(h){if(h!=null)if(h>=0)d+=h;else e+=h});if(d==null&&e==null)return null;return{max:d||0,min:e||0}},_reduceStackedCategoryValueExtent:function(a,b){return pvc.unionExtents(a,b)},_coordinateSmallChartsLayout:function(a){this.base(a);var b=0,c,d=null,e={};this.children.forEach(function(h){h.basePanel.layout();var g,j=h.titlePanel;if(j){c||(c=j.anchorOrthoLength());g=j[c];if(g>b)b=g}var k=h.axesPanels;d||(d=def.query(def.ownKeys(k)).where(function(f){return f===k[f].axis.id}).select(function(f){e[f]=
{axis:0,title:0};return f}).array());d.forEach(function(f){var i=k[f];f=e[f];var l=i.axis.orientation==="x"?"height":"width";g=i[l];if(g>f.axis)f.axis=g;if(i=i.titlePanel){g=i[l];if(g>f.title)f.title=g}})},this);this.children.forEach(function(h){if(b>0){var g=h.titlePanel;g.size=g.size.clone().set(c,b)}var j=h.axesPanels;d.forEach(function(k){var f=j[k];k=e[k];var i=f.axis.orientation==="x"?"height":"width";f.size=f.size.clone().set(i,k.axis);if(f=f.titlePanel)f.size=f.size.clone().set(i,k.title)});
h.basePanel.invalidateLayout()},this)},defaults:{orthoAxisOrdinal:false}});def.type("pvc.CategoricalAbstractPanel",pvc.CartesianAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d);this.stacked=c.option("Stacked")});
def.type("pvc.AxisPanel",pvc.BasePanel).init(function(a,b,c,d){d=def.create(d,{anchor:c.option("Position")});var e=d.anchor||this.anchor;this.axis=c;this.base(a,b,d);this.roleName=c.role.name;this.isDiscrete=c.role.isDiscrete();this._extensionPrefix=c.extensionPrefixes;if(this.labelSpacingMin==null)this.labelSpacingMin=this.isDiscrete?0.25:1.5;if(this.showTicks==null)this.showTicks=!this.isDiscrete;if(d.font===undefined)if(a=this._getConstantExtension("label","font"))this.font=a;if(d.tickLength===
undefined){d=+this._getConstantExtension("ticks",this.anchorOrthoLength(e));if(!isNaN(d)&&isFinite(d))this.tickLength=d}}).add({pvRule:null,pvTicks:null,pvLabel:null,pvRuleGrid:null,pvScale:null,isDiscrete:false,roleName:null,axis:null,anchor:"bottom",tickLength:6,scale:null,ruleCrossesMargin:true,font:"9px sans-serif",labelSpacingMin:null,desiredTickCount:null,showMinorTicks:true,showTicks:null,hiddenLabelText:"\u00b7",_isScaleSetup:false,_createLogInstanceId:function(){return this.base()+" - "+
this.axis.id},getTicks:function(){return this._layoutInfo&&this._layoutInfo.ticks},_calcLayout:function(a){var b=this.axis.scale;if(!this._isScaleSetup){this.scale=this.pvScale=b;this.extend(b,"scale");this._isScaleSetup=true}if(b.isNull)a.axisSize=0;else this._calcLayoutCore(a);return this.createAnchoredSize(a.axisSize,a.clientSize)},_calcLayoutCore:function(a){var b=a.desiredClientSize[this.anchorOrthoLength()];a.axisSize=b;if(this.isDiscrete&&this.useCompositeAxis){if(a.axisSize==null)a.axisSize=
50}else{a.textAngle=def.number.as(this._getExtension("label","textAngle"),0);a.textMargin=def.number.as(this._getExtension("label","textMargin"),3);this._calcTicks();if(this.scale.type==="discrete")this._tickIncludeModulo=this._calcDiscreteTicksIncludeModulo();this._calcAxisSizeFromLabel();if(a.axisSize==null)a.axisSize=a.requiredAxisSize;this._calcMaxTextLengthThatFits();this._calcOverflowPaddings()}},_calcAxisSizeFromLabel:function(){this._calcLabelBBox();this._calcAxisSizeFromLabelBBox()},_calcLabelBBox:function(){var a=
this._layoutInfo,b=this._getExtension("label","textAlign");if(typeof b!=="string")b=this.isAnchorTopOrBottom()?"center":this.anchor=="left"?"right":"left";var c=this._getExtension("label","textBaseline");if(typeof c!=="string")switch(this.anchor){case "right":case "left":case "center":c="middle";break;case "bottom":c="top";break;default:c="bottom"}return a.labelBBox=pvc.text.getLabelBBox(a.maxTextWidth!=null?a.maxTextWidth:a._maxTextWidth,a.textHeight,b,c,a.textAngle,a.textMargin)},_calcAxisSizeFromLabelBBox:function(){var a=
this._layoutInfo,b=a.labelBBox,c=this.tickLength+this._getLabelBBoxQuadrantLength(b,this.anchor);b.sourceAngle===0&&this.isAnchorTopOrBottom()||(c+=this.tickLength);a.requiredAxisSize=c},_getLabelBBoxQuadrantLength:function(a,b){var c;switch(b){case "left":c=-a.x;break;case "right":c=a.x2;break;case "top":c=-a.y;break;case "bottom":c=a.y2;break}return Math.max(c,0)},_calcOverflowPaddings:function(){if(this._layoutInfo.canChange){this._layoutInfo.labelBBox||this._calcLabelBBox();this._calcOverflowPaddingsFromLabelBBox()}else pvc.debug>=
2&&this._warn("Layout cannot change. Skipping calculation of overflow paddings.")},_calcOverflowPaddingsFromLabelBBox:function(){var a=null,b=this._layoutInfo,c=b.ticks,d=c.length;if(d){var e=b.paddings,h=b.labelBBox,g=this.isAnchorTopOrBottom(),j=g?"left":"top";g=g?"right":"bottom";var k=this.scale.type==="discrete",f=b.clientSize[this.anchorLength()];this.axis.setScaleRange(f);var i;if(k){c=this.scale.range().step/2;i=def.set({},j,c,g,c)}else i=def.set({},j,this.scale(c[0]),g,f-this.scale(c[d-1]));
[j,g].forEach(function(l){var m=this._getLabelBBoxQuadrantLength(h,l);if(m>0){m-=e[l]||0;if(m>0){m-=i[l];if(m>1){if(k)m*=1.05;a||(a={});a[l]=m}}}},this);pvc.debug>=6&&a&&this._log("OverflowPaddings = "+pvc.stringify(a))}b.overflowPaddings=a},_calcMaxTextLengthThatFits:function(){var a=this._layoutInfo;if(this.compatVersion()<=1)a.maxTextWidth=null;else{var b=a.clientSize[this.anchorOrthoLength()],c=Math.min(a.axisSize,b);if(c>=a.requiredAxisSize-this.tickLength)a.maxTextWidth=null;else{b=a.labelBBox;
c=c-2*this.tickLength;var d,e;switch(this.anchor){case "left":e=pv.vector(0,1);d=pv.vector(-c,0);break;case "right":e=pv.vector(0,1);d=pv.vector(c,0);break;case "top":e=pv.vector(1,0);d=pv.vector(0,-c);break;case "bottom":e=pv.vector(1,0);d=pv.vector(0,c);break}var h=d.norm(),g=b.source.points(),j=g[0],k=g[1],f=g[2];g=g[3];var i=f.minus(g),l=k.minus(j),m=pv.SvgScene.lineIntersect;l=m(d,e,j,l);d=m(d,e,g,i);m=e=b.sourceTextWidth;var n=l.minus(j),o=n.length();if(o<=e&&n.dot(i)>=0)m=j.dot(h)<k.dot(h)?
o:l.minus(k).length();j=d.minus(g);k=j.length();if(k<=e&&j.dot(i)>=0)m=g.dot(h)<f.dot(h)?Math.min(m,k):Math.min(m,d.minus(f).length());if(b.sourceAlign==="center")m-=e-m;a.maxTextWidth=m;pvc.debug>=3&&this._log("Trimming labels' text at length "+m.toFixed(2)+"px maxOrthoLength="+c.toFixed(2)+"px")}}},_calcTicks:function(){var a=this._layoutInfo;a.textHeight=pv.Text.fontHeight(this.font)*2/3;a.maxTextWidth=null;this.axis.setTicks(null);switch(this.scale.type){case "discrete":this._calcDiscreteTicks();
break;case "timeSeries":this._calcTimeSeriesTicks();break;case "numeric":this._calcNumberTicks(a);break;default:throw def.error.operationInvalid("Undefined axis scale type");}this.axis.setTicks(a.ticks);this.axis.setScaleRange(a.clientSize[this.anchorLength()]);if(a.maxTextWidth==null)a.maxTextWidth=def.query(a.ticksText).select(function(b){return pv.Text.measure(b,this.font).width},this).max();a._maxTextWidth=a.maxTextWidth},_calcDiscreteTicks:function(){var a=this._layoutInfo,b=this.axis.role,c=
b.flatten(this.data,{visible:true});a.data=c;a.ticks=c._children;var d,e;b=b.grouping;if(b.isSingleDimension&&(e=b.firstDimensionType())&&e.valueType===Date)if((e=c.dimensions(e.name).extent())&&e.min!==e.max){var h=new pv.Scale.linear(e.min.value,e.max.value);h.ticks();(d=this.axis.option("TickFormatter"))&&h.tickFormatter(d);d=function(g){return h.tickFormat(g.value)}}d||(d=function(g){return g.absLabel});a.ticksText=c._children.map(d)},_calcTimeSeriesTicks:function(){this._calcContinuousTicks(this._layoutInfo)},
_calcNumberTicks:function(){var a=this.desiredTickCount;if(a==null){if(this.isAnchorTopOrBottom()){this._calcNumberHTicks();return}a=this._calcNumberVDesiredTickCount()}this._calcContinuousTicks(this._layoutInfo,a)},_calcContinuousTicks:function(a,b){this._calcContinuousTicksValue(a,b);this._calcContinuousTicksText(a)},_calcContinuousTicksValue:function(a,b){a.ticks=this.axis.calcContinuousTicks(b);if(pvc.debug>4){this._log("DOMAIN: "+pvc.stringify(this.scale.domain()));this._log("TICKS:  "+pvc.stringify(a.ticks))}},
_calcContinuousTicksText:function(a){a.ticksText=def.query(a.ticks).select(function(b){return this.scale.tickFormat(b)},this).array()},_calcDiscreteTicksIncludeModulo:function(){if(this.axis.option("OverlappedLabelsMode")!=="hide")return 1;var a=this._layoutInfo,b=a.ticks.length;if(b<=1)return 1;var c=this.scale.range().step,d=a.textHeight,e=a.maxTextWidth;if(!(e>0&&d>0&&c>0))return 1;var h=d*this.labelSpacingMin;a=a.textAngle;var g=this.isAnchorTopOrBottom(),j=g?"sin":"cos";g=!g?"sin":"cos";var k=
1;do{var f=k*c,i=f*Math.abs(Math[j](a))-d;f=f*Math.abs(Math[g](a))-e;if(i>=h||f>=h)break;k++}while(Math.ceil(b/k)>1);k>1&&pvc.debug>=3&&this._info("Showing only one in every "+k+" tick labels");return k},_calcNumberVDesiredTickCount:function(){var a=this._layoutInfo,b=a.textHeight*(1+Math.max(0,this.labelSpacingMin));a=a.clientSize[this.anchorLength()];return Math.max(1,~~(a/b))},_calcNumberHTicks:function(){var a=this._layoutInfo,b=a.clientSize[this.anchorLength()],c=a.textHeight*Math.max(0,this.labelSpacingMin),
d=this._calcNumberHDesiredTickCount(c),e=pvc.debug>=7,h,g,j,k,f;do{e&&this._log("calculateNumberHTicks TickCount IN desired = "+d);j={};this._calcContinuousTicksValue(j,d);var i=j.ticks,l=i.length;if(i.exponentOverflow)if(h==null)if(i.exponent===this.exponentMin){k=j;h=1}else{f=j;h=-1}else{if(h===1){if(k)j=k}else if(f)j=f;break}else if(g==null||l!==g){e&&this._log("calculateNumberHTicks TickCount desired/resulting = "+d+" -> "+l);g=l;this._calcContinuousTicksText(j);var m=this._calcNumberHLength(j,
c),n=j.excessLength=m-b,o=j.error=Math.abs(n/b);if(e){this._log("calculateNumberHTicks error="+(n>=0?"+":"-")+(j.error*100).toFixed(0)+"% count="+l+" step="+i.step);this._log("calculateNumberHTicks Length client/resulting = "+b+" / "+m+" spacing = "+c)}if(n>0){if(d===1){if(l===3&&o<=1){j.ticks.splice(1,1);j.ticksText.splice(1,1);j.ticks.step*=2}else{j.ticks.length=1;j.ticksText.length=1}delete j.maxTextWidth;break}if(k){j=k;break}f=j;h=-1}else{if(o<=0.05||h===-1)break;k=j;h=+1}}d+=h}while(1);if(j){a.ticks=
j.ticks;a.ticksText=j.ticksText;a.maxTextWidth=j.maxTextWidth;if(pvc.debug>=5)this._log("calculateNumberHTicks RESULT error="+(j.excessLength>=0?"+":"-")+(j.error*100).toFixed(0)+"% count="+j.ticks.length+" step="+j.ticks.step)}e&&this._log("calculateNumberHTicks END")},_calcNumberHDesiredTickCount:function(a){var b=this._layoutInfo,c=this.scale.domain().map(function(d){d=+d.toFixed(2);d=this.scale.tickFormat(d);return pv.Text.measure(d,this.font).width},this);c=Math.max((c[1]+c[0])/2,b.textHeight);
b=b.clientSize[this.anchorLength()];return Math.max(1,~~(b/(c+a)))},_calcNumberHLength:function(a,b){a=a.ticksText;var c=def.query(a).select(function(d){return pv.Text.measure(d,this.font).width},this).max();return Math.max(c,(a.length-1)*(c+b))},_createCore:function(){if(!this.scale.isNull){var a=this._layoutInfo.clientSize,b=this._layoutInfo.paddings,c=this.anchorOrtho(),d=this.anchorOpposite(c),e=this.anchorOrthoLength(c),h=this.ruleCrossesMargin?-b[c]:0;this._rSize=a=a[e]+(this.ruleCrossesMargin?
b[d]:0)-h;b=this._getRootScene();this.pvRule=(new pvc.visual.Rule(this,this.pvPanel,{extensionId:"rule"})).lock("data",[b]).override("defaultColor",def.fun.constant("#666666")).lock(this.anchorOpposite(),0).lock(c,h).lock(e,a).pvMark.zOrder(30).strokeDasharray(null).lineCap("square");if(this.isDiscrete)this.useCompositeAxis?this.renderCompositeOrdinalAxis():this.renderOrdinalAxis();else this.renderLinearAxis()}},_getExtensionId:function(){return""},_getRootScene:function(){if(!this._rootScene){var a=
this._rootScene=new pvc.visual.CartesianAxisRootScene(null,{panel:this,group:this._getRootData()}),b=this._layoutInfo,c=b.ticksText;if(this.isDiscrete)this.useCompositeAxis?this._buildCompositeScene(a):b.ticks.forEach(function(d,e){new pvc.visual.CartesianAxisTickScene(a,{group:d,tick:d.value,tickRaw:d.rawValue,tickLabel:c[e]})});else b.ticks.forEach(function(d,e){new pvc.visual.CartesianAxisTickScene(a,{tick:d,tickRaw:d,tickLabel:c[e]})},this)}return this._rootScene},_buildCompositeScene:function(a){function b(d){var e=
d.group;if(c){var h=d.vars.tick;d.nodeValue=d.value=h.rawValue;d.nodeLabel=d.label=h.label}e.childCount()&&e.children().each(function(g){g=new pvc.visual.CartesianAxisTickScene(d,{group:g,tick:g.value,tickRaw:g.rawValue,tickLabel:g.label});b(g)})}var c=this.compatVersion()<=1;a.vars.tick=new pvc.visual.ValueLabelVar("","");b(a)},_getRootData:function(){var a=this.chart,b=a.data;if(this.isDiscrete&&this.useCompositeAxis){var c=this.anchor;c=c=="bottom"||c=="left";b=a.visualRoles(this.roleName).select(b,
{visible:true,reverse:c})}return b},renderOrdinalAxis:function(){var a=this.scale,b=this.hiddenLabelText,c=this.anchorOpposite(),d=this.anchorLength(),e=this.anchorOrtho(),h=this.anchorOrthoLength(),g=this.pvRule,j=this._getRootScene(),k=this._tickIncludeModulo,f=this.compatVersion()<=1;j.vars.tickIncludeModulo=k;j.vars.hiddenLabelText=b;var i;if(f){var l=function(q){this.value=this.absValue=q.rawValue;this.path=(this.nodeName=""+(this.value||""))?[this.nodeName]:[];this.label=this.absLabel=q.label};
l.prototype.toString=function(){return""+this.value};i=function(q){return function(r){var v=Object.create(this);v.index=this.parent.index;return q.call(v,new l(r.vars.tick))}}}b=(new pvc.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"})).lock("data",j.childNodes).localProperty("hidden").lockMark("hidden",function(){return this.index%k!==0}).lock(c,0).lockMark(e,function(q){return a(q.vars.tick.value)}).lock("strokeDasharray",null).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",
0).pvMark.zOrder(20);if(f||this.showTicks)this.pvTicks=(new pvc.visual.Rule(this,b,{extensionId:"ticks",wrapper:i})).lock("data").intercept("visible",function(){return!this.pvMark.parent.hidden()&&this.delegateExtension(true)}).optional("lineWidth",1).lock(c,0).lock(e,0).lock(d,null).optional(h,this.tickLength*2/3).override("defaultColor",function(){if(f)return pv.Color.names.transparent;return g.scene?g.scene[0].strokeStyle:"#666666"}).pvMark;var m,n;switch(this.anchor){case "top":n="center";m="bottom";
break;case "bottom":n="center";m="top";break;case "left":n="right";m="middle";break;case "right":n="left";m="middle";break}var o=this.font,p=this._layoutInfo.maxTextWidth;isFinite(p)||(p=0);this.pvLabel=(new pvc.visual.Label(this,b,{extensionId:"label",noClick:false,noDoubleClick:false,noSelect:false,noTooltip:false,noHover:false,wrapper:i,tooltipArgs:{buildTooltip:function(q){return q.scene.vars.tick.label},isLazy:false,options:{gravity:this._calcTipsyGravity()}}})).intercept("visible",function(q){return!this.pvMark.parent.hidden()?
this.delegateExtension(true):!!q.vars.hiddenLabelText}).intercept("text",function(q){var r;if(this.pvMark.parent.hidden())r=q.vars.hiddenLabelText;else{r=this.delegateExtension();if(r===undefined)r=q.vars.tick.label;if(p)r=pvc.text.trimToWidthB(p,r,o,"..",false)}return r}).pvMark.zOrder(40).lock(c,this.tickLength).lock(e,0).font(o).textStyle("#666666").textAlign(n).textBaseline(m);this._debugTicksPanel(b)},_debugTicksPanel:function(a){if(pvc.debug>=16){var b=this._layoutInfo.labelBBox.source.points();
if(b.length>1)b=b.concat(b[0]);a.add(pv.Panel)[this.anchorOpposite()](this.tickLength)[this.anchorOrtho()](0)[this.anchorLength()](0)[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).add(pv.Line).visible(function(){var c=this.parent.parent;return!c.hidden||!c.hidden()}).data(b).left(function(c){return c.x}).top(function(c){return c.y}).strokeStyle("red").lineWidth(0.5).strokeDasharray("-")}},renderLinearAxis:function(){var a=this.scale,b=this.pvRule,c=this.anchorOpposite(),
d=this.anchorLength(),e=this.anchorOrtho(),h=this.anchorOrthoLength(),g=this._getRootScene(),j;if(this.compatVersion()<=1)j=function(l){return function(m){var n=Object.create(this);n.index=this.parent.index;return l.call(n,m.vars.tick.rawValue)}};g=(new pvc.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"})).lock("data",g.childNodes).lock(c,0).lockMark(e,function(l){return a(l.vars.tick.value)}).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",0).pvMark.zOrder(20);if(this.showTicks){var k=
this.pvTicks=(new pvc.visual.Rule(this,g,{extensionId:"ticks",wrapper:j})).lock("data").override("defaultColor",function(){return b.scene?b.scene[0].strokeStyle:"#666666"}).lock(c,0).lock(e,0).lock(d,null).optional(h,this.tickLength).pvMark;if(this.showMinorTicks){var f=this._layoutInfo.ticks,i=f.length;f=i>1?Math.abs(a(f[1])-a(f[0]))/2:0;this.pvMinorTicks=(new pvc.visual.Rule(this,this.pvTicks,{extensionId:"minorTicks",wrapper:j})).lock("data").intercept("visible",function(){return this.index<i-
1&&(!k.scene||k.scene[0].visible)&&this.delegateExtension(true)}).override("defaultColor",function(){return k.scene?k.scene[0].strokeStyle:pv.Color.names.d}).lock(c,0).lock(d,null).optional(h,this.tickLength/2).lockMark(e,f).pvMark}}this.renderLinearAxisLabel(g,j);this._debugTicksPanel(g)},renderLinearAxisLabel:function(a,b){var c=this.anchorOpposite(),d=this.anchorOrtho(),e=this.font,h=this._layoutInfo.maxTextWidth;isFinite(h)||(h=0);var g=this.pvLabel=(new pvc.visual.Label(this,a,{extensionId:"label",
wrapper:b})).lock("data").pvMark.lock(c,this.tickLength).lock(d,0).zOrder(40).text(function(k){k=k.vars.tick.label;if(h)k=pvc.text.trimToWidthB(h,k,e,"..",false);return k}).font(this.font).textStyle("#666666"),j=this.pvPanel.root;this.isAnchorTopOrBottom()?g.textBaseline(c).textAlign(function(k){if(this.index===0){k=g.toScreenTransform().transformHPosition(g.left());if(k<=0)return"left"}else if(this.index===k.parent.childNodes.length-1){k=g.toScreenTransform().transformHPosition(g.left());if(k>=j.width())return"right"}return"center"}):
g.textAlign(c).textBaseline(function(k){if(this.index===0){k=g.toScreenTransform().transformVPosition(g.top());if(k>=j.height())return"bottom"}else if(this.index===k.parent.childNodes.length-1){k=g.toScreenTransform().transformVPosition(g.top());if(k<=0)return"top"}return"middle"})},_onV1Click:function(a,b){this.isDiscrete&&this.useCompositeAxis&&b.call(a.pvMark,a.scene,a.event)},_onV1DoubleClick:function(a,b){this.isDiscrete&&this.useCompositeAxis&&b.call(a.pvMark,a.scene,a.event)},_getSelectableMarks:function(){if(this.isDiscrete&&
this.isVisible&&this.pvLabel)return this.base()},renderCompositeOrdinalAxis:function(){var a=this.isAnchorTopOrBottom(),b=a?"h":"v",c=2,d=2,e=this.font,h=pv.Text.fontHeight(e)/2,g=this._pvLayout=this.getLayoutSingleCluster();g.node.def("fitInfo",null).height(function(f){var i=pvc.text.getFitInfo(f.dx,f.dy,f.vars.tick.label,e,h);if(!i.h)if(b==="v"&&i.v)d=Math.min(c,f.depth);else c=Math.min(c,f.depth);this.fitInfo(i);return f.dy});g.node.add(pv.Bar).fillStyle("rgba(127,127,127,.001)").strokeStyle(function(f){if(f.maxDepth===
1||!f.maxDepth)return null;return"rgba(127,127,127,0.3)"}).lineWidth(function(f){if(f.maxDepth===1||!f.maxDepth)return 0;return 0.5}).text(function(f){return f.vars.tick.label});var j=a?"center":this.anchor=="left"?"right":"left",k;if(this.compatVersion()<=1)k=function(f){return function(i){return f.call(this,i)}};this.pvLabel=(new pvc.visual.Label(this,g.label,{extensionId:"label",noClick:false,noDoubleClick:false,noSelect:false,noTooltip:false,noHover:false,wrapper:k,tooltipArgs:{isLazy:false,buildTooltip:function(f){return f.scene.vars.tick.label},
options:{gravity:this._calcTipsyGravity(),offset:h*2}}})).pvMark.def("lblDirection","h").textAngle(function(f){if(f.depth>=d&&f.depth<c){this.lblDirection("v");return-Math.PI/2}if(f.depth>=c){f=Math.atan(f.dy/f.dx);if(f>1.27){this.lblDirection("v");return-Math.PI/2}if(f>0.3){this.lblDirection("d");return-f}}this.lblDirection("h");return 0}).textMargin(1).textAlign(function(f){return b!="v"||f.depth>=d||f.depth>=c?"center":j}).left(function(f){return b!="v"||f.depth>=d||f.depth>=c?f.x+f.dx/2:j=="right"?
f.x+f.dx:f.x}).font(e).textStyle("#666666").text(function(f){var i=this.fitInfo(),l=f.vars.tick.label;switch(this.lblDirection()){case "h":if(!i.h)return pvc.text.trimToWidthB(f.dx,l,e,"..");break;case "v":if(!i.v)return pvc.text.trimToWidthB(f.dy,l,e,"..");break;case "d":if(!i.d){f=Math.sqrt(def.sqr(f.dy)+def.sqr(f.dx));return pvc.text.trimToWidthB(f-h,l,e,"..")}break}return l})},getLayoutSingleCluster:function(){var a=this._getRootScene(),b=this.anchor,c=a.group.treeHeight,d=this._layoutInfo.axisSize;
c++;var e=d/c;e-=c>2?1/12*d:0;c=c/(c-1);var h=pvc.BasePanel.orthogonalLength[b];e=h=="width"?b==="left"?[-e,0]:[e,0]:b==="top"?[0,-e]:[0,e];this.pvRule.sign.override("defaultColor",def.fun.constant(null)).override("defaultStrokeWidth",def.fun.constant(0));d=this.pvRule.add(pv.Panel)[h](d).strokeStyle(null).lineWidth(0).add(pv.Panel)[h](d*c).strokeStyle(null).lineWidth(0);d.transform(pv.Transform.identity.translate(e[0],e[1]));return d.add(pv.Layout.Cluster.Fill).nodes(a.nodes()).orient(b)},_calcTipsyGravity:function(){switch(this.anchor){case "bottom":return"s";
case "top":return"n";case "left":return"w";case "right":return"e"}return"s"}});def.type("pvc.AxisTitlePanel",pvc.TitlePanelAbstract).init(function(a,b,c,d){this.axis=c;this.base(a,b,d);this._extensionPrefix=c.extensionPrefixes.map(function(e){return e+"Title"})}).add({_calcLayout:function(a){var b=this.axis.scale;if(!b||b.isNull)return new pvc.Size(0,0);return this.base(a)},_createCore:function(a){var b=this.axis.scale;if(!(!b||b.isNull))return this.base(a)}});
def.type("pvc.PieChartPanel",pvc.PlotPanel).init(function(a,b,c,d){var e=c.option("ValuesLabelStyle");this.base(a,b,c,d);this.explodedOffsetRadius=c.option("ExplodedSliceRadius");this.explodedSliceIndex=c.option("ExplodedSliceIndex");this.activeOffsetRadius=c.option("ActiveSliceRadius");this.labelStyle=e;if(e==="linked"){this.linkInsetRadius=c.option("LinkInsetRadius");this.linkOutsetRadius=c.option("LinkOutsetRadius");this.linkMargin=c.option("LinkMargin");this.linkHandleWidth=c.option("LinkHandleWidth");
this.linkLabelSize=c.option("LinkLabelSize");this.linkLabelSpacingMin=c.option("LinkLabelSpacingMin")}}).add({pvPie:null,pvPieLabel:null,valueRoleName:"value",_getV1Datum:function(a){var b=a.datum;if(b){b=Object.create(b);b.percent=a.vars.value.percent;b=b}return b},_calcLayout:function(a){function b(r){return def.between(pvc.PercentValue.resolve(r,h),0,h)}function c(r){return def.between(pvc.PercentValue.resolve(r,e),0,e)}var d=a.clientSize,e=d.width,h=Math.min(e,d.height)/2;if(!h)return new pvc.Size(0,
0);d=pv.vector(d.width/2,d.height/2);var g=this._getConstantExtension("label","font");if(!def.string.is(g))g=this.valuesFont;var j=h;if(this.valuesVisible&&this.labelStyle==="linked"){var k=b(this.linkInsetRadius),f=b(this.linkOutsetRadius),i=c(this.linkMargin),l=c(this.linkLabelSize),m=def.number.to(this._getConstantExtension("label","textMargin"),3),n=pv.Text.fontHeight(g),o=this.linkHandleWidth*n;i+=o;var p=this.linkLabelSpacingMin*n,q=Math.max(0,e/2-h);q=Math.max(0,f+i+l-q);q=Math.max(0,f+n,q);
if(q>=j){this.valuesVisible=false;pvc.debug>=2&&this._log("Hiding linked labels due to insufficient space.")}else{j-=q;a.link={insetRadius:k,outsetRadius:f,elbowRadius:j+f,linkMargin:i,handleWidth:o,labelSize:l,maxTextWidth:l-m,labelSpacingMin:p,textMargin:m,lineHeight:n}}}k=b(this.explodedOffsetRadius);f=0;if(this.chart.options.hoverable)f=b(this.activeOffsetRadius);j=j-(k+f);if(j<0)return new pvc.Size(0,0);a.center=d;a.clientRadius=h;a.normalRadius=j;a.explodedOffsetRadius=k;a.activeOffsetRadius=
f;a.labelFont=g},_createCore:function(a){var b=this,c=this.chart,d=this._buildScene(),e=a.center,h=a.normalRadius,g,j=["slice"];if(this.compatVersion()<=1){j.push("");g=function(i){return function(l){return i.call(this,l.vars.value.value)}}}this.pvPie=(new pvc.visual.PieSlice(this,this.pvPanel,{extensionId:j,center:e,activeOffsetRadius:a.activeOffsetRadius,wrapper:g,tooltipArgs:{options:{useCorners:true,gravity:function(){var i=Math.cos(this.midAngle())>=0,l=Math.sin(this.midAngle())>=0;return i?
l?"nw":"sw":l?"ne":"se"}}}})).lock("data",d.childNodes).override("angle",function(){return this.scene.vars.value.angle}).override("baseOffsetRadius",function(){var i=b.explodedSliceIndex;if(i==null||i==this.pvMark.index)return a.explodedOffsetRadius;return this.base()}).lock("outerRadius",function(){return c.animate(0,h)}).localProperty("innerRadiusEx",pvc.PercentValue.parse).intercept("innerRadius",function(){var i=this.delegateExtension();if(i==null){i=this.pvMark.innerRadiusEx();i=i!=null?pvc.PercentValue.resolve(i,
this.pvMark.outerRadius())||0:0}return i>0?c.animate(0,i):0}).pvMark;if(this.valuesVisible){this.valuesFont=a.labelFont;if(this.labelStyle==="inside")this.pvPieLabel=pvc.visual.ValueLabel.maybeCreate(this,this.pvPie,{wrapper:g,noHover:false}).intercept("visible",function(i){return i.vars.value.angle>=0.001&&this.delegateExtension(true)}).pvMark.text(function(i){return i.vars.value.sliceLabel}).textMargin(10);else if(this.labelStyle==="linked"){var k=a.link;d.layoutLinkLabels(a);this.pvLinkPanel=this.pvPanel.add(pv.Panel).data(d.childNodes).localProperty("pieSlice").pieSlice(function(){return b.pvPie.scene[this.index]});
this.pvLinkLine=(new pvc.visual.Line(this,this.pvLinkPanel,{extensionId:"linkLine",freePosition:true,noClick:true,noDoubleClick:true,noSelect:true,noTooltip:true,noHover:true,showsActivity:false})).lockMark("data",function(i){var l=this.parent.pieSlice(),m=l.startAngle+l.angle/2,n=l.outerRadius-k.insetRadius,o=l.left+n*Math.cos(m);l=l.top+n*Math.sin(m);m=i.childNodes[0];if(!m||!m._isFirstDynamicScene){m=new pvc.visual.PieLinkLineScene(i,o,l,0);m._isFirstDynamicScene=true}else{m.x=o;m.y=l}return i.childNodes}).override("defaultColor",
function(i){if(i==="stroke")return"black";return this.base(i)}).override("defaultStrokeWidth",def.fun.constant(0.5)).pvMark.lock("visible").lock("top",function(i){return i.y}).lock("left",function(i){return i.x});this.pvPieLabel=(new pvc.visual.Label(this,this.pvLinkPanel,{extensionId:"label",noClick:false,noDoubleClick:false,noSelect:false,noHover:false,showsInteraction:true})).lockMark("data",function(i){return i.lineScenes}).intercept("textStyle",function(){delete this._finished;var i=this.delegate();
if(i&&!this.hasOwnProperty("_finished")&&!this.mayShowActive()&&this.mayShowNotAmongSelected())i=this.dimColor(i,"text");return i}).pvMark.lock("visible").left(function(i){return i.vars.link.labelX}).top(function(i){return i.vars.link.labelY+(this.index+1)*k.lineHeight}).textAlign(function(i){return i.vars.link.labelAnchor}).textMargin(k.textMargin).textBaseline("bottom").text(function(i){return i.vars.link.labelLines[this.index]});if(pvc.debug>=20){this.pvPanel.add(pv.Panel).zOrder(-10).left(e.x-
a.clientRadius).top(e.y-a.clientRadius).width(a.clientRadius*2).height(a.clientRadius*2).strokeStyle("red");this.pvPanel.strokeStyle("green");var f=pv.Colors.category10();this.pvLinkLine.segmented(true).strokeStyle(function(){return f(this.index)})}}this.pvPieLabel.font(a.labelFont)}},_getExtensionId:function(){var a=[{abs:"content"}];this.chart.parent&&a.push({abs:"smallContent"});return a.concat(this.base())},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(){var a=new pvc.visual.PieRootScene(this);
this.sum=a.vars.sumAbs.value;return a}});
def.type("pvc.visual.PieRootScene",pvc.visual.Scene).init(function(a){function b(l,m){if(m){m=m._datums;if(m.length===1)return m[0].atoms[h].label}return g.format(l)}function c(){var l=this.vars.value;l.angle=this.parent.angleScale(l.value);var m=Math.abs(l.value)/f;l.percent=new pvc.visual.ValueLabelVar(m,j(m));l.sliceLabel=this.sliceLabel()}var d=a.visualRoles.category.flatten(a.data,pvc.data.visibleKeyArgs);this.base(null,{panel:a,group:d});var e=new pvc.visual.RoleVarHelper(this,a.visualRoles.color,
{roleVar:"color"}),h=a.visualRoles[a.valueRoleName].firstDimensionName(),g=d.dimensions(h),j=a.chart.options.percentValueFormat,k=this,f=0,i=def.type(pvc.visual.PieCategoryScene).init(function(l,m){this.base(k,{group:l});this.vars.category=pvc.visual.ValueLabelVar.fromComplex(l);f+=Math.abs(m);this.vars.value=new pvc.visual.ValueLabelVar(m,b(m,l));e.onNewScene(this,true)});a._extendSceneType("category",i,["sliceLabel","sliceLabelMask"]);d.children().each(function(l){var m=l.dimensions(h).sum(pvc.data.visibleKeyArgs);
m!==0&&new i(l,m)});this.angleScale=pv.Scale.linear(0,f).range(0,2*Math.PI).by1(Math.abs);this.vars.sumAbs=new pvc.visual.ValueLabelVar(f,b(f));this.childNodes.forEach(function(l){c.call(l)})}).add({layoutLinkLabels:function(a){var b=-Math.PI/2,c=[],d=[];this.childNodes.forEach(function(e){b=e.layoutI(a,b);(e.vars.link.dir>0?d:c).push(e)});this._distributeLabels(-1,c,a);this._distributeLabels(+1,d,a)},_distributeLabels:function(a,b,c){b.sort(function(d,e){return def.compare(d.vars.link.targetY,e.vars.link.targetY)});
this._distributeLabelsDownwards(b,c)&&this._distributeLabelsUpwards(b,c)&&this._distributeLabelsEvenly(b,c);b.forEach(function(d){d.layoutII(c)})},_distributeLabelsDownwards:function(a,b){var c=b.link.labelSpacingMin;b=b.clientSize.height;for(var d=false,e=0,h=a.length-1;e<h;e++){var g=a[e].vars.link;if(!e&&g.labelTop()<0)d=true;var j=a[e+1].vars.link,k=g.labelBottom()+c;if(j.labelTop()<k){g=j.labelHeight/2;k=k+g;g=b-g;if(k>g){d=true;j.targetY=g}else j.targetY=k}}return d},_distributeLabelsUpwards:function(a,
b){b=b.link.labelSpacingMin;for(var c=false,d=a.length-1;d>0;d--){var e=a[d-1].vars.link,h=a[d].vars.link;if(d===1&&e.labelTop()<0)c=true;var g=h.labelTop()-b;if(e.labelBottom()>g){h=e.labelHeight/2;g=g-h;if(g<h){c=true;e.targetY=h}else e.targetY=g}}return c},_distributeLabelsEvenly:function(a,b){var c=0;a.forEach(function(h){c+=h.vars.link.labelHeight});var d=b.clientSize.height-c;if(a.length>1)d/=a.length-1;var e=0;a.forEach(function(h){h=h.vars.link;var g=h.labelHeight/2;e+=g;h.targetY=e;e+=g+
d});return true}});def.type("pvc.visual.PieLinkLabelVar").add({labelTop:function(){return this.targetY-this.labelHeight/2},labelBottom:function(){return this.targetY+this.labelHeight/2}});
def.type("pvc.visual.PieCategoryScene",pvc.visual.Scene).add({sliceLabelMask:function(){return this.panel().valuesMask},sliceLabel:function(){return this.format(this.sliceLabelMask())},layoutI:function(a,b){var c=this.vars.value,d=b+c.angle,e=(b+d)/2;b=this.vars.link=new pvc.visual.PieLinkLabelVar;var h=a.link;c=pvc.text.justify(c.sliceLabel,h.maxTextWidth,a.labelFont);var g=c.length;b.labelLines=c;b.labelHeight=g*h.lineHeight;this.lineScenes=def.array.create(g,this);c=Math.cos(e);var j=Math.sin(e);
e=(g=c>=0)?1:-1;b.labelAnchor=g?"left":"right";a=a.center;g=h.elbowRadius;j=a.y+g*j;var k=a.x+e*g;h=k+e*h.linkMargin;new pvc.visual.PieLinkLineScene(this,a.x+g*c,j);new pvc.visual.PieLinkLineScene(this,k,j);b.elbowY=j;b.targetY=j+0;b.targetX=h;b.dir=e;return d},layoutII:function(a){var b=this.vars.link,c=b.targetY,d=b.targetX;a=a.link.handleWidth;a>0&&new pvc.visual.PieLinkLineScene(this,d-b.dir*a,c);new pvc.visual.PieLinkLineScene(this,d,c);b.labelX=d;b.labelY=c-b.labelHeight/2}});
def.type("pvc.visual.PieLinkLineScene",pvc.visual.Scene).init(function(a,b,c,d){this.base(a,{group:a.group,index:d});this.x=b;this.y=c}).add(pv.Vector);
def.type("pvc.PieChart",pvc.BaseChart).add({_animatable:true,pieChartPanel:null,_getColorRoleSpec:function(){return{isRequired:true,defaultSourceRole:"category",defaultDimension:"color*",requireIsDiscrete:true}},_initVisualRoles:function(){this.base();this._addVisualRole("category",{isRequired:true,defaultDimension:"category*",autoCreateDimension:true});this._addVisualRole("value",{isMeasure:true,isRequired:true,isPercent:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:"value"})},
_initPlotsCore:function(){new pvc.visual.PiePlot(this)},_preRenderContent:function(a){this.base();if(this.compatVersion()<=1){var b=pvc.castNumber(this.options.innerGap)||0.95;b=def.between(b,0.1,1);a.paddings=((1-b)*100/2).toFixed(2)+"%"}else if(a.paddings==null)a.paddings=new pvc.PercentValue(0.025);this.pieChartPanel=new pvc.PieChartPanel(this,this.basePanel,this.plots.pie,def.create(a,{scenes:def.getPath(this.options,"pie.scenes")}))}});
def.type("pvc.BarAbstractPanel",pvc.CategoricalAbstractPanel).add({pvBar:null,pvBarLabel:null,pvCategoryPanel:null,pvSecondLine:null,pvSecondDot:null,_creating:function(){var a=this.defaultVisibleBulletGroupScene();if(a&&!a.hasRenderer()){var b=a.colorAxis,c=b.option("LegendDrawLine");if(!c||b.option("LegendDrawMarker")){b={drawMarker:true,markerShape:b.option("LegendShape"),drawRule:c,markerPvProto:new pv.Mark};this.extend(b.markerPvProto,"",{constOnly:true});a.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(b))}}},
_createCore:function(){this.base();var a=this,b=a.chart,c=a.plot,d=!!a.stacked,e=a.isOrientationVertical(),h=a.visibleData(),g=a.visualRoles.series.flatten(h);h=a._buildScene(h,g);var j=a.axes.ortho,k=a.axes.base,f=j.scale,i=f(0),l=j.sceneScale({sceneVarName:"value",nullToZero:false});j=k.sceneScale({sceneVarName:"category"});f=c.option("BarSizeRatio");var m=c.option("BarSizeMax"),n=c.option("BarStackedMargin"),o=k.scale.range();k=o.band;o=o.step;var p=e===d;if(d)g=k;else{g=g.childCount();g=g>0?k*
f/g:0}if(g>m)g=m;a.barWidth=g;a.barStepWidth=o;var q;if(a.compatVersion()<=1)q=function(r){return function(v){var t=Object.create(this.parent),u=Object.create(this);u.parent=t;var w=v.parent.childIndex(),x=v.childIndex();if(d){t.index=w;u.index=x}else{t.index=x;u.index=w}return r.call(u,v.vars.value.rawValue)}};a.pvBarPanel=(new pvc.visual.Panel(a,a.pvPanel,{panelType:pv.Layout.Band,extensionId:"panel"})).lock("layers",h.childNodes).lockMark("values",function(r){return r.childNodes}).lockMark("orient",
e?"bottom-left":"left-bottom").lockMark("layout",d?"stacked":"grouped").lockMark("verticalMode",a._barVerticalMode()).lockMark("yZero",i).pvMark.band.x(j).w(k).differentialControl(a._barDifferentialControl()).item.order(p?"reverse":null).h(function(r){r=l(r);return r!=null?b.animate(0,r-i):null}).w(g).horizontalRatio(f).verticalMargin(n).end;this.pvBar=(new pvc.visual.Bar(a,a.pvBarPanel.item,{extensionId:"",freePosition:true,wrapper:q})).lockDimensions().pvMark.antialias(false);c.option("OverflowMarkersVisible")&&
this._addOverflowMarkers(q);if(c=pvc.visual.ValueLabel.maybeCreate(a,a.pvBar,{wrapper:q}))a.pvBarLabel=c.pvMark.visible(function(){return this.scene.target[this.index][e?"height":"width"]>=4})},_barVerticalMode:function(){return null},_barDifferentialControl:function(){return null},_getV1Datum:function(a){var b=a.datum;if(b){b=Object.create(b);b.percent=a.vars.value.percent;b=b}return b},_addOverflowMarkers:function(a){var b=this.axes.ortho;if(b.option("FixedMax")!=null)this.pvOverflowMarker=this._addOverflowMarker(false,
b.scale,a);if(b.option("FixedMin")!=null)this.pvUnderflowMarker=this._addOverflowMarker(true,b.scale,a)},_addOverflowMarker:function(a,b,c){var d=this.isOrientationVertical(),e=d?"bottom":"left",h=this.anchorOpposite(e),g=this.anchorOrthoLength(e),j=this.anchorLength(e),k=this._layoutInfo.paddings,f=a?b.min-k[e]:b.max+k[h];b=a?d?0:Math.PI/2:d?Math.PI:-Math.PI/2;return(new pvc.visual.Dot(this,this.pvBar.anchor("center"),{noSelect:true,noHover:true,noClick:true,noDoubleClick:true,noTooltip:true,freePosition:true,
extensionId:a?"underflowMarker":"overflowMarker",wrapper:c})).intercept("visible",function(i){var l=this.delegateExtension();if(l!==undefined&&!l)return false;i=i.vars.value.value;if(i==null)return false;l=this.pvMark.scene.target[this.index];i=l[e]+(i>0?l[g]:0);return a?i<f:i>f}).lock(h,null).lock("shapeSize").pvMark.shape("triangle").shapeRadius(function(){return Math.min(Math.sqrt(10),this.scene.target[this.index][j]/2)}).shapeAngle(b).lineWidth(1.5).strokeStyle("red").fillStyle("white")[e](function(){return f+
(a?1:-1)*(this.shapeRadius()+2)})},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(a,b){function c(k){var f=new pvc.visual.Scene(d,{group:k}),i=k.key;f.vars.series=pvc.visual.ValueLabelVar.fromComplex(k);j.onNewScene(f,false);e.forEach(function(l){var m=new pvc.visual.Scene(f,{group:a._childrenByKey[l.key]._childrenByKey[i]});(m.vars.category=pvc.visual.ValueLabelVar.fromComplex(l)).group=l;g.onNewScene(m,true);j.onNewScene(m,true)})}var d=new pvc.visual.Scene(null,{panel:this,
group:a}),e=a._children,h=this.visualRoles,g=new pvc.visual.RoleVarHelper(d,h.value,{roleVar:"value",hasPercentSubVar:this.stacked}),j=new pvc.visual.RoleVarHelper(d,h.color,{roleVar:"color"});b.children().each(c);return d}});
def.type("pvc.BarAbstract",pvc.CategoricalAbstract).init(function(a){this.base(a);if(a=this.parent)this._valueRole=a._valueRole}).add({_initVisualRoles:function(){this.base();this._addVisualRole("value",{isMeasure:true,isRequired:true,isPercent:this.options.stacked,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:"value"});this._valueRole=this.visualRoles("value")},_getCategoryRoleSpec:function(){var a=this.base();a.requireIsDiscrete=true;return a},_initData:function(){this.base.apply(this,
arguments);this._valueDim=this.data.dimensions(this._valueRole.firstDimensionName())}});def.type("pvc.BarPanel",pvc.BarAbstractPanel).add({});
def.type("pvc.BarChart",pvc.BarAbstract).add({_animatable:true,_allowV1SecondAxis:true,_initPlotsCore:function(){var a=this.options,b=(new pvc.visual.BarPlot(this)).option("Trend");if(a.plot2){a=new pvc.visual.PointPlot(this,{name:"plot2",fixed:{DataPart:"1"},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:true}});b||(b=a.option("Trend"))}b&&new pvc.visual.PointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",ColorRole:"series",NullInterpolatioMode:"none"},defaults:{ColorAxis:2,
LinesVisible:true,DotsVisible:false}})},_hasDataPartRole:function(){return true},_createPlotPanels:function(a,b){var c=this.plots,d=new pvc.BarPanel(this,a,c.bar,Object.create(b));this.barChartPanel=d;var e=c.plot2;if(e){pvc.debug>=3&&this._log("Creating Point panel.");e=new pvc.PointPanel(this,a,e,Object.create(b));d.pvSecondLine=e.pvLine;d.pvSecondDot=e.pvDot;e._applyV1BarSecondExtensions=true}if(c=c.trend){pvc.debug>=3&&this._log("Creating Trends Point panel.");new pvc.PointPanel(this,a,c,Object.create(b))}}});
def.type("pvc.NormalizedBarPanel",pvc.BarAbstractPanel).add({_barVerticalMode:function(){return"expand"}});
def.type("pvc.NormalizedBarChart",pvc.BarAbstract).add({_processOptionsCore:function(a){a.stacked=true;this.base(a)},_getContinuousVisibleExtentConstrained:function(a,b,c){if(a.type==="ortho")return{min:0,max:100,minLocked:true,maxLocked:true};return this.base(a,b,c)},_initPlotsCore:function(){new pvc.visual.NormalizedBarPlot(this)},_createPlotPanels:function(a,b){this.barChartPanel=new pvc.NormalizedBarPanel(this,a,this.plots.bar,Object.create(b))}});
def.type("pvc.visual.legend.WaterfallBulletGroupScene",pvc.visual.Scene).init(function(a,b){this.base(a,b);this.extensionPrefix=def.get(b,"extensionPrefix")||"";this.createItem({value:null,rawValue:null,label:def.get(b,"label")}).color=def.get(b,"color")}).add({hasRenderer:function(){return this._renderer},renderer:function(a){if(a!=null)this._renderer=a;return this._renderer},itemSceneType:function(){var a=this._itemSceneType;if(!a){a=def.type(pvc.visual.legend.BulletItemScene);this.panel()._extendSceneType("item",
a,["isOn","isClickable","click"]);this._itemSceneType=a}return a},createItem:function(a){return new (this.itemSceneType())(this,a)}});
def.type("pvc.WaterfallPanel",pvc.BarAbstractPanel).add({pvWaterfallLine:null,ruleData:null,_barDifferentialControl:function(){var a=this.chart._isFalling;return function(b){if(a&&!this.index)return 1;b=b.vars.category.group;if(b._isFlattenGroup&&!b._isDegenerateFlattenGroup)return-2;return a?-1:1}},_creating:function(){var a=this._getLegendBulletRootScene();if(a)if((a=a.firstChild)&&!a.hasRenderer()){var b={drawRule:true,drawMarker:false,noSelect:true,noHover:true,rulePvProto:new pv.Mark};this.extend(b.rulePvProto,
"line",{constOnly:true});a.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(b))}},_createCore:function(){this.base();var a=this.chart,b=this.isOrientationVertical(),c=b?"bottom":"left",d=this.anchorOrtho(c),e=this._buildRuleScene(),h=a.axes.ortho.scale,g=0.04*(h.range()[1]-h.range()[0]),j=h(0),k=a.axes.ortho.sceneScale({sceneVarName:"value"}),f=a.axes.base.sceneScale({sceneVarName:"category"}),i=a.axes.base.scale,l=this.barWidth/2,m=this.barWidth,n=this.barStepWidth,o=a._isFalling,p=a._waterColor;
if(this.plot.option("AreasVisible")){var q=pv.Colors.category10(),r=this._buildWaterGroupScene();this.pvWaterfallGroupPanel=(new pvc.visual.Panel(this,this.pvPanel,{extensionId:"group"})).lock("data",r.childNodes).pvMark.zOrder(-1).fillStyle(function(){return q(0).alpha(0.15)})[d](function(v){return i(v.vars.category.leftValue)-n/2})[this.anchorLength(c)](function(v){v=v.vars.category;return Math.abs(i(v.rightValue)-i(v.leftValue))+n})[c](function(v){return h(v.vars.value.bottomValue)-g/2})[this.anchorOrthoLength(c)](function(v){return h(v.vars.value.heightValue)+
g})}this.pvBar.sign.override("baseColor",function(v){var t=this.base(v);if(v==="fill")if(!this.scene.vars.category.group._isFlattenGroup)return pv.color(t).alpha(0.5);return t});this.pvWaterfallLine=(new pvc.visual.Rule(this,this.pvPanel,{extensionId:"line",noTooltip:false,noHover:false,noSelect:false,noClick:false,noDoubleClick:false})).lock("data",e.childNodes).optional("visible",function(){return o&&!!this.scene.previousSibling||!o&&!!this.scene.nextSibling}).optional(c,function(){return j+a.animate(0,
k(this.scene)-j)}).optional(this.anchorLength(c),n+m).optional(d,o?function(){return f(this.scene)-n-l}:function(){return f(this.scene)-l}).override("defaultColor",function(){return p}).pvMark.antialias(true).lineCap("butt");if(this.plot.option("TotalValuesVisible"))this.pvWaterfallLabel=(new pvc.visual.Label(this,this.pvWaterfallLine,{extensionId:"lineLabel"})).intercept("visible",function(v){if(v.vars.category.group._isFlattenGroup)return false;return o||!!v.nextSibling}).pvMark[c](function(v){return j+
a.animate(0,k(v)-j)})[this.anchorOrtho(c)](f).textAlign(b?"center":"left").textBaseline(function(v){if(!b)return"middle";v=v.vars.direction;if(v==null)return"bottom";return!o===(v==="up")?"bottom":"top"}).textStyle(pv.Color.names.darkgray.darker(2)).textMargin(5).text(function(v){return v.vars.value.label})},_buildRuleScene:function(){function a(d){var e=d.group,h=new pvc.visual.Scene(b,{group:e});(h.vars.category=pvc.visual.ValueLabelVar.fromComplex(e)).group=e;d=d.offset;h.vars.value=new pvc.visual.ValueLabelVar(d,
this.chart._valueDim.format(d));h.vars.direction=c==null||c===d?null:c<d?"up":"down";c=d}var b=new pvc.visual.Scene(null,{panel:this,group:this.visibleData()}),c;this.chart._ruleInfos&&this.chart._ruleInfos.forEach(a,this);return b},_buildWaterGroupScene:function(){function a(k,f){var i=k.children().where(function(r){return r.key!==""}).array();if(i.length){if(f){var l=new pvc.visual.Scene(j,{group:k}),m=l.vars.category=pvc.visual.ValueLabelVar.fromComplex(k);m.group=k;m.level=f;l=l.vars.value={};
var n=h[k.absKey],o=n.offset,p=n.range,q=-p.min+p.max;if(g){k=c(k);k=h[k.absKey];m.leftValue=n.group.value;m.rightValue=k.group.value}else{k=b(k);m.leftValue=h[k.absKey].group.value;m.rightValue=n.group.value}l.bottomValue=o-p.max;l.heightValue=q}i.forEach(function(r){a(r,f+1)})}}function b(k){var f=k._children&&k._children[0];return f?b(f):k}function c(k){var f=k._children&&k._children[k._children.length-1];return f?c(f):k}var d=this.chart,e=this.chart._ruleInfos,h=e&&def.query(e).object({name:function(k){return k.group.absKey},
value:function(k){return k}}),g=d._isFalling;d=d._catRole.select(d.partData(this.dataPartValue),{visible:true});var j=new pvc.visual.Scene(null,{panel:this,group:d});h&&a(d,0);return j}});
def.type("pvc.WaterfallChart",pvc.BarAbstract).init(function(a){this.base(a);if(a=this.parent)this._isFalling=a._isFalling}).add({_animatable:true,_isFalling:true,_ruleInfos:null,_waterColor:pv.color("#1f77b4").darker(),_processOptionsCore:function(a){a.stacked=true;a.baseAxisComposite=false;this.base(a);a.plot2=false},_initPlotsCore:function(){this._isFalling=(new pvc.visual.WaterfallPlot(this)).option("Direction")==="down";this._catRole.setFlatteningMode(this._isFalling?"tree-pre":"tree-post");
this._catRole.setFlattenRootLabel(this.plots.water.option("AllCategoryLabel"))},_initLegendScenes:function(a){var b=this.plots.water,c=this._getConstantExtension(pvc.makeExtensionAbsId("line",b.extensionPrefixes),"strokeStyle");if(c)this._waterColor=pv.color(c);c=a._getBulletRootScene();new pvc.visual.legend.WaterfallBulletGroupScene(c,{extensionPrefix:pvc.buildIndexedId("",1),label:b.option("TotalLineLabel"),color:this._waterColor});this.base(a)},_reduceStackedCategoryValueExtent:function(a,b,c){var d;
if(!a){if(b){d=b.min+b.max;this._ruleInfos=[{offset:d,group:c,range:b}];return{min:b.min,max:b.max,offset:d}}return null}d=a.offset;this._isFalling&&this._ruleInfos.push({offset:d,group:c,range:b});if(!c._isFlattenGroup||c._isDegenerateFlattenGroup){d=a.offset=d+(this._isFalling?-1:1)*(b.min+b.max);if(d>a.max)a.max=d;if(d<a.min)a.min=d}this._isFalling||this._ruleInfos.push({offset:d,group:c,range:b});return a},_createPlotPanels:function(a,b){this.wfChartPanel=new pvc.WaterfallPanel(this,a,this.plots.water,
def.create(b,{waterfall:this.options.waterfall}))}});
def.type("pvc.PointPanel",pvc.CategoricalAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d);this.linesVisible=c.option("LinesVisible");this.dotsVisible=c.option("DotsVisible");this.areasVisible=c.option("AreasVisible");if(!this.linesVisible&&!this.dotsVisible&&!this.areasVisible){this.linesVisible=true;c.option.specify({LinesVisible:true})}}).add({pvLine:null,pvArea:null,pvDot:null,pvLabel:null,pvScatterPanel:null,_creating:function(){var a=this.defaultVisibleBulletGroupScene();if(a&&!a.hasRenderer()){var b=
a.colorAxis,c=def.nullyTo(b.option("LegendDrawMarker",true),this.dotsVisible||this.areasVisible),d=!c||def.nullyTo(b.option("LegendDrawLine",true),this.linesVisible&&!this.areasVisible);if(c||d){var e={drawMarker:c,drawRule:d};if(c){b=b.option("LegendShape",true);if(this.dotsVisible){b||(b="circle");e.markerPvProto=(new pv.Dot).lineWidth(1.5,pvc.extensionTag).shapeSize(12,pvc.extensionTag)}else e.markerPvProto=new pv.Mark;e.markerShape=b;this._applyV1BarSecondExtensions&&this.chart.extend(e.markerPvProto,
"barSecondDot",{constOnly:true});this.extend(e.markerPvProto,"dot",{constOnly:true})}if(d){e.rulePvProto=(new pv.Line).lineWidth(1.5,pvc.extensionTag);this._applyV1BarSecondExtensions&&this.chart.extend(e.rulePvProto,"barSecondLine",{constOnly:true});this.extend(e.rulePvProto,"line",{constOnly:true})}a.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(e))}}},_createCore:function(){this.base();var a=this,b=this.chart,c=this.stacked,d=this.dotsVisible,e=this.areasVisible,h=this.linesVisible,
g=this.isOrientationVertical()?"bottom":"left";this.valueRole=b.visualRoles(this.plot.option("OrthoRole"));this.valueRoleName=this.valueRole.name;this.valueDimName=this.valueRole.firstDimensionName();var j=this.axes.base.role.grouping.isDiscrete(),k=this._buildScene(this.visibleData(),j);e?this.pvPanel.zOrder(-7):this.pvPanel.zOrder(1);this.pvScatterPanel=(new pvc.visual.Panel(this,this.pvPanel,{extensionId:"panel"})).lock("data",k.childNodes).pvMark;var f=e&&h&&!c?0.5:null,i;if(this.compatVersion()<=
1)i=c?function(q){return function(r){return q.call(this,r.vars.value.rawValue)}}:function(q){return function(r){var v={category:r.vars.category.rawValue,value:r.vars.value.rawValue},t=Object.create(this);t.index=r.dataIndex;return q.call(t,v)}};var l=j&&c?function(){return!this.scene.isNull||this.scene.isIntermediate}:function(){return!this.scene.isNull};k=b._canSelectWithFocusWindow();this.pvArea=(new pvc.visual.Area(this,this.pvScatterPanel,{extensionId:"area",noTooltip:false,wrapper:i,noSelect:k,
noRubberSelect:true,showsSelection:!k})).lock("visible",l).lock("data",function(q){return q.childNodes}).override("x",function(){return this.scene.basePosition}).override("y",function(){return this.scene.orthoPosition}).override("dy",function(){return b.animate(0,this.scene.orthoLength)}).override("color",function(q){return e?this.base(q):null}).override("baseColor",function(q){q=this.base(q);if(!this._finished&&q&&f!=null)q=q.alpha(f);return q}).override("dimColor",function(q,r){return c?pvc.toGrayScale(q,
1,null,null).brighter():this.base(q,r)}).lock("events",e?"painted":"none").pvMark;var m=d&&!h&&!e,n=c&&e,o=["line"];this._applyV1BarSecondExtensions&&o.push({abs:"barSecondLine"});l=!m&&l;m=e&&!h;this.pvLine=(new pvc.visual.Line(this,this.pvArea.anchor(this.anchorOpposite(g)),{extensionId:o,freePosition:true,wrapper:i,noTooltip:m,noDoubleClick:m,noClick:m,noHover:m,noSelect:m||k,showsSelection:!k})).lock("visible",l).override("defaultColor",function(q){q=this.base(q);if(!this._finished&&n&&q)q=q.darker(0.6);
return q}).override("normalColor",function(q){return h?q:null}).override("baseStrokeWidth",function(){var q;if(h)q=this.base();return q==null?1.5:q}).intercept("strokeDasharray",function(){var q=this.delegateExtension();if(q===undefined){q=this.scene;var r=q.isInterpolated;if(!r){r=(r=q.nextSibling)&&r.isIntermediate&&r.isInterpolated;if(!r)r=(r=q.previousSibling)&&q.isIntermediate&&r.isInterpolated}q=r?". ":null}return q}).pvMark;var p=!(e&&j&&c);o=["dot"];this._applyV1BarSecondExtensions&&o.push({abs:"barSecondDot"});
this.pvDot=(new pvc.visual.Dot(this,this.pvLine,{extensionId:o,freePosition:true,wrapper:i})).intercept("visible",function(){var q=this.scene;return!q.isNull&&!q.isIntermediate&&this.delegateExtension(true)}).override("color",function(q){if(!d)if(!(this.scene.isActive||!p&&this.scene.isSingle||p&&this.scene.isAlone))return pvc.invisibleFill;var r=this.base(q);if(this.scene.isInterpolated&&q==="fill")return r&&pv.color(r).brighter(0.5);return r}).override("defaultColor",function(q){q=this.base(q);
if(!this._finished&&n&&q)q=q.darker(0.6);return q}).override("baseSize",function(){if(!d)if((this.scene.isActive||!p&&this.scene.isSingle||p&&this.scene.isAlone)&&!this.scene.isActive){var q=Math.max(a.pvLine.lineWidth(),0.2)/2;return def.sqr(q)}if(this.scene.isInterpolated)return 0.8*this.base();return this.base()}).pvMark;if(g=pvc.visual.ValueLabel.maybeCreate(this,this.pvDot,{wrapper:i}))this.pvLabel=g.pvMark},renderInteractive:function(){this.pvScatterPanel.render()},_buildScene:function(a,b){function c(t){for(var u=
[],w=t.childNodes,x,s=0,y=null,D=0,F=0,M=w.length;D<M;D++,F++){var E=w[F],O=D*2;u[O]=E;d.call(this,x,E,v&&v[O]);if(E.isAlone&&!y)y=E;E.isNull||s++;if(x)if(x=e.call(this,t,x,E,F,v&&v[O-1])){u[O-1]=x;F++}x=E}if(s===1&&y&&M===1)y.isSingle=true;if(l)v=u}function d(t,u,w){var x=u.vars.value.accValue;if(w){if(u.isNull&&!b)x=o;else x+=w.vars.value.accValue;u.vars.value.accValue=x}u.basePosition=q(u);u.orthoPosition=p;u.orthoLength=n(x)-p;if(t=(!t||t.isNull)&&!u.isNull){t=u.nextSibling;t=!t||t.isNull}u.isAlone=
t;u.isSingle=false}function e(t,u,w,x,s){var y=u.isNull||w.isNull;if(y&&!this.areasVisible)return null;var D,F;if(y){if(s&&b){s=s.vars.value;D=s.accValue;s=s[this.valueRoleName]}else s=D=o;F=l&&b?w.basePosition-q.range().step/2:u.isNull?w.basePosition:u.basePosition}else{D=u.vars.value;F=w.vars.value;s=(F.value+D.value)/2;D=(F.accValue+D.accValue)/2;F=(w.basePosition+u.basePosition)/2}t=new pvc.visual.Scene(t,{index:x,group:w.group,datum:w.group?null:w.datum});t.dataIndex=w.dataIndex;t.vars.category=
w.vars.category;x=new pvc.visual.ValueLabelVar(s,i.format(s),s);x.accValue=D;t.vars.value=x;t.ownerScene=w;t.isInterpolated=w.isInterpolated;t.isIntermediate=true;t.isSingle=false;t.isNull=y;t.isAlone=y&&w.isNull&&u.isNull;t.basePosition=F;t.orthoPosition=p;t.orthoLength=n(D)-p;f.onNewScene(t,true);return t}function h(t){for(var u=t.childNodes,w=u.length,x,s;w&&(x=u[0]).isNull;){if((s=x.nextSibling)&&!s.isNull)break;t.removeAt(0);w--}for(;w&&(x=u[w-1]).isNull;){if((s=x.previousSibling)&&!s.isNull)break;
t.removeAt(w-1);w--}}var g=new pvc.visual.Scene(null,{panel:this,group:a}),j=a._children,k=this.visualRoles.series,f=new pvc.visual.RoleVarHelper(g,this.visualRoles.color,{roleVar:"color"}),i=a.owner.dimensions(this.valueDimName),l=this.stacked,m={visible:true,zeroIfNone:false},n=this.axes.ortho.scale,o=def.scope(function(){var t=n.domain(),u=t[0];t=t[1];if(u*t>=0)return u>=0?u:t;return 0}),p=n(o),q=this.axes.base.sceneScale({sceneVarName:"category"});def.scope(function(){return k&&k.grouping?k.flatten(a).children():
def.query([null])}).each(function(t){var u=new pvc.visual.Scene(g,{group:t||a});u.vars.series=pvc.visual.ValueLabelVar.fromComplex(t);f.onNewScene(u,false);j.forEach(function(w,x){var s=w;if(t)s=s._childrenByKey[t.key];var y=s?s.dimensions(i.name).sum(m):null,D=new pvc.visual.Scene(u,{group:s});D.dataIndex=x;D.vars.category=pvc.visual.ValueLabelVar.fromComplex(w);w=new pvc.visual.ValueLabelVar(y,i.format(y),y);w.accValue=y!=null?y:o;D.vars.value=w;f.onNewScene(D,true);w=false;if(s)if((s=s._datums[0])&&
s.isInterpolated)w=true;D.isInterpolated=w;D.isNull=y==null;D.isIntermediate=false},this)},this);var r=g.children().reverse().array(),v;r.forEach(c,this);r.forEach(h,this);return g}});
def.type("pvc.PointAbstract",pvc.CategoricalAbstract).add({_animatable:true,_processOptionsCore:function(a){a.panelSizeRatio=1;this.base(a)},_hasDataPartRole:function(){return true},_initVisualRoles:function(){this.base();this._addVisualRole("value",{isMeasure:true,isRequired:true,isPercent:this.options.stacked,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:"value"})},_initPlotsCore:function(){var a=this.options,b=this._createPointPlot().option("Trend");if(a.plot2){a=
new pvc.visual.PointPlot(this,{name:"plot2",fixed:{DataPart:"1"},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:true}});b||(b=a.option("Trend"))}b&&new pvc.visual.PointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",ColorRole:"series",NullInterpolatioMode:"none"},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:false}})},_bindAxes:function(a){this.base(a);(a=this.axesByType.base)&&a.forEach(function(b){b.scaleType==="discrete"||b.option.defaults({Offset:0.01})});(a=this.axesByType.ortho)&&
a.forEach(function(b){b.option.defaults({Offset:0.04})})},_createPlotPanels:function(a,b){var c=this.plots;this.scatterChartPanel=new pvc.PointPanel(this,a,c.point,Object.create(b));var d=c.plot2;if(d){pvc.debug>=3&&this._log("Creating second Point panel.");new pvc.PointPanel(this,a,d,Object.create(b))}if(c=c.trend){pvc.debug>=3&&this._log("Creating Trends Point panel.");new pvc.PointPanel(this,a,c,Object.create(b))}},defaults:{tooltipOffset:10}});
def.type("pvc.DotChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{DotsVisible:true}})}});def.type("pvc.LineChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{LinesVisible:true}})}});def.type("pvc.AreaChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{AreasVisible:true}})}});
pvc.mStackedLineChart=def.type("pvc.StackedLineChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{LinesVisible:true,Stacked:true}})}});def.type("pvc.StackedDotChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{DotsVisible:true,Stacked:true}})}});
pvc.mStackedAreaChart=def.type("pvc.StackedAreaChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{AreasVisible:true,Stacked:true},defaults:{LinesVisible:true}})}});
def.type("pvc.HeatGridPanel",pvc.CategoricalAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d);this.axes.size=a._getAxis("size",c.option("SizeAxis")-1);b=this.visualRoles;d=c.option("SizeRole");b.size=a.visualRoles(d);this.useShapes=c.option("UseShapes");this.shape=c.option("Shape");this.nullShape=c.option("NullShape")}).add({defaultBorder:1,nullBorder:2,selectedBorder:2,_createCore:function(){var a=this;a.base();var b=a._calcCellSize(),c=a.isOrientationVertical()?"bottom":"left",d=pvc.BasePanel.relativeAnchor[c],
e=pvc.BasePanel.parallelLength[c],h=pvc.BasePanel.orthogonalLength[c],g=a.data.flattenBy(a.visualRoles.series,{visible:true}),j=a._buildScene(a.visibleData(),g,b);g=j.isColorBound;var k=j.isSizeBound,f=a._buildSignsWrapper(j),i=a.compatVersion()<=1,l=this.axes.base.scale,m=this.axes.ortho.scale,n=l.range().step,o=m.range().step,p=n/2,q=o/2;c=(new pvc.visual.Panel(a,a.pvPanel)).pvMark.data(j.childNodes)[c](function(r){return m(r.vars.series.value)-q})[h](o);h=["panel"];i&&h.push("");h={extensionId:h,
wrapper:f};a.useShapes||def.copy(h,{noSelect:false,noHover:false,noClick:false,noDoubleClick:false,freeColor:false,noTooltip:i});a.pvHeatGrid=(new pvc.visual.Panel(a,c,h)).lock("data",function(r){return r.childNodes}).pvMark.lock(d,function(r){return l(r.vars.category.value)-p}).lock(e,n).antialias(false);a.shapes=a.useShapes?a._createShapesHeatMap(b,f,g,k):a._createNoShapesHeatMap(g);if(a.valuesVisible&&!a.valuesMask)a.valuesMask=a._getDefaultValuesMask(g,k);if(b=pvc.visual.ValueLabel.maybeCreate(a,
a.pvHeatGrid,{wrapper:f}))a.pvHeatGridLabel=b.pvMark},_calcCellSize:function(){var a=this.axes.x.scale,b=this.axes.y.scale;a=(a.max-a.min)/a.domain().length;b=(b.max-b.min)/b.domain().length;if(!this.isOrientationVertical()){var c=a;a=b;b=c}return{width:a,height:b}},_buildSignsWrapper:function(a){if(this.compatVersion()>1)return null;var b=def.query(a.childNodes).object({name:function(c){return""+c.vars.series.value},value:function(c){return def.query(c.childNodes).object({name:function(d){return""+
d.vars.category.value},value:function(d){return(d=d.vars.color)?""+d.value:null}})}});return function(c){return function(d){var e=b[d.vars.series.value],h=d.vars.category.rawValue,g=Object.create(this.parent),j=Object.create(this);j.parent=g;var k=d.childIndex();d=d.parent.childIndex();g.index=k;j.index=d;return c.call(j,e,h)}}},_getDefaultValuesMask:function(a,b){var c=this.visualRoles;if(a=a?"color":b?"size":null)return"{#"+c[a].firstDimensionName()+"}"},_createNoShapesHeatMap:function(a){var b=
this._buildGetBaseFillColor(a);return this.pvHeatGrid.sign.override("defaultColor",function(c){if(c==="stroke")return null;return b.call(this.pvMark,this.scene)}).override("interactiveColor",function(c,d){var e=this.scene;if(e.isActive)return c.alpha(0.6);if(e.anySelected()&&!e.isSelected())return this.dimColor(c,d);return this.base(c,d)}).override("dimColor",function(c){return pvc.toGrayScale(c,0.6)}).pvMark.lineWidth(1.5)},_buildGetBaseFillColor:function(a){var b=this.axes.color;if(a)return b.sceneScale({sceneVarName:this.visualRoles.color.name});
a=b&&b.option("Missing");return def.fun.constant(a||pvc.defaultColor)},_createShapesHeatMap:function(a,b,c,d){var e=this;a=e._calcDotAreaRange(a);d&&e.axes.size.setScaleRange(a);b={extensionId:"dot",freePosition:true,activeSeriesAware:false,wrapper:b,tooltipArgs:e._buildShapesTooltipArgs(c,d)};e=(new pvc.visual.DotSizeColor(e,e.pvHeatGrid,b)).override("dimColor",function(h){return pvc.toGrayScale(h,0.6)}).pvMark.lock("shapeAngle");d||e.sign.override("defaultSize",def.fun.constant(a.max));return e},
_calcDotAreaRange:function(a){a=Math.min(a.width,a.height)/2;if(this.shape==="diamond")a/=Math.SQRT2;a-=2;a=def.sqr(a);var b=12,c=a-b;if(c<=1){a=Math.max(a,2);b=1;c=a-b;pvc.debug>=2&&this._warn("Using rescue mode dot area calculation due to insufficient space.")}return{min:b,max:a,span:c}},_buildShapesTooltipArgs:function(a,b){var c=this.chart;if(this.compatVersion<=1&&c._tooltipEnabled){var d=c.options,e=d.customTooltip;e||(e=function(j,k,f){if(f!=null&&f[0]!==undefined)return f.join(", ");return f});
c=this.visualRoles;var h=c.series.grouping.dimensionNames(),g=c.category.grouping.dimensionNames();return{buildTooltip:d.isMultiValued?function(j){var k=j.scene.group,f=pvc.data.Complex.values(k,h);k=pvc.data.Complex.values(k,g);var i=[];j=j.scene.vars;if(b)i[d.sizeValIdx||0]=j.size.value;if(a)i[d.colorValIdx||0]=j.color.value;return e.call(d,f,k,i)}:function(j){j=j.scene.vars;var k=j[a?"color":"size"];return e.call(d,j.series.rawValue,j.category.rawValue,k?k.value:null)}}}},renderInteractive:function(){this.pvPanel.render()},
_buildScene:function(a,b,c){function d(l){var m=new pvc.visual.Scene(g,{group:l});m.vars.series=pvc.visual.ValueLabelVar.fromComplex(l);j.forEach(function(n){e.call(h,m,n,l)})}function e(l,m,n){l=new pvc.visual.Scene(l,{group:a._childrenByKey[m.key]._childrenByKey[n.key]});l.vars.category=pvc.visual.ValueLabelVar.fromComplex(m);f.onNewScene(l,true);i.onNewScene(l,true)}var h=this,g=new pvc.visual.Scene(null,{panel:h,group:a}),j=a._children,k=h.visualRoles,f=new pvc.visual.RoleVarHelper(g,k.color,
{roleVar:"color"}),i=new pvc.visual.RoleVarHelper(g,k.size,{roleVar:"size"});g.cellSize=c;b.children().each(d);return g}});
def.type("pvc.HeatGridChart",pvc.CategoricalAbstract).add({_allowColorPerCategory:true,_axisCreateIfUnbound:{color:true},_processOptionsCore:function(a){this.base(a);def.set(a,"orthoAxisOrdinal",true,"legend",false,"panelSizeRatio",1);a="value";var b="value2";if(this.compatVersion()<=1){switch(this.options.colorValIdx){case 0:a="value";break;case 1:a="value2";break;default:a="value"}switch(this.options.sizeValIdx){case 0:b="value";break;case 1:b="value2";break;default:b="value"}}this._colorDimName=
a;this._sizeDimName=b},_getCategoryRoleSpec:function(){var a=this.base();a.requireIsDiscrete=true;return a},_getColorRoleSpec:function(){return{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:this._colorDimName}},_initVisualRoles:function(){this.base();this._addVisualRole("size",{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:this._sizeDimName})},_initPlotsCore:function(){new pvc.visual.HeatGridPlot(this)},
_collectPlotAxesDataCells:function(a,b){this.base(a,b);if(a.type==="heatGrid"&&a.option("UseShapes")){var c=this.visualRoles(a.option("SizeRole"));if(c.isBound()){b=def.array.lazy(b,"size");def.array.lazy(b,a.option("SizeAxis")-1).push({plot:a,role:c,dataPartValue:a.option("DataPart")})}}},_setAxesScales:function(a){this.base(a);if(!a||this.parent)(a=this.axes.size)&&a.isBound()&&this._createAxisScale(a)},_createPlotPanels:function(a,b){this.heatGridChartPanel=new pvc.HeatGridPanel(this,a,this.plots.heatGrid,
Object.create(b))},defaults:{colorValIdx:0,sizeValIdx:1,measuresIndexes:[2],axisOffset:0,plotFrameVisible:false,colorNormByCategory:true,numSD:2}});
def.type("pvc.MetricXYAbstract",pvc.CartesianAbstract).add({_processOptionsCore:function(a){this.base(a);a.panelSizeRatio=1},_initVisualRoles:function(){this.base();this._addVisualRole("x",{isMeasure:true,isRequired:true,requireSingleDimension:true,requireIsDiscrete:false,defaultDimension:"x",dimensionDefaults:{valueType:this.options.timeSeries?Date:Number}});this._addVisualRole("y",{isMeasure:true,isRequired:true,requireSingleDimension:true,requireIsDiscrete:false,defaultDimension:"y",dimensionDefaults:{valueType:Number}})},
_generateTrendsDataCellCore:function(a,b,c){function d(m){var n=function(t){return t.atoms[f].value},o=function(t){return t.atoms[i].value},p=m.datums().sort(null,n).array(),q=def.create(j,{rows:def.query(p),x:n,y:o}),r=c.model(q);if(r){var v=l.owner.dimensions(k).intern(this.root._firstTrendAtomProto);p.forEach(function(t,u){var w=n(t);if(w){t=r.sample(w,o(t),u);if(t!=null){w=def.set(Object.create(m.atoms),f,w,i,t,k,v);a.push(def.set(new pvc.data.Datum(l.owner,w),"isVirtual",true,"isTrend",true,
"trendType",c.type))}}})}}var e=this._serRole,h=this.visualRoles("x"),g=b.role,j=b.trend;this._warnSingleContinuousValueRole(g);var k=this._dataPartRole.firstDimensionName(),f=h.firstDimensionName(),i=g.firstDimensionName(),l=this.visibleData(b.dataPartValue);def.scope(function(){return e.isBound()?l.children():def.query([l])}).each(d,this)}});
def.type("pvc.data.MetricPointChartTranslationOper").add({_meaLayoutRoles:["x","y","color","size"],configureType:function(){var a=this._itemTypes,b=[],c=[];def.range(0,a.length).each(function(j){this._userUsedIndexes[j]||(a[j]===1?b.push(j):c.push(j))},this);var d,e=[];d=b.length;if(d>0){for(var h=this._meaLayoutRoles.length,g=0;g<h&&e.length<d;){this._getUnboundRoleDefaultDimNames(this._meaLayoutRoles[g],1,e);g++}d=e.length;if(d>0){b.length=d;this.defReader({names:e,indexes:b})}}d=c.length;if(d>
0){e.length=0;this._getUnboundRoleDefaultDimNames("series",d,e);d=e.length;if(d>0){c.length=d;this.defReader({names:e,indexes:c})}}}});
def.type("pvc.MetricPointPanel",pvc.CartesianAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d);this.axes.size=a._getAxis("size",(c.option("SizeAxis")||0)-1);b=c.option("SizeRole");this.visualRoles.size=b?a.visualRoles(b):null;this.linesVisible=c.option("LinesVisible");this.dotsVisible=c.option("DotsVisible");if(!this.linesVisible&&!this.dotsVisible){this.linesVisible=true;c.option.specify({LinesVisible:true})}if(!this.offsetPaddings)this.offsetPaddings=new pvc.Sides(0.01)}).add({sizeAxisRatio:0.2,
sizeAxisRatioTo:"minWidthHeight",autoPaddingByDotSize:true,_v1DimRoleName:{category:"x",value:"y"},_creating:function(){var a=this.defaultVisibleBulletGroupScene();if(a&&!a.hasRenderer()){var b=a.colorAxis,c=def.nullyTo(b.option("LegendDrawMarker",true),this.dotsVisible),d=def.nullyTo(b.option("LegendDrawLine",true),this.linesVisible);if(c||d){var e={drawMarker:c,drawRule:d};if(c){e.markerShape=b.option("LegendShape",true)||"circle";e.markerPvProto=(new pv.Dot).lineWidth(1.5,pvc.extensionTag).shapeSize(12,
pvc.extensionTag);this.extend(e.markerPvProto,"dot",{constOnly:true})}if(d){e.rulePvProto=(new pv.Line).lineWidth(1.5,pvc.extensionTag);this.extend(e.rulePvProto,"line",{constOnly:true})}a.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(e))}}},_getRootScene:function(){return def.lazy(this,"_rootScene",this._buildScene,this)},_calcLayout:function(a){var b=this._getRootScene();b.isSizeBound&&this.axes.size.setScaleRange(this._calcDotAreaRange(a));this._calcAxesPadding(a,b)},_getDotDiameterRefLength:function(a){var b=
a.clientSize,c=a.paddings;switch(this.sizeAxisRatioTo){case "minWidthHeight":return Math.min(b.width+c.width,b.height+c.height);case "width":return b.width+c.width;case "height":return b.height+c.height}pvc.debug>=2&&this._log(def.format("Invalid option 'sizeAxisRatioTo' value. Assuming 'minWidthHeight'.",[this.sizeAxisRatioTo]));this.sizeRatioTo="minWidthHeight";return this._getDotDiameterRefLength(a)},_calcDotRadiusRange:function(a){a=this.sizeAxisRatio/2*this._getDotDiameterRefLength(a);return{min:Math.sqrt(12),
max:a}},_calcDotAreaRange:function(a){var b=this._calcDotRadiusRange(a);if(this.shape==="diamond"){b.max/=Math.SQRT2;b.min/=Math.SQRT2}a=def.sqr(b.max);b=def.sqr(b.min);var c=a-b;if(c<=1){a=Math.max(a,2);b=1;c=a-b;pvc.debug>=3&&this._log("Using rescue mode dot area calculation due to insufficient space.")}return{min:b,max:a,span:c}},_calcAxesPadding:function(a,b){var c;if(this.autoPaddingByDotSize){var d=this.axes,e=a.clientSize,h=a.paddings;c={};d.x.setScaleRange(e.width);d.y.setScaleRange(e.height);
var g=d.base.sceneScale({sceneVarName:"x"}),j=d.ortho.sceneScale({sceneVarName:"y"}),k=d.base.scale.max,f=d.ortho.scale.max,i=b.isSizeBound,l=i?this.axes.size.scale:null;if(!l){d=def.number.as(this._getExtension("dot","shapeRadius"),0);if(d<=0){d=def.number.as(this._getExtension("dot","shapeSize"),0);if(d<=0)d=12}else d=def.sqr(d);l=def.fun.constant(d)}c={};var m;if(this.offsetPaddings){m={};pvc.Sides.names.forEach(function(o){var p=pvc.BasePanel.orthogonalLength[o];m[o]=(this.offsetPaddings[o]||
0)*(e[p]+h[p])},this)}var n=function(o,p){if(m)p+=m[o]||0;if(p<0)p=0;var q=c[o];if(q==null||p>q)c[o]=p};b.children().selectMany(function(o){return o.childNodes}).each(function(o){var p=g(o),q=j(o);o=Math.sqrt(l(i?o.vars.size.value:0));n("left",o-p);n("bottom",o-q);n("right",p+o-k);n("top",q+o-f)})}else c=this._calcRequestPaddings(a);a.requestPaddings=c},_createCore:function(){var a=this;a.base();var b=a.chart,c=a._getRootScene(),d=a._buildSignsWrapper(),e=a.compatVersion()<=1;this._finalizeScene(c);
a.pvPanel.zOrder(1);this.pvScatterPanel=(new pvc.visual.Panel(a,a.pvPanel,{extensionId:"panel"})).lock("data",c.childNodes).pvMark;b=b._canSelectWithFocusWindow();var h=c.isColorBound&&this.visualRoles.color.isDiscrete();b=(new pvc.visual.Line(a,a.pvScatterPanel,{extensionId:"line",wrapper:d,noTooltip:false,noSelect:b,showsSelection:!b})).lock("data",function(g){return g.childNodes}).intercept("visible",function(g){if(!a.linesVisible)return false;var j=this.delegateExtension();if(j==null)j=!g.isNull&&
(!c.isSizeBound&&!c.isColorBound||c.isSizeBound&&g.vars.size.value!=null||c.isColorBound&&(h||g.vars.color.value!=null));return j}).override("x",function(){return this.scene.basePosition}).override("y",function(){return this.scene.orthoPosition});a.pvLine=b.pvMark;b=(new pvc.visual.DotSizeColor(a,a.pvLine,{extensionId:"dot",wrapper:d,activeSeriesAware:a.linesVisible})).override("x",function(){return this.scene.basePosition}).override("y",function(){return this.scene.orthoPosition}).override("color",
function(g){if(!a.dotsVisible&&!this.scene.isActive&&!this.scene.isSingle)return pvc.invisibleFill;return this.base(g)});if(c.isSizeBound)a.autoPaddingByDotSize&&a.sizeAxisRatioTo==="minWidthHeight"||a.pvPanel.borderPanel.overflow("hidden");else b.override("baseSize",function(){if(!a.dotsVisible)if(this.scene.isSingle){var g=Math.max(a.pvLine.scene[this.pvMark.index].lineWidth,0.2)/2;return def.sqr(g)}return this.base()});a.pvDot=b.pvMark;a.pvDot.rubberBandSelectionMode="center";if(pvc.visual.ValueLabel.isNeeded(a)){b=
["label"];e&&b.push("lineLabel");if(d=pvc.visual.ValueLabel.maybeCreate(a,a.pvDot,{extensionId:b,wrapper:d}))a.pvHeatGridLabel=d.pvMark}},_buildSignsWrapper:function(){if(this.compatVersion()>1)return null;return function(a){return function(b){var c={category:b.vars.x.rawValue,value:b.vars.y.rawValue},d=Object.create(this);d.index=b.dataIndex;return a.call(d,c)}}},renderInteractive:function(){this.pvScatterPanel.render()},_buildScene:function(){function a(i){var l=new pvc.visual.Scene(e,{group:i});
l.vars.series=pvc.visual.ValueLabelVar.fromComplex(i);g.onNewScene(l,false);i.datums().each(function(m,n){var o=m.atoms[k.name];if(o.value!=null){var p=m.atoms[f.name];if(p.value!=null){m=new pvc.visual.Scene(l,{datum:m});m.dataIndex=n;m.vars.x=pvc.visual.ValueLabelVar.fromAtom(o);m.vars.y=pvc.visual.ValueLabelVar.fromAtom(p);j.onNewScene(m,true);g.onNewScene(m,true);m.isIntermediate=false}}})}function b(i){for(var l=i.childNodes,m,n=0,o=0,p=l.length;n<p;n++,o++){var q=l[o];q.isSingle=!m&&!q.nextSibling;
m&&c(i,m,q,o)&&o++;m=q}}function c(i,l,m,n){var o=f.type.cast.call(null,(+m.vars.y.value+ +l.vars.y.value)/2);l=k.type.cast.call(null,(+m.vars.x.value+ +l.vars.x.value)/2);i=new pvc.visual.Scene(i,{index:n,datum:m.datum});i.dataIndex=m.dataIndex;i.vars.x=new pvc.visual.ValueLabelVar(l,k.format(l),l);i.vars.y=new pvc.visual.ValueLabelVar(o,f.format(o),o);j.onNewScene(i,true);g.onNewScene(i,true);i.ownerScene=m;i.isIntermediate=true;i.isSingle=false;return i}var d=this.visibleData(),e=new pvc.visual.Scene(null,
{panel:this,group:d}),h=this.visualRoles,g=new pvc.visual.RoleVarHelper(e,h.color,{roleVar:"color"}),j=new pvc.visual.RoleVarHelper(e,h.size,{roleVar:"size"}),k=d.owner.dimensions(h.x.firstDimensionName()),f=d.owner.dimensions(h.y.firstDimensionName());d.children().each(a,this);e.children().each(b,this);return e},_finalizeScene:function(a){var b=this.axes,c=b.base.sceneScale({sceneVarName:"x"}),d=b.ortho.sceneScale({sceneVarName:"y"});a.children().selectMany(function(e){return e.childNodes}).each(function(e){e.basePosition=
c(e);e.orthoPosition=d(e)});return a}});
def.type("pvc.MetricPointAbstract",pvc.MetricXYAbstract).add({_initPlotsCore:function(){this._createPointPlot().option("Trend")&&new pvc.visual.MetricPointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",NullInterpolatioMode:"none",ColorRole:"series",SizeRole:null,SizeAxis:null,OrthoAxis:1},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:false}})},_hasDataPartRole:function(){return true},_getColorRoleSpec:function(){return{defaultSourceRole:"series",defaultDimension:"color*",dimensionDefaults:{valueType:Number}}},
_initVisualRoles:function(){this.base();this._addVisualRole("size",{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,defaultDimension:"size",dimensionDefaults:{valueType:Number}})},_getTranslationClass:function(a){return def.type(this.base(a)).add(pvc.data.MetricPointChartTranslationOper)},_collectPlotAxesDataCells:function(a,b){this.base(a,b);if(a.type==="scatter"&&a.option("DotsVisible")){var c=a.option("SizeRole");if(c){c=this.visualRoles(c);if(c.isBound()){b=def.array.lazy(b,
"size");def.array.lazy(b,a.option("SizeAxis")-1).push({plot:a,role:c,dataPartValue:a.option("DataPart")})}}}},_setAxesScales:function(a){this.base(a);if(!a||this.parent)(a=this.axes.size)&&a.isBound()&&this._createAxisScale(a)},_createPlotPanels:function(a,b){var c=this.options;b=def.set(Object.create(b),"sizeAxisRatio",c.sizeAxisRatio,"sizeAxisRatioTo",c.sizeAxisRatioTo,"autoPaddingByDotSize",c.autoPaddingByDotSize);this.scatterChartPanel=new pvc.MetricPointPanel(this,a,this.plots.scatter,b);(c=
this.plots.trend)&&new pvc.MetricPointPanel(this,a,c,Object.create(b))},defaults:{axisOriginIsZero:false,tooltipOffset:10}});def.type("pvc.MetricDotChart",pvc.MetricPointAbstract).add({_createPointPlot:function(){return new pvc.visual.MetricPointPlot(this,{fixed:{DotsVisible:true}})}});def.type("pvc.MetricLineChart",pvc.MetricPointAbstract).add({_createPointPlot:function(){return new pvc.visual.MetricPointPlot(this,{fixed:{LinesVisible:true}})}});
def.type("pvc.BulletChart",pvc.BaseChart).init(function(a){a=a||{};var b=a.dimensionGroups||(a.dimensionGroups={}),c=b.range||(b.range={});if(c.valueType===undefined)c.valueType=Number;b=b.marker||(b.marker={});if(b.valueType===undefined)b.valueType=Number;this.base(a)}).add({bulletChartPanel:null,allowNoData:true,_processOptionsCore:function(a){this.base(a);a.legend=false;a.selectable=false},_initVisualRoles:function(){this.base();this._addVisualRole("title",{defaultDimension:"title*"});this._addVisualRole("subTitle",
{defaultDimension:"subTitle*"});this._addVisualRole("value",{isMeasure:true,requireIsDiscrete:false,valueType:Number,defaultDimension:"value*"});this._addVisualRole("marker",{isMeasure:true,requireIsDiscrete:false,valueType:Number,defaultDimension:"marker*"});this._addVisualRole("range",{isMeasure:true,requireIsDiscrete:false,valueType:Number,defaultDimension:"range*"})},_createTranslation:function(a){a=this.base(a);var b=a.virtualItemSize();if(b)switch(b){case 1:a.defReader({names:"value"});break;
case 2:a.defReader({names:["title","value"]});break;case 3:a.defReader({names:["title","value","marker"]});break;default:a.defReader({names:["title","subTitle","value","marker"]});b>4&&a.defReader({names:"range",indexes:pv.range(4,b)});break}return a},_initPlotsCore:function(){new pvc.visual.BulletPlot(this)},_preRenderContent:function(a){this.bulletChartPanel=new pvc.BulletChartPanel(this,this.basePanel,this.plots.bullet,def.create(a,{tooltipEnabled:this._tooltipEnabled}))},defaults:{compatVersion:1,
orientation:"horizontal",bulletSize:30,bulletSpacing:50,bulletMargin:100,bulletTitle:"Title",bulletSubtitle:"",bulletTitlePosition:"left",tooltipFormat:function(a,b,c){return this.chart.options.valueFormat(c)},crosstabMode:false,seriesInRows:false}});
def.type("pvc.BulletChartPanel",pvc.PlotPanel).add({pvBullets:null,pvBullet:null,data:null,onSelectionChange:null,_createCore:function(a){var b=this.chart,c=b.options,d=this.buildData(),e=c.orientation=="horizontal"?"left":"bottom",h,g,j,k,f,i,l,m;if(c.orientation=="horizontal"){a=a.clientSize.width-this.chart.options.bulletMargin-20;h=0;switch(c.bulletTitlePosition){case "top":i=this.chart.options.bulletMargin;j=0;g="left";k=-12;m=parseInt(c.titleSize/2,10);break;case "bottom":i=this.chart.options.bulletMargin;
j=0;g="left";k=c.bulletSize+32;m=0;break;case "right":i=5;j=a+5;g="left";k=parseInt(c.bulletSize/2,10);m=0;break;case "left":default:i=this.chart.options.bulletMargin;j=0;k=parseInt(c.bulletSize/2,10);g="right";m=0}f="bottom";l=function(){return this.index*(c.bulletSize+c.bulletSpacing)+m}}else{a=a.clientSize.height-this.chart.options.bulletMargin-20;switch(c.bulletTitlePosition){case "top":i=this.chart.options.bulletMargin;j=0;g="left";k=-20;h=0;l=undefined;break;case "bottom":i=this.chart.options.bulletMargin;
j=0;g="left";k=a+20;h=0;l=20;break;case "right":i=5;j=this.chart.options.bulletSize+40;g="left";k=a;h=-Math.PI/2;l=undefined;break;case "left":default:i=this.chart.options.bulletMargin;j=-12;k=this.height-this.chart.options.bulletMargin-20;g="left";h=-Math.PI/2;l=undefined}f="right";i=function(){return c.bulletMargin+this.index*(c.bulletSize+c.bulletSpacing)}}this.pvBullets=this.pvPanel.add(pv.Panel).data(d)[pvc.BasePanel.orthogonalLength[e]](a)[pvc.BasePanel.parallelLength[e]](this.chart.options.bulletSize).margin(20).left(i).top(l);
this.pvBullet=this.pvBullets.add(pv.Layout.Bullet).orient(e).ranges(function(q){return q.ranges}).measures(function(q){return q.measures}).markers(function(q){return q.markers});if(c.clickable&&this.clickAction){var n=this;this.pvBullet.cursor("pointer").event("click",function(q){return n.clickAction(q.title,q.subtitle,q.measures,pv.event)})}this.pvBulletRange=this.pvBullet.range.add(pv.Bar);this.pvBulletMeasure=this.pvBullet.measure.add(pv.Bar).text(function(q,r){return r.formattedMeasures[this.index]});
this.pvBulletMarker=this.pvBullet.marker.add(pv.Dot).shape("square").fillStyle("white").text(function(q,r){return r.formattedMarkers[this.index]});if(this.tooltipEnabled){var o=this;this.pvBulletMeasure.localProperty("tooltip").tooltip(function(q,r){return b.options.tooltipFormat.call(o,r.title,r.subtitle,q)});this.pvBulletMarker.localProperty("tooltip").tooltip(function(q,r){return b.options.tooltipFormat.call(o,r.title,r.subtitle,q)});this.pvBulletMeasure.event("mouseover",pv.Behavior.tipsy(this.chart._tooltipOptions));
this.pvBulletMarker.event("mouseover",pv.Behavior.tipsy(this.chart._tooltipOptions))}this.pvBulletRule=this.pvBullet.tick.add(pv.Rule);this.pvBulletRuleLabel=this.pvBulletRule.anchor(f).add(pv.Label).text(this.pvBullet.x.tickFormat);this.pvBulletTitle=this.pvBullet.anchor(e).add(pv.Label).font("bold 12px sans-serif").textAngle(h).left(-10).textAlign(g).textBaseline("bottom").left(j).top(k).text(function(q){return q.formattedTitle});this.pvBulletSubtitle=this.pvBullet.anchor(e).add(pv.Label).textStyle("#666").textAngle(h).textAlign(g).textBaseline("top").left(j).top(k).text(function(q){return q.formattedSubtitle});
var p=typeof c.axisDoubleClickAction=="function"?function(q,r){c.axisDoubleClickAction(q,r)}:null;if(c.clickable&&p){this.pvBulletTitle.cursor("pointer").events("all").event("dblclick",function(q){p(q,arguments[arguments.length-1])});this.pvBulletSubtitle.cursor("pointer").events("all").event("dblclick",function(q){p(q,arguments[arguments.length-1])})}},applyExtensions:function(){this.base();this.extend(this.pvBullets,"bulletsPanel");this.extend(this.pvBullet,"bulletPanel");this.extend(this.pvBulletRange,
"bulletRange");this.extend(this.pvBulletMeasure,"bulletMeasure");this.extend(this.pvBulletMarker,"bulletMarker");this.extend(this.pvBulletRule,"bulletRule");this.extend(this.pvBulletRuleLabel,"bulletRuleLabel");this.extend(this.pvBulletTitle,"bulletTitle");this.extend(this.pvBulletSubtitle,"bulletSubtitle")},_getExtensionId:function(){return[{abs:"content"}].concat(this.base())},buildData:function(){var a=this.chart,b=a.options,c=a.visualRoles("title").grouping,d=a.visualRoles("subTitle").grouping,
e=a.visualRoles("value").grouping,h=a.visualRoles("marker").grouping,g=a.visualRoles("range").grouping,j={title:b.bulletTitle,formattedTitle:b.bulletTitle,subtitle:b.bulletSubtitle,formattedSubtitle:b.bulletSubtitle,ranges:def.array.to(b.bulletRanges)||[],measures:def.array.to(b.bulletMeasures)||[],markers:def.array.to(b.bulletMarkers)||[]};def.set(j,"formattedRanges",j.ranges.map(String),"formattedMeasures",j.measures.map(String),"formattedMarkers",j.markers.map(String));return!e&&!c&&!h&&!d&&!g?
[j]:a.data.datums().select(function(k){var f=Object.create(j),i;if(e){i=e.view(k);f.measures=i.values();f.formattedMeasures=i.labels()}if(c){i=c.view(k);f.title=i.value;f.formattedTitle=i.label}if(d){i=d.view(k);f.subtitle=i.value;f.formattedSubtitle=i.label}if(h){i=h.view(k);f.markers=i.values();f.formattedMarkers=i.labels()}if(g){i=g.view(k);f.ranges=i.values();f.formattedRanges=i.labels()}return f},this).array()}});
def.type("pvc.ParallelCoordinates",pvc.BaseChart).init(function(a){a=a||{};a.dimensions=a.dimensions||{};if(!a.dimensions.value)a.dimensions.value={valueType:null};this.base(a)}).add({parCoordPanel:null,_preRenderContent:function(a){this.parCoordPanel=new pvc.ParCoordPanel(this,this.basePanel,def.create(a,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,sortCategorical:this.options.sortCategorical,
mapAllDimensions:this.options.mapAllDimensions,numDigits:this.options.numDigits}))},defaults:def.create(pvc.BaseChart.prototype.defaults,{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,sortCategorical:true,mapAllDimensions:true,numDigits:0})});
def.type("pvc.ParCoordPanel",pvc.BasePanel).add({anchor:"fill",pvParCoord:null,dimensions:null,dimensionDescr:null,data:null,retrieveData:function(){var a=this.chart.data,b=this.chart.options.numDigits;this.dimensions=a.getVisibleCategories();var c=a.getValues(),d=a.getVisibleSeriesIndexes(),e=a.getVisibleCategoriesIndexes(),h=a.getCategories(),g=this.chart.options.mapAllDimensions?e.map(function(t){return isNaN(c[t][0])?{categorical:true,len:0,map:[]}:{categorical:false,len:0,map:[],displayValue:[]}}):
e.map(function(t){return isNaN(c[t][0])?{categorical:true,len:0,map:[]}:null}),j=function(t,u){t=g[t];var w=null;if(t.categorical){w=t.map[u];if(w==null){w=t.len;t.len++;t.map[u]=w}}else{var x=u.toFixed(b);w=t.map[x];if(w==null){w=t.len;t.len++;t.map[x]=w;t.displayValue[x]=u}}return w};for(var k in g)if(g.hasOwnProperty(k)&&g[k]&&g[k].categorical)g[k].displayValue=g[k].map;var f;if(this.chart.options.sortCategorical||this.chart.options.mapAllDimensions)for(a=0;a<g.length;a++)if(g[a]){for(k=0;k<c[a].length;k++)j(a,
c[a][k]);var i=g[a].map,l=[];for(f in i)i.hasOwnProperty(f)&&l.push(f);l.sort();if(g[a].categorical)for(k=0;k<l.length;k++)i[l[k]]=k;else for(k=0;k<l.length;k++)i[l[k]].index=k}var m=function(t){var u={};for(var w in e)if(e.hasOwnProperty(w))u[h[w]]=g[w]?j(w,c[w][t]):c[w][t];return u};this.data=d.map(function(t){return m(t)});d=this.dimensions.map(function(t){var u={},w=t.split("__");u.id=t;u.name=w[0];u.unit=w.length>1?w[1]:"";return u});for(a=0;a<d.length;a++){f=d[a];i=e[a];f.orgRowIndex=i;var n=
c[i].length,o,p,q,r;if(g[i]){l=o=p=q=g[i].displayValue[c[i][0]];for(k=1;k<n;k++){r=g[i].displayValue[c[i][k]];if(r<l){p=l;l=r}if(r>o){q=o;o=r}}}else{l=o=p=q=c[i][0];for(k=1;k<n;k++){r=c[i][k];if(r<l){p=l;l=r}if(r>o){q=o;o=r}}}k=(o-q+(p-l))/2;f.min=l;f.max=o;f.step=k;f.categorical=false;if(g[i]){f.map=g[i].map;f.mapLength=g[i].len;f.categorical=g[i].categorical;if(!f.categorical){f.orgValue=[];k=g[i].map;for(var v in k)if(k.hasOwnProperty(v))f.orgValue[k[v]]=0+v}}}this.dimensionDescr=function(t,u){for(var w=
{},x=0;x<t.length;x++)w[t[x]]=u[x];return w}(this.dimensions,d)},_createCore:function(){function a(s){var y=s.dim;v[y].min=Math.max(q[y].domain()[0],q[y].invert(d-s.y-s.dy));v[y].max=Math.min(q[y].domain()[1],q[y].invert(d-s.y));t=y;x.render();return false}function b(s){if(s.dy<3){var y=s.dim;v[y].min=Math.max(q[y].domain()[0],q[y].invert(0));v[y].max=Math.min(q[y].domain()[1],q[y].invert(d));s.y=g;s.dy=i;t=y;x.render()}return false}var c=this;this.retrieveData();var d=this.height,e=this.chart.options.numDigits,
h=this.chart.options.topRuleOffset,g=this.chart.options.botRuleOffset,j=this.chart.options.leftRuleOffset,k=this.width-this.chart.options.rightRuleOffset,f=this.height-h,i=f-g,l=h-12,m=this.dimensions,n=this.dimensionDescr,o=function(s,y){var D=n[s].min,F=n[s].max;s=n[s].step;if(y){D-=s;F+=s}return pv.Scale.linear(D,F).range(g,f)},p=pv.Scale.ordinal(m).splitFlush(j,k),q=pv.dict(m,function(s){var y=o(s,true).range(g,f),D=n[s];if(D.orgValue&&!D.categorical){s=function(F){return y(D.orgValue[F])};s.domain=
function(){return y.domain()};s.invert=function(F){return y.invert(F)};return s}return y}),r=pv.dict(m,function(s){return o(s,false).range("steelblue","brown")}),v=pv.dict(m,function(s){return{min:q[s].domain()[0],max:q[s].domain()[1]}}),t=m[0];j=this.chart.options.mapAllDimensions?function(s){return m.every(function(y){var D=n[y];D=D.orgValue&&!D.categorical?D.orgValue[s[y]]:s[y];return D>=v[y].min&&D<=v[y].max})}:function(s){return m.every(function(y){return s[y]>=v[y].min&&s[y]<=v[y].max})};this.pvParCoord=
this.pvPanel.add(pv.Panel).data(c.data).visible(j).add(pv.Line).data(m).left(function(s){return p(s)}).bottom(function(s,y){return q[s](y[s])}).strokeStyle("#ddd").lineWidth(1).antialias(false);this.pvPanel.add(pv.Rule).data(m).left(p).top(h).bottom(g).anchor("top").add(pv.Label).top(l).font("bold 10px sans-serif").text(function(s){return n[s].name});h=[];for(var u in n)if(n.hasOwnProperty(u)){l=n[u];if(l.categorical){k=p(l.id)+6;for(var w in l.map)if(l.map.hasOwnProperty(w))h[h.length]={x:k,y:q[l.id](l.map[w])+
3,label:w}}}this.pvPanel.add(pv.Panel).data(h).add(pv.Label).left(function(s){return s.x}).bottom(function(s){return s.y}).text(function(s){return s.label}).textAlign("left");var x=this.pvPanel.add(pv.Panel);x.add(pv.Panel).data(c.data).visible(j).add(pv.Line).data(m).left(function(s){return p(s)}).bottom(function(s,y){return q[s](y[s])}).strokeStyle(function(s,y){s=n[t];return r[t](s.orgValue&&!s.categorical?s.orgValue[y[t]]:y[t])}).lineWidth(1);c=x.add(pv.Panel).data(m.map(function(s){return{y:g,
dy:i,dim:s}})).left(function(s){return p(s.dim)-30}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",pv.Behavior.select()).event("select",a).event("selectend",b).add(pv.Bar).left(25).top(function(s){return s.y}).width(10).height(function(s){return s.dy}).fillStyle(function(s){return s.dim==t?r[s.dim]((v[s.dim].max+v[s.dim].min)/2):"hsla(0,0,50%,.5)"}).strokeStyle("white").cursor("move").event("mousedown",pv.Behavior.drag()).event("dragstart",a).event("drag",a);c.anchor("bottom").add(pv.Label).textBaseline("top").text(function(s){return n[s.dim].categorical?
"":v[s.dim].min.toFixed(e)+n[s.dim].unit});c.anchor("top").add(pv.Label).textBaseline("bottom").text(function(s){return n[s.dim].categorical?"":v[s.dim].max.toFixed(e)+n[s.dim].unit});this.extend(this.pvParCoord,"parCoord");this.extend(this.pvPanel,"chart")}});
def.type("pvc.DataTree",pvc.BaseChart).init(function(a){a=a||{};a.dimensionGroups=a.dimensionGroups||{};if(!a.dimensionGroups.value)a.dimensionGroups.value={valueType:null};this.base(a)}).add({structEngine:null,structMetadata:null,structDataset:null,DataTreePanel:null,_getColorRoleSpec:function(){return{isRequired:true,defaultSourceRole:"category",requireIsDiscrete:true}},setStructData:function(a){this.structDataset=a.resultset;this.structDataset.length||this._log("Warning: Structure-dataset is empty");
this.structMetadata=a.metadata;this.structMetadata.length||this._log("Warning: Structure-Metadata is empty")},_preRenderContent:function(a){var b=this.structEngine,c=b?b.type:new pvc.data.ComplexType;c.addDimension("value",{});var d=new pvc.data.CrosstabTranslationOper(c,this.structDataset,this.structMetadata,{seriesInRows:true,crosstabMode:true});d.configureType();if(!b)b=this.structEngine=new pvc.data.Data({type:c});b.load(d.execute(b));pvc.debug>=3&&this._log(this.structEngine.getInfo());this.dataTreePanel=
new pvc.DataTreePanel(this,this.basePanel,def.create(a,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,boxplotColor:this.options.boxplotColor,valueFontsize:this.options.valueFontsize,headerFontsize:this.options.headerFontsize,border:this.options.border,perpConnector:this.options.perpConnector,numDigits:this.options.numDigits,minVerticalSpace:this.options.minVerticalSpace,connectorSpace:this.options.connectorSpace,
minAspectRatio:this.options.minAspectRatio}))},defaults:{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,boxplotColor:"grey",headerFontsize:16,valueFontsize:20,border:2,perpConnector:false,numDigits:0,connectorSpace:0.15,minVerticalSpace:0.05,minAspectRatio:2}});
def.type("pvc.DataTreePanel",pvc.PlotPanel).add({pvDataTree:null,treeElements:null,structMap:null,structArr:null,hRules:null,vRules:null,rules:null,generatePerpConnectors:function(a){this.hRules=[];this.vRules=[];this.rules=[];for(var b in this.structMap){var c=this.structMap[b];if(c.children!=null){var d=+1E4,e=-10000,h=c.left+c.width;this.hRules.push({left:h,width:a,bottom:c.bottom+c.height/2});h+=a;for(var g in c.children){var j=this.structMap[c.children[g]],k=j.bottom+j.height/2;if(k>e)e=k;if(k<
d)d=k;this.hRules.push({left:h,width:j.left-h,bottom:k})}e>d&&this.vRules.push({left:h,bottom:d,height:e-d})}}},generateLineSegment:function(a,b,c,d){var e=[];e.push({x:a,y:b});e.push({x:c,y:d});this.rules.push(e)},generateConnectors:function(a){this.hRules=[];this.vRules=[];if(this.chart.options.perpConnector)this.generatePerpConnectors(a);else{this.rules=[];for(var b in this.structMap){var c=this.structMap[b];if(c.children!=null){var d,e,h,g=+1E4,j=-10000;for(h in c.children){e=this.structMap[c.children[h]];
d=e.bottom+e.height/2;if(d>j)j=d;if(d<g)g=d}g=(j+g)/2;d=c.left+c.width;j=d+a;this.generateLineSegment(d,c.bottom+c.height/2,j,g);for(h in c.children){e=this.structMap[c.children[h]];d=e.bottom+e.height/2;this.generateLineSegment(j,g,e.left,d)}}}}},retrieveStructure:function(){var a=this.chart.structEngine,b=this.chart.options,c=a.getVisibleCategories();this.treeElements=a.getVisibleSeries();a=a.getValues();c=c.length>4;var d;for(d in this.treeElements)this.treeElements[d]=$.trim(this.treeElements[d]);
var e=[];e.getElement=function(m){if(e[m]==null)e[m]={min:+1E4,max:-10000};return e[m]};e.addValue=function(m,n){m=e.getElement(m);if(n<m.min)m.min=n;if(n>m.max)m.max=n;return m};var h,g,j;for(d in this.treeElements){j=this.treeElements[d];h=j[0];g=h.charCodeAt(0);j=parseInt(j.slice(1),10);e.addValue("__cols",g);e.addValue(h,j)}h=e.getElement("__cols");var k=this.innerWidth/(h.max-h.min+1),f=k-b.connectorSpace*k;g=f/b.minAspectRatio;var i=h.min;delete e.__cols;for(d in e){h=e[d];if(typeof h!="function"){var l=
h.max-h.min+1;h.gridHeight=this.innerHeight/l;h.cellHeight=h.gridHeight*(1-b.minVerticalSpace);if(h.cellHeight>g)h.cellHeight=g;h.relBottom=(h.gridHeight-h.cellHeight)/2;h.numRows=l}}b=new RegExp("[\\s\"']+","g");this.structMap={};for(d in this.treeElements){l={};j=this.treeElements[d];l.box_id=j;this.structMap[j]=l;h=j[0];g=h.charCodeAt(0);j=parseInt(j.slice(1),10);h=e.getElement(h);l.colIndex=g-i;l.rowIndex=h.numRows-(j-h.min)-1;l.left=this.leftOffs+l.colIndex*k;l.width=f;if(c){l.bottom=a[4][d];
l.height=a[5][d]}else{l.bottom=this.botOffs+l.rowIndex*h.gridHeight+h.relBottom;l.height=h.cellHeight}l.label=a[0][d];l.selector=a[1][d];l.aggregation=a[2][d];g=(a[3][d]||"").replace(b," ");l.children=g===" "||g===""?null:g.split(" ")}this.generateConnectors((k-f)/2);this.structArr=[];for(d in this.structMap){j=this.structMap[d];this.structArr.push(j)}},findDataValue:function(a,b){for(var c=0;c<b[0].length;c++)if(b[0][c]==a)return b[1][c];this._log("Error: value with key : "+a+" not found.")},generateBoxPlots:function(){var a=
this.chart.options;for(var b in this.structArr){var c=this.structArr[b];if(c.values.length){c.subplot={};var d=c.subplot,e=[],h=c.width/6;d.hRules=[];d.vRules=[];d.marks=[];d.labels=[];e.push(this.findDataValue("_p5",c.values));e.push(this.findDataValue("_p25",c.values));e.push(this.findDataValue("_p50",c.values));e.push(this.findDataValue("_p75",c.values));e.push(this.findDataValue("_p95",c.values));var g=false;if(typeof e[2]!="undefined"){if(e[4]<e[0]){e=e.reverse();this._log(" dataset "+c.box_id+
" repaired (_p95 was smaller than _p5)")}if(e[4]>e[0])d.hScale=pv.Scale.linear(e[0],e[4]);else{g=true;d.hScale=pv.Scale.linear(e[0]-1.0E-10,e[0]+1.0E-10)}d.hScale.range(c.left+h,c.left+c.width-h);h=""+e[2];var j;for(j=0;j<e.length;j++)e[j]=d.hScale(e[j]);d.bot=c.bottom+c.height/3;d.top=c.bottom+2*c.height/3;d.mid=(d.top+d.bot)/2;d.textBottom=c.bottom+15;d.textBottom=d.bot-a.valueFontsize-1;if(g)d.vRules.push({left:e[0],bottom:d.bot,lWidth:3,height:d.top-d.bot});else{d.hRules.push({left:e[0],width:e[1]-
e[0],lWidth:1,bottom:d.mid});d.hRules.push({left:e[1],width:e[3]-e[1],lWidth:1,bottom:d.bot});d.hRules.push({left:e[1],width:e[3]-e[1],lWidth:1,bottom:d.top});d.hRules.push({left:e[3],width:e[4]-e[3],lWidth:1,bottom:d.mid});for(j=0;j<e.length;j++)d.vRules.push({left:e[j],bottom:d.bot,lWidth:j==2?3:1,height:d.top-d.bot})}d.labels.push({left:e[2],bottom:d.textBottom,text:this.labelFixedDigits(h),size:a.smValueFont,color:a.boxplotColor})}}}},labelFixedDigits:function(a){if(typeof a=="string")a=parseFloat(a);
if(typeof a=="number")a=a.toFixed(this.chart.options.numDigits);return""+a},addDataPoint:function(a){var b=this.chart.options;for(var c in this.structArr){var d=this.structArr[c];if(d.values.length){var e=this.findDataValue(a,d.values);if(typeof e!="undefined"){d=d.subplot;var h=d.hScale(e);d.marks.push({left:h,bottom:d.mid,color:"green"});d.labels.push({left:h,bottom:d.textBottom,text:this.labelFixedDigits(e),size:b.valueFont,color:"green"})}}}},retrieveData:function(){var a=this.chart.data,b=this.chart.options;
a.getVisibleCategories();var c=a.getVisibleSeries();a=a.getValues();var d={},e,h=a.length;for(var g in this.structArr){var j=this.structArr[g];j.values=[];for(e=0;e<h;e++)j.values.push([]);d[j.selector]=j}g={};for(e in c){h=d[c[e]];if(typeof h!="undefined")for(var k in a)h.values[k].push(a[k][e]);else g[c[e]]=true}for(var f in g)this._log("Could'nt find box for selector: "+f);this.generateBoxPlots();c=new RegExp("[\\s\"']+","g");if(b.selectParam){b=b.selectParam.replace(c,"");if(b!="undefined"&&b.length>
0&&typeof window[b]!="undefined"){b=window[b];this.addDataPoint(b)}}},_createCore:function(){var a=this,b=this.chart.options;b.smValueFontsize=Math.round(0.6*b.valueFontsize);b.smValueFont=""+b.smValueFontsize+"px sans-serif";b.valueFont=""+b.valueFontsize+"px sans-serif";var c=b.topRuleOffset,d=b.botRuleOffset,e=b.leftRuleOffset;this.innerWidth=this.width-e-b.rightRuleOffset;this.innerHeight=this.height-c-d;this.botOffs=d;this.leftOffs=e;this.retrieveStructure();this.retrieveData();var h=b.headerFontsize+
3;d=this.rules;for(c=0;c<d.length;c++)this.pvPanel.add(pv.Line).data(d[c]).left(function(g){return g.x}).bottom(function(g){return g.y}).lineWidth(1).strokeStyle("black");this.pvDataTree=this.pvPanel.add(pv.Bar).data(a.structArr).left(function(g){return g.left}).bottom(function(g){return g.bottom}).height(function(g){return g.height}).width(function(g){return g.width}).fillStyle("green").add(pv.Bar).left(function(g){return g.left+b.border}).bottom(function(g){return g.bottom+b.border}).height(function(g){return g.height-
b.border-h}).width(function(g){return g.width-2*b.border}).fillStyle("white").add(pv.Label).text(function(g){return g.label}).textAlign("center").left(function(g){return g.left+g.width/2}).bottom(function(g){return g.bottom+g.height-b.headerFontsize-5+b.headerFontsize/5}).font(""+b.headerFontsize+"px sans-serif").textStyle("white").fillStyle("blue");for(c=0;c<this.structArr.length;c++){d=this.structArr[c];this.pvPanel.add(pv.Rule).data(d.subplot.hRules).left(function(g){return g.left}).width(function(g){return g.width}).bottom(function(g){return g.bottom}).lineWidth(function(g){return g.lWidth}).strokeStyle(a.chart.options.boxplotColor);
this.pvPanel.add(pv.Rule).data(d.subplot.vRules).left(function(g){return g.left}).height(function(g){return g.height}).bottom(function(g){return g.bottom}).lineWidth(function(g){return g.lWidth}).strokeStyle(a.chart.options.boxplotColor);this.pvPanel.add(pv.Dot).data(d.subplot.marks).left(function(g){return g.left}).bottom(function(g){return g.bottom}).fillStyle(function(g){return g.color});this.pvPanel.add(pv.Label).data(d.subplot.labels).left(function(g){return g.left}).bottom(function(g){return g.bottom}).font(function(g){return g.size}).text(function(g){return g.text}).textAlign("center").textStyle(function(g){return g.color})}if(b.perpConnector){this.pvPanel.add(pv.Rule).data(a.vRules).left(function(g){return g.left}).bottom(function(g){return g.bottom}).height(function(g){return g.height}).strokeStyle("black");
this.pvPanel.add(pv.Rule).data(a.hRules).left(function(g){return g.left}).bottom(function(g){return g.bottom}).width(function(g){return g.width}).strokeStyle("black")}},applyExtensions:function(){this.extend(this.pvDataTree,"dataTree")}});
def.type("pvc.data.BoxplotChartTranslationOper").add({_configureTypeCore:function(){var a=[];this._getUnboundRoleDefaultDimNames("category",this.virtualItemSize()-this.M,a);pvc.BoxplotChart.measureRolesNames.forEach(function(b){this._getUnboundRoleDefaultDimNames(b,1,a)},this);a.slice(0,this.freeVirtualItemSize());a.length&&this.defReader({names:a})}});
def.type("pvc.BoxplotPanel",pvc.CategoricalAbstractPanel).init(function(a,b,c,d){this.base(a,b,c,d);this.boxSizeRatio=c.option("BoxSizeRatio");this.maxBoxSize=c.option("BoxSizeMax")}).add({plotType:"box",anchor:"fill",_v1DimRoleName:{value:"median"},_createCore:function(){function a(i){var l=this.base(i);return i==="stroke"?l.darker(1):l}function b(i){i.lock(g,function(){return this.pvMark.parent[j]()/2}).override("defaultColor",a);return i}function c(i){i.lock(g,function(l){return l.vars.category.boxLeft}).lock(j,
function(l){return l.vars.category.boxWidth});return i}function d(i){c(i);i.override("defaultColor",a);return i}this.base();var e=this._buildScene(),h=this.isOrientationVertical()?"bottom":"left",g=this.anchorOrtho(h),j=this.anchorLength(h),k=this.anchorOrthoLength(h),f=["panel"];this.compatVersion()<=1&&f.push("");this.pvBoxPanel=(new pvc.visual.Panel(this,this.pvPanel,{extensionId:f})).lock("data",e.childNodes).lockMark(g,function(i){i=i.vars.category;return i.x-i.width/2}).pvMark[j](function(i){return i.vars.category.width});
this.pvRuleWhiskerUpper=b(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept("visible",function(i){return i.vars.category.showRuleWhiskerUpper&&this.delegateExtension(true)}).lock(h,function(i){return i.vars.category.ruleWhiskerUpperBottom}).lock(k,function(i){return i.vars.category.ruleWhiskerUpperHeight}).pvMark;this.pvRuleWhiskerLower=b(new pvc.visual.Rule(this,
this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept("visible",function(i){return i.vars.category.showRuleWhiskerBelow&&this.delegateExtension(true)}).lock(h,function(i){return i.vars.category.ruleWhiskerLowerBottom}).lock(k,function(i){return i.vars.category.ruleWhiskerLowerHeight}).pvMark;this.pvBar=c(new pvc.visual.Bar(this,this.pvBoxPanel,{extensionId:"boxBar",freePosition:true,normalStroke:true})).intercept("visible",
function(i){return i.vars.category.showBox&&this.delegateExtension(true)}).lock(h,function(i){return i.vars.category.boxBottom}).lock(k,function(i){return i.vars.category.boxHeight}).override("defaultColor",a).override("defaultStrokeWidth",def.fun.constant(1)).pvMark;this.pvRuleMin=d(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMin",freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept("visible",function(){return this.scene.vars.minimum.value!=
null&&this.delegateExtension(true)}).lock(h,function(){return this.scene.vars.minimum.position}).pvMark;this.pvRuleMax=d(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMax",freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept("visible",function(){return this.scene.vars.maximum.value!=null&&this.delegateExtension(true)}).lock(h,function(){return this.scene.vars.maximum.position}).pvMark;this.pvRuleMedian=d(new pvc.visual.Rule(this,
this.pvBoxPanel,{extensionId:"boxRuleMedian",freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept("visible",function(){return this.scene.vars.median.value!=null&&this.delegateExtension(true)}).lock(h,function(){return this.scene.vars.median.position}).override("defaultStrokeWidth",def.fun.constant(2)).pvMark},renderInteractive:function(){this.pvBoxPanel.render()},_buildScene:function(){function a(l){var m=new pvc.visual.Scene(h,{group:l}),
n=m.vars;n.series=new pvc.visual.ValueLabelVar(null,"");var o=n.category=new pvc.visual.ValueLabelVar(l.value,l.label);def.set(o,"group",l,"x",g(l.value),"width",j,"boxWidth",k,"boxLeft",j/2-k/2);b.measureVisualRoles().forEach(function(w){var x=c[w.name],s;if(x){s=l.dimensions(x);x=s.sum(d);s=new pvc.visual.ValueLabelVar(x,s.format(x));s.position=f(x)}else{s=new pvc.visual.ValueLabelVar(null,"");s.position=null}n[w.name]=s});i.onNewScene(m,true);m=n.minimum.value!=null;var p=n.lowerQuartil.value!=
null,q=n.median.value!=null,r=n.upperQuartil.value!=null,v,t,u=p||r;if(u){v=p?n.lowerQuartil.position:q?n.median.position:n.upperQuartil.position;t=r?n.upperQuartil.position:q?n.median.position:n.lowerQuartil.position;if(u=t!==v){o.boxBottom=v;o.boxHeight=t-v}}o.showBox=u;if(u=n.maximum.value!=null){v=r?n.upperQuartil.position:q?n.median.position:p?n.lowerQuartil.position:m?n.minimum.position:null;if(u=v!=null){o.ruleWhiskerUpperBottom=v;o.ruleWhiskerUpperHeight=n.maximum.position-v}}o.showRuleWhiskerUpper=
u;if(u=m){t=p?n.lowerQuartil.position:q?n.median.position:r?n.upperQuartil.position:null;if(u=t!=null){v=n.minimum.position;o.ruleWhiskerLowerHeight=t-v;o.ruleWhiskerLowerBottom=v}}o.showRuleWhiskerBelow=u}var b=this.chart,c=def.query(b.measureVisualRoles()).object({name:function(l){return l.name},value:function(l){return l.firstDimensionName()}}),d={visible:true,zeroIfNone:false},e=this.visibleData(),h=new pvc.visual.Scene(null,{panel:this,group:e}),g=this.axes.base.scale,j=g.range().band,k=Math.min(j*
this.boxSizeRatio,this.maxBoxSize),f=this.axes.ortho.scale,i=new pvc.visual.RoleVarHelper(h,this.visualRoles.color,{roleVar:"color"});e.children().each(a,this);return h}});
def.type("pvc.BoxplotChart",pvc.CategoricalAbstract).add({_processOptionsCore:function(a){this.base.apply(this,arguments);a.stacked=false},_initVisualRoles:function(){this.base();var a={isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number};[{name:"median",label:"Median",defaultDimension:"median",isRequired:true},{name:"lowerQuartil",label:"Lower Quartil",defaultDimension:"lowerQuartil"},{name:"upperQuartil",label:"Upper Quartil",defaultDimension:"upperQuartil"},{name:"minimum",
label:"Minimum",defaultDimension:"minimum"},{name:"maximum",label:"Maximum",defaultDimension:"maximum"}].forEach(function(b){this._addVisualRole(b.name,def.create(a,b))},this)},_getTranslationClass:function(a){return def.type(this.base(a)).add(pvc.data.BoxplotChartTranslationOper)},_initPlotsCore:function(){new pvc.visual.BoxPlot(this);if(this.options.plot2){this._animatable=true;new pvc.visual.PointPlot(this,{name:"plot2",defaults:{LinesVisible:true,DotsVisible:true,OrthoRole:"median",ColorAxis:2},
fixed:{OrthoAxis:1}})}},_bindAxes:function(a){this.base(a);(a=this.axesByType.ortho)&&a.forEach(function(b){b.option.defaults({Offset:0.02})})},_createPlotPanels:function(a,b){var c=this.plots;this.bpChartPanel=new pvc.BoxplotPanel(this,a,c.box,Object.create(b));if(c=c.plot2){pvc.debug>=3&&this._log("Creating Point panel.");(new pvc.PointPanel(this,a,c,Object.create(b)))._v1DimRoleName.value=c.option("OrthoRole")}},defaults:{crosstabMode:false}}).addStatic({measureRolesNames:["median","lowerQuartil",
"upperQuartil","minimum","maximum"]});
